<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="keywords" content="Hexo Theme Keep">
    <meta name="description" content="Hexo Theme Keep">
    <meta name="author" content="zsk">
    <meta name="baidu-site-verification" content="codeva-FDuSf8Qgto" />
    
    <title>
        
            Unidbgæ“ä½œè¯´æ˜ |
        
        zskã®blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
        <link rel="shortcut icon" href="/images/logo.svg">
    
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/font/css/fontawesome.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/font/css/regular.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/font/css/solid.min.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/font/css/brands.min.css">
    
        
            
        
    
    <script class="keep-theme-configurations">
    const KEEP = window.KEEP || {}
    KEEP.hexo_config = {"hostname":"www.zskkk.cn","root":"/","language":"zh-CN","path":"search.json"}
    KEEP.theme_config = {"toc":{"enable":true,"number":true,"expand_all":true,"init_open":true,"layout":"right"},"style":{"primary_color":"#0066cc","logo":"/images/logo.svg","favicon":"/images/logo.svg","avatar":"/images/head.svg","first_screen":{"enable":true,"header_transparent":true,"background_img":"/images/bg.svg","description":"Keep writing and Keep loving.","hitokoto":true},"scroll":{"progress_bar":true,"percent":true}},"local_search":{"enable":true,"preload":true},"code_block":{"tools":{"enable":true,"style":"mac"},"highlight_theme":"obsidian"},"pjax":{"enable":true},"lazyload":{"enable":true},"comment":{"enable":true,"use":"valine","valine":{"appid":"WxNQs5QEQtykF82Sb7nAjXRO-gzGzoHsz","appkey":"4rZ6NwH5zAu6VEspHwVrgqOq","server_urls":null,"placeholder":"ğŸ˜œ å°½æƒ…åæ§½å§~"},"gitalk":{"github_id":null,"github_admins":null,"repository":null,"client_id":null,"client_secret":null,"proxy":null},"twikoo":{"env_id":null,"region":null,"version":"1.6.21"},"waline":{"server_url":null,"reaction":false,"version":2},"giscus":{"repo":null,"repo_id":null,"category":"Announcements","category_id":null,"reactions_enabled":false}},"post":{"author_label":{"enable":true,"auto":true,"custom_label_list":["Trainee","Engineer","Architect"]},"word_count":{"wordcount":true,"min2read":true},"datetime_format":"YYYY-MM-DD HH:mm:ss","copyright_info":true,"share":true,"reward":{"enable":false,"img_link":null,"text":null}},"website_count":{"busuanzi_count":{"enable":true,"site_uv":true,"site_pv":true,"page_pv":true}},"version":"3.8.1"}
    KEEP.language_ago = {"second":"%s ç§’å‰","minute":"%s åˆ†é’Ÿå‰","hour":"%s å°æ—¶å‰","day":"%s å¤©å‰","week":"%s å‘¨å‰","month":"%s ä¸ªæœˆå‰","year":"%s å¹´å‰"}
    KEEP.language_code_block = {"copy":"å¤åˆ¶ä»£ç ","copied":"å·²å¤åˆ¶","fold":"æŠ˜å ä»£ç å—","folded":"å·²æŠ˜å "}
    KEEP.language_copy_copyright = {"copy":"å¤åˆ¶ç‰ˆæƒä¿¡æ¯","copied":"å·²å¤åˆ¶","title":"åŸæ–‡æ ‡é¢˜","author":"åŸæ–‡ä½œè€…","link":"åŸæ–‡é“¾æ¥"}
  </script>
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
</head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <i class="pjax-progress-icon fas fa-circle-notch fa-spin"></i>
    
</div>


<main class="page-container border-box">

    <!-- home first screen  -->
    

    <!-- page content -->
    <div class="page-main-content border-box">
        <div class="page-main-content-top">
            
<header class="header-wrapper">

    <div class="border-box header-content">
        <div class="left border-box">
            
                <a class="logo-image border-box" href="/">
                    <img src="/images/logo.svg">
                </a>
            
            <a class="site-name border-box" href="/">
               zskã®blog
            </a>
        </div>

        <div class="right border-box">
            <div class="pc">
                <ul class="menu-list">
                    
                        <li class="menu-item">
                            <a class=""
                               href="/"
                            >
                                é¦–é¡µ
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/archives"
                            >
                                å½’æ¡£
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/tags"
                            >
                                æ ‡ç­¾
                            </a>
                        </li>
                    
                        <li class="menu-item">
                            <a class=""
                               href="/about"
                            >
                                å…³äº
                            </a>
                        </li>
                    
                    
                        <li class="menu-item search search-popup-trigger">
                            <i class="fas fa-search"></i>
                        </li>
                    
                </ul>
            </div>
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div>
                
                <div class="icon-item menu-bar">
                    <div class="menu-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="header-drawer">
        <ul class="drawer-menu-list">
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/">é¦–é¡µ</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/archives">å½’æ¡£</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/tags">æ ‡ç­¾</a>
                </li>
            
                <li class="drawer-menu-item flex-center">
                    <a class=""
                       href="/about">å…³äº</a>
                </li>
            
        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="page-main-content-middle border-box">

            <div class="main-content border-box">

                

                    <div class="fade-in-down-animation">
    <div class="post-page-container border-box">

        <div class="article-content-container border-box">

            

            <div class="article-content-bottom border-box">
                
                    <div class="article-title">
                        Unidbgæ“ä½œè¯´æ˜
                    </div>
                

                
                    <div class="article-header border-box">
                        
                            <div class="avatar-box border-box">
                                <img src="/images/head.svg">
                            </div>
                        
                        <div class="info-box">
                            <div class="author">
                                <span class="name">zsk</span>
                                
                                    <span class="author-label">Lv4</span>
                                
                            </div>
                            <div class="meta-info border-box">
                                

<div class="article-meta-info-container border-box post">
    <div class="article-meta-info border-box">
        


        
            <span class="meta-info-item article-create-date">
                <i class="icon fa-solid fa-calendar-check"></i>&nbsp;
                <span class="pc">2022-10-19 00:00:00</span>
                <span class="mobile">2022-10-19 00:00</span>
            </span>

            <span class="meta-info-item article-update-date">
                <i class="icon fa-solid fa-file-pen"></i>&nbsp;
                <span class="pc" data-updated="Wed Oct 19 2022 00:00:00 GMT+0800">2022-10-19 00:00:00</span>
            </span>
        

        

        
            <span class="article-tag meta-info-item border-box">
                <i class="icon fas fa-tags"></i>&nbsp;
                <ul>
                    
                            <li class="tag-item"><span class="tag-separator"><i class="icon fas fa-hashtag"></i></span><a href="/tags/Unidbg/">Unidbg</a></li>
                        
                    
                </ul>
            </span>
        

        
        
            <span class="meta-info-item article-wordcount">
                <i class="icon fas fa-file-word"></i>&nbsp;<span>17.5k å­—</span>
            </span>
        
        
            <span class="meta-info-item article-min2read">
                <i class="icon fas fa-clock"></i>&nbsp;<span>79 åˆ†é’Ÿ</span>
            </span>
        
        
            <span class="meta-info-item article-pv">
                <i class="icon fas fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
            </span>
        
    </div>

    
</div>

                            </div>
                        </div>
                    </div>
                

                <div class="article-content keep-markdown-body">
                    

                    <h2 id="è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™"><a href="#è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™" class="headerlink" title="è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™"></a>è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™</h2><ol>
<li>å¸¸è§„objectï¼Œæ¯”å¦‚jstringï¼Œjarrayä½¿ç”¨Unidbgå°è£…çš„API</li>
<li>é™¤æ­¤ä¹‹å¤–çš„jobjectä½¿ç”¨vm.resolveClass(className).newObject(object)ï¼Œjclassä½¿ç”¨vm.resolveClass(className)</li>
<li>å¦‚æœobjectä¸å¯å¾—ï¼Œä¼ ç©º&#x2F;æ–¹æ³•ç­¾å&#x2F;æ ‡è¯†</li>
</ol>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><a href="#AndroidEmulator">AndroidEmulator</a><ul>
<li><a href="#AndroidEmulator%E4%BB%8B%E7%BB%8D">AndroidEmulatorä»‹ç»</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAAndroidEmulator%E5%AE%9E%E4%BE%8B">åˆ›å»ºAndroidEmulatorå®ä¾‹</a></li>
<li><a href="#AndroidEmulator%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3">AndroidEmulatoræ“ä½œæ¥å£</a><ul>
<li><a href="#getMemory">getMemory</a></li>
<li><a href="#createDalvikVM">createDalvikVM</a></li>
<li><a href="#loadLibrary">loadLibrary</a></li>
<li><a href="#getDalvikVM">getDalvikVM</a></li>
<li><a href="#showRegs">showRegs</a></li>
<li><a href="#getBackend">getBackend</a></li>
<li><a href="#getPid">getPid</a></li>
<li><a href="#getProcessName">getProcessName</a></li>
<li><a href="#getContext">getContext</a></li>
<li><a href="#isRunning">isRunning</a></li>
<li><a href="#Trace">Trace</a></li>
<li><a href="#et-x2F-Get">Set&#x2F;Get</a></li>
<li><a href="#SyscallHandler">SyscallHandler</a></li>
<li><a href="#Debugger">Debugger</a></li>
<li><a href="#emulateSignal">emulateSignal</a></li>
<li><a href="#disassemble">disassemble</a></li>
<li><a href="#close">close</a></li>
<li><a href="#getUnwinder">getUnwinder</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Memory">Memory</a><ul>
<li><a href="#Memory%E4%BB%8B%E7%BB%8D">Memoryä»‹ç»</a></li>
<li><a href="#Memory%E6%93%8D%E4%BD%9C">Memoryæ“ä½œ</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Memory%E5%AE%9E%E4%BE%8B">è·å–Memoryå®ä¾‹</a></li>
<li><a href="#setLibraryResolver">setLibraryResolver</a></li>
<li><a href="#findModule">findModule</a></li>
<li><a href="#allocateStack">allocateStack</a></li>
<li><a href="#malloc">malloc</a></li>
<li><a href="#setErrno">setErrno</a></li>
<li><a href="#getStackPoint">getStackPoint</a></li>
<li><a href="#disableCallInitFunction">disableCallInitFunction</a></li>
<li><a href="#getMemoryMap">getMemoryMap</a></li>
<li><a href="#pointer">pointer</a></li>
<li><a href="#addModuleListener">addModuleListener</a></li>
<li><a href="#load">load</a></li>
</ul>
</li>
<li><a href="#Memory%E6%80%BB%E7%BB%93">Memoryæ€»ç»“</a></li>
</ul>
</li>
<li><a href="#VM">VM</a><ul>
<li><a href="#VM%E4%BB%8B%E7%BB%8D">VMä»‹ç»</a></li>
<li><a href="#VM%E4%BB%8B%E7%BB%8D">VMä»‹ç»</a></li>
<li><a href="#VM%E6%8E%A5%E5%8F%A3">VMæ¥å£</a><ul>
<li><a href="#%E6%97%A5%E5%BF%97%E6%8E%A7%E5%88%B6">æ—¥å¿—æ§åˆ¶</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AEJNI">è®¾ç½®JNI</a></li>
<li><a href="#%E8%B0%83%E7%94%A8JNI_OnLoad%E5%87%BD%E6%95%B0">è°ƒç”¨JNI_OnLoadå‡½æ•°</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%9E%E4%BE%8B">è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96APK%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF">è·å–APKç›¸å…³ä¿¡æ¯</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97">åŠ è½½æ¨¡å—</a></li>
</ul>
</li>
<li><a href="#VM%E6%80%BB%E7%BB%93">VMæ€»ç»“</a></li>
</ul>
</li>
<li><a href="#CallMethod">CallMethod</a><ul>
<li><a href="#%E6%89%A7%E8%A1%8CJNI%E5%87%BD%E6%95%B0">æ‰§è¡ŒJNIå‡½æ•°</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%87%BD%E6%95%B0">æ‰§è¡Œä»»æ„å‡½æ•°</a></li>
<li><a href="#%E6%89%A7%E8%A1%8Cmain%E5%87%BD%E6%95%B0">æ‰§è¡Œmainå‡½æ•°</a></li>
<li><a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNIæ–¹æ³•å°è£…</a><ul>
<li><a href="#void">void</a></li>
<li><a href="#boolean">boolean</a></li>
<li><a href="#int">int</a></li>
<li><a href="#long">long</a></li>
<li><a href="#float">float</a></li>
<li><a href="#double">double</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B">å¯¹è±¡ç±»å‹</a></li>
</ul>
</li>
<li><a href="#JNI%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D">JNIæ–¹æ³•ç­¾å</a></li>
</ul>
</li>
<li><a href="#Hook">Hook</a><ul>
<li><a href="#Hook%E4%BB%8B%E7%BB%8D">Hookä»‹ç»</a></li>
<li><a href="#Hook%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB">Hookæ¡†æ¶åˆ†ç±»</a><ul>
<li><a href="#HookZz">HookZz</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96HookZz%E5%AE%9E%E4%BE%8B">è·å–HookZzå®ä¾‹</a></li>
<li><a href="#HookZz-API">HookZz API</a><ul>
<li><a href="#wrap">wrap</a></li>
<li><a href="#replace">replace</a></li>
<li><a href="#instrument">instrument</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Dobby">Dobby</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Dobby%E5%AE%9E%E4%BE%8B">è·å–Dobbyå®ä¾‹</a></li>
<li><a href="#Dobby-API">Dobby API</a><ul>
<li><a href="#replace-1">replace</a></li>
<li><a href="#instrument">instrument</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xHook">xHook</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96xHook%E5%AE%9E%E4%BE%8B">è·å–xHookå®ä¾‹</a></li>
<li><a href="#xHook-API">xHook API</a><ul>
<li><a href="#register">register</a></li>
<li><a href="#refresh">refresh</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Whale">Whale</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Whale%E5%AE%9E%E4%BE%8B">è·å–Whaleå®ä¾‹</a></li>
<li><a href="#Whale-API">Whale API</a></li>
</ul>
</li>
<li><a href="#patch">patch</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#JNI">JNI</a><ul>
<li><a href="#JNI%E4%BB%8B%E7%BB%8D">JNIä»‹ç»</a></li>
<li><a href="#%E7%B1%BB-x2F-%E7%B1%BB%E5%9E%8B">ç±»&#x2F;ç±»å‹</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B">å¯¹è±¡&#x2F;å®ä¾‹</a></li>
<li><a href="#%E5%8C%85%E8%A3%85%E5%AF%B9%E8%B1%A1">åŒ…è£…å¯¹è±¡</a><ul>
<li><a href="#String">String</a></li>
<li><a href="#Array">Array</a></li>
<li><a href="#List">List</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Module">Module</a><ul>
<li><a href="#Module%E4%BB%8B%E7%BB%8D">Moduleä»‹ç»</a></li>
<li><a href="#Module%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7">Moduleå¸¸ç”¨çš„å±æ€§</a><ul>
<li><a href="#base">base</a></li>
<li><a href="#name">name</a></li>
<li><a href="#callEntry">callEntry</a></li>
<li><a href="#findSymbolByName">findSymbolByName</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Backend">Backend</a><ul>
<li><a href="#Backend%E4%BB%8B%E7%BB%8D">Backendä»‹ç»</a></li>
<li><a href="#Backend%E5%88%97%E8%A1%A8">Backendåˆ—è¡¨</a><ul>
<li><a href="#Unicorn-x2F-Unicorn2">Unicorn&#x2F;Unicorn2</a><ul>
<li>ä½¿ç”¨Unicorn2åç«¯:</li>
<li>Unicornåç«¯ç‰¹ç‚¹</li>
</ul>
</li>
<li><a href="#Dynarmic">Dynarmic</a><ul>
<li>ä½¿ç”¨Dynarmicåç«¯</li>
<li>Dynarmicåç«¯ç‰¹ç‚¹</li>
</ul>
</li>
<li><a href="#Hypervisor">Hypervisor</a><ul>
<li>ä½¿ç”¨Hypervisoråç«¯</li>
<li>Hypervisoråç«¯ç‰¹ç‚¹</li>
</ul>
</li>
<li><a href="#Kvm">Kvm</a><ul>
<li>ä½¿ç”¨Kvmåç«¯</li>
<li>Kvmåç«¯ç‰¹ç‚¹</li>
</ul>
</li>
</ul>
</li>
<li><a href="#Backend%E6%8E%A5%E5%8F%A3">Backendæ¥å£</a></li>
</ul>
</li>
<li><a href="#yxDebuggerRMm">Debugger</a><ul>
<li><a href="#Debugger%E4%BB%8B%E7%BB%8D">Debuggerä»‹ç»</a></li>
<li><a href="#ConsoleDebugger">ConsoleDebugger</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4">ä½¿ç”¨æ­¥éª¤</a></li>
<li><a href="#%E8%B0%83%E8%AF%95%E6%8C%87%E4%BB%A4">è°ƒè¯•æŒ‡ä»¤</a></li>
</ul>
</li>
<li><a href="#GDB_SERVER">GDB_SERVER</a></li>
<li><a href="#ANDROID_SERVER_V7">ANDROID_SERVER_V7</a></li>
<li><a href="#Block">Block</a></li>
</ul>
</li>
<li><a href="#SyscallHandler">SyscallHandler</a><ul>
<li><a href="#SyscallHandler%E4%BB%8B%E7%BB%8D">SyscallHandlerä»‹ç»</a></li>
<li><a href="#API">API</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96SyscallHandler%E5%AE%9E%E4%BE%8B">è·å–SyscallHandlerå®ä¾‹</a></li>
<li><a href="#setVerbose">setVerbose</a></li>
<li><a href="#addIOResolver">addIOResolver</a></li>
<li><a href="#setEnableThreadDispatcher">setEnableThreadDispatcher</a></li>
<li><a href="#setFileListener">setFileListener</a></li>
<li><a href="#getFileIO">getFileIO</a></li>
</ul>
</li>
<li><a href="#%E8%87%AA%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8">è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨</a></li>
<li><a href="#FileResult">FileResult</a><ul>
<li>success</li>
<li>failed</li>
<li>fallback</li>
</ul>
</li>
</ul>
</li>
<li><a href="#VirtualModule">VirtualModule</a><ul>
<li><a href="#VirtualModule%E4%BB%8B%E7%BB%8D">VirtualModuleä»‹ç»</a></li>
<li><a href="#unidbg%E8%87%AA%E5%B8%A6%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97">unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97">è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—</a><ul>
<li>æ¨¡æ‹Ÿåœºæ™¯</li>
<li>é¦–æ¬¡å°è¯•</li>
<li>å¤„ç†é—®é¢˜</li>
<li>å®Œæ•´ä»£ç </li>
</ul>
</li>
</ul>
</li>
<li><a href="#Jnitrace">Jnitrace</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8">ä½¿ç”¨</a></li>
<li><a href="#jnitrace%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E6%97%B6%E5%80%99">jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™</a></li>
<li><a href="#%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B">å †æ ˆæ£€æµ‹</a></li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">å‡½æ•°è°ƒç”¨çš„ä¸¤ç§æ–¹å¼</a><ul>
<li><a href="#%E7%AC%A6%E5%8F%B7%E8%B0%83%E7%94%A8">ç¬¦å·è°ƒç”¨</a></li>
<li><a href="#%E5%9C%B0%E5%9D%80%E8%B0%83%E7%94%A8">åœ°å€è°ƒç”¨</a></li>
</ul>
</li>
<li><a href="#%E6%9E%84%E5%BB%BA%E7%B1%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼</a></li>
<li><a href="#%E7%B1%BB%E7%BB%A7%E6%89%BF%E7%9A%84%E5%86%99%E6%B3%95">ç±»ç»§æ‰¿çš„å†™æ³•</a></li>
<li><a href="#unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7">unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E5%AE%9E%E7%8E%B0-IOResolver">æ–‡ä»¶é‡å®šå‘ï¼Œå®ç°-IOResolver</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD">ä¸€äº›å¸¸ç”¨åŠŸèƒ½</a></li>
<li><a href="#%E5%8F%8D%E5%88%B6unidbg">ååˆ¶unidbg</a></li>
<li><a href="#Unidbg%E6%8A%A5%E9%94%99">UnidbgæŠ¥é”™</a></li>
</ul>
<h2 id="åŸºæœ¬æ¡†æ¶"><a href="#åŸºæœ¬æ¡†æ¶" class="headerlink" title="åŸºæœ¬æ¡†æ¶"></a>åŸºæœ¬æ¡†æ¶</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">xxxx() &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹,è¿›ç¨‹åå»ºè®®ä¾ç…§å®é™…è¿›ç¨‹åå¡«å†™ï¼Œå¯ä»¥è§„é¿é’ˆå¯¹è¿›ç¨‹åçš„æ ¡éªŒ</span></span><br><span class="line">    emulator = AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;xxxxx&quot;</span>).build();</span><br><span class="line">    <span class="comment">// è·å–æ¨¡æ‹Ÿå™¨çš„å†…å­˜æ“ä½œæ¥å£</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">    <span class="comment">// è®¾ç½®ç³»ç»Ÿç±»åº“è§£æ</span></span><br><span class="line">    memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">    <span class="comment">// åˆ›å»ºAndroidè™šæ‹Ÿæœº,ä¼ å…¥APKï¼ŒUnidbgå¯ä»¥æ›¿æˆ‘ä»¬åšéƒ¨åˆ†ç­¾åæ ¡éªŒçš„å·¥ä½œ</span></span><br><span class="line">    vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apkè·¯å¾„&quot;</span>));</span><br><span class="line">    <span class="comment">// åŠ è½½ç›®æ ‡SO</span></span><br><span class="line">    <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;soè·¯å¾„&quot;</span>), <span class="literal">true</span>); <span class="comment">// åŠ è½½soåˆ°è™šæ‹Ÿå†…å­˜</span></span><br><span class="line">    <span class="comment">//è·å–æœ¬SOæ¨¡å—çš„å¥æŸ„,åç»­éœ€è¦ç”¨å®ƒ</span></span><br><span class="line">    <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">    vm.setJni(<span class="built_in">this</span>); <span class="comment">// è®¾ç½®JNI</span></span><br><span class="line">    vm.setVerbose(<span class="literal">true</span>); <span class="comment">// æ‰“å°æ—¥å¿—</span></span><br><span class="line"></span><br><span class="line">    dm.callJNI_OnLoad(emulator); <span class="comment">// è°ƒç”¨JNI OnLoad</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="AndroidEmulator"><a href="#AndroidEmulator" class="headerlink" title="AndroidEmulator"></a>AndroidEmulator</h2><h3 id="AndroidEmulatorä»‹ç»"><a href="#AndroidEmulatorä»‹ç»" class="headerlink" title="AndroidEmulatorä»‹ç»"></a>AndroidEmulatorä»‹ç»</h3><p>AndroidEmulatoræ˜¯ä¸€ä¸ªæŠ½è±¡çš„Androidæ¨¡æ‹Ÿå™¨æ¥å£ã€‚å®ƒä½œä¸ºä¸€ä¸ªæ¢çº½ï¼Œåè°ƒunidbgä¸­å¤§å¤šæ•°æ¨¡å—ç›¸äº’å·¥ä½œï¼Œè‡³å…³é‡è¦ã€‚æˆ‘ä»¬éœ€è¦çš„å¤§å¤šæ•°æ“ä½œä¹Ÿéƒ½éœ€è¦å€ŸåŠ©äºå®ƒã€‚</p>
<h3 id="åˆ›å»ºAndroidEmulatorå®ä¾‹"><a href="#åˆ›å»ºAndroidEmulatorå®ä¾‹" class="headerlink" title="åˆ›å»ºAndroidEmulatorå®ä¾‹"></a>åˆ›å»ºAndroidEmulatorå®ä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AndroidEmulator</span> <span class="variable">build</span> <span class="operator">=</span> AndroidEmulatorBuilder</span><br><span class="line">    <span class="comment">// æŒ‡å®š32ä½CPU</span></span><br><span class="line">    .for32Bit()</span><br><span class="line">    <span class="comment">// æ·»åŠ åç«¯ï¼Œæ¨èä½¿ç”¨Dynarmicï¼Œè¿è¡Œé€Ÿåº¦å¿«ï¼Œä½†å¹¶ä¸æ”¯æŒæŸäº›æ–°ç‰¹æ€§</span></span><br><span class="line">    .addBackendFactory(<span class="keyword">new</span> <span class="title class_">DynarmicFactory</span>(<span class="literal">true</span>))</span><br><span class="line">    <span class="comment">// æŒ‡å®šè¿›ç¨‹åï¼Œæ¨èä»¥å®‰å“åŒ…ååšä¸ºè¿›ç¨‹å</span></span><br><span class="line">    .setProcessName(<span class="string">&quot;com.github.unidbg&quot;</span>)</span><br><span class="line">    <span class="comment">// è®¾ç½®æ ¹è·¯å¾„</span></span><br><span class="line">    .setRootDir(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/rootfs/default&quot;</span>))</span><br><span class="line">    <span class="comment">// ç”ŸæˆAndroidEmulatorå®ä¾‹</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<h3 id="AndroidEmulatoræ“ä½œæ¥å£"><a href="#AndroidEmulatoræ“ä½œæ¥å£" class="headerlink" title="AndroidEmulatoræ“ä½œæ¥å£"></a>AndroidEmulatoræ“ä½œæ¥å£</h3><h4 id="getMemory"><a href="#getMemory" class="headerlink" title="getMemory"></a>getMemory</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å†…å­˜æ“ä½œæ¥å£</span></span><br><span class="line"><span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br></pre></td></tr></table></figure>
<p>è·å–å†…å­˜æ“ä½œæ¥å£ï¼Œå…³äºMemoryæ¥å£ä»‹ç»æŸ¥çœ‹<a href="#Memory">Memory</a>ã€‚</p>
<h4 id="getPid"><a href="#getPid" class="headerlink" title="getPid"></a>getPid</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è¿›ç¨‹pid</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pid</span> <span class="operator">=</span> emulator.getPid();</span><br></pre></td></tr></table></figure>

<h4 id="createDalvikVM"><a href="#createDalvikVM" class="headerlink" title="createDalvikVM"></a>createDalvikVM</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºè™šæ‹Ÿæœº</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.createDalvikVM();</span><br><span class="line"><span class="comment">// åˆ›å»ºè™šæ‹Ÿæœºå¹¶æŒ‡å®šAPKæ–‡ä»¶</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apk file path&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>åˆ›å»ºè™šæ‹Ÿæœºï¼Œå…³äºVMçš„æ¥å£æŸ¥çœ‹<a href="#VM">VMä»‹ç»</a></p>
<h4 id="loadLibrary"><a href="#loadLibrary" class="headerlink" title="loadLibrary"></a>loadLibrary</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸€: Soæˆ–å¯æ‰§è¡ŒELFæ–‡ä»¶</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: æ˜¯å¦å¼ºåˆ¶æ‰§è¡ŒInitåˆå§‹åŒ–ç³»åˆ—å‡½æ•°</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Elfæ–‡ä»¶è·¯å¾„&quot;</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//çœç•¥å‚æ•°äºŒï¼Œé»˜è®¤ä¸ºfalse</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Elfæ–‡ä»¶è·¯å¾„&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="getDalvikVM"><a href="#getDalvikVM" class="headerlink" title="getDalvikVM"></a>getDalvikVM</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å·²åˆ›å»ºçš„è™šæ‹Ÿæœº</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.getDalvikVM();</span><br></pre></td></tr></table></figure>
<p>è·å–å·²åˆ›å»ºçš„è™šæ‹Ÿæœºã€‚</p>
<h4 id="showRegs"><a href="#showRegs" class="headerlink" title="showRegs"></a>showRegs</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰“å°æ‰€æœ‰å¯„å­˜å™¨ä¿¡æ¯</span></span><br><span class="line">emulator.showRegs();</span><br><span class="line"><span class="comment">//æ‰“å°æŒ‡å®šå¯„å­˜å™¨ä¿¡æ¯</span></span><br><span class="line">emulator.showRegs(ArmConst.UC_ARM_REG_R0, ArmConst.UC_ARM_REG_R1);</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å½“å‰å¯„å­˜å™¨ä¿¡æ¯ã€‚</p>
<h4 id="getBackend"><a href="#getBackend" class="headerlink" title="getBackend"></a>getBackend</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–åç«¯CPU</span></span><br><span class="line">Backend backend = emulator.getBackend();</span><br></pre></td></tr></table></figure>
<p>è·å–åç«¯ï¼Œå…³äºåç«¯è¯·æŸ¥çœ‹<a href="#Backend">Backend</a>ä»‹ç»</p>
<h4 id="getProcessName"><a href="#getProcessName" class="headerlink" title="getProcessName"></a>getProcessName</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–è¿›ç¨‹å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">processName</span> <span class="operator">=</span> emulator.getProcessName();</span><br></pre></td></tr></table></figure>
<p>è·å–è¿›ç¨‹åã€‚</p>
<h4 id="getContext"><a href="#getContext" class="headerlink" title="getContext"></a>getContext</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–å¯„å­˜å™¨</span></span><br><span class="line">RegisterContext context = emulator.getContext();</span><br></pre></td></tr></table></figure>
<p>è·å–å¯„å­˜å™¨ä¸Šä¸‹æ–‡ï¼Œå…³äºå¯„å­˜å™¨ä¸Šä¸‹æ–‡ä»‹ç»è¯·æŸ¥çœ‹<a href="#RegisterContext">RegisterContextä»‹ç»</a>ã€‚</p>
<h4 id="isRunning"><a href="#isRunning" class="headerlink" title="isRunning"></a>isRunning</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ˜¯å¦æ­£åœ¨è¿è¡Œ</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> emulator.isRunning();</span><br></pre></td></tr></table></figure>
<p>æ˜¯å¦æ­£åœ¨è¿è¡Œã€‚</p>
<h4 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Traceæ±‡ç¼–æŒ‡ä»¤</span></span><br><span class="line">emulator.traceCode();</span><br><span class="line"><span class="comment">//æŒ‡å®šèµ·å§‹ç»“æŸèŒƒå›´Traceæ±‡ç¼–æŒ‡ä»¤ã€‚</span></span><br><span class="line">emulator.traceCode(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//å¸¦å›è°ƒçš„Traceï¼Œæ¯æ¡æŒ‡ä»¤éƒ½ä¼šå›è°ƒonInstructionæ–¹æ³•</span></span><br><span class="line">emulator.traceCode(<span class="number">1</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">TraceCodeListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onInstruction</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address, Instruction insn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mnemonic</span> <span class="operator">=</span> insn.getMnemonic();</span><br><span class="line">        <span class="keyword">if</span> (mnemonic.equals(<span class="string">&quot;svc&quot;</span>) || mnemonic.equals(<span class="string">&quot;swi&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;0x&quot;</span>+Long.toHexString(address)+<span class="string">&quot;æ‰§è¡Œäº†svcæŒ‡ä»¤&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Traceè¯»å†…å­˜</span></span><br><span class="line">emulator.traceRead();</span><br><span class="line"><span class="comment">// emulator.traceRead(èµ·å§‹åœ°å€ï¼Œç»“æŸåœ°å€);  // å“ªé‡Œåšäº†è¯»å–</span></span><br><span class="line"><span class="comment">//Traceå†™å†…å­˜</span></span><br><span class="line">emulator.traceWrite(); </span><br><span class="line"><span class="comment">// emulator.traceWrite(èµ·å§‹åœ°å€ï¼Œç»“æŸåœ°å€);  // å“ªé‡Œåšäº†èµ‹å€¼</span></span><br></pre></td></tr></table></figure>
<p><strong>æ³¨æ„ï¼šTraceåŠŸèƒ½ä»…æ”¯æŒUnicornåç«¯å¼•æ“</strong><br />å¦‚ä½¿ç”¨å¸¦èŒƒå›´çš„Traceï¼Œèµ·å§‹ä½ç½®å¤§äºç»“æŸä½ç½®å°†å…¨éƒ¨è¿›è¡ŒTraceã€‚ä¸æ— å‚æ–¹æ³•ä½œç”¨ç›¸åŒã€‚æ¯ç§Traceéƒ½åŒ…å«äº†ä¸‰ç§é‡è½½ï¼Œå‚ç…§traceCode()å³å¯ã€‚<br /></p>
<h4 id="Set-x2F-Get"><a href="#Set-x2F-Get" class="headerlink" title="Set&#x2F;Get"></a>Set&#x2F;Get</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">emulator.set(<span class="string">&quot;Test&quot;</span>,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> emulator.&lt;DocTest&gt;get(<span class="string">&quot;Test&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>emulatorå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªMapï¼Œå¦‚æœ‰å…¨å±€çš„å¯¹è±¡éœ€è¦å­˜å‚¨ï¼Œå¯å€ŸåŠ©è¿™ä¸¤ä¸ªAPIæ¥æ“ä½œï¼Œæ— éœ€é¢å¤–ç»´æŠ¤Mapå¯¹è±¡</p>
<h4 id="SyscallHandler"><a href="#SyscallHandler" class="headerlink" title="SyscallHandler"></a>SyscallHandler</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SyscallHandler&lt;AndroidFileIO&gt; syscallHandler = emulator.getSyscallHandler();</span><br></pre></td></tr></table></figure>
<p>è·å–ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨ï¼Œå…¶APIè¯·æŸ¥çœ‹<a href="#SyscallHandler-1">SyscallHandlerä»‹ç»</a>ã€‚</p>
<h4 id="Debugger"><a href="#Debugger" class="headerlink" title="Debugger"></a>Debugger</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ— å‚é»˜è®¤CONSOLEè°ƒè¯•å™¨</span></span><br><span class="line"><span class="type">Debugger</span> <span class="variable">attach</span> <span class="operator">=</span> emulator.attach();</span><br><span class="line"><span class="comment">//æŒ‡å®šè°ƒè¯•å™¨</span></span><br><span class="line"><span class="type">Debugger</span> <span class="variable">attach</span> <span class="operator">=</span> emulator.attach(DebuggerType.CONSOLE);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">DebuggerType</span> &#123;</span><br><span class="line">    <span class="comment">//console debugger</span></span><br><span class="line">    CONSOLE,</span><br><span class="line">    <span class="comment">//gdb server</span></span><br><span class="line">    GDB_SERVER,</span><br><span class="line">    <span class="comment">//ida android server v7.x</span></span><br><span class="line">    ANDROID_SERVER_V7</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é™„åŠ è°ƒè¯•å™¨ã€‚å…³äºè°ƒè¯•å™¨è¯·æŸ¥çœ‹<a href="#Deggbuer">Debuggerä»‹ç»</a>ã€‚</p>
<h4 id="emulateSignal"><a href="#emulateSignal" class="headerlink" title="emulateSignal"></a>emulateSignal</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸ºSIG_NUM Linuxæ‰§è¡Œ kill -l æŸ¥çœ‹ä¿¡å·åˆ—è¡¨</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> emulator.emulateSignal(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>æ¨¡æ‹Ÿå‘è¿›ç¨‹å‘é€ä¸€ä¸ªä¿¡å·ã€‚</p>
<h4 id="disassemble"><a href="#disassemble" class="headerlink" title="disassemble"></a>disassemble</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°ä¸€: åœ°å€</span></span><br><span class="line"><span class="comment">// å‚æ•°äºŒ: æœºå™¨ç </span></span><br><span class="line"><span class="comment">// å‚æ•°ä¸‰: æ˜¯å¦ä¸ºThumbæŒ‡ä»¤</span></span><br><span class="line"><span class="comment">// å‚æ•°å››: æœ€å¤šå¤„ç†å¤šå°‘æ¡æŒ‡ä»¤</span></span><br><span class="line"><span class="type">byte</span>[] code = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x00</span>, <span class="number">0x20</span>&#125;;</span><br><span class="line">Instruction[] disassemble = emulator.disassemble(<span class="number">0</span>, code, <span class="literal">true</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>å¦‚éœ€çµæ´»è½¬æ¢ï¼Œè¯·ä½¿ç”¨Capstoneï¼Œæ­¤å¤„åªæ˜¯Capstoneçš„ç®€å•å°è£…ã€‚disassembleæ–¹æ³•çš„å¦ä¸€é‡è½½ä¸æ¨èå¤§å®¶ä½¿ç”¨ï¼Œä¸ºTraceè€Œå°è£…çš„ï¼Œäº†è§£å³å¯ã€‚</p>
<h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emulator.close();</span><br></pre></td></tr></table></figure>
<p>è°ƒç”¨æ­¤æ–¹æ³•æ¥é‡Šæ”¾Androidè™šæ‹Ÿæœºä½¿ç”¨çš„èµ„æºã€‚</p>
<h4 id="getUnwinder"><a href="#getUnwinder" class="headerlink" title="getUnwinder"></a>getUnwinder</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emulator.getUnwinder().unwind();</span><br></pre></td></tr></table></figure>
<p>æ­¤æ–¹æ³•ç”¨æ¥æ‰“å°è°ƒç”¨æ ˆ</p>
<h2 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h2><h3 id="Memoryä»‹ç»"><a href="#Memoryä»‹ç»" class="headerlink" title="Memoryä»‹ç»"></a>Memoryä»‹ç»</h3><p>Memoryå†…å­˜æ¥å£ä¸»è¦æä¾›äº†ä¸¤ä¸ªåŠŸèƒ½</p>
<ul>
<li>å†…å­˜ç®¡ç†</li>
<li>ELFæ–‡ä»¶çš„åŠ è½½</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬æ¥ä»‹ç»ä¸‹Memoryæ“ä½œçš„ä¸»è¦æ¥å£ã€‚</p>
<h3 id="Memoryæ“ä½œ"><a href="#Memoryæ“ä½œ" class="headerlink" title="Memoryæ“ä½œ"></a>Memoryæ“ä½œ</h3><h4 id="è·å–Memoryå®ä¾‹"><a href="#è·å–Memoryå®ä¾‹" class="headerlink" title="è·å–Memoryå®ä¾‹"></a>è·å–Memoryå®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//emulatorä¸ºæ¨¡æ‹Ÿå™¨å®ä¾‹</span></span><br><span class="line"><span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br></pre></td></tr></table></figure>

<h4 id="setLibraryResolver"><a href="#setLibraryResolver" class="headerlink" title="setLibraryResolver"></a>setLibraryResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šAndroid SDK ç‰ˆæœ¬ï¼Œç›®å‰æ”¯æŒ19å’Œ23ä¸¤ä¸ªç‰ˆæœ¬</span></span><br><span class="line">memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br></pre></td></tr></table></figure>
<p><font color="red">æ­¤æ¥å£å±äºå¿…è°ƒç”¨æ¥å£ã€‚</font>è®¾ç½®SDKç‰ˆæœ¬ï¼Œç®¡ç†äº†Androidæä¾›çš„å¸¸ç”¨åŸºæœ¬soåº“ã€‚å¦‚ä¸è°ƒç”¨æ­¤æ–¹æ³•ï¼Œåœ¨å¤„ç†Elfæ–‡ä»¶çš„ä¾èµ–æ—¶ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†ä¾èµ–é—®é¢˜ã€‚åªæœ‰Soä¸­æ— ä»»ä½•ä¾èµ–çš„æƒ…å†µä¸‹å¯ä»¥ä¸è°ƒç”¨æ­¤æ–¹æ³•ã€‚</p>
<h4 id="findModule"><a href="#findModule" class="headerlink" title="findModule"></a>findModule</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®åç§°è·å–å·²åŠ è½½æ¨¡å—</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.findModule(<span class="string">&quot;libc.so&quot;</span>);</span><br><span class="line"><span class="comment">//æ ¹æ®æ¨¡å—åœ¨å†…å­˜ä¸­çš„åœ°å€æŸ¥æ‰¾å·²åŠ è½½æ¨¡å—</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.findModuleByAddress(address);</span><br><span class="line"><span class="comment">//è·å–æ‰€æœ‰å·²ç»åŠ è½½è¿‡çš„æ¨¡å—</span></span><br><span class="line">Collection&lt;Module&gt; loadedModules = memory.getLoadedModules();</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢ä¸¤ä¸ªæ–¹æ³•éƒ½ä¸ºè·å–å·²åŠ è½½çš„æ¨¡å—ï¼Œéœ€åœ¨è‡ªè¡ŒåŠ è½½æ¨¡å—ä¹‹åè°ƒç”¨ã€‚</p>
<h4 id="allocateStack"><a href="#allocateStack" class="headerlink" title="allocateStack"></a>allocateStack</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸ºç”³è¯·æ ˆç©ºé—´çš„å¤§å°</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.allocateStack(<span class="number">0x10</span>);</span><br><span class="line"><span class="comment">//åœ¨æ ˆç©ºé—´å†™å…¥æ•°æ®å¹¶è¿”å›æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.writeStackBytes(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x01</span>, <span class="number">0x02</span>&#125;);</span><br><span class="line"><span class="comment">//åœ¨æ ˆç©ºé—´å†™å…¥å­—ç¬¦ä¸²å¹¶è¿”å›æŒ‡é’ˆ</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.writeStackString(<span class="string">&quot;doc&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>ä¸è¦åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¿®æ”¹æ ˆï¼Œå¦‚æœä½ ä¸æ¸…æ¥šåœ¨åšä»€ä¹ˆï¼Œæœ€å¥½ä¸è¦è‡ªè¡Œå¼€è¾Ÿæ ˆç©ºé—´ï¼Œunidbgä¼šè‡ªè¡Œç»´æŠ¤ã€‚</p>
<h4 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸€: åˆ†é…å†…å­˜çš„å¤§å°</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: runtimeæ ‡å¿—</span></span><br><span class="line"><span class="type">MemoryBlock</span> <span class="variable">malloc</span> <span class="operator">=</span> memory.malloc(<span class="number">0x10</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//è·å–å·²åˆ†é…å†…å­˜çš„æŒ‡é’ˆæ¥æ“ä½œè¯¥å†…å­˜</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> malloc.getPointer();</span><br><span class="line"><span class="comment">//é‡Šæ”¾å·²åˆ†é…çš„å†…å­˜</span></span><br><span class="line">malloc.free();</span><br></pre></td></tr></table></figure>
<p>å‚æ•°äºŒçš„runtimeæ ‡å¿—ï¼štrueè¡¨ç¤ºä½¿ç”¨mmapæŒ‰é¡µå¤§å°åˆ†é…ï¼Œç›¸åº”çš„è°ƒç”¨MemoryBlock.freeæ–¹æ³•åˆ™ä½¿ç”¨munmapé‡Šæ”¾ã€‚falseè¡¨ç¤ºä½¿ç”¨libc.mallocåˆ†é…ï¼Œç›¸åº”çš„è°ƒç”¨MemoryBlock.freeæ–¹æ³•åˆ™ä½¿ç”¨libc.freeé‡Šæ”¾ã€‚</p>
<h4 id="setErrno"><a href="#setErrno" class="headerlink" title="setErrno"></a>setErrno</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">memory.setErrno(UnixEmulator.EPERM); </span><br></pre></td></tr></table></figure>
<p>å¦‚éœ€åœ¨æ¨¡æ‹Ÿæ‰§è¡ŒæŸå‡½æ•°å‰éœ€è¦æŒ‡å®šerrnoï¼Œå¯ä½¿ç”¨æ­¤æ–¹æ³•è®¾ç½®ã€‚</p>
<h4 id="getStackPoint"><a href="#getStackPoint" class="headerlink" title="getStackPoint"></a>getStackPoint</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">stackPoint</span> <span class="operator">=</span> memory.getStackPoint(); </span><br></pre></td></tr></table></figure>
<p>è¿”å›å½“å‰SPå¯„å­˜å™¨æŒ‡å‘çš„åœ°å€ã€‚</p>
<h4 id="disableCallInitFunction"><a href="#disableCallInitFunction" class="headerlink" title="disableCallInitFunction"></a>disableCallInitFunction</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">memory.disableCallInitFunction();</span><br><span class="line"><span class="comment">//å‚æ•°ä¸€: æŒ‡å®šæ˜¯å¦è°ƒç”¨åˆå§‹åŒ–</span></span><br><span class="line">memory.setCallInitFunction(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>ç¦ç”¨ElfåŠ è½½æ—¶è°ƒç”¨åˆå§‹åŒ–å‡½æ•°ã€‚éœ€é…åˆåŠ è½½æ¨¡å—çš„forceCallInitå‚æ•°ä½¿ç”¨ã€‚å¦‚ä¸è¿›è¡Œä¸Šè¿°è®¾ç½®ï¼Œé»˜è®¤ä¸ºtrueã€‚</p>
<h4 id="getMemoryMap"><a href="#getMemoryMap" class="headerlink" title="getMemoryMap"></a>getMemoryMap</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Collection&lt;MemoryMap&gt; memoryMap = memory.getMemoryMap();</span><br><span class="line"><span class="comment">//æ‰“å°å½“å‰å†…å­˜æ˜ å°„æƒ…å†µ</span></span><br><span class="line"><span class="keyword">for</span> (MemoryMap map : memoryMap)&#123;</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è·å–å†…å­˜æ˜ å°„ä¿¡æ¯ï¼Œæ‰€æœ‰æ­£åœ¨ä½¿ç”¨çš„å†…å­˜å—éƒ½ç»´æŠ¤åœ¨æ­¤Mapä¸­ã€‚</p>
<h4 id="pointer"><a href="#pointer" class="headerlink" title="pointer"></a>pointer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.pointer(<span class="number">0x40000000</span>);</span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer2</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator, <span class="number">0x40000000</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨unidbgä¸­ï¼Œå¯ä»¥å€ŸåŠ©unidbgPointerå°è£…çš„APIæ¥è¯»å†™å†…å­˜ï¼Œæ­¤APIä¾›å·²çŸ¥åœ°å€çš„æƒ…å†µä¸‹ï¼Œè·å¾—ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å·²çŸ¥åœ°å€ï¼Œç»§è€Œè¿›è¡Œæ“ä½œã€‚å¯ä»¥ç†è§£ä¸ºæŒ‡å“ªæ‰“å“ªã€‚å…·ä½“å†…å­˜è¯»å†™æ“ä½œè¯·æŸ¥çœ‹<a href="#UnidbgPointer">UnidbgPointer</a>ã€‚</p>
<h4 id="addModuleListener"><a href="#addModuleListener" class="headerlink" title="addModuleListener"></a>addModuleListener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">memory.addModuleListener(<span class="keyword">new</span> <span class="title class_">ModuleListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoaded</span><span class="params">(Emulator&lt;?&gt; emulator, Module <span class="keyword">module</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">module</span>.name + <span class="string">&quot;å·²è¢«åŠ è½½&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ ä¸€ä¸ªæ¨¡å—åŠ è½½ç›‘å¬å™¨ï¼Œå½“ä¸€ä¸ªæ–°æ¨¡å—è¢«åŠ è½½åï¼Œä¼šå›è°ƒModuleListenerçš„onLoadedæ–¹æ³•ï¼Œç”¨æ¥æ„ŸçŸ¥æŸæ¨¡å—åŠ è½½ã€‚ä¸€èˆ¬ç”¨äºæƒ³åœ¨æŸä¸ªæ¨¡å—åŠ è½½åæ¥ç€è¿›è¡Œhookçš„æ“ä½œã€‚éœ€åœ¨æ¨¡å—åŠ è½½å‰è®¾ç½®ï¼Œå¦åˆ™æ— æ•ˆã€‚</p>
<h4 id="load"><a href="#load" class="headerlink" title="load"></a>load</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.load(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;æ–‡ä»¶åœ°å€&quot;</span>)); </span><br></pre></td></tr></table></figure>
<p>å…¶ä½™å‡ ä¸ªé‡è½½å°±ä¸ä»‹ç»äº†ï¼Œemulatoræ¥å£æä¾›çš„æ¨¡å—åŠ è½½APIå’ŒVMæä¾›çš„åŠ è½½APIåº•å±‚éƒ½åŸºäºæ­¤ï¼Œä»…æ˜¯å¯¹æ­¤APIçš„ä¸€å±‚å°è£…ã€‚</p>
<h3 id="Memoryæ€»ç»“"><a href="#Memoryæ€»ç»“" class="headerlink" title="Memoryæ€»ç»“"></a>Memoryæ€»ç»“</h3><p>Memoryæ¨¡å—å°è£…äº†å…³äºå†…å­˜ç®¡ç†çš„å„ä¸ªæ¥å£ï¼Œå…¶ä½™æœªä»‹ç»çš„æ–¹æ³•ä¸æ¨èå¤§å®¶ä½¿ç”¨ï¼Œå¤šä¸ºunidbgå†…éƒ¨å°è£…çš„åŠŸèƒ½ã€‚</p>
<h2 id="VM"><a href="#VM" class="headerlink" title="VM"></a>VM</h2><h3 id="VMä»‹ç»"><a href="#VMä»‹ç»" class="headerlink" title="VMä»‹ç»"></a>VMä»‹ç»</h3><p>å¦‚æœè¦åŠ è½½çš„æ¨¡å—ä¸­å­˜åœ¨JNIäº¤äº’çš„åœºæ™¯ï¼Œéœ€è¦åˆ›å»ºVMã€‚VMä¸»è¦çš„ä½œç”¨å°±æ˜¯ä»£ç†äº†ä¸€å¥—JNIï¼Œåœ¨æ¨¡æ‹Ÿæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœéœ€è¦å€ŸåŠ©JNIæ¥æ“ä½œJavaå±‚ï¼Œå°±å°‘ä¸äº†VMçš„å¸®åŠ©ã€‚</p>
<h3 id="VMåˆ›å»º"><a href="#VMåˆ›å»º" class="headerlink" title="VMåˆ›å»º"></a>VMåˆ›å»º</h3><p>åœ¨<a href="#AndroidEmulator">AndroidEmulator</a>ä¸€èŠ‚æˆ‘ä»¬ä»‹ç»è¿‡ï¼Œä¸»è¦æœ‰ä¸¤ç§åˆ›å»ºVMçš„æ–¹å¼</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºè™šæ‹Ÿæœº</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">dalvikVM</span> <span class="operator">=</span> emulator.createDalvikVM();</span><br><span class="line"><span class="comment">//åˆ›å»ºè™šæ‹Ÿæœºå¹¶æŒ‡å®šAPKæ–‡ä»¶</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">dalvikVM</span> <span class="operator">=</span> emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apk file path&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>æ¨èä½¿ç”¨æŒ‡å®šAPKæ–‡ä»¶è¿›è¡Œåˆ›å»ºï¼ŒæŸäº›APIéœ€è¦æŒ‡å®šAPKæ–‡ä»¶æ‰å¯ä½¿ç”¨ã€‚</p>
<h3 id="VMæ¥å£"><a href="#VMæ¥å£" class="headerlink" title="VMæ¥å£"></a>VMæ¥å£</h3><h4 id="æ—¥å¿—æ§åˆ¶"><a href="#æ—¥å¿—æ§åˆ¶" class="headerlink" title="æ—¥å¿—æ§åˆ¶"></a>æ—¥å¿—æ§åˆ¶</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®æ˜¯å¦è¾“å‡ºJNIè¿è¡Œæ—¥å¿— </span></span><br><span class="line">vm.setVerbose(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>æ­¤å¼€å…³åªæ§åˆ¶VMçš„æ—¥å¿—ï¼Œä¸»è¦è¡¨ç°ä¸ºJNIäº¤äº’çš„è¯¦ç»†æ—¥å¿—ã€‚</p>
<h4 id="è®¾ç½®JNI"><a href="#è®¾ç½®JNI" class="headerlink" title="è®¾ç½®JNI"></a>è®¾ç½®JNI</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®JNIæ¥å£ </span></span><br><span class="line">dalvikVM.setJni(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>å¦‚ç¨‹åºä¸­å­˜åœ¨ä½¿ç”¨JNIçš„æ¥å£ï¼Œå¿…é¡»è®¾ç½®JNIã€‚æ¨èè‡ªå®ç°çš„ç±»ç»§æ‰¿AbstractJniç±»ï¼Œæ­¤ç±»å°è£…äº†ç»å¤§éƒ¨ä»½å¸¸ç”¨çš„æ–¹æ³•ï¼Œå…å»éƒ¨åˆ†ç¹æ‚çš„å†…å®¹ã€‚å¦‚ç­¾åæ ¡éªŒ(éœ€æŒ‡å®šAPKæ–‡ä»¶åˆ›å»ºVM)ã€å¸¸ç”¨JDKæ“ä½œç­‰ã€‚ å…³äºJNIéƒ¨åˆ†è¯·æŸ¥çœ‹<a href="#JNI">JNIä»‹ç»</a></p>
<h4 id="è°ƒç”¨JNI-OnLoadå‡½æ•°"><a href="#è°ƒç”¨JNI-OnLoadå‡½æ•°" class="headerlink" title="è°ƒç”¨JNI_OnLoadå‡½æ•°"></a>è°ƒç”¨JNI_OnLoadå‡½æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°ä¸€: æ¨¡æ‹Ÿå™¨å®ä¾‹ </span></span><br><span class="line"><span class="comment">// å‚æ•°äºŒ: è¦æ‰§è¡ŒJNI_OnLoadå‡½æ•°çš„æ¨¡å— </span></span><br><span class="line">dalvikVM.callJNI_OnLoad(emulator,<span class="keyword">module</span>);</span><br></pre></td></tr></table></figure>
<p>å¯¹JNI_OnLoadå‡½æ•°è¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œã€‚å¦‚æŸäº›JNIæ–¹æ³•åœ¨JNI_OnLoadå‡½æ•°è¿›è¡ŒåŠ¨æ€ç»‘å®šéœ€è°ƒç”¨æ­¤å‡½æ•°åæ‰èƒ½å¤Ÿè°ƒç”¨JNIæ–¹æ³•ï¼Œæ¨èåŠ è½½æ¨¡å—åç´§æ¥æ‰§è¡Œæ­¤æ–¹æ³•ã€‚</p>
<h4 id="è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹"><a href="#è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹" class="headerlink" title="è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹"></a>è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Emulator&lt;?&gt; emulator = dalvikVM.getEmulator(); </span><br></pre></td></tr></table></figure>

<h4 id="è·å–APKç›¸å…³ä¿¡æ¯"><a href="#è·å–APKç›¸å…³ä¿¡æ¯" class="headerlink" title="è·å–APKç›¸å…³ä¿¡æ¯"></a>è·å–APKç›¸å…³ä¿¡æ¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æŒ‡å®šAPKæ–‡ä»¶ä»¥åï¼Œå¯è°ƒç”¨è¯¥æ–¹æ³•è·å–èµ„æºæ–‡ä»¶</span></span><br><span class="line"><span class="type">byte</span>[] bytes = dalvikVM.openAsset(<span class="string">&quot;fileName&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šAPKæ–‡ä»¶ä»¥åï¼Œå¯è°ƒç”¨è¯¥æ–¹æ³•è·å–APKåŒ…å</span></span><br><span class="line"><span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> dalvikVM.getPackageName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šAPKæ–‡ä»¶ä»¥åï¼Œå¯è°ƒç”¨è¯¥æ–¹æ³•è·å–APKç‰ˆæœ¬åç§°</span></span><br><span class="line"><span class="type">String</span> <span class="variable">versionName</span> <span class="operator">=</span> dalvikVM.getVersionName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šAPKæ–‡ä»¶ä»¥åï¼Œå¯è°ƒç”¨è¯¥æ–¹æ³•è·å–APKç‰ˆæœ¬å·</span></span><br><span class="line"><span class="type">long</span> <span class="variable">versionCode</span> <span class="operator">=</span> dalvikVM.getVersionCode();</span><br><span class="line"></span><br><span class="line"><span class="comment">//æŒ‡å®šAPKæ–‡ä»¶ä»¥åï¼Œå¯è°ƒç”¨è¯¥æ–¹æ³•è·å–Manifestæ¸…å•ä¿¡æ¯</span></span><br><span class="line"><span class="type">String</span> <span class="variable">manifestXml</span> <span class="operator">=</span> dalvikVM.getManifestXml();</span><br></pre></td></tr></table></figure>

<h4 id="åŠ è½½æ¨¡å—"><a href="#åŠ è½½æ¨¡å—" class="headerlink" title="åŠ è½½æ¨¡å—"></a>åŠ è½½æ¨¡å—</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸€: æ¨¡å—åç§°</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: æ˜¯å¦å¼ºåˆ¶æ‰§è¡ŒInitåˆå§‹åŒ–</span></span><br><span class="line"><span class="type">DalvikModule</span> <span class="variable">docModule</span> <span class="operator">=</span> dalvikVM.loadLibrary(<span class="string">&quot;doc&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//å‚æ•°ä¸€: æ¨¡å—åç§°</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: è¦åŠ è½½æ¨¡å—çš„å­—èŠ‚æ•°æ®</span></span><br><span class="line"><span class="comment">//å‚æ•°ä¸‰: æ˜¯å¦å¼ºåˆ¶æ‰§è¡ŒInitåˆå§‹åŒ–</span></span><br><span class="line"><span class="type">DalvikModule</span> <span class="variable">docModule</span> <span class="operator">=</span> dalvikVM.loadLibrary(<span class="string">&quot;doc&quot;</span>, soFile.getBytes(), <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>VMåŒæ ·èƒ½å¤ŸåŠ è½½Elfæ¨¡å—ï¼Œå…·ä½“çš„å·®å¼‚å°±æ˜¯å¦‚æœæŒ‡å®šäº†APKæ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸Šè¿°ç¬¬ä¸€ä¸ªé‡è½½æ–¹æ³•æŒ‡å®šæ¨¡å—åç§°ï¼Œunidbgä¼šè‡ªè¡Œä»APKæ–‡ä»¶ä¸­æå–è¯¥Soæ–‡ä»¶è¿›è¡ŒåŠ è½½ã€‚ç¬¬äºŒä¸ªé‡è½½æ–¹æ³•ä½¿ç”¨è¾ƒå°‘ï¼ŒæŒ‡å®šbyte[]æ•°æ®è¿›è¡ŒåŠ è½½ï¼Œåç§°ç”±å‚æ•°ä¸€æŒ‡å®šã€‚<br />è¿”å›ä¸€ä¸ªDalvikModuleå®ä¾‹ï¼Œå¯è°ƒç”¨JNI_OnLoadå‡½æ•°:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docModule.callJNI_OnLoad(emulator); </span><br></pre></td></tr></table></figure>
<p>è¯¥å®ä¾‹è¿˜ç»´æŠ¤äº†ä¸€ä¸ªModuleå®ä¾‹ï¼Œå¯ä½¿ç”¨ä¸‹é¢æ–¹æ³•è·å–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> docModule.getModule(); </span><br></pre></td></tr></table></figure>
<p>æœ‰å…³Moduleå®ä¾‹è¯·æŸ¥çœ‹<a href="#Module">Module</a></p>
<h3 id="VMæ€»ç»“"><a href="#VMæ€»ç»“" class="headerlink" title="VMæ€»ç»“"></a>VMæ€»ç»“</h3><p>ä¸Šè¿°çš„å‡ ä¸ªæ¥å£ä¸»è¦æ¥æ§åˆ¶VMæˆ–è·å–APKæ–‡ä»¶ä¿¡æ¯ï¼ŒVMå…¶ä¸­çš„æ–¹æ³•ä¸æ­¢äºè¿™äº›ï¼Œæˆ‘ä»¬ç•™åˆ°JNIéƒ¨åˆ†æ¥ä»‹ç»ï¼Œå› ä¸ºå…¶ä»–çš„å‡ ä¸ªæ–¹æ³•éƒ½æ˜¯æœ‰å…³äºJNIäº¤äº’åœºæ™¯çš„ï¼Œä¹Ÿå°±æ˜¯unidbgä¸­çš„ç¯å¢ƒé—®é¢˜ã€‚<br />unidbgè¡¥ç¯å¢ƒã€JNIäº¤äº’è¯·æŸ¥çœ‹<a href="#JNI">JNIä»‹ç»</a></p>
<h2 id="CallMethod"><a href="#CallMethod" class="headerlink" title="CallMethod"></a>CallMethod</h2><h3 id="æ‰§è¡ŒJNIå‡½æ•°"><a href="#æ‰§è¡ŒJNIå‡½æ•°" class="headerlink" title="æ‰§è¡ŒJNIå‡½æ•°"></a>æ‰§è¡ŒJNIå‡½æ•°</h3><ul>
<li>æˆ‘ä»¬é¦–å…ˆæ¥å†™ä¸€æ®µå°æ¡ˆä¾‹æ¥è¯´æ˜å¦‚ä½•åœ¨unidbgä¸­æ‰§è¡ŒJNIå‡½æ•°</li>
</ul>
<p>Javaå±‚:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-doc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">jnitest</span><span class="params">(String arg)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Soå±‚:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">extern <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line"><span class="title function_">Java_com_github_unidbg_Test_jnitest</span><span class="params">(JNIEnv *env, jobject thiz, jstring arg)</span> &#123;</span><br><span class="line">    const <span class="type">char</span> *c_arg = env-&gt;GetStringUTFChars(arg, nullptr);</span><br><span class="line">    <span class="type">string</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="string">&quot;unidbg:&quot;</span>;</span><br><span class="line">    hello.append(c_arg);</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éå¸¸ç®€å•çš„ä¸€æ®µå°ä¾‹å­ï¼Œæˆ‘ä»¬å°±ä»¥è¯¥ä¾‹å­æ¥è¯´æ˜å¦‚ä½•è°ƒç”¨libnative-doc.soä¸­çš„jnitestå‡½æ•°ã€‚</p>
<ul>
<li><p>ç¬¬ä¸€æ­¥: åˆ›å»ºä¸€ä¸ªDvmObjectï¼Œæ­¤å¯¹è±¡ç›¸å½“äºåœ¨Javaå±‚å»è°ƒç”¨nativeå‡½æ•°çš„ç±»çš„å®ä¾‹å¯¹è±¡</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡</span></span><br><span class="line">DvmObject&lt;?&gt; obj = vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>).newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>å…³äºå®ä¾‹å¯¹è±¡çš„ä»‹ç»è¯·æŸ¥çœ‹<a href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B">JNIå¯¹è±¡&#x2F;å®ä¾‹</a></p>
</li>
<li><p>ç¬¬äºŒæ­¥: ä½¿ç”¨è¯¥å¯¹è±¡è°ƒç”¨JNIæ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸€: Emulatorå®ä¾‹</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: æ–¹æ³•çš„ç­¾å</span></span><br><span class="line"><span class="comment">//å‚æ•°ä¸‰: å¯å˜å‚æ•°ï¼Œä¼ éœ€è¦å‘è¯¥æ–¹æ³•ä¼ é€’çš„å‚æ•°</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> obj.callJniMethodObject(emulator, <span class="string">&quot;jnitest(Ljava/lang/String;)Ljava/lang/String;&quot;</span>, <span class="string">&quot;yyds!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬æ‹¥æœ‰äº†ä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå°±å¯ä»¥åƒåœ¨Javaä¸­é‚£æ ·æ¥è°ƒç”¨nativeæ–¹æ³•äº†ï¼Œé’ˆå¯¹Javaå±‚ä¸­ä¸åŒè¿”å›å€¼è°ƒç”¨çš„APIä¸åŒï¼Œè¯·æŸ¥çœ‹<a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNIæ–¹æ³•å°è£…</a><br />å‚æ•°äºŒæ˜¯æ–¹æ³•çš„ç­¾åï¼Œæ­¤å‚æ•°å¦‚ä½•å¡«å†™è¯·æŸ¥çœ‹<a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNIæ–¹æ³•ç­¾å</a></p>
</li>
</ul>
<h3 id="æ‰§è¡Œä»»æ„å‡½æ•°"><a href="#æ‰§è¡Œä»»æ„å‡½æ•°" class="headerlink" title="æ‰§è¡Œä»»æ„å‡½æ•°"></a>æ‰§è¡Œä»»æ„å‡½æ•°</h3><p>å½“æˆ‘ä»¬æƒ³æ‰§è¡Œçš„å‡½æ•°å¹¶éå¯¼å‡ºå‡½æ•°ï¼Œä¹Ÿå¯ä½¿ç”¨åœ°å€è¿›è¡Œè°ƒç”¨ï¼Œè¯·è‡ªè¡Œå‚è€ƒunidbgå¯¹JNIå‡½æ•°è°ƒç”¨çš„å°è£…ï¼Œè‡ªè¡Œå®ç°æ­¤éƒ¨åˆ†ã€‚</p>
<h3 id="æ‰§è¡Œmainå‡½æ•°"><a href="#æ‰§è¡Œmainå‡½æ•°" class="headerlink" title="æ‰§è¡Œmainå‡½æ•°"></a>æ‰§è¡Œmainå‡½æ•°</h3><p>å¦‚æœåŠ è½½çš„æ–‡ä»¶æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼Œéœ€è¦æŒæœ‰è¯¥æ–‡ä»¶è¢«åŠ è½½åè¿”å›çš„Moduleå®ä¾‹æ¥è°ƒç”¨callEntryæ–¹æ³•ï¼Œè¯·æŸ¥çœ‹<a href="#Module">Module</a></p>
<h3 id="JNIæ–¹æ³•å°è£…"><a href="#JNIæ–¹æ³•å°è£…" class="headerlink" title="JNIæ–¹æ³•å°è£…"></a>JNIæ–¹æ³•å°è£…</h3><h4 id="void"><a href="#void" class="headerlink" title="void"></a>void</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨voidè¿”å›å€¼çš„å‡½æ•°</span></span><br><span class="line">testClass.callStaticJniMethod(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line">obj.callJniMethod(emulator,<span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨booleanè¿”å›å€¼çš„å‡½æ•°</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodBoolean(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodBoolean(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="int"><a href="#int" class="headerlink" title="int"></a>int</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨intè¿”å›å€¼çš„å‡½æ•°</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="long"><a href="#long" class="headerlink" title="long"></a>long</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨longè¿”å›å€¼çš„å‡½æ•°</span></span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="float"><a href="#float" class="headerlink" title="float"></a>float</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>å…ˆæ‹¿åˆ°4å­—èŠ‚çš„intæ•°æ®ï¼Œç„¶åå°†å…¶è½¬æ¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">allocate</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">allocate.putInt(ret);</span><br><span class="line">allocate.flip();</span><br><span class="line"><span class="type">float</span> <span class="variable">f_ret</span> <span class="operator">=</span> allocate.getFloat();</span><br></pre></td></tr></table></figure>

<h4 id="double"><a href="#double" class="headerlink" title="double"></a>double</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>å…ˆæ‹¿åˆ°8å­—èŠ‚çš„longæ•°æ®ï¼Œç„¶åå°†å…¶è½¬æ¢</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">allocate</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">8</span>);</span><br><span class="line">allocate.putLong(ret);</span><br><span class="line">allocate.flip();</span><br><span class="line"><span class="type">double</span> <span class="variable">d_ret</span> <span class="operator">=</span> allocate.getDouble();</span><br></pre></td></tr></table></figure>

<h4 id="å¯¹è±¡ç±»å‹"><a href="#å¯¹è±¡ç±»å‹" class="headerlink" title="å¯¹è±¡ç±»å‹"></a>å¯¹è±¡ç±»å‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//è°ƒç”¨å¯¹è±¡ç±»å‹è¿”å›å€¼çš„å‡½æ•°</span></span><br><span class="line">DvmObject&lt;?&gt; ret = testClass.callStaticJniMethodObject(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line">DvmObject&lt;?&gt;  ret = obj.callJniMethodObject(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>åŸºæœ¬ç±»å‹å¤–çš„æ‰€æœ‰ç±»å‹éƒ½ä¸ºå¯¹è±¡ç±»å‹ï¼ŒåŒ…æ‹¬åŸºæœ¬ç±»å‹çš„æ•°ç»„ç±»å‹</p>
<h3 id="JNIæ–¹æ³•ç­¾å"><a href="#JNIæ–¹æ³•ç­¾å" class="headerlink" title="JNIæ–¹æ³•ç­¾å"></a>JNIæ–¹æ³•ç­¾å</h3><p>é€šè¿‡ç±»åä¸æ–¹æ³•ç­¾åçš„é…åˆï¼Œæ‰èƒ½å®šä½åˆ°å”¯ä¸€çš„å‡½æ•°ã€‚æ‰€ä»¥ä¸€å®šè¦å°†æ–¹æ³•ç­¾åå¡«å†™æ­£ç¡®ï¼Œunidbgæ‰å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ï¼Œæ‰€æœ‰çš„ç±»å‹éƒ½æŒ‰JNIæœ¬èº«å®šä¹‰çš„ç­¾åä¸€è‡´ã€‚</p>
<table>
<thead>
<tr>
<th><strong>Javaç±»å‹</strong></th>
<th><strong>ç±»å‹ç­¾å</strong></th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>Z</td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
</tr>
<tr>
<td>char</td>
<td>C</td>
</tr>
<tr>
<td>long</td>
<td>J</td>
</tr>
<tr>
<td>float</td>
<td>F</td>
</tr>
<tr>
<td>double</td>
<td>D</td>
</tr>
<tr>
<td>short</td>
<td>S</td>
</tr>
<tr>
<td>int</td>
<td>I</td>
</tr>
<tr>
<td>ç±»</td>
<td>Lå…¨é™å®šç±»å;</td>
</tr>
<tr>
<td>æ•°ç»„</td>
<td>[å…ƒç´ ç±»å‹ç­¾å</td>
</tr>
</tbody></table>
<p>unidbgæ–¹æ³•ç­¾åå¦‚ä¸‹æ ¼å¼:<br />æ–¹æ³•å(å‚æ•°åˆ—è¡¨)è¿”å›å€¼ <br />ä¸¾ä¸ªä¾‹å­:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">jnitest</span><span class="params">(String arg)</span>;</span><br></pre></td></tr></table></figure>
<p>å¯¹åº”çš„æ–¹æ³•ç­¾åä¸º:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitest(Ljava/lang/String;)Ljava/lang/String;</span><br></pre></td></tr></table></figure>



<h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><h3 id="Hookä»‹ç»"><a href="#Hookä»‹ç»" class="headerlink" title="Hookä»‹ç»"></a>Hookä»‹ç»</h3><p>Hookæ¨¡å—ä¸ºunidbgå¼•å…¥ç¬¬ä¸‰æ–¹Hookæ¡†æ¶è€Œå°è£…çš„ä¸€ä¸ªæ¨¡å—ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿå¯¹ç›®æ ‡Soè¿›è¡Œhookæ“ä½œã€‚è€ŒAPIåŸºæœ¬ä¸ç¬¬ä¸‰æ–¹Hookæ¡†æ¶ä¿æŒä¸€è‡´ã€‚å¦‚æœæ˜¯32ä½ç¨‹åºï¼Œè¦æ³¨æ„Hookç›®æ ‡åœ°å€æ˜¯å¦ä¸ºThumbæ¨¡å¼ï¼Œæ‰‹åŠ¨å¤„ç†+1æ“ä½œã€‚</p>
<h3 id="Hookæ¡†æ¶åˆ†ç±»"><a href="#Hookæ¡†æ¶åˆ†ç±»" class="headerlink" title="Hookæ¡†æ¶åˆ†ç±»"></a>Hookæ¡†æ¶åˆ†ç±»</h3><h4 id="HookZz"><a href="#HookZz" class="headerlink" title="HookZz"></a>HookZz</h4><p>HookZzä¸ºDobbyçš„å‰èº«ï¼Œ32ä½æ¨¡å¼ä¸‹æ¨èä½¿ç”¨HookZzã€‚æ”¯æŒinline hookã€‚</p>
<h5 id="è·å–HookZzå®ä¾‹"><a href="#è·å–HookZzå®ä¾‹" class="headerlink" title="è·å–HookZzå®ä¾‹"></a>è·å–HookZzå®ä¾‹</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HookZz hook = HookZz.getInstance(emulator);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨ä»»ä½•Hookæ¡†æ¶ä¹‹å‰éƒ½éœ€è¦æ‹¿åˆ°unidbgå¯¹è¯¥Hookæ¡†æ¶çš„å°è£…å®ä¾‹ã€‚</p>
<h5 id="HookZz-API"><a href="#HookZz-API" class="headerlink" title="HookZz API"></a>HookZz API</h5><h6 id="wrap"><a href="#wrap" class="headerlink" title="wrap"></a>wrap</h6><p>wrapçš„ä½œç”¨ç›¸å½“äºåœ¨ç›®æ ‡åœ°å€è¿›è¡Œä¸€å±‚åŒ…è£…ï¼Œå›è°ƒåˆ°æˆ‘ä»¬çš„ä»£ç ï¼Œå¯ä»¥å¯¹å…¶æ‰“å°å½“å‰å‚æ•°æˆ–å¯„å­˜å™¨çš„å€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.è·å–HookZzå®ä¾‹</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">// 2.åˆ›å»ºhookè§¦å‘å›è°ƒ</span></span><br><span class="line">WrapCallback&lt;HookZzArm32RegisterContextImpl&gt; wrapCallback = <span class="keyword">new</span> <span class="title class_">WrapCallback</span>&lt;HookZzArm32RegisterContextImpl&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContextImpl ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        <span class="comment">//hookå‡½æ•°è¿›å…¥å‰å›è°ƒ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;arg0:&quot;</span> + ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContextImpl ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        <span class="comment">//hookå‡½æ•°è¿”å›åå›è°ƒ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ret:&quot;</span> + ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 3.wrap</span></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*åç§»*/</span>;</span><br><span class="line">hookZz.wrap(functionAddress, wrapCallback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.wrapé‡è½½, hookå¯¼å‡ºç¬¦å·</span></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line">hookZz.wrap(symbol, wrapCallback);</span><br></pre></td></tr></table></figure>

<h6 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h6><p>replaceå¯ä»¥è¿›è¡Œæ›¿æ¢ç›®æ ‡å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–HookZzå®ä¾‹</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">//åˆ›å»ºreplaceè§¦å‘å›è°ƒ</span></span><br><span class="line"><span class="type">ReplaceCallback</span> <span class="variable">replaceCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReplaceCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HookStatus <span class="title function_">onCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context, <span class="type">long</span> originFunction)</span> &#123;</span><br><span class="line">        <span class="comment">//å‡½æ•°è°ƒç”¨å‰å›è°ƒã€‚ä¸Šå±‚ä¼šæ ¹æ®HookStatusæ¥å†³å®šç¨‹åºæµç¨‹</span></span><br><span class="line">        <span class="comment">//å…ˆæ¥ä»‹ç»å‡ ä¸ªå‚æ•°</span></span><br><span class="line">        <span class="comment">//emulator: æ¨¡æ‹Ÿå™¨å®ä¾‹</span></span><br><span class="line">        <span class="comment">//context: Hookä¸Šä¸‹æ–‡ï¼Œå¯æ ¹æ®æ­¤å‚æ•°è·å–å„ç§å‚æ•°ã€‚ä¹Ÿå¯å­˜å‚¨ä¸´æ—¶æ•°æ®ã€‚</span></span><br><span class="line">        <span class="comment">//originFunction: åŸå‡½æ•°åœ°å€</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//è·å–å‚æ•°ä¸€å¹¶æ‰“å°</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;arg0:&quot;</span>+arg0);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//è·å–æŒ‡é’ˆå‚æ•°äºŒå¹¶å­˜å…¥context</span></span><br><span class="line">        context.push(context.getPointerArg(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//ä¿®æ”¹å‚æ•°ä¸‰çš„å€¼ä¸º0</span></span><br><span class="line">        <span class="type">EditableArm32RegisterContext</span> <span class="variable">ctx</span> <span class="operator">=</span> (EditableArm32RegisterContext) context;</span><br><span class="line">        ctx.setR2(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//å¯ä»¥åœ¨æ­¤æ”¹å˜å‡½æ•°æµç¨‹</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">newFuncAddr</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xDC0</span><span class="comment">/*åç§»*/</span>;</span><br><span class="line">        <span class="keyword">return</span> HookStatus.RET(emulator, newFuncAddr);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //ä¹Ÿå¯ä»¥ç›´æ¥è¿”å›ä¸€ä¸ªå€¼è€Œä¸è°ƒç”¨å‡½æ•°</span></span><br><span class="line"><span class="comment">        long retValue = 0L;</span></span><br><span class="line"><span class="comment">        return HookStatus.LR(emulator, retValue);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context)</span> &#123;</span><br><span class="line">        <span class="comment">//æ­¤å›è°ƒä¼šæ ¹æ®hookZz.replaceæ–¹æ³•çš„ç¬¬ä¸‰ä¸ªå‚æ•°enablePostCallå†³å®š</span></span><br><span class="line">        <span class="comment">//å¯ä»¥è·å–contextå­˜å‚¨çš„æ•°æ®</span></span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg2</span> <span class="operator">=</span> context.pop();</span><br><span class="line">        <span class="comment">//å¯åœ¨æ­¤ä¿®æ”¹å‡½æ•°è¿”å›å€¼</span></span><br><span class="line">        <span class="built_in">super</span>.postCall(emulator, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*åç§»*/</span>;</span><br><span class="line"><span class="comment">//å¯¹ç›®æ ‡åœ°å€è¿›è¡Œinline hook, å¹¶ä¼ å…¥å›è°ƒå®ä¾‹</span></span><br><span class="line">hookZz.replace(functionAddress, replaceCallback);</span><br><span class="line"><span class="comment">//replaceé‡è½½ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ§åˆ¶æ˜¯å¦å¯ä»¥ä¿®æ”¹è¿”å›å€¼</span></span><br><span class="line">hookZz.replace(functionAddress, replaceCallback, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line"><span class="comment">//ä½¿ç”¨ç¬¦å·è¿›è¡Œhook</span></span><br><span class="line">hookZz.replace(symbol, replaceCallback);</span><br><span class="line">hookZz.replace(symbol, replaceCallback, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h6 id="instrument"><a href="#instrument" class="headerlink" title="instrument"></a>instrument</h6><p>instrumentæä¾›äº†ä¸€ç§å¯¹å•è¡Œæ±‡ç¼–è¿›è¡ŒHookçš„èƒ½åŠ›ï¼Œä½¿ç”¨åœºæ™¯è¾ƒå°‘ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è·å–HookZzå®ä¾‹</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">//åˆ›å»ºInstrumentCallbackå®ä¾‹</span></span><br><span class="line">InstrumentCallback&lt;RegisterContext&gt; instrumentCallback = <span class="keyword">new</span> <span class="title class_">InstrumentCallback</span>&lt;RegisterContext&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dbiCall</span><span class="params">(Emulator&lt;?&gt; emulator, RegisterContext ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        System.out.println(ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*åç§»*/</span>;</span><br><span class="line"><span class="comment">//å¯¹å•è¡Œåœ°å€è¿›è¡Œhook</span></span><br><span class="line">hookZz.instrument(functionAddress, instrumentCallback);</span><br><span class="line"></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line">hookZz.instrument(symbol, instrumentCallback);</span><br></pre></td></tr></table></figure>

<h4 id="Dobby"><a href="#Dobby" class="headerlink" title="Dobby"></a>Dobby</h4><p>64ä½æ¨¡å¼ä¸‹æ¨èä½¿ç”¨Dobbyè¿›è¡Œinline hookã€‚</p>
<h5 id="è·å–Dobbyå®ä¾‹"><a href="#è·å–Dobbyå®ä¾‹" class="headerlink" title="è·å–Dobbyå®ä¾‹"></a>è·å–Dobbyå®ä¾‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dobby</span> <span class="variable">dobby</span> <span class="operator">=</span> Dobby.getInstance(emulator);</span><br></pre></td></tr></table></figure>

<h5 id="Dobby-API"><a href="#Dobby-API" class="headerlink" title="Dobby API"></a>Dobby API</h5><h6 id="replace-1"><a href="#replace-1" class="headerlink" title="replace"></a>replace</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Dobby</span> <span class="variable">dobby</span> <span class="operator">=</span> Dobby.getInstance(emulator);</span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*åç§»*/</span>;</span><br><span class="line">dobby.replace(functionAddress, <span class="keyword">new</span> <span class="title class_">ReplaceCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HookStatus <span class="title function_">onCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context, <span class="type">long</span> originFunction)</span> &#123;</span><br><span class="line">        <span class="type">Pointer</span> <span class="variable">result</span> <span class="operator">=</span> context.getPointerArg(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;input:&quot;</span> + result.getString(<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onCall(emulator, context, originFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.postCall(emulator, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>Dobby.replaceçš„ç”¨æ³•åŒHookZzï¼Œè¯¦ç»†ä½¿ç”¨è¯·æŸ¥çœ‹<a href="#replace">HookZz-replace</a></p>
<h6 id="instrument-1"><a href="#instrument-1" class="headerlink" title="instrument"></a>instrument</h6><p>åŒHookZzä¸­çš„<a href="#instrument-1">instrument</a>ã€‚</p>
<h4 id="xHook"><a href="#xHook" class="headerlink" title="xHook"></a>xHook</h4><p>xHookæ¡†æ¶å®ç°åŸç†æœ¬èº«å°±å­˜åœ¨å±€é™æ€§ï¼Œåªèƒ½å¤Ÿhookç¬¦å·è¡¨å‡½æ•°ã€‚æœ‰å¥½æœ‰åï¼Œå®ƒçš„ä¼˜ç‚¹å°±æ˜¯ç¨³å®šã€‚</p>
<h5 id="è·å–xHookå®ä¾‹"><a href="#è·å–xHookå®ä¾‹" class="headerlink" title="è·å–xHookå®ä¾‹"></a>è·å–xHookå®ä¾‹</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IxHook</span> <span class="variable">hook</span> <span class="operator">=</span> XHookImpl.getInstance(emulator);</span><br></pre></td></tr></table></figure>

<h5 id="xHook-API"><a href="#xHook-API" class="headerlink" title="xHook API"></a>xHook API</h5><h6 id="register"><a href="#register" class="headerlink" title="register"></a>register</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">IxHook</span> <span class="variable">hook</span> <span class="operator">=</span> XHookImpl.getInstance(emulator);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>xHookçš„registeræ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºpathname_regex_str, å…¶æ”¯æŒPOSIX BRE (Basic Regular Expression) å®šä¹‰çš„æ­£åˆ™è¡¨è¾¾å¼è¯­æ³•ã€‚ç”¨æ¥æ£€ç´¢ç¬¦åˆæ¡ä»¶çš„Soã€‚ç¬¬äºŒä¸ªå‚æ•°ä¸ºç¬¦å·åã€‚è¯¦æƒ…è¯·çœ‹<a class="link"   target="_blank" rel="noopener" href="https://github.com/iqiyi/xHook/blob/master/README.zh-CN.md" >xhookä»‹ç»<i class="fas fa-external-link-alt"></i></a></p>
<h6 id="refresh"><a href="#refresh" class="headerlink" title="refresh"></a>refresh</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hook.refresh(); </span><br></pre></td></tr></table></figure>
<p>åœ¨ä½¿ç”¨xHookè¿›è¡Œhookæ—¶ï¼ŒåŠ¡å¿…è°ƒç”¨æ­¤æ–¹æ³•è¿›è¡Œåˆ·æ–°æ‰èƒ½ç”Ÿæ•ˆã€‚</p>
<h4 id="Whale"><a href="#Whale" class="headerlink" title="Whale"></a>Whale</h4><p>Whale Hookæ¡†æ¶ä¸ºè·¨å¹³å°çš„Hookæ¡†æ¶ï¼Œåœ¨Androidä¸­çš„å®ç°ä¸ºinline hookã€‚</p>
<h5 id="è·å–Whaleå®ä¾‹"><a href="#è·å–Whaleå®ä¾‹" class="headerlink" title="è·å–Whaleå®ä¾‹"></a>è·å–Whaleå®ä¾‹</h5><p>IWhale whale &#x3D; Whale.getInstance(emulator); </p>
<h5 id="Whale-API"><a href="#Whale-API" class="headerlink" title="Whale API"></a>Whale API</h5><p>TODO</p>
<h4 id="åŸç”Ÿhook"><a href="#åŸç”Ÿhook" class="headerlink" title="åŸç”Ÿhook"></a>åŸç”Ÿhook</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;memcmp&quot;</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;callMemcmpä½œæ¯”è¾ƒ&quot;</span>);</span><br><span class="line">        <span class="type">RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg1</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">0</span>);</span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg2</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> registerContext.getIntArg(<span class="number">2</span>);</span><br><span class="line">        Inspector.inspect(arg1.getByteArray(<span class="number">0</span>, length), <span class="string">&quot;arg1&quot;</span>);</span><br><span class="line">        Inspector.inspect(arg2.getByteArray(<span class="number">0</span>, length), <span class="string">&quot;arg2&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (arg1.getString(<span class="number">0</span>).equals(<span class="string">&quot;Context&quot;</span>))&#123;</span><br><span class="line">            emulator.attach().debug();</span><br><span class="line">            <span class="comment">// mr1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>ç¬¬ä¸€ç§ï¼Œä½¿ç”¨armè½¬æœºå™¨ç <br />è½¬æ¢ç½‘å€ <a class="link"   target="_blank" rel="noopener" href="https://armconverter.com/" >https://armconverter.com/<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patch</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator,<span class="keyword">module</span>.base + <span class="number">0x3E8</span>);</span><br><span class="line">    <span class="type">byte</span>[] code = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) <span class="number">0xd0</span>, <span class="number">0x1a</span>&#125;;</span><br><span class="line">    pointer.write(code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒç§ï¼Œä½¿ç”¨keystone</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patch2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator,<span class="keyword">module</span>.base + <span class="number">0x3E8</span>);</span><br><span class="line">    <span class="type">Keystone</span> <span class="variable">keystone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Keystone</span>(KeystoneArchitecture.Arm, KeystoneMode.ArmThumb);</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;subs r0, r2, r3&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] machineCode = keystone.assemble(s).getMachineCode();</span><br><span class="line">    <span class="comment">//byte[] code = ;</span></span><br><span class="line">    pointer.write(machineCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h2><h3 id="JNIä»‹ç»"><a href="#JNIä»‹ç»" class="headerlink" title="JNIä»‹ç»"></a>JNIä»‹ç»</h3><p>å½“ä¸€ä¸ªSoåœ¨æ¨¡æ‹Ÿæ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå®ƒè¦ä¸Javaå±‚è¿›è¡Œäº¤äº’ï¼Œæ¯”å¦‚è·å–Javaå±‚æŸä¸ªå­—æ®µçš„å€¼ã€è°ƒç”¨Javaå±‚çš„æŸä¸ªæ–¹æ³•è·å–è¿”å›å€¼ç­‰ç­‰ï¼Œå¦‚æœä½ ä¸å‘Šè¯‰unidbgå¦‚ä½•åšï¼Œé‚£ç¨‹åºå°±æ— æ³•æ‰§è¡Œä¸‹å»ã€‚ä½ å‘Šè¯‰undibgç¢°åˆ°è®¿é—®Javaå±‚çš„æŸäº›ä¸œè¥¿çš„æ—¶å€™è¯¥æ€ä¹ˆåšçš„è¿™ä¸ªè¿‡ç¨‹ï¼Œä»è€Œè®©ç¨‹åºæ­£ç¡®çš„æ‰§è¡Œä¸‹å»ï¼Œå°±å«åšè¡¥ç¯å¢ƒã€‚<br />æˆ‘ä»¬åœ¨JNIéƒ¨åˆ†æ¥ä»‹ç»unidbgå¦‚ä½•æ¥è¡¥ç¯å¢ƒï¼Œé¦–å…ˆæˆ‘ä»¬è¦æ¥çœ‹unidbgä¸­çš„å‡ ä¸ªæ¦‚å¿µ</p>
<h3 id="ç±»-x2F-ç±»å‹"><a href="#ç±»-x2F-ç±»å‹" class="headerlink" title="ç±»&#x2F;ç±»å‹"></a>ç±»&#x2F;ç±»å‹</h3><p>Javaä¸­å¯ä»¥æŠ½è±¡å‡ºä¸€ä¸ªç±»ï¼Œä¸€ä¸ªç±»å¯ä»¥åˆ›å»ºå¯¹è±¡ï¼Œå¯ä»¥è°ƒç”¨è¯¥ç±»ä¸Šçš„é™æ€æ–¹æ³•ã€‚ä¸€ä¸ªç±»çš„åŸºæœ¬å±æ€§æœ‰å¾ˆå¤šï¼Œunidbgæ¨¡æ‹Ÿäº†çˆ¶ç±»å’Œæ¥å£ã€‚åœ¨unidbgä¸­å¯¹åº”çš„ä¸ºDvmClassã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å‚æ•°ä¸€: ç±»å</span></span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">Test</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line"><span class="comment">//é‡è½½æ–¹æ³•ï¼Œå¯ä»¥æŒ‡å®šçˆ¶ç±»å‹ã€‚ä¹Ÿå°±æ˜¯è¡¨ç¤ºäº†TestUnidbgç»§æ‰¿äº†Testç±»ã€‚</span></span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">dvmClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/TestUnidbg&quot;</span>, Test);</span><br></pre></td></tr></table></figure>
<p>VMçš„resolveClassæ–¹æ³•ä¼šåˆ›å»ºå‡ºä¸€ä¸ªç±»å‹ï¼Œå¯ä»¥ç†è§£ä¸ºJavaä¸­çš„ä¸€ä¸ªç±»ï¼Œå‚æ•°ä¸ºå…¨é™å®šç±»åï¼Œå°†.æ¢ä¸º&#x2F;ã€‚è¿™æ ·å°±åˆ›å»ºå‡ºæ¥ä¸€ç§ç±»å‹äº†ã€‚æˆ‘ä»¬å¯ä»¥åŸºäºæ­¤ç±»å‹åˆ›å»ºå¯¹è±¡ã€‚</p>
<h3 id="å¯¹è±¡-x2F-å®ä¾‹"><a href="#å¯¹è±¡-x2F-å®ä¾‹" class="headerlink" title="å¯¹è±¡&#x2F;å®ä¾‹"></a>å¯¹è±¡&#x2F;å®ä¾‹</h3><p>Javaå±‚è‚¯å®šä¼šæœ‰å¯¹è±¡çš„ï¼Œæˆ–è€…å«åšå®ä¾‹ï¼Œunidbgä¸­å¯¹åº”çš„å«åšDvmObjectã€‚unidbgä¸­æ‰€æœ‰çš„Javaå±‚çš„å¯¹è±¡éƒ½ç›´æ¥æˆ–é—´æ¥çš„ç»§æ‰¿è‡ªDvmObjectã€‚æ¨¡æ‹Ÿåˆ›å»ºå¯¹è±¡:</p>
<ul>
<li><p>ç¬¬ä¸€ç§æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">dvmClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line"><span class="comment">//å‚æ•°ä¸€: å€¼</span></span><br><span class="line">DvmObject&lt;?&gt; obj = dvmClass.newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>åœ¨Javaä¸­ï¼Œæœ‰äº†ç±»ï¼Œå°±å¯ä»¥newå¯¹è±¡äº†å¯¹å§ã€‚unidbgçš„newObjectæ“ä½œå°±ç±»ä¼¼è¿™æ ·ã€‚å®ƒå¯ä»¥æœ‰äº†ä¸€ç§ç±»å‹åè¿›è¡Œåˆ›å»ºå¯¹è±¡ï¼Œå…¶ä¸­çš„å‚æ•°ä½ å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œæ­¤æ•°æ®å°±ä¼šä¸è¯¥DvmObjectç»‘å®šã€‚</p>
</li>
<li><p>ç¬¬äºŒç§æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ ¹æ®æ•°æ®æ¥åˆ›å»ºDvmObject</span></span><br><span class="line"><span class="comment">//å‚æ•°ä¸€: VMå®ä¾‹</span></span><br><span class="line"><span class="comment">//å‚æ•°äºŒ: value</span></span><br><span class="line">DvmObject&lt;?&gt; obj = ProxyDvmObject.createObject(vm, <span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>unidbgä¼šæ ¹æ®æ­¤valueå€¼çš„ç±»å‹æ¥åˆ›å»ºDvmObjectã€‚å¦‚æœvalueä¸ºåŸºæœ¬æ•°æ®ç±»å‹åˆ™ä¼šè¢«å°è£…ä¸ºè¯¥åŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»å‹ã€‚å¦‚æœvalueä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™ä¼šè·å–è¯¥å¯¹è±¡æ‰€å¯¹åº”çš„Classï¼Œæ ¹æ®Classåç§°æ¥è‡ªåŠ¨åˆ›å»ºè¯¥ç±»å‹ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œç›¸å½“äºå¯¹ç¬¬ä¸€ç§æ–¹æ³•çš„ä¸€ä¸ªå°è£…ã€‚å¦‚æœä¸ºæ•°ç»„ç±»å‹ï¼Œåˆ™ä¼šè¢«å°è£…ä¸ºç”±unidbgåˆ›å»ºçš„åŒ…è£…å¯¹è±¡ã€‚</p>
</li>
</ul>
<h3 id="åŒ…è£…å¯¹è±¡"><a href="#åŒ…è£…å¯¹è±¡" class="headerlink" title="åŒ…è£…å¯¹è±¡"></a>åŒ…è£…å¯¹è±¡</h3><p>ç†è®ºä¸Šæ‰€æœ‰çš„Javaå±‚çš„å¯¹è±¡åœ¨unidbgä¸­éƒ½å¯ä»¥æŒ‰ç…§ä¸Šé¢æ‰€è¿°çš„æ–¹æ³•è¿›è¡Œåˆ›å»ºã€‚ä½†unidbgå†…éƒ¨æœ‰éƒ¨åˆ†å°è£…ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨çš„æ—¶å€™æˆ‘ä»¬è¦ä½¿ç”¨unidbgçš„åŒ…è£…å¯¹è±¡</p>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><p>Stringç±»å‹è¢«å°è£…ä¸ºStringObject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">StringObject</span>(vm,<span class="string">&quot;unidbg&quot;</span>); </span><br></pre></td></tr></table></figure>

<h4 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h4><p>æ•°ç»„ç±»å‹åœ¨ä½¿ç”¨çš„æ—¶å€™æŒ‰å¦‚ä¸‹ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//byte[]</span></span><br><span class="line"><span class="type">ByteArray</span> <span class="variable">byteArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArray</span>(vm, <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//int[]</span></span><br><span class="line"><span class="type">IntArray</span> <span class="variable">intArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntArray</span>(vm, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//short[]</span></span><br><span class="line"><span class="type">ShortArray</span> <span class="variable">shortArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShortArray</span>(vm, <span class="keyword">new</span> <span class="title class_">short</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//float[]</span></span><br><span class="line"><span class="type">FloatArray</span> <span class="variable">floatArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FloatArray</span>(vm, <span class="keyword">new</span> <span class="title class_">float</span>[]&#123;<span class="number">1.0f</span>, <span class="number">2.0f</span>, <span class="number">3.0f</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//double[]</span></span><br><span class="line"><span class="type">DoubleArray</span> <span class="variable">doubleArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleArray</span>(vm, <span class="keyword">new</span> <span class="title class_">double</span>[]&#123;<span class="number">1.0d</span>, <span class="number">2.0d</span>, <span class="number">3.0d</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Object[]</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayObject</span>(byteArray, intArray);</span><br></pre></td></tr></table></figure>

<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>Listç±»å‹çš„æ•°æ®è¢«å°è£…ä¸ºArrayListObject</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">Test</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">List&lt;DvmObject&lt;?&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(Test.newObject(<span class="literal">null</span>));</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayListObject</span>(vm,list);</span><br></pre></td></tr></table></figure>

<!-- ### è¡¥ç¯å¢ƒ
TODO -->

<h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><h3 id="Moduleä»‹ç»"><a href="#Moduleä»‹ç»" class="headerlink" title="Moduleä»‹ç»"></a>Moduleä»‹ç»</h3><p>åœ¨undibgä¸­ï¼Œç»è¿‡MemoryåŠ è½½åˆ°å†…å­˜ä¸­çš„Elfæ–‡ä»¶ï¼Œéƒ½è¢«æŠ½è±¡ä¸ºä¸€ä¸ªModule(LinuxModule)å¯¹è±¡ã€‚æ— è®ºæ˜¯Emulatorè¿˜æ˜¯VMåŠ è½½çš„ï¼Œåº•å±‚éƒ½æ˜¯å¯¹Memoryçš„loadè¿›è¡Œäº†å°è£…ï¼Œè¿”å›å€¼å°±æ˜¯ä¸€ä¸ªModuleå®ä¾‹ã€‚</p>
<h3 id="Moduleå¸¸ç”¨çš„å±æ€§"><a href="#Moduleå¸¸ç”¨çš„å±æ€§" class="headerlink" title="Moduleå¸¸ç”¨çš„å±æ€§"></a>Moduleå¸¸ç”¨çš„å±æ€§</h3><h4 id="base"><a href="#base" class="headerlink" title="base"></a>base</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;åŠ è½½çš„åŸºå€: &quot;</span>+<span class="keyword">module</span>.base);</span><br></pre></td></tr></table></figure>
<p>baseå±æ€§ç»´æŠ¤äº†è¯¥Elfæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­çš„åŸºå€ã€‚</p>
<h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;æ¨¡å—çš„åç§°: &quot;</span>+<span class="keyword">module</span>.name);</span><br></pre></td></tr></table></figure>
<p>nameå±æ€§ç»´æŠ¤äº†è¯¥æ¨¡å—çš„åç§°ï¼Œé€šå¸¸ä¸ºæ–‡ä»¶åã€‚</p>
<h4 id="callEntry"><a href="#callEntry" class="headerlink" title="callEntry"></a>callEntry</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="keyword">module</span>.callEntry(emulator);</span><br></pre></td></tr></table></figure>
<p>å½“è¢«åŠ è½½çš„æ–‡ä»¶æ˜¯å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œéœ€è¦é€šè¿‡è¯¥æ–¹æ³•æ¥è°ƒç”¨mainå‡½æ•°ã€‚</p>
<h4 id="findSymbolByName"><a href="#findSymbolByName" class="headerlink" title="findSymbolByName"></a>findSymbolByName</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡åå­—æŸ¥æ‰¾å½“å‰æ¨¡å—ä¸­çš„ç¬¦å·ã€‚</p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><h3 id="Backendä»‹ç»"><a href="#Backendä»‹ç»" class="headerlink" title="Backendä»‹ç»"></a>Backendä»‹ç»</h3><p>unidbgå†…ç½®äº†äº”ç§Backendã€‚Backendçš„ä½œç”¨æ˜¯ç”¨æ¥æ¨¡æ‹Ÿæ‰§è¡Œæœºå™¨æŒ‡ä»¤ã€‚å®ƒä½œä¸ºä¸€ä¸ªæ¨¡å—è¢«unidbgå¼•å…¥ï¼Œæä¾›äº†æ¨¡æ‹ŸCPUçš„èƒ½åŠ›ï¼Œä¸”è¢«å°è£…ä¸ºç»Ÿä¸€çš„Backendæ¥å£ã€‚</p>
<h3 id="Backendåˆ—è¡¨"><a href="#Backendåˆ—è¡¨" class="headerlink" title="Backendåˆ—è¡¨"></a>Backendåˆ—è¡¨</h3><p>unidbgé»˜è®¤ä½¿ç”¨Unicornåç«¯ã€‚å³åœ¨åˆ›å»ºAndroidEmulatoræ—¶æ— é¢å¤–æ·»åŠ BackendFactoryå³ä¸ºUnicornåç«¯ã€‚</p>
<h4 id="Unicorn-x2F-Unicorn2"><a href="#Unicorn-x2F-Unicorn2" class="headerlink" title="Unicorn&#x2F;Unicorn2"></a>Unicorn&#x2F;Unicorn2</h4><p><a class="link"   target="_blank" rel="noopener" href="https://www.unicorn-engine.org/" >Unicornå®˜ç½‘<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="ä½¿ç”¨Unicorn2åç«¯"><a href="#ä½¿ç”¨Unicorn2åç«¯" class="headerlink" title="ä½¿ç”¨Unicorn2åç«¯:"></a>ä½¿ç”¨Unicorn2åç«¯:</h5><p>emulator &#x3D; AndroidEmulatorBuilder           .for32Bit()           .addBackendFactory(new Unicorn2Factory(true))           .build();<br />Unicorn2Factoryæ„é€ æ–¹æ³•çš„å‚æ•°è¡¨ç¤ºåœ¨Unicorn2åˆ›å»ºå¤±è´¥æ—¶ï¼Œæ˜¯å¦é€€å›ä½¿ç”¨Unicornåç«¯ã€‚å¦‚è®¾ç½®falseï¼Œåœ¨Unicorn2åç«¯åˆ›å»ºå¤±è´¥åå°±é€€å‡ºï¼Œè€Œä¸é€‰æ‹©ä½¿ç”¨Unicornåç«¯ã€‚</p>
<h5 id="Unicornåç«¯ç‰¹ç‚¹"><a href="#Unicornåç«¯ç‰¹ç‚¹" class="headerlink" title="Unicornåç«¯ç‰¹ç‚¹"></a>Unicornåç«¯ç‰¹ç‚¹</h5><ul>
<li>æ‰§è¡Œè¾ƒå…¶ä»–åç«¯æ…¢</li>
<li>æ”¯æŒåŸç”ŸHook</li>
<li>æ”¯æŒDebuggeråŠŸèƒ½</li>
<li>æ”¯æŒåŸç”ŸTrace</li>
</ul>
<p>å¯¹è°ƒè¯•ã€TraceåŠŸèƒ½æ”¯æŒè¾ƒå¥½ï¼Œç¼ºç‚¹æ˜¯æ‰§è¡Œè¾ƒæ…¢ã€‚æ¨èåœ¨å®éªŒç¯å¢ƒä¸­ä½¿ç”¨ã€‚</p>
<h4 id="Dynarmic"><a href="#Dynarmic" class="headerlink" title="Dynarmic"></a>Dynarmic</h4><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/MerryMage/dynarmic" >Dynarmicå®˜ç½‘<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="ä½¿ç”¨Dynarmicåç«¯"><a href="#ä½¿ç”¨Dynarmicåç«¯" class="headerlink" title="ä½¿ç”¨Dynarmicåç«¯"></a>ä½¿ç”¨Dynarmicåç«¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for32Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">DynarmicFactory</span>(<span class="literal">true</span>))</span><br><span class="line">          .build();</span><br></pre></td></tr></table></figure>

<h5 id="Dynarmicåç«¯ç‰¹ç‚¹"><a href="#Dynarmicåç«¯ç‰¹ç‚¹" class="headerlink" title="Dynarmicåç«¯ç‰¹ç‚¹"></a>Dynarmicåç«¯ç‰¹ç‚¹</h5><ul>
<li>æ‰§è¡Œé€Ÿåº¦å¿«</li>
<li>æ— åŸç”ŸHookåŠŸèƒ½</li>
</ul>
<p>ç”Ÿäº§ç¯å¢ƒæ¨èä½¿ç”¨ï¼Œé€Ÿåº¦æ¯”Unicornå¿«å¾ˆå¤šã€‚</p>
<h4 id="Hypervisor"><a href="#Hypervisor" class="headerlink" title="Hypervisor"></a>Hypervisor</h4><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/Bareflank/hypervisor" >Hypervisorå®˜ç½‘<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="ä½¿ç”¨Hypervisoråç«¯"><a href="#ä½¿ç”¨Hypervisoråç«¯" class="headerlink" title="ä½¿ç”¨Hypervisoråç«¯"></a>ä½¿ç”¨Hypervisoråç«¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for32Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">HypervisorFactory</span>(<span class="literal">true</span>))</span><br><span class="line">          .build()</span><br></pre></td></tr></table></figure>

<h5 id="Hypervisoråç«¯ç‰¹ç‚¹"><a href="#Hypervisoråç«¯ç‰¹ç‚¹" class="headerlink" title="Hypervisoråç«¯ç‰¹ç‚¹"></a>Hypervisoråç«¯ç‰¹ç‚¹</h5><ul>
<li>æ”¯æŒApple M1</li>
<li>æœ€å¿«çš„ARM64åç«¯</li>
</ul>
<h4 id="Kvm"><a href="#Kvm" class="headerlink" title="Kvm"></a>Kvm</h4><p><a class="link"   target="_blank" rel="noopener" href="https://github.com/kholia/OSX-KVM" >Kvmå®˜ç½‘<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="ä½¿ç”¨Kvmåç«¯"><a href="#ä½¿ç”¨Kvmåç«¯" class="headerlink" title="ä½¿ç”¨Kvmåç«¯"></a>ä½¿ç”¨Kvmåç«¯</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for64Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">KvmFactory</span>(<span class="literal">false</span>))</span><br><span class="line">          .build();</span><br></pre></td></tr></table></figure>

<h5 id="Kvmåç«¯ç‰¹ç‚¹"><a href="#Kvmåç«¯ç‰¹ç‚¹" class="headerlink" title="Kvmåç«¯ç‰¹ç‚¹"></a>Kvmåç«¯ç‰¹ç‚¹</h5><ul>
<li>æ”¯æŒRaspberry Pi B4</li>
</ul>
<h3 id="Backendæ¥å£"><a href="#Backendæ¥å£" class="headerlink" title="Backendæ¥å£"></a>Backendæ¥å£</h3><p>Backendä¸ºCPUçš„æŠ½è±¡æ¥å£ï¼Œé€šè¿‡å®ƒå¯ä»¥ç›´æ¥è¯»å†™CPUçš„å¯„å­˜å™¨çš„å€¼ã€å†…å­˜è¯»å†™ã€‚unidbgå¯¹æ­¤ç±»æ¥å£éƒ½æœ‰å¯¹åº”çš„å°è£…ï¼Œä¸å»ºè®®ç›´æ¥ä½¿ç”¨æ­¤ç±»æ¥å£ã€‚</p>
<h2 id="Deggbuer"><a href="#Deggbuer" class="headerlink" title="Deggbuer"></a>Deggbuer</h2><h3 id="Debuggerä»‹ç»"><a href="#Debuggerä»‹ç»" class="headerlink" title="Debuggerä»‹ç»"></a>Debuggerä»‹ç»</h3><p><strong>é‡è¦æé†’: åªæœ‰unicornåç«¯æ”¯æŒè°ƒè¯•åŠŸèƒ½ï¼ï¼ï¼</strong> <strong>é‡è¦æé†’: åªæœ‰unicornåç«¯æ”¯æŒè°ƒè¯•åŠŸèƒ½ï¼ï¼ï¼</strong> <strong>é‡è¦æé†’: åªæœ‰unicornåç«¯æ”¯æŒè°ƒè¯•åŠŸèƒ½ï¼ï¼ï¼</strong><br />è°ƒè¯•æ˜¯åœ¨é€†å‘å·¥ç¨‹ä¸­ä¸å¯ç¼ºå°‘çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿå®šä½é—®é¢˜ã€‚åœ¨unidbgä¹Ÿæ˜¯æ”¯æŒçš„ï¼Œè€Œä¸”è¿™éƒ¨åˆ†åŠŸèƒ½åŸºäºåŸç”ŸUnicornåç«¯ï¼Œæ”¯æŒéå¸¸å¥½ã€‚<br />ä¸»è¦åŠŸèƒ½:</p>
<ul>
<li>æ–­ç‚¹è°ƒè¯•</li>
<li>å†…å­˜è¯»å†™</li>
<li>å¯„å­˜å™¨è¯»å†™</li>
<li>å•æ­¥è°ƒè¯•</li>
<li>å †æ ˆæœç´¢</li>
<li>è°ƒç”¨æ ˆæ‰“å°</li>
<li>åæ±‡ç¼–</li>
<li>patch</li>
</ul>
<h3 id="ConsoleDebugger"><a href="#ConsoleDebugger" class="headerlink" title="ConsoleDebugger"></a>ConsoleDebugger</h3><h4 id="ä½¿ç”¨æ­¥éª¤"><a href="#ä½¿ç”¨æ­¥éª¤" class="headerlink" title="ä½¿ç”¨æ­¥éª¤"></a>ä½¿ç”¨æ­¥éª¤</h4><h5 id="ç¬¬é›¶æ­¥"><a href="#ç¬¬é›¶æ­¥" class="headerlink" title="ç¬¬é›¶æ­¥"></a>ç¬¬é›¶æ­¥</h5><p>å†æç¤ºä¸€ä¸‹ï¼Œå…ˆå°†åç«¯åˆ‡æ¢å›Unicornã€‚å¦‚ä½•åˆ‡æ¢è¯·æŸ¥çœ‹: <a href="#Backend">Backend</a></p>
<h5 id="ç¬¬ä¸€æ­¥"><a href="#ç¬¬ä¸€æ­¥" class="headerlink" title="ç¬¬ä¸€æ­¥"></a>ç¬¬ä¸€æ­¥</h5><p>å¾—åˆ°æ§åˆ¶å°è°ƒè¯•å™¨å®ä¾‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Debugger</span> <span class="variable">debugger</span> <span class="operator">=</span> emulator.attach();</span><br></pre></td></tr></table></figure>

<h5 id="ç¬¬äºŒæ­¥"><a href="#ç¬¬äºŒæ­¥" class="headerlink" title="ç¬¬äºŒæ­¥"></a>ç¬¬äºŒæ­¥</h5><p>ä¸‹æ–­ç‚¹ã€‚ä¸‹æ–­ç‚¹æœ‰å¤šç§é‡è½½æ–¹ä¾¿ä½¿ç”¨:</p>
<ul>
<li>æ¨¡å— + åç§»</li>
<li>æ¨¡å— + ç¬¦å·å</li>
<li>ç»å¯¹åœ°å€<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ¨¡å— + åç§»</span></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="number">0x8607</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ¨¡å— + ç¬¦å·</span></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="string">&quot;Java_com_github_unidbg_Test_sign&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç»å¯¹åœ°å€</span></span><br><span class="line"><span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0x8607</span>;</span><br><span class="line">debugger.addBreakPoint(address);</span><br></pre></td></tr></table></figure>
<strong><font color="red">ä¸‹æ–­ç‚¹æ— éœ€æ‰‹åŠ¨thumbæŒ‡ä»¤+1æ“ä½œï¼Œæ‰‹åŠ¨+1ä¸‹æ–­ç‚¹ä¹Ÿæ˜¯ä¸€æ ·çš„æ•ˆæœã€‚ä½†æ‰‹åŠ¨+1ä¼šæœ‰å…¶ä»–çš„ä½œç”¨ï¼Œå¦‚æŸ¥çœ‹æ–­ç‚¹ç­‰åŠŸèƒ½ï¼Œæ¨èæ‰‹åŠ¨+1ã€‚</font></strong><br />è¿˜æœ‰å…¶ä»–ä¸‰ç§æ–­ç‚¹é‡è½½ï¼Œæ·»åŠ ä¸€ä¸ªæ–­ç‚¹å›è°ƒ:<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BreakPointCallback</span> <span class="variable">breakPointCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">      <span class="comment">//å½“æ–­ç‚¹å‘½ä¸­ä¼šå›è°ƒæ­¤æ–¹æ³•</span></span><br><span class="line">      <span class="comment">//do something...</span></span><br><span class="line">      <span class="comment">//è¿”å›å€¼å†³å®šæ˜¯å¦è¿›å…¥æ‰‹åŠ¨è°ƒè¯•ã€‚</span></span><br><span class="line">      <span class="comment">//è¿”å›trueï¼Œåˆ™åªå›è°ƒæ­¤æ–¹æ³•ï¼Œä¸è¿›å…¥è°ƒè¯•</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="number">0x8607</span>, breakPointCallback);</span><br><span class="line"></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="string">&quot;Java_com_github_unidbg_Test_sign&quot;</span>, breakPointCallback);</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0x8607</span>;</span><br><span class="line">debugger.addBreakPoint(address, breakPointCallback);</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="ç¬¬ä¸‰æ­¥"><a href="#ç¬¬ä¸‰æ­¥" class="headerlink" title="ç¬¬ä¸‰æ­¥"></a>ç¬¬ä¸‰æ­¥</h5><p>æ‰§è¡Œã€‚æ— è®ºä½¿ç”¨å“ªç§æ–¹å¼å¯¹ç›®æ ‡åœ°å€ä¸‹æ–­ç‚¹ï¼Œåœ¨æ‰§è¡Œèµ·æ¥åå¦‚æœæ‰§è¡Œåˆ°æ–­ç‚¹ä½ç½®ï¼Œå°±ä¼šåœ¨æ§åˆ¶å°æ–­ä¸‹ç­‰å¾…å‘½ä»¤çš„è¾“å…¥ã€‚ä»¥æˆ‘ç›®å‰ä¾‹å­ï¼Œå‘½ä¸­æ–­ç‚¹åè¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">debugger <span class="keyword">break</span> at: <span class="number">0x40008606</span> @ Function32 address=<span class="number">0x40008607</span>, arguments=[unidbg@<span class="number">0xfffe12a0</span>[libadd.so]<span class="number">0x2a0</span>, <span class="number">17037394</span>, <span class="number">1</span>]</span><br><span class="line">&gt;&gt;&gt; r0=<span class="number">0xfffe12a0</span>(-<span class="number">126304</span>) r1=<span class="number">0x103f852</span> r2=<span class="number">0x1</span> r3=<span class="number">0x2</span> r4=<span class="number">0x0</span> r5=<span class="number">0x0</span> r6=<span class="number">0x0</span> r7=<span class="number">0x0</span> r8=<span class="number">0x0</span> sb=<span class="number">0x0</span> sl=<span class="number">0x0</span> fp=<span class="number">0x0</span> ip=<span class="number">0x401315e0</span></span><br><span class="line">&gt;&gt;&gt; SP=<span class="number">0xbffff730</span> LR=unidbg@<span class="number">0xffff0000</span> PC=RX@<span class="number">0x40008606</span>[libnative-doc.so]<span class="number">0x8606</span> cpsr: N=<span class="number">0</span>, Z=<span class="number">1</span>, C=<span class="number">0</span>, V=<span class="number">0</span>, T=<span class="number">1</span>, mode=<span class="number">0b10000</span></span><br><span class="line">&gt;&gt;&gt; d0=<span class="number">0x0</span>(<span class="number">0.0</span>) d1=<span class="number">0x3220302034203720</span>(<span class="number">3.002229861217884E-67</span>) d2=<span class="number">0x3436333832203236</span>(<span class="number">3.5366761868402984E-57</span>) d3=<span class="number">0x3120323938343135</span>(<span class="number">4.583358096989596E-72</span>) d4=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d5=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d6=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d7=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>)</span><br><span class="line">&gt;&gt;&gt; d8=<span class="number">0x0</span>(<span class="number">0.0</span>) d9=<span class="number">0x0</span>(<span class="number">0.0</span>) d10=<span class="number">0x0</span>(<span class="number">0.0</span>) d11=<span class="number">0x0</span>(<span class="number">0.0</span>) d12=<span class="number">0x0</span>(<span class="number">0.0</span>) d13=<span class="number">0x0</span>(<span class="number">0.0</span>) d14=<span class="number">0x0</span>(<span class="number">0.0</span>) d15=<span class="number">0x0</span>(<span class="number">0.0</span>)</span><br><span class="line">Java_com_github_unidbg_Test_sign + <span class="number">0x0</span></span><br><span class="line">=&gt; *[libnative-doc.so*<span class="number">0x08607</span>]*[80b5    ]*<span class="number">0x40008606</span>:*<span class="string">&quot;push &#123;r7, lr&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08609</span>] [6f46    ] <span class="number">0x40008608</span>: <span class="string">&quot;mov r7, sp&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860b</span>] [84b0    ] <span class="number">0x4000860a</span>: <span class="string">&quot;sub sp, #0x10&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860d</span>] [0390    ] <span class="number">0x4000860c</span>: <span class="string">&quot;str r0, [sp, #0xc]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860f</span>] [0291    ] <span class="number">0x4000860e</span>: <span class="string">&quot;str r1, [sp, #8]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08611</span>] [0192    ] <span class="number">0x40008610</span>: <span class="string">&quot;str r2, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08613</span>] [0198    ] <span class="number">0x40008612</span>: <span class="string">&quot;ldr r0, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08615</span>] [4ff48061] <span class="number">0x40008614</span>: <span class="string">&quot;mov.w r1, #0x400&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08619</span>] [fff75aec] <span class="number">0x40008618</span>: <span class="string">&quot;blx #0x40007ed0&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0861d</span>] [04b0    ] <span class="number">0x4000861c</span>: <span class="string">&quot;add sp, #0x10&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0861f</span>] [80bd    ] <span class="number">0x4000861e</span>: <span class="string">&quot;pop &#123;r7, pc&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08621</span>] [80b5    ] <span class="number">0x40008620</span>: <span class="string">&quot;push &#123;r7, lr&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08623</span>] [6f46    ] <span class="number">0x40008622</span>: <span class="string">&quot;mov r7, sp&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08625</span>] [82b0    ] <span class="number">0x40008624</span>: <span class="string">&quot;sub sp, #8&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08627</span>] [0190    ] <span class="number">0x40008626</span>: <span class="string">&quot;str r0, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08629</span>] [0198    ] <span class="number">0x40008628</span>: <span class="string">&quot;ldr r0, [sp, #4]&quot;</span></span><br></pre></td></tr></table></figure>
<p>ä¸»è¦ä¿¡æ¯æœ‰: æ–­ç‚¹å’Œå½“å‰å‡½æ•°å‚æ•°ä¿¡æ¯ï¼Œå½“å‰æ‰€æœ‰å¯„å­˜å™¨ä¿¡æ¯ï¼Œå½“å‰ä½ç½®çš„åæ±‡ç¼–ä¿¡æ¯ã€‚ çœ‹åˆ°å¦‚ä¸Šè°ƒè¯•ä¿¡æ¯åï¼Œunidbgå°±ä¼šç­‰å¾…å‘½ä»¤çš„è¾“å…¥ï¼Œå‘½ä»¤æ‰æ˜¯ConsoleDebuggerçš„æ ¸å¿ƒã€‚ä¸‹é¢æˆ‘ä»¬å°±æ¥çœ‹å¦‚ä½•ä½¿ç”¨å‘½ä»¤æ¥æ“ä½œConsoleDebuggerã€‚</p>
<h4 id="è°ƒè¯•æŒ‡ä»¤"><a href="#è°ƒè¯•æŒ‡ä»¤" class="headerlink" title="è°ƒè¯•æŒ‡ä»¤"></a>è°ƒè¯•æŒ‡ä»¤</h4><h5 id="help"><a href="#help" class="headerlink" title="help"></a>help</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">help </span><br></pre></td></tr></table></figure>
<p>ä¼šçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼Œæ­¤ä¸ºConsoleDebuggerçš„å¸®åŠ©æ–‡æ¡£ã€‚æˆ‘ä»¬ä¸‹é¢ä¹Ÿæ˜¯ä»‹ç»æ­¤å¸®åŠ©æ–‡æ¡£çš„å†…å®¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">help</span><br><span class="line">c: <span class="keyword">continue</span></span><br><span class="line">n: step over</span><br><span class="line">bt: back trace</span><br><span class="line"></span><br><span class="line">st hex: search stack</span><br><span class="line">shw hex: search writable heap</span><br><span class="line">shr hex: search readable heap</span><br><span class="line">shx hex: search executable heap</span><br><span class="line"></span><br><span class="line">nb: <span class="keyword">break</span> at next block</span><br><span class="line">s|si: step into</span><br><span class="line">s[decimal]: execute specified amount instruction</span><br><span class="line"><span class="title function_">s</span><span class="params">(blx)</span>: execute util BLX mnemonic, low performance</span><br><span class="line"></span><br><span class="line"><span class="title function_">m</span><span class="params">(op)</span> [size]: show memory, <span class="keyword">default</span> size is <span class="number">0x70</span>, size may hex or decimal</span><br><span class="line">mr0-mr7, mfp, mip, msp [size]: show memory of specified register</span><br><span class="line"><span class="title function_">m</span><span class="params">(address)</span> [size]: show memory of specified address, address must start with 0x</span><br><span class="line"></span><br><span class="line">wr0-wr7, wfp, wip, wsp &lt;value&gt;: write specified register</span><br><span class="line"><span class="title function_">wb</span><span class="params">(address)</span>, ws(address), wi(address) &lt;value&gt;: write (<span class="type">byte</span>, <span class="type">short</span>, integer) memory of specified address, address must start with 0x</span><br><span class="line"><span class="title function_">wx</span><span class="params">(address)</span> &lt;hex&gt;: write bytes to memory at specified address, address must start with 0x</span><br><span class="line"></span><br><span class="line"><span class="title function_">b</span><span class="params">(address)</span>: add temporarily breakpoint, address must start with 0x, can be <span class="keyword">module</span> offset</span><br><span class="line">b: add breakpoint of register PC</span><br><span class="line">r: remove breakpoint of register PC</span><br><span class="line">blr: add temporarily breakpoint of register LR</span><br><span class="line"></span><br><span class="line"><span class="title function_">p</span> <span class="params">(assembly)</span>: patch assembly at PC address</span><br><span class="line">where: show java stack trace</span><br><span class="line"></span><br><span class="line">trace [begin end]: Set trace instructions</span><br><span class="line">traceRead [begin end]: Set trace memory read</span><br><span class="line">traceWrite [begin end]: Set trace memory write</span><br><span class="line">vm: view loaded modules</span><br><span class="line">vbs: view breakpoints</span><br><span class="line">d|dis: show disassemble</span><br><span class="line"><span class="title function_">d</span><span class="params">(0x)</span>: show disassemble at specify address</span><br><span class="line">stop: stop emulation</span><br><span class="line">run [arg]: run test</span><br><span class="line">gc: Run System.gc()</span><br><span class="line">cc size: convert asm from <span class="number">0x40008608</span> - <span class="number">0x40008608</span> + size bytes to c function</span><br></pre></td></tr></table></figure>
<h4 id="shr"><a href="#shr" class="headerlink" title="shr"></a>shr</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shr 637c777bf26b6fc5</span><br></pre></td></tr></table></figure>
<p>å†…å­˜æŸ¥æ‰¾å­—èŠ‚</p>
<h5 id="show-disassemble"><a href="#show-disassemble" class="headerlink" title="show disassemble"></a>show disassemble</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d | dis</span><br></pre></td></tr></table></figure>
<p>æ‰“å°å½“å‰ä½ç½®åç¼–è¯‘ä¿¡æ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d(address)</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">d0x40008607</span><br></pre></td></tr></table></figure>
<p>æ‰“å°æŒ‡å®šåœ°å€å¤„çš„åç¼–è¯‘ä¿¡æ¯ã€‚</p>
<h5 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c</span><br></pre></td></tr></table></figure>
<p>ç»§ç»­æ‰§è¡Œã€‚ç›´è‡³é‡åˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹æ–­ä¸‹æˆ–è¿è¡Œç»“æŸã€‚</p>
<h5 id="step-over"><a href="#step-over" class="headerlink" title="step over"></a>step over</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure>
<p>å•æ­¥æ­¥è¿‡ï¼Œä¸è¿›å…¥è·³è½¬æŒ‡ä»¤ã€‚</p>
<h5 id="step-into"><a href="#step-into" class="headerlink" title="step into"></a>step into</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s | si </span><br></pre></td></tr></table></figure>
<p>å•æ­¥æ‰§è¡Œã€‚æ‰§è¡Œä¸€å¥æŒ‡ä»¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s10 </span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œ10å¥æŒ‡ä»¤ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sblx </span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåˆ°blxæŒ‡ä»¤ã€‚æ€§èƒ½è¾ƒä½ã€‚</p>
<h5 id="next-block"><a href="#next-block" class="headerlink" title="next block"></a>next block</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nb </span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œåˆ°ä¸‹ä¸€<a href="#Block">block</a>å¤„ã€‚</p>
<h5 id="b"><a href="#b" class="headerlink" title="b"></a>b</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b </span><br></pre></td></tr></table></figure>
<p>å¯åœ¨å½“å‰PCå¤„ä¸‹æ–­ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b0x40008607 </span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šåœ°å€ä¸‹æ–­ç‚¹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b0x8607 </span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šåç§»ä¸‹æ–­ç‚¹ï¼Œä¼šæ ¹æ®å½“å‰ä½ç½®çš„æ¨¡å—æ¥è®¡ç®—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">blr </span><br></pre></td></tr></table></figure>
<p>åœ¨LRå¤„ä¸‹æ–­ç‚¹ã€‚</p>
<h5 id="r"><a href="#r" class="headerlink" title="r"></a>r</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">r </span><br></pre></td></tr></table></figure>
<p>åˆ é™¤å½“å‰ä½ç½®çš„æ–­ç‚¹ã€‚</p>
<h5 id="blr"><a href="#blr" class="headerlink" title="blr"></a>blr</h5><p>åœ¨å‡½æ•°è¿”å›æ—¶å€™ä¸‹æ–­ç‚¹</p>
<h5 id="vbs"><a href="#vbs" class="headerlink" title="vbs"></a>vbs</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vbs </span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å½“å‰ä¸‹çš„æ‰€æœ‰æ–­ç‚¹ã€‚</p>
<h5 id="back-trace"><a href="#back-trace" class="headerlink" title="back trace"></a>back trace</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bt </span><br></pre></td></tr></table></figure>
<p>æ‰“å°å½“å‰ä½ç½®è°ƒç”¨æ ˆã€‚</p>
<h5 id="show-memory"><a href="#show-memory" class="headerlink" title="show memory"></a>show memory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mr0-mr7 | mfp | mip | msp [size]</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">mr1 <span class="number">0x10</span></span><br></pre></td></tr></table></figure>
<p>è¯»å–å¯¹åº”å¯„å­˜å™¨æ‰€æŒ‡å‘çš„åœ°å€çš„å†…å­˜ã€‚sizeæŒ‡å®šå¤§å°ï¼Œé»˜è®¤0x70å¤§å°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m(address) [size]</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">m0xbffff730 <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>è¯»å–æŒ‡å®šåœ°å€çš„å†…å­˜ã€‚åœ°å€å¿…é¡»ä¸º0xå¼€å¤´çš„åå…­è¿›åˆ¶æ•°ã€‚</p>
<h5 id="write-memory"><a href="#write-memory" class="headerlink" title="write memory"></a>write memory</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wr0-wr7, wfp, wip, wsp &lt;value&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">wr2 <span class="number">0x100</span></span><br></pre></td></tr></table></figure>
<p>å‘å¯¹åº”å¯„å­˜å™¨å†™å…¥valueæŒ‡å®šçš„å€¼ã€‚æ­¤å€¼å¯ä¸º0xå¼€å¤´åå…­è¿›åˆ¶æ•°ï¼Œå¯ä¸ºåè¿›åˆ¶æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wb(address), ws(address), wi(address) &lt;value&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">wb0x40008606 <span class="number">1</span></span><br><span class="line">ws0x40008606 <span class="number">0xb502</span></span><br></pre></td></tr></table></figure>
<p>å‘æŒ‡å®šåœ°å€å†™å…¥valueæŒ‡å®šçš„å€¼ã€‚å†™å…¥çš„å®½åº¦ç”±ä¸åŒæŒ‡ä»¤æ‰€æŒ‡å®šï¼Œwbèƒ½å†™å…¥ä¸€ä¸ªå­—èŠ‚æ•°æ®ã€wsèƒ½shortæ•°æ®ã€wièƒ½å†™å…¥intæ•°æ®ï¼Œä¸”å¤§å°ç«¯åºä¼šè¢«è‡ªåŠ¨è½¬æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wx(address) &lt;hex&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">wx0x40008606 b502</span><br></pre></td></tr></table></figure>
<p>å‘æŒ‡å®šåœ°å€å†™å…¥hexæ•°æ®ï¼Œæ­¤å¤„hexä¸èƒ½åŠ 0xå¼€å¤´ï¼Œç›´æ¥å†™åå…­è¿›åˆ¶å°±å¯ä»¥äº†ã€‚</p>
<h5 id="search-stack"><a href="#search-stack" class="headerlink" title="search stack"></a>search stack</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">st &lt;hex&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">st <span class="number">313233</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å½“å‰æ ˆä¸Šæœç´¢æŒ‡å®šçš„hexæ•°æ®ã€‚</p>
<h5 id="search-writable-heap"><a href="#search-writable-heap" class="headerlink" title="search writable heap"></a>search writable heap</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shr &lt;hex&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">shr <span class="number">313233</span></span><br></pre></td></tr></table></figure>
<p>åœ¨å¯å†™çš„å†…å­˜æœç´¢æŒ‡å®šçš„hexæ•°æ®ã€‚</p>
<h5 id="search-readable-heap"><a href="#search-readable-heap" class="headerlink" title="search readable heap"></a>search readable heap</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shx &lt;hex&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">shx 6f46</span><br></pre></td></tr></table></figure>
<p>åœ¨å¯è¯»çš„å†…å­˜æœç´¢æŒ‡å®šçš„hexæ•°æ®ã€‚</p>
<h5 id="search-executable-heap"><a href="#search-executable-heap" class="headerlink" title="search executable heap"></a>search executable heap</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">shx &lt;hex&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">shx 6f46</span><br></pre></td></tr></table></figure>
<p>åœ¨å¯æ‰§è¡Œçš„å†…å­˜æœç´¢æŒ‡å®šçš„hexæ•°æ®ã€‚</p>
<h5 id="where"><a href="#where" class="headerlink" title="where"></a>where</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">where </span><br></pre></td></tr></table></figure>
<p>æ‰“å°å½“å‰unidbgçš„è°ƒç”¨æ ˆã€‚</p>
<h5 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vm </span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹å½“å‰æ‰€æœ‰åŠ è½½çš„æ¨¡å—ã€‚</p>
<h5 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stop </span><br></pre></td></tr></table></figure>
<p>åœæ­¢è¿è¡Œã€‚</p>
<h5 id="patch-1"><a href="#patch-1" class="headerlink" title="patch"></a>patch</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p &lt;assembly&gt;</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">p movs r0, #<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>å°†å½“å‰ä½ç½®è¿›è¡Œpatchï¼Œæ— éœ€å…³å¿ƒthumbã€‚</p>
<h5 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">trace [begin end]</span><br><span class="line"><span class="comment">//å¦‚</span></span><br><span class="line">trace <span class="number">0x40008606</span> <span class="number">0x40008612</span></span><br><span class="line"></span><br><span class="line">traceRead [begin end]</span><br><span class="line">traceWrite [begin end]</span><br></pre></td></tr></table></figure>
<p>æŒ‡å®šèµ·å§‹ç»“æŸä½ç½®è¿›è¡Œtraceã€‚</p>
<h3 id="GDB-SERVER"><a href="#GDB-SERVER" class="headerlink" title="GDB_SERVER"></a>GDB_SERVER</h3><p>ä¸æ¨èä½¿ç”¨ã€‚è¯·ä½¿ç”¨<a href="#ConsoleDebugger">ConsoleDebugger</a>ã€‚</p>
<h3 id="ANDROID-SERVER-V7"><a href="#ANDROID-SERVER-V7" class="headerlink" title="ANDROID_SERVER_V7"></a>ANDROID_SERVER_V7</h3><p>ä¸æ¨èä½¿ç”¨ã€‚è¯·ä½¿ç”¨<a href="#ConsoleDebugger">ConsoleDebugger</a>ã€‚</p>
<h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><p>ä»€ä¹ˆå«åšblockï¼Ÿç®€å•æ¥è¯´å°±æ˜¯æœªå‘ç”Ÿè·³è½¬çš„ä¸€æ•´æ®µæ±‡ç¼–ä¸ºä¸€ä¸ªblockï¼Œå¦‚å‘ç”ŸBç³»åˆ—æŒ‡ä»¤è·³è½¬ï¼Œå°±ä¼šè¿›å…¥ä¸‹ä¸€blockã€‚<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/01.png"
                      alt="01"
                ></p>
<h2 id="RegisterContext"><a href="#RegisterContext" class="headerlink" title="RegisterContext"></a>RegisterContext</h2><p>TODO</p>
<h2 id="SyscallHandler-1"><a href="#SyscallHandler-1" class="headerlink" title="SyscallHandler"></a>SyscallHandler</h2><h3 id="SyscallHandlerä»‹ç»"><a href="#SyscallHandlerä»‹ç»" class="headerlink" title="SyscallHandlerä»‹ç»"></a>SyscallHandlerä»‹ç»</h3><p>SyscallHandleræ¨¡å—ä¸ºå¤„ç†ç³»ç»Ÿè°ƒç”¨å¤„ç†å™¨çš„æ ¸å¿ƒæ¨¡å—ï¼Œæ¨¡æ‹Ÿäº†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€äº§ç”Ÿçš„å¤§å¤§å°å°çš„ç³»ç»Ÿè°ƒç”¨ã€‚è™½ç„¶è¯¥æ¨¡å—ä¸ºæ ¸å¿ƒæ¨¡å—ï¼Œä½†æä¾›çš„APIå¹¶ä¸å¤šï¼Œæˆ‘ä»¬æ¥çœ‹ã€‚</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="è·å–SyscallHandlerå®ä¾‹"><a href="#è·å–SyscallHandlerå®ä¾‹" class="headerlink" title="è·å–SyscallHandlerå®ä¾‹"></a>è·å–SyscallHandlerå®ä¾‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SyscallHandler&lt;AndroidFileIO&gt; syscallHandler = emulator.getSyscallHandler(); </span><br></pre></td></tr></table></figure>

<h4 id="setVerbose"><a href="#setVerbose" class="headerlink" title="setVerbose"></a>setVerbose</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syscallHandler.setVerbose(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure>
<p>éƒ¨åˆ†ç³»ç»Ÿè°ƒç”¨æ—¥å¿—å¼€å…³ã€‚</p>
<h4 id="addIOResolver"><a href="#addIOResolver" class="headerlink" title="addIOResolver"></a>addIOResolver</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">syscallHandler.addIOResolver(<span class="keyword">new</span> <span class="title class_">IOResolver</span>&lt;AndroidFileIO&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> FileResult&lt;AndroidFileIO&gt; <span class="title function_">resolve</span><span class="params">(Emulator&lt;AndroidFileIO&gt; emulator, String pathname, <span class="type">int</span> oflags)</span> &#123;</span><br><span class="line">        <span class="comment">//å‚æ•°äºŒ: æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">        <span class="comment">//å‚æ•°ä¸‰: æ“ä½œæ–‡ä»¶æ ‡å¿—</span></span><br><span class="line">        <span class="comment">//è¿”å›å€¼: FileResult </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>æ·»åŠ IOå¤„ç†å™¨ã€‚å¦‚æœåœ¨æ¨¡æ‹Ÿæ‰§è¡ŒæœŸé—´ï¼Œæœ‰è¯»å†™æ–‡ä»¶æ“ä½œï¼Œå¯ç”±è‡ªå®šä¹‰æŒ‡å®šçš„IOå¤„ç†å™¨è¿›è¡Œå¤„ç†ï¼Œä¸”è‡ªå®šä¹‰IOå¤„ç†å™¨çš„ä¼˜å…ˆçº§æœ€é«˜ã€‚å…³äºè¿”å›å€¼è¯·æŸ¥çœ‹<a href="#FileResult">FileResult</a>ã€‚</p>
<h4 id="setEnableThreadDispatcher"><a href="#setEnableThreadDispatcher" class="headerlink" title="setEnableThreadDispatcher"></a>setEnableThreadDispatcher</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">syscallHandler.setEnableThreadDispatcher(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure>
<p>å¤šçº¿ç¨‹è‡ªåŠ¨è°ƒåº¦å¼€å…³ã€‚å¼€å¯æ­¤å¼€å…³ï¼Œä¼šä»¥å¤šçº¿ç¨‹æ¨¡å¼è¿è¡Œï¼Œå½“æœ‰çº¿ç¨‹åˆ›å»ºä¼šè‡ªåŠ¨è¿›è¡Œå¤„ç†è°ƒåº¦ã€‚</p>
<h4 id="setFileListener"><a href="#setFileListener" class="headerlink" title="setFileListener"></a>setFileListener</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">syscallHandler.setFileListener(<span class="keyword">new</span> <span class="title class_">FileListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpenSuccess</span><span class="params">(Emulator&lt;?&gt; emulator, String pathname, FileIO io)</span> &#123;</span><br><span class="line">        System.out.println(pathname+<span class="string">&quot;æ–‡ä»¶æ‰“å¼€æˆåŠŸï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Emulator&lt;?&gt; emulator, FileIO io)</span> &#123;</span><br><span class="line">        System.err.println(io.getPath()+<span class="string">&quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è®¾ç½®æ–‡ä»¶ç›‘å¬å™¨ã€‚æ­¤APIåœ¨åœ¨è¿è¡ŒæœŸé—´ï¼Œå¯ä»¥ç›‘å¬æ‰€æœ‰æˆåŠŸæ‰“å¼€å’Œå…³é—­çš„æ–‡ä»¶ï¼Œæ‰“å¼€å¤±è´¥çš„æ–‡ä»¶ä¸ä¼šè¿›è¡Œå›è°ƒã€‚</p>
<h4 id="getFileIO"><a href="#getFileIO" class="headerlink" title="getFileIO"></a>getFileIO</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FileIO</span> <span class="variable">fileIO</span> <span class="operator">=</span> syscallHandler.getFileIO(<span class="number">0</span>); </span><br></pre></td></tr></table></figure>
<p>æ ¹æ®fdæŸ¥è¯¢å¯¹åº”çš„Fileã€‚</p>
<h3 id="è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨"><a href="#è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨"></a>è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨</h3><p>å¦‚æœunidbgå¤„ç†çš„ç³»ç»Ÿè°ƒç”¨ä¸è¶³ä»¥æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œå¯ä»¥è‡ªå·±å‚è€ƒunidbgçš„å¤„ç†æ–¹å¼ï¼Œå®šåˆ¶SyscallHandleræ¥å¤„ç†ã€‚</p>
<h3 id="FileResult"><a href="#FileResult" class="headerlink" title="FileResult"></a>FileResult</h3><p>åœ¨è‡ªå®šä¹‰IOå¤„ç†ä¸­ï¼ŒFileResultä½œä¸ºå›è°ƒæ–¹æ³•çš„è¿”å›å€¼ã€‚å…¶æœ‰3ä¸ªé™æ€æ–¹æ³•ï¼Œåˆ†åˆ«ä»£è¡¨å¯¹æ–‡ä»¶çš„ä¸åŒæ“ä½œã€‚</p>
<h4 id="success"><a href="#success" class="headerlink" title="success"></a>success</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileResult.&lt;AndroidFileIO&gt;success(<span class="keyword">new</span> <span class="title class_">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;filepath&quot;</span>),pathname));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>successæ–¹æ³•è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æ­£å¸¸å¤„ç†ã€‚å‚æ•°æ˜¯ä¸€ä¸ªNewFileIOæ¥å£çš„å®ç°ï¼Œæ ¹æ®ä¸åŒçš„åœºæ™¯è¿”å›ä¸åŒã€‚å¦‚ä¸Šé¢ä¾‹å­ï¼Œå°±æ˜¯è¿”å›ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œå°±ä½¿ç”¨SimpleFileIOå®ç°ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œå°±ä½¿ç”¨DirectoryFileIOå®ç°ï¼Œå…¶ä»–åœºæ™¯å¯è‡ªè¡ŒæŸ¥çœ‹æ¥å£çš„å®ç°ç±»ã€‚</p>
<h4 id="failed"><a href="#failed" class="headerlink" title="failed"></a>failed</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileResult.failed(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºæ–‡ä»¶æ‰“å¼€å¤±è´¥ã€‚å‚æ•°æ˜¯ä¸€ä¸ªerrnoï¼Œä¼šç”±ä¸Šå±‚å¤„ç†å°†errnoè®¾ç½®ä¸ºè¯¥å‚æ•°ã€‚</p>
<h4 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FileResult.&lt;AndroidFileIO&gt;fallback(<span class="keyword">new</span> <span class="title class_">DirectoryFileIO</span>(oflags,pathname,<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;filepath&quot;</span>)));</span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºé™ä½è‡ªå·±çš„ä¼˜å…ˆçº§ï¼Œåœ¨å…¶ä»–å¤„ç†å™¨æ— æ³•æ‰¾åˆ°è¯¥æ–‡ä»¶æ—¶ï¼Œç”±fallbackæŒ‡å®šçš„æ–‡ä»¶IOæ¥ä»£æ›¿ã€‚</p>
<h2 id="VirtualModule"><a href="#VirtualModule" class="headerlink" title="VirtualModule"></a>VirtualModule</h2><h3 id="VirtualModulemä»‹ç»"><a href="#VirtualModulemä»‹ç»" class="headerlink" title="VirtualModulemä»‹ç»"></a>VirtualModulemä»‹ç»</h3><p>VirtualModuleæ˜¯unidbgæä¾›çš„ä¸€ç§è™šæ‹Ÿæ¨¡å—æ–¹æ¡ˆã€‚å®ƒçš„ç”¨é€”æ˜¯å½“ä¸€ä¸ªSoç”±äºæŸç§åŸå› ï¼Œæ— æ³•å®Œæ•´åŠ è½½è¿›unidbgï¼Œæˆ–æƒ³è‡ªå·±å®ç°è¯¥Soçš„éƒ¨åˆ†åŠŸèƒ½æ—¶ï¼Œå°±å¯ä»¥ä½¿ç”¨è™šæ‹Ÿæ¨¡å—æ¥è§£å†³ã€‚</p>
<h3 id="unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—"><a href="#unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—" class="headerlink" title="unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—"></a>unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—</h3><p>unidbgä¸­è‡ªå¸¦äº†ä¸¤ä¸ªè™šæ‹Ÿæ¨¡å—:</p>
<ul>
<li>AndroidModule(libandroid.so)</li>
<li>JniGraphics(libjnigraphics.so)</li>
</ul>
<p>è¿™ä¸¤ä¸ªæ¨¡å—ä¸­çš„éƒ¨åˆ†å¸¸ç”¨ç¬¦å·å·²ç»åœ¨unidbgä¸­æœ‰æä¾›ï¼Œå½“æˆ‘ä»¬è¦æ¨¡æ‹Ÿæ‰§è¡Œä¸€ä¸ªSoæ—¶ï¼Œè€Œå®ƒåˆæ­£å¥½ä½¿ç”¨äº†libandroid.soï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿™æ ·åš:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">AndroidModule</span>(emulator,vm).register(memory); </span><br></pre></td></tr></table></figure>
<p>ç„¶åå†åŠ è½½ç›®æ ‡Soã€‚libjnigraphics.soåŒç†ã€‚</p>
<h3 id="è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—"><a href="#è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—" class="headerlink" title="è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—"></a>è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—</h3><p>å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªè™šæ‹Ÿæ¨¡å—ã€‚ä¸‹é¢æˆ‘ä»¬ä»¥ä¸€ä¸ªä¾‹å­æ¥è¯´æ˜è™šæ‹Ÿæ¨¡å—åº”è¯¥å¦‚ä½•ä½¿ç”¨ã€‚</p>
<h4 id="æ¨¡æ‹Ÿåœºæ™¯"><a href="#æ¨¡æ‹Ÿåœºæ™¯" class="headerlink" title="æ¨¡æ‹Ÿåœºæ™¯"></a>æ¨¡æ‹Ÿåœºæ™¯</h4><p>æˆ‘ä»¬å…ˆæ¥æ¨¡æ‹Ÿä¸€ä¸ªä½¿ç”¨è™šæ‹ŸSoçš„åœºæ™¯ã€‚å…ˆæ¥çœ‹Javaå±‚çš„ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-doc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">sign</span><span class="params">(<span class="type">int</span> a)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Javaå±‚åŠ è½½äº†libnative-doc.soï¼Œæœ‰ä¸€ä¸ªsignæ–¹æ³•ï¼Œå‚æ•°è·Ÿè¿”å›å€¼éƒ½ä¸ºintç±»å‹ã€‚æˆ‘ä»¬å†æ¥çœ‹Soå±‚çš„ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include <span class="string">&quot;myAdd.h&quot;</span></span><br><span class="line"></span><br><span class="line">extern <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT jint JNICALL</span><br><span class="line"><span class="title function_">Java_com_github_unidbg_Test_sign</span><span class="params">(JNIEnv *env, jobject thiz, jint a)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> myAdd(a, <span class="number">1024</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Soçš„ä»£ç æœ‰signæ–¹æ³•çš„å®ç°ï¼Œè€Œä¸”å®ç°éå¸¸ç®€å•ï¼Œè°ƒç”¨äº†myAddå‡½æ•°ã€‚ä½†æ˜¯è¿™ä¸ªmyAddå‡½æ•°æ˜¯æ¥è‡ªå…¶ä»–çš„Soçš„ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸”è¿™ä¸ªSoè¿˜ç”±äºæŸç§åŸå› ä¸èƒ½è¢«æ­£å¸¸åŠ è½½æˆ–æ²¡å¿…è¦å»åŠ è½½ï¼Œæˆ‘ä»¬æ¥çœ‹åœ¨unidbgä¸­è¯¥å¦‚ä½•å»åšã€‚</p>
<h4 id="é¦–æ¬¡å°è¯•"><a href="#é¦–æ¬¡å°è¯•" class="headerlink" title="é¦–æ¬¡å°è¯•"></a>é¦–æ¬¡å°è¯•</h4><p>ç°åœ¨é¦–å…ˆè¦åšçš„æ˜¯åœ¨unidbgä¸­åŠ è½½native-docæ¨¡å—ï¼Œçœ‹ä»£ç :</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg.android;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocTest</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DocTest</span>();</span><br><span class="line">        test.sign();</span><br><span class="line">        test.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æ¸…ç†èµ„æº</span></span><br><span class="line">        IOUtils.close(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DocTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//è·å–Memoryæ¥å£</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">//åˆ›å»ºè™šæ‹Ÿæœº</span></span><br><span class="line">        vm = emulator.createDalvikVM();</span><br><span class="line">        <span class="comment">//åŠ è½½æ¨¡å—</span></span><br><span class="line">        <span class="keyword">module</span> = emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/java/com/github/unidbg/libnative-doc.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒJNI_OnLoadå‡½æ•°</span></span><br><span class="line">        vm.callJNI_OnLoad(emulator, <span class="keyword">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨com/github/unidbg/Testç±»ä¸‹çš„signæ–¹æ³•</span></span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">        DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;sign(I)I&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œç»“æœ: &quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“æˆ‘ä»¬å†™å®Œä¸Šé¢çš„ä»£ç ï¼Œæ‰§è¡Œæ—¶ä¼šå‘ç°å¦‚ä¸‹é”™è¯¯:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libnative-doc.so load dependency libadd.so failed</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>unidbgä¼šæç¤ºä½ libnative-doc.soéœ€è¦ä¸€ä¸ªlibadd.soï¼Œè€Œunidbgåˆæ‰¾ä¸åˆ°è¿™ä¸ªSoæ¥åŠ è½½ï¼Œæ‰€ä»¥å°±æ— æ³•æ‰§è¡Œå‡ºæ­£å¸¸çš„ç»“æœã€‚è¿™ä¸ªlibadd.soæä¾›äº†myAddå‡½æ•°çš„å®ç°ï¼Œä½†æ˜¯å®ƒæ— æ³•è¢«æ­£å¸¸åŠ è½½ï¼Œæˆ‘ä»¬çŸ¥é“çš„æ˜¯myAddå‡½æ•°çš„å®ç°æ˜¯ä»€ä¹ˆæ ·å­çš„ã€‚å®ƒå°±æ˜¯å°†ä¸¤ä¸ªå‚æ•°è¿›è¡Œç›¸åŠ ï¼Œç„¶åè¿”å›ç»“æœã€‚æˆ‘ä»¬çŸ¥é“å®ç°å°±å¥½åŠäº†ï¼Œä¸‹é¢é€šè¿‡è™šæ‹ŸSoæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h4 id="å¤„ç†é—®é¢˜"><a href="#å¤„ç†é—®é¢˜" class="headerlink" title="å¤„ç†é—®é¢˜"></a>å¤„ç†é—®é¢˜</h4><p>å¤„ç†è¿™ç§é—®é¢˜å°±åˆ†ä¸¤æ­¥ã€‚ç¬¬ä¸€æ­¥åˆ›å»ºè™šæ‹Ÿæ¨¡å—ï¼Œæ¥å¤„ç†æœªæ‰¾åˆ°çš„ç¬¦å·:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç»§æ‰¿VirtualModuleç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Add</span> <span class="keyword">extends</span> <span class="title class_">VirtualModule</span>&lt;VM&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Add</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra)</span>&#123;</span><br><span class="line">        <span class="comment">//å‚æ•°ä¸‰ä¸ºæˆ‘ä»¬æ— æ³•åŠ è½½çš„Soæ¨¡å—åç§°å…¨ç§°</span></span><br><span class="line">        <span class="built_in">super</span>(emulator,extra,<span class="string">&quot;libadd.so&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInitialize</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra, Map&lt;String, UnidbgPointer&gt; symbols)</span> &#123;</span><br><span class="line">        <span class="type">SvcMemory</span> <span class="variable">svcMemory</span> <span class="operator">=</span> emulator.getSvcMemory();</span><br><span class="line">        <span class="comment">//æ·»åŠ ä¸€ä¸ªmyAddç¬¦å·</span></span><br><span class="line">        symbols.put(<span class="string">&quot;_Z5myAddii&quot;</span>,svcMemory.registerSvc(<span class="keyword">new</span> <span class="title class_">ArmSvc</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">handle</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">                <span class="type">RegisterContext</span> <span class="variable">context</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg1</span> <span class="operator">=</span> context.getIntArg(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> arg0 + arg1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç¬¬äºŒæ­¥ï¼Œåœ¨åŠ è½½æˆ‘ä»¬ç›®æ ‡Soæ—¶ï¼Œå…ˆæ¥åŠ è½½æˆ‘ä»¬çš„è™šæ‹ŸSo:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ è½½è™šæ‹Ÿæ¨¡å—</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Add</span>(emulator, vm).register(memory);</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·å°±å¯ä»¥æå®šå•¦ã€‚</p>
<h4 id="å®Œæ•´ä»£ç "><a href="#å®Œæ•´ä»£ç " class="headerlink" title="å®Œæ•´ä»£ç "></a>å®Œæ•´ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg.android;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.ArmSvc;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.context.RegisterContext;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.SvcMemory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.virtualmodule.VirtualModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocTest</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DocTest</span>();</span><br><span class="line">        test.sign();</span><br><span class="line">        test.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//æ¸…ç†èµ„æº</span></span><br><span class="line">        IOUtils.close(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DocTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//åˆ›å»ºæ¨¡æ‹Ÿå™¨å®ä¾‹</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//è·å–Memoryæ¥å£</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">//åˆ›å»ºè™šæ‹Ÿæœº</span></span><br><span class="line">        vm = emulator.createDalvikVM();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŠ è½½è™šæ‹Ÿæ¨¡å—</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Add</span>(emulator, vm).register(memory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//åŠ è½½æ¨¡å—</span></span><br><span class="line">        <span class="keyword">module</span> = emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/java/com/github/unidbg/libnative-doc.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//æ‰§è¡ŒJNI_OnLoadå‡½æ•°</span></span><br><span class="line">        vm.callJNI_OnLoad(emulator, <span class="keyword">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è°ƒç”¨com/github/unidbg/Testç±»ä¸‹çš„signæ–¹æ³•</span></span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">        DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;sign(I)I&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œç»“æœ: &quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Add</span> <span class="keyword">extends</span> <span class="title class_">VirtualModule</span>&lt;VM&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Add</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(emulator, extra, <span class="string">&quot;libadd.so&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInitialize</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra, Map&lt;String, UnidbgPointer&gt; symbols)</span> &#123;</span><br><span class="line">            <span class="type">SvcMemory</span> <span class="variable">svcMemory</span> <span class="operator">=</span> emulator.getSvcMemory();</span><br><span class="line">            <span class="comment">//æ·»åŠ ä¸€ä¸ªmyAddç¬¦å·</span></span><br><span class="line">            symbols.put(<span class="string">&quot;_Z5myAddii&quot;</span>, svcMemory.registerSvc(<span class="keyword">new</span> <span class="title class_">ArmSvc</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">handle</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">                    <span class="type">RegisterContext</span> <span class="variable">context</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">arg1</span> <span class="operator">=</span> context.getIntArg(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span> arg0 + arg1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Jnitrace"><a href="#Jnitrace" class="headerlink" title="Jnitrace"></a>Jnitrace</h2><h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jnitrace -l soæ–‡ä»¶ åŒ…å &gt; xxx.txt</span><br></pre></td></tr></table></figure>

<h3 id="jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™"><a href="#jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™" class="headerlink" title="jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™"></a>jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/02.png"
                      alt="02"
                ><br /> SOè¿è¡Œå­˜åœ¨å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œå¤šçº¿ç¨‹ä¼šç»™Traceåˆ†æå¸¦æ¥å¹²æ‰°ï¼Œæˆ‘ä»¬åœ¨æ–‡æœ¬ä¸­æŸ¥æ‰¾TID 11372ï¼Œè·Ÿç€è¿™ä¸ªçº¿ ç¨‹èµ°ä¸‹å»  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/03.png"
                      alt="03"
                ><br /> æ­¤å¤„åœ¨è·å–0x49å³æˆ‘ä»¬çš„å­—ç¬¦ä¸²çš„é•¿åº¦ï¼Œç»§ç»­å¾€ä¸‹  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/04.png"
                      alt="04"
                ><br /> æ­¤å¤„å°†jstringè½¬æˆNative å­—ç¬¦ä¸²ï¼Œåœ¨JNIå¼€å‘ä¸­ï¼Œå¤§éƒ¨åˆ†JObjectéƒ½å±äºå±€éƒ¨å¼•ç”¨ï¼Œå±€éƒ¨å¼•ç”¨åœ¨ç”¨å®Œä¹‹åéœ€è¦æ‰‹åŠ¨é‡Šæ”¾  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/05.png"
                      alt="image.png"
                ><br /> æ¯”å¦‚GetStringUTFCharsè·å–çš„èµ„æºï¼Œæœ€åä¸€å®šè¦ReleaseStringUTFCharsï¼ŒJNItraceä¼šåœ¨Releasexxxè¿™ ç³»åˆ—APIä¸­ï¼Œæ‰“å°å†…å®¹  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/06.png"
                      alt="image.png"
                ><br /> <font color="red">ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¼•ç”¨çš„é‡Šæ”¾æ–¹å¼æœ‰ä¸¤ç§ï¼Œé™¤äº†Releasexxç³»åˆ—ï¼Œä¹Ÿå¯ä»¥ç”¨DeleteLocalRefé‡Šæ”¾å±€éƒ¨å¼• ç”¨ï¼Œå¦‚æœé€šè¿‡DeleteLocalRefé‡Šæ”¾ï¼ŒJNItraceå¹¶ä¸ä¼šæ‰“å°å‡ºå…·ä½“å€¼</font>  </p>
<h3 id="å †æ ˆæ£€æµ‹"><a href="#å †æ ˆæ£€æµ‹" class="headerlink" title="å †æ ˆæ£€æµ‹"></a>å †æ ˆæ£€æµ‹</h3><p>â€œjava&#x2F;lang&#x2F;Throwable-&gt;<init>()Vâ€<br /> newä¸€ä¸ªå¼‚å¸¸ä¹‹å<br />â€œjava&#x2F;lang&#x2F;Throwable-&gt;getStackTrace()[Ljava&#x2F;lang&#x2F;StackTraceElement;â€<br />æŸ¥çœ‹å †æ ˆï¼Œè¿™ä¸å°±æ˜¯å †æ ˆæ£€æµ‹å—ï¼Œå¦‚æœè¢«Xposed Hookäº†ï¼Œå †æ ˆé‡Œä¼šæœ‰Xposedè¿™ä¸€ å±‚ã€‚  <br /> new å¼‚å¸¸ä¹‹åï¼ŒgetStackTraceå³å¾—åˆ°å¼‚å¸¸å †æ ˆæ•°ç»„ï¼Œå†™ä»£ç éªŒè¯ä¸€ä¸‹<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/07.png"
                      alt="image.png"
                >ç»§ç»­çœ‹JNItrace <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/08.png"
                      alt="image.png"
                ><br />é¦–å…ˆè·å–æ•°æ®é•¿åº¦ï¼Œè¿™å¾ˆå¥½ç†è§£å˜›ï¼Œåé¢è‚¯å®šæ˜¯æƒ³å¾ªç¯éå†å–å‡ºå®Œæ•´çš„è°ƒç”¨æ ˆï¼Œå¾—çŸ¥é“è°ƒç”¨æ ˆæœ‰å¤šé•¿ <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/09.png"
                      alt="image.png"
                ><br />è·å–æ•°ç»„ç¬¬0ä¸ªå…ƒç´ <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/10.png"
                      alt="image.png"
                ><br /> getClassNameï¼Œå³è·å–å…·ä½“çš„ç±»å <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/11.png"
                      alt="image.png"
                ><br />å› ä¸ºæ˜¯åœ¨JNIä¸­å¤„ç†ï¼Œæ‰€ä»¥åé¢è¿˜å¾—getString <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/12.png"
                      alt="image.png"
                ><br />ç”¨å®Œä¹‹åReleaseé‡Šæ”¾è¿™ä¸ªå­—ç¬¦ä¸²èµ„æºï¼Œé˜²æ­¢å†…å­˜æ³„æ¼<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/13.png"
                      alt="image.png"
                ><br /> com.xunmeng.pinduoduo.secure.DeviceNativeå³è°ƒç”¨æ ˆçš„ç¬¬ä¸€å±‚ <br />ç„¶åå®ƒå¯¹æ•°ç»„çš„ç¬¬äºŒä¸ªå…ƒç´ åšåŒæ ·çš„æ“ä½œï¼Œä¸€å¥—æµç¨‹æ€»ç»“ä¸‹æ¥ï¼Œå°±æ˜¯æ„é€ å¼‚å¸¸åè¯»å–è°ƒç”¨æ ˆå˜›</p>
<h4 id="æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ"><a href="#æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ" class="headerlink" title="æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ"></a>æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ</h4><p><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/14.png"
                      alt="image.png"
                ></p>
<h2 id="å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼"><a href="#å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼" class="headerlink" title="å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼"></a>å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼</h2><p>Unidbg call å‚æ•°ä¼ é€’ï¼Œåˆ°åº•æ˜¯è‡ªå·±call åœ°å€ è¿˜æ˜¯ç”¨Unidbgå°è£…çš„APIï¼Ÿ<br />å„æœ‰ä¼˜åŠ£ï¼Œç”¨APIçš„è¯ä»£ç é‡å°ä¸€äº›ï¼Œè‡ªå·±callçš„è¯æ›´çµæ´»ï¼Œé™åˆ¶å°ã€‚ç†Ÿèƒ½ç”Ÿå·§ã€‚</p>
<h3 id="ç¬¦å·è°ƒç”¨"><a href="#ç¬¦å·è°ƒç”¨" class="headerlink" title="ç¬¦å·è°ƒç”¨"></a>ç¬¦å·è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;dta&quot;</span>;</span><br><span class="line"><span class="type">DvmObject</span> <span class="variable">dvmObject</span> <span class="operator">=</span> obj.callJniMethodObject(emulator, <span class="string">&quot;md5(Ljava/lang/String;)Ljava/lang/String;&quot;</span>, data);</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) dvmObject.getValue();</span><br><span class="line">System.out.println(<span class="string">&quot;[symble] Call the so md5 function result is ==&gt; &quot;</span>+ result);</span><br></pre></td></tr></table></figure>

<h3 id="åœ°å€è°ƒç”¨"><a href="#åœ°å€è°ƒç”¨" class="headerlink" title="åœ°å€è°ƒç”¨"></a>åœ°å€è°ƒç”¨</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Pointer</span> <span class="variable">jniEnv</span> <span class="operator">=</span> vm.getJNIEnv();</span><br><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">StringObject</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm,<span class="string">&quot;dta&quot;</span>);</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; args = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">args.add(jniEnv);</span><br><span class="line">args.add(vm.addLocalObject(obj));</span><br><span class="line">args.add(vm.addLocalObject(data));</span><br><span class="line"></span><br><span class="line">Number[] numbers = <span class="keyword">module</span>.callFunction(emulator, <span class="number">0x8E81</span>, args.toArray());</span><br><span class="line">DvmObject&lt;?&gt; object = vm.getObject(numbers[<span class="number">0</span>].intValue());</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) object.getValue();</span><br><span class="line">System.out.println(<span class="string">&quot;[addr] Call the so md5 function result is ==&gt; &quot;</span>+ value);</span><br></pre></td></tr></table></figure>

<h2 id="æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼"><a href="#æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼"></a>æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼</h2><p>ä»¥å½“å‰åŒ…ç±»ä¸ºç±»å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>è‡ªå®šä¹‰åŒ…åç±»å</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="ç±»ç»§æ‰¿çš„å†™æ³•"><a href="#ç±»ç»§æ‰¿çš„å†™æ³•" class="headerlink" title="ç±»ç»§æ‰¿çš„å†™æ³•"></a>ç±»ç»§æ‰¿çš„å†™æ³•</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/15.png"
                      alt="image.png"
                ><br />é“¾å¼ç»§æ‰¿<br />vm.resolveClass(â€œå­ç±»â€, vm.resolveClass(â€œçˆ¶ç±»â€, vm.resolveClass(â€œçˆ¶ç±»çš„çˆ¶ç±»â€))).newObject(signature);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;android/app/ActivityThread-&gt;getApplication()Landroid/app/Application;&quot;</span>: &#123;</span><br><span class="line">    <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;android/app/Application&quot;</span>, vm.resolveClass(<span class="string">&quot;android/content/ContextWrapper&quot;</span>, vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>))).newObject(signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤šè¡Œçš„å†™æ³•</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">context</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>);</span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">ContextWrapper</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/content/ContextWrapper&quot;</span>,context);</span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">Application</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/app/Application&quot;</span>,ContextWrapper);</span><br><span class="line"><span class="keyword">return</span> Application.newObject(signature);</span><br></pre></td></tr></table></figure>

<h2 id="unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§"><a href="#unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§" class="headerlink" title="unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§"></a>unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§</h2><p><a href="https://www.zskkk.cn/2022/12/22/unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7/">unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§</a><br />å¯ä»¥ä½¿ç”¨unidbgå°è£…å¥½çš„hookæ–¹æ³•çŸ¥é“ç³»ç»Ÿè°ƒç”¨äº†å“ªäº›ç³»ç»Ÿå±æ€§ï¼Œ__system_property_get</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SystemPropertyHook</span> <span class="variable">systemPropertyHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemPropertyHook</span>(emulator);</span><br><span class="line">systemPropertyHook.setPropertyProvider(<span class="keyword">new</span> <span class="title class_">SystemPropertyProvider</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProperty</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;lilac Systemkey:&quot;</span>+key);</span><br><span class="line">        <span class="keyword">switch</span> (key)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">memory.addHookListener(systemPropertyHook);</span><br></pre></td></tr></table></figure>

<h2 id="æ–‡ä»¶é‡å®šå‘ï¼Œå®ç°-IOResolver"><a href="#æ–‡ä»¶é‡å®šå‘ï¼Œå®ç°-IOResolver" class="headerlink" title="æ–‡ä»¶é‡å®šå‘ï¼Œå®ç° IOResolver"></a>æ–‡ä»¶é‡å®šå‘ï¼Œå®ç° IOResolver</h2><p>éœ€è¦ç»§æ‰¿ IOResolver é‡å†™ resolveæ–¹æ³•<br />åœ¨å®šä¹‰emulatorå¥½åï¼Œåœ¨soåŠ è½½å‰æ·»åŠ æ–‡ä»¶é‡å®šä½å™¨<br />emulator.getSyscallHandler().addIOResolver(this);<br />æŒ‡å®šè·¯å¾„æ–‡ä»¶å®šå‘ï¼ˆå•æ–‡ä»¶ï¼‰</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/key.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/key.txt&quot;</span>), pathname));</span><br><span class="line"><span class="comment">//            return FileResult.success(new ByteArrayFileIO(oflags, pathname, String.valueOf(System.currentTimeMillis()).getBytes(StandardCharsets.UTF_8)));</span></span><br><span class="line"><span class="comment">//            return null;</span></span><br><span class="line"><span class="comment">//            return FileResult.failed(13);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿”å›å¯¹åº”çš„æ–‡ä»¶å¤¹ï¼ˆç›®å½•æ–‡ä»¶ï¼‰</span></span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">DirectoryFileIO</span>(oflags, pathname,</span><br><span class="line">            <span class="keyword">new</span> DirectoryFileIO.<span class="built_in">DirectoryEntry</span>(<span class="literal">true</span>, String.<span class="built_in">valueOf</span>(System.<span class="built_in">currentTimeMillis</span>())), <span class="keyword">new</span> DirectoryFileIO.<span class="built_in">DirectoryEntry</span>(<span class="literal">true</span>, <span class="string">&quot;1234&quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/1.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/1.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/2.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/2.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/3.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/3.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((<span class="string">&quot;proc/&quot;</span> + emulator.<span class="built_in">getPid</span>() + <span class="string">&quot;/status&quot;</span>).<span class="built_in">equals</span>(pathname)) &#123;</span><br><span class="line"><span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">ByteArrayFileIO</span>(oflags, pathname, (<span class="string">&quot;æ–‡æœ¬å†…å®¹.....&quot;</span>).<span class="built_in">getBytes</span>())&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ–è€…æ˜¯è™šæ‹Ÿç›®å½•ï¼ˆå¯¹æ¯”æ–‡ä»¶å¤¹é‡Œçš„æ–‡ä»¶æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹æ¯”è¾ƒå¥½ï¼‰<br />åœ¨åˆ›å»ºemulatorçš„æ—¶å€™ç›´æ¥æŒ‡å®šç›®å½•</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder.for32Bit().<span class="built_in">setRootDir</span>(<span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/VFS&quot;</span>)).<span class="built_in">build</span>();</span><br></pre></td></tr></table></figure>

<p>è¡¥äº†è™šæ‹Ÿç›®å½•å’Œä»£ç ï¼Œå“ªè¾¹ä¼šç”Ÿæ•ˆï¼Ÿ<br />ä»£ç æ‰§è¡Œä¼šå…ˆçœ‹æœ‰æ²¡æœ‰é‡å†™æ–‡ä»¶é‡å®šä½å™¨ï¼Œæ²¡æœ‰å°±é»˜è®¤é‡å®šä½å™¨ï¼Œä¸¤ä¸ªéƒ½æ²¡æœ‰æ‰¾åˆ°å°±åˆ°è™šæ‹Ÿç›®å½•ç³»ç»Ÿæ‰¾ï¼Œ</p>
<h2 id="ä¸€äº›å¸¸ç”¨åŠŸèƒ½"><a href="#ä¸€äº›å¸¸ç”¨åŠŸèƒ½" class="headerlink" title="ä¸€äº›å¸¸ç”¨åŠŸèƒ½"></a>ä¸€äº›å¸¸ç”¨åŠŸèƒ½</h2><h3 id="æ‰“å°å†…å­˜ï¼Œhexdump"><a href="#æ‰“å°å†…å­˜ï¼Œhexdump" class="headerlink" title="æ‰“å°å†…å­˜ï¼Œhexdump"></a>æ‰“å°å†…å­˜ï¼Œhexdump</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Inspector.inspect(ctx.getR0Pointer().getByteArray(<span class="number">0</span>, <span class="number">0x10</span>), <span class="string">&quot;Arg1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="unidbgä¸‹æ–­ç‚¹"><a href="#unidbgä¸‹æ–­ç‚¹" class="headerlink" title="unidbgä¸‹æ–­ç‚¹"></a>unidbgä¸‹æ–­ç‚¹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ™®é€šæ–­ç‚¹</span><br><span class="line">emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x3161E</span>);</span><br><span class="line"></span><br><span class="line">å†…å­˜å†™å…¥æ–­ç‚¹</span><br><span class="line">emulator.traceWrite(<span class="keyword">module</span>.base + <span class="number">0x3A0C0</span>,<span class="keyword">module</span>.base + <span class="number">0x3A0C0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="å¼€å¯æ‰€æœ‰çš„æ—¥å¿—"><a href="#å¼€å¯æ‰€æœ‰çš„æ—¥å¿—" class="headerlink" title="å¼€å¯æ‰€æœ‰çš„æ—¥å¿—"></a>å¼€å¯æ‰€æœ‰çš„æ—¥å¿—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.ARM32SyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.unix.UnixSyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.AbstractEmulator&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.DalvikVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.BaseVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line"></span><br><span class="line">æ‰€éœ€è¦çš„å¤´æ–‡ä»¶</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br></pre></td></tr></table></figure>

<h3 id="è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°"><a href="#è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°" class="headerlink" title="è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°"></a>è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°</h3><p>è®¡ç®—æŸä¸ªå‡½æ•°çš„æ±‡ç¼–è¡Œæ•°å‰ä½¿ç”¨</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">traceLength</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.getBackend().hook_add_new(<span class="keyword">new</span> <span class="title class_">CodeHook</span>() &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="keyword">module</span>.base, <span class="keyword">module</span>.base + <span class="keyword">module</span>.size, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼"><a href="#æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼" class="headerlink" title="æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼"></a>æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookRandom</span><span class="params">()</span>&#123;</span><br><span class="line">       emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;lrand48&quot;</span>, <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;call lrand48&quot;</span>);</span><br><span class="line">               <span class="comment">// æ‰“å°è°ƒç”¨æ ˆ</span></span><br><span class="line">               emulator.getUnwinder().unwind();</span><br><span class="line">               <span class="comment">// æ‰“å°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼</span></span><br><span class="line">               emulator.attach().addBreakPoint(emulator.getContext().getLRPointer().peer, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                       <span class="comment">//emulator.getBackend().reg_write(ArmConst.UC_ARM_REG_R0, 0x12345678);</span></span><br><span class="line">                       <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> emulator.getBackend().reg_read(ArmConst.UC_ARM_REG_R0);</span><br><span class="line">                       System.out.println(<span class="string">&quot;number &quot;</span> + number.intValue());</span><br><span class="line">                       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š"><a href="#éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š" class="headerlink" title="éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š"></a>éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š</h3><p>ç¨‹åºä¸­æœ€å¸¸è§çš„éšæœºå˜é‡æ˜¯æ—¶é—´æˆ³å’Œéšæœºæ•°ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç¨‹åºä¼šä½¿ç”¨ arc4random è¿™æ ·çš„åº“å‡½æ•°è·å–éšæœºæ•°ï¼Œå…¶åº•å±‚ä¾èµ–äº <code>/dev/urandom</code>ã€<code>/dev/random</code> ç­‰éšæœºæ–‡ä»¶ï¼Œæˆ–è€…ç›´æ¥è®¿é—®è¿™äº›æ–‡ä»¶ï¼Œè·å–éšæœºæ•°ã€‚<br>åœ¨ Unidbg é‡Œï¼Œè¿™å‡ ä¸ªä¼ªè®¾å¤‡æ–‡ä»¶çš„æ¨¡æ‹Ÿä½ç½®åœ¨ <code>src/main/java/com/github/unidbg/linux/file/DriverFileIO.java</code>ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> DriverFileIO <span class="title function_">create</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">int</span> oflags, String pathname)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;/dev/urandom&quot;</span>.equals(pathname) || <span class="string">&quot;/dev/random&quot;</span>.equals(pathname) || <span class="string">&quot;/dev/srandom&quot;</span>.equals(pathname)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RandomFileIO</span>(emulator, pathname);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;/dev/alarm&quot;</span>.equals(pathname) || <span class="string">&quot;/dev/null&quot;</span>.equals(pathname)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DriverFileIO</span>(emulator, oflags, pathname);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;/dev/ashmem&quot;</span>.equals(pathname)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Ashmem</span>(emulator, oflags, pathname);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&quot;/dev/zero&quot;</span>.equals(pathname)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ZeroFileIO</span>(emulator, oflags, pathname);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åˆ° RandomFileIO ç±»é‡Œï¼ŒæŠŠ randBytes å‡½æ•°é‡Œçš„ ThreadLocalRandom.current().nextBytes(bytes); æ³¨é‡Šæ‰</p>
<h3 id="è·å–-Trace"><a href="#è·å–-Trace" class="headerlink" title="è·å– Trace"></a>è·å– Trace</h3><p>ä½¿ç”¨æ–¹å¼çœ‹ <a href="#Trace">Trace</a>ï¼Œä¸‹é¢æ˜¯ä¿å­˜åˆ°æ–‡ä»¶<br>å¦‚æœä¸å¸Œæœ› trace åªæ˜¯æ‰“å°åœ¨æ—¥å¿—é‡Œï¼Œè€Œæ˜¯è¦é‡å®šä½åˆ°æ–‡ä»¶é‡Œï¼Œæ‰€ä»¥è¦å¤šå‡ è¡Œä»£ç </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">traceFile</span> <span class="operator">=</span> <span class="string">&quot;unidbg-android/src/test/resources/trace/tracecode.txt&quot;</span>;</span><br><span class="line">PrintStream traceStream;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    traceStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(traceFile), <span class="literal">true</span>);</span><br><span class="line">    emulator.traceCode(<span class="keyword">module</span>.base,<span class="keyword">module</span>.base+<span class="keyword">module</span>.size).setRedirect(traceStream);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¤§æ¦‚80wè¡Œè€—æ—¶3åˆ†é’Ÿå·¦å³ï¼Œæ˜¯å¦å¯ä»¥ä¼˜åŒ–å’ŒåŠ é€Ÿ Unidbg trace çš„é€Ÿåº¦ã€‚<br>æŒ‡ä»¤è¿½è¸ªçš„è€—æ—¶æœ‰ä¸¤éƒ¨åˆ†ï¼Œ1 æ˜¯ä¸ºäº†å®ç°æŒ‡ä»¤è¿½è¸ªçš„èƒ½åŠ›ï¼Œæ‰€åšçš„æŒ‡ä»¤è†¨èƒ€å’Œæ’æ¡©ã€‚2 æ˜¯åœ¨å±•ç¤ºä¸Šçš„è€—æ—¶ã€‚å‰ä¸€éƒ¨åˆ†çš„æŸè€—æˆ‘ä»¬å¾ˆéš¾æ§åˆ¶ï¼Œè€Œåä¸€éƒ¨åˆ†å±•ç¤ºä¸Šçš„è€—æ—¶ï¼Œå¯åšå¾ˆå¤šä¼˜åŒ–ã€‚<br>åœ¨å±•ç¤ºä¸Šï¼Œtrace éœ€è¦åŒ…æ‹¬ä¸‰è¦ç´ ã€‚<br>â— åœ°å€<br>â— æ±‡ç¼–ä»£ç <br>â— å¯„å­˜å™¨ã€å†…å­˜çš„å€¼å˜åŒ–å±•ç¤º<br>è€—æ—¶ä¸»è¦åœ¨è¦ç´ äºŒï¼Œåæ±‡ç¼–æœºå™¨ç è·å–æ±‡ç¼–ä»£ç ä¸Šã€‚åœ¨ Unidbg çš„å¤„ç†é€»è¾‘é‡Œï¼Œè¿è¡Œæ¯ä¸€æ¡æŒ‡ä»¤éƒ½ä¼šå¯¹å®ƒé‡æ–°åšåæ±‡ç¼–ã€‚ä½†æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå¦‚æœåœ°å€å’Œæœºå™¨ç éƒ½ä¸å˜åŒ–ï¼ˆå³æ²¡æœ‰å‘ç”Ÿä»£ç è‡ªä¿®æ”¹çš„æƒ…å†µé‡Œï¼‰ï¼Œä½¿ç”¨å…ˆå‰å¯¹è¿™ä¸ªåœ°å€ç¼“å­˜ä¸‹æ¥çš„åæ±‡ç¼–å³å¯ã€‚<br>æ¥ä¸‹æ¥è®©æˆ‘ä»¬å¯¹ Unidbg çš„æºç åšä¸€ç‚¹ä¿®æ”¹ï¼Œä¸‹é¢åªå¤„ç† ARM64ã€‚<br>æ‰¾åˆ°<code>unidbg-api/src/main/java/com/github/unidbg/arm/AbstractARM64Emulator.java</code>ï¼Œåœ¨ç±»ä¸­æ·»åŠ ä¸€ä¸ª HashMap ç”¨äºå­˜å‚¨åæ±‡ç¼–ç»“æœï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å®ƒæ¥ç¼“å­˜åæ±‡ç¼–ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Long, Instruction[]&gt; disassembleCache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>printAssemble å‡½æ•°çš„ä»£ç åŸå…ˆå¦‚ä¸‹</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Instruction[] printAssemble(PrintStream out, <span class="type">long</span> address, <span class="type">int</span> size, <span class="type">int</span> maxLengthLibraryName, InstructionVisitor visitor) &#123;</span><br><span class="line">    Instruction[] insns = disassemble(address, size, <span class="number">0</span>);</span><br><span class="line">    printAssemble(out, insns, address, ARM.isThumb(backend), maxLengthLibraryName, visitor);</span><br><span class="line">    <span class="keyword">return</span> insns;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¿®æ”¹å®ƒï¼Œå½“è°ƒç”¨ printAssemble å‡½æ•°æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥ç¼“å­˜ä¸­æ˜¯å¦å·²æœ‰ç›¸åº”çš„åæ±‡ç¼–ç»“æœï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™è¿›è¡Œåæ±‡ç¼–å¹¶å°†ç»“æœå­˜å…¥ç¼“å­˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Instruction[] printAssemble(PrintStream out, <span class="type">long</span> address, <span class="type">int</span> size, <span class="type">int</span> maxLengthLibraryName, InstructionVisitor visitor) &#123;</span><br><span class="line">    Instruction[] insns = disassembleCache.get(address);</span><br><span class="line">    <span class="keyword">if</span> (insns == <span class="literal">null</span>) &#123;</span><br><span class="line">        insns = disassemble(address, size, <span class="number">0</span>);</span><br><span class="line">        disassembleCache.put(address, insns);</span><br><span class="line">    &#125;</span><br><span class="line">    printAssemble(out, insns, address, maxLengthLibraryName, visitor);</span><br><span class="line">    <span class="keyword">return</span> insns;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>é‡æ–°æµ‹è¯• traceï¼Œè¿™æ¬¡é‡å®šå‘åˆ° tracecode2.txtã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">traceFile</span> <span class="operator">=</span> <span class="string">&quot;unidbg-android/src/test/resources/trace/tracecode2.txt&quot;</span>;</span><br><span class="line">PrintStream traceStream;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    traceStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(traceFile), <span class="literal">true</span>);</span><br><span class="line">    emulator.traceCode(<span class="keyword">module</span>.base,<span class="keyword">module</span>.base+<span class="keyword">module</span>.size).setRedirect(traceStream);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨è€—æ—¶ä¸Šï¼Œä»…èŠ±è´¹åŠåˆ†é’Ÿä¸åˆ°ï¼Œå¯ä»¥è¯´æ˜¯é€Ÿåº¦å¤§å¤§æå‡ï¼Œè¿™ä¹ˆç®—çš„è¯ï¼Œå³ä½¿ trace æŒ‡ä»¤æµçš„è¡Œæ•°ä»¥äº¿è®¡ï¼Œä¹Ÿèƒ½åœ¨çŸ­çŸ­å‡ ä¸ªå°æ—¶å†… trace å®Œã€‚<br>æ¥ä¸‹æ¥ç»§ç»­ä¿®æ”¹ printAssemble å‡½æ•°çš„ä»£ç ï¼Œä¸Šé¢çš„ä»£ç æ²¡æœ‰è€ƒè™‘åˆ°ä»£ç è‡ªä¿®æ”¹çš„æƒ…å†µï¼Œè‡ªä¿®æ”¹å³ç¨‹åºåœ¨è¿è¡ŒæœŸé—´ä¿®æ”¹è‡ªèº«æŒ‡ä»¤ï¼Œä¸ç®¡æ˜¯å‡ºäºè§£å¯†ã€åè°ƒï¼Œè¿˜æ˜¯å…¶å®ƒç›®çš„ï¼Œè‡ªä¿®æ”¹éƒ½æ˜¯ä¸€ä»¶å¸¸äº‹ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜è¦åˆ¤æ–­ä¸€ä¸‹å­—èŠ‚æ˜¯å¦å‘ç”Ÿäº†æ”¹å˜ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Instruction[] printAssemble(PrintStream out, <span class="type">long</span> address, <span class="type">int</span> size, <span class="type">int</span> maxLengthLibraryName, InstructionVisitor visitor) &#123;</span><br><span class="line">    Instruction[] insns = disassembleCache.get(address);</span><br><span class="line">    <span class="type">byte</span>[] currentCode = backend.mem_read(address, size);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">needUpdateCache</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">if</span> (insns != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">byte</span>[] cachedCode = <span class="keyword">new</span> <span class="title class_">byte</span>[size];</span><br><span class="line">        <span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Instruction insn : insns) &#123;</span><br><span class="line">            <span class="type">byte</span>[] insnBytes = insn.getBytes();</span><br><span class="line">            System.arraycopy(insnBytes, <span class="number">0</span>, cachedCode, offset, insnBytes.length);</span><br><span class="line">            offset += insnBytes.length;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!Arrays.equals(currentCode, cachedCode)) &#123;</span><br><span class="line">            needUpdateCache = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        needUpdateCache = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (needUpdateCache) &#123;</span><br><span class="line">        insns = disassemble(address, currentCode, <span class="literal">false</span>, <span class="number">0</span>);</span><br><span class="line">        disassembleCache.put(address, insns);</span><br><span class="line">    &#125;</span><br><span class="line">    printAssemble(out, insns, address, maxLengthLibraryName, visitor);</span><br><span class="line">    <span class="keyword">return</span> insns;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ–°ä»£ç ä¼šåˆ¤æ–­å½“å‰åœ°å€çš„æœºå™¨ç æ˜¯å¦å’Œç¼“å­˜çš„è¿™ä¸ªåœ°å€ä¸Šçš„æœºå™¨ç ä¸€è‡´ï¼Œè¿™å¢åŠ äº†ä¸€ç‚¹å¼€é”€ï¼Œè¿è¡Œå®Œæ¯•åæ¯”è¾ƒä¸€ä¸‹ï¼Œä¹Ÿå°±æ…¢äº†å‡ ç§’é’Ÿï¼Œå®Œå…¨èƒ½æ‰¿å—ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">traceFile</span> <span class="operator">=</span> <span class="string">&quot;unidbg-android/src/test/resources/trace/tracecode3.txt&quot;</span>;</span><br><span class="line">PrintStream traceStream;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    traceStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(traceFile), <span class="literal">true</span>);</span><br><span class="line">    emulator.traceCode(<span class="keyword">module</span>.base,<span class="keyword">module</span>.base+<span class="keyword">module</span>.size).setRedirect(traceStream);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="è·å–å‡½æ•°è°ƒç”¨æµ"><a href="#è·å–å‡½æ•°è°ƒç”¨æµ" class="headerlink" title="è·å–å‡½æ•°è°ƒç”¨æµ"></a>è·å–å‡½æ•°è°ƒç”¨æµ</h3><p>åŸºäºå¯¹æŒ‡ä»¤æµä¸­<code>BL</code>ã€<code>BLR</code>ç­‰å‡½æ•°è°ƒç”¨æŒ‡ä»¤çš„ç›‘æ§ï¼ŒUnidbg å®ç°äº†å¯¹å‡½æ•°çš„ç›‘æ§å’Œè¿½è¸ªï¼Œæˆ‘ä»¬ç¨ä½œå¤„ç†ï¼Œå°†å®ƒé‡å®šå‘åˆ°æ–‡ä»¶ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">traceFile</span> <span class="operator">=</span> <span class="string">&quot;unidbg-android/src/test/resources/trace/tracefunction.txt&quot;</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> PrintStream traceStream;</span><br><span class="line">    traceStream = <span class="keyword">new</span> <span class="title class_">PrintStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(traceFile), <span class="literal">true</span>);</span><br><span class="line">    emulator.attach().traceFunctionCall(<span class="keyword">module</span>, <span class="keyword">new</span> <span class="title class_">FunctionCallListener</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onCall</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> callerAddress, <span class="type">long</span> functionAddress)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> callerAddress, <span class="type">long</span> functionAddress, Number[] args)</span> &#123;</span><br><span class="line">            traceStream.println(<span class="string">&quot;onCallFinish caller=&quot;</span> + UnidbgPointer.pointer(emulator, callerAddress) + <span class="string">&quot;, function=&quot;</span> + UnidbgPointer.pointer(emulator, functionAddress));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»£ç ç½®äº JNI_OnLoad åã€‚</p>
<h3 id="åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®"><a href="#åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®" class="headerlink" title="åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®"></a>åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®</h3><p>å‡å¦‚ç›®æ ‡æ•°æ®æ˜¯EC 03 CE 8A 99 16 7F 9A 8F 2D F5 CD 8E E1 47 F2ã€‚<br>â— è¿™ä¸²æ•°æ®åœ¨ç¬¬ 25w è¡Œå·¦å³çš„åœ°å€ç”Ÿæˆï¼Œåœ°å€æ˜¯ A<br>â— åœ¨ 36w è¡Œçš„ä½ç½®ç”± A èµ‹å€¼ç»™ Bï¼Œå³ A â€“&gt; B<br>â— åœ¨ 47w è¡Œçš„ä½ç½® B â€“&gt; C<br>â— åœ¨ 55w è¡Œçš„ä½ç½® C â€“&gt; D<br>â— åœ¨ 82w è¡Œçš„ä½ç½® D â€“&gt; E<br>â— åœ¨ 97w è¡Œçš„ä½ç½® Eâ€“&gt; F<br>åœ¨é€†å‘è¿½æº¯æ—¶ï¼Œä» F å¼€å§‹åš traceWriteï¼Œç»è¿‡å››äº”æ¬¡è·³è½¬ï¼Œæœ€ç»ˆæ‰èƒ½æ‰¾åˆ° Aï¼Œéå¸¸çš„éº»çƒ¦ã€‚<br>åœ¨è¿™ä¸ª Android Native Runtime é‡Œï¼Œåªéœ€è¦å¤„ç†å•ä¸ª SO é‡Œçš„å•ä¸ªå‡½æ•°ï¼Œå› æ­¤å®ƒæ‰€ä½¿ç”¨å’Œæ“çºµçš„å†…å­˜åŒºå—å¾ˆæœ‰æ•ˆï¼Œåªæœ‰å‡  MB å¤§å°ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ä»å‡½æ•°èµ·å§‹ç‚¹å¼€å§‹ï¼Œé«˜é¢‘ç‡çš„æœç´¢å†…å­˜é‡Œæ˜¯å¦å‡ºç°äº†æŸä¸ªå€¼ï¼Œä»è€Œç¡®å®šæŸä¸ªæ•°æ®æœ€æ—©å‡ºç°çš„ä½ç½®ï¼Œä¸‹é¢æ˜¯åŸºæœ¬çš„å®ç°ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.unidbg.Emulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.Pointer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DataSearch</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Emulator&lt;?&gt; emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TreeSet&lt;Long&gt; addressUsed = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Long, Byte&gt; memoryData = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">byte</span>[] data;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="variable">find</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> interval;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;<span class="type">long</span>[]&gt; activePlace = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataSearch</span><span class="params">(Emulator&lt;?&gt; emulator, String data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emulator = emulator;</span><br><span class="line">        <span class="built_in">this</span>.data = hexStringToByteArray(data);</span><br><span class="line">        <span class="built_in">this</span>.interval = <span class="number">100</span>;</span><br><span class="line">        hookReadAndWrite();</span><br><span class="line">        hookBlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataSearch</span><span class="params">(Emulator&lt;?&gt; emulator, String data, <span class="type">int</span> interval)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emulator = emulator;</span><br><span class="line">        <span class="built_in">this</span>.data = hexStringToByteArray(data);</span><br><span class="line">        <span class="built_in">this</span>.interval = interval;</span><br><span class="line">        hookReadAndWrite();</span><br><span class="line">        hookBlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] hexStringToByteArray(String s) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">byte</span>[] data = <span class="keyword">new</span> <span class="title class_">byte</span>[len / <span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; len; i += <span class="number">2</span>) &#123;</span><br><span class="line">            data[i / <span class="number">2</span>] = (<span class="type">byte</span>) ((Character.digit(s.charAt(i), <span class="number">16</span>) &lt;&lt; <span class="number">4</span>)</span><br><span class="line">                    + Character.digit(s.charAt(i + <span class="number">1</span>), <span class="number">16</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">hookReadAndWrite</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WriteHook</span> <span class="variable">writeHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, <span class="type">long</span> value, Object user)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>; offset &lt; size; offset++) &#123;</span><br><span class="line">                    memoryData.put(address + offset, (<span class="type">byte</span>) (value &gt;&gt;&gt; (offset * <span class="number">8</span>)));</span><br><span class="line">                &#125;</span><br><span class="line">                updateActivePlace(address, size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ReadHook</span> <span class="variable">readHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReadHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">                <span class="type">byte</span>[] readBytes = emulator.getBackend().mem_read(address, size);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>; offset &lt; size; offset++) &#123;</span><br><span class="line">                    memoryData.put(address + offset, readBytes[offset]);</span><br><span class="line">                &#125;</span><br><span class="line">                updateActivePlace(address, size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        emulator.getBackend().hook_add_new(writeHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">        emulator.getBackend().hook_add_new(readHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">hookBlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">BlockHook</span> <span class="variable">blockHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlockHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookBlock</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">if</span> (!find &amp;&amp; (count % interval == <span class="number">0</span>)) &#123;</span><br><span class="line">                    searchData();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        emulator.getBackend().hook_add_new(blockHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">searchData</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!find) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">long</span>[] range : activePlace) &#123;</span><br><span class="line">                <span class="keyword">if</span> (searchDataInRange(range)) &#123;</span><br><span class="line">                    find = <span class="literal">true</span>;</span><br><span class="line">                    printAddress(range);</span><br><span class="line">                    emulator.attach().debug();</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">searchDataInRange</span><span class="params">(<span class="type">long</span>[] range)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> range[<span class="number">0</span>], max = range[<span class="number">1</span>] - data.length; i &lt;= max; i++) &#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; data.length; j++) &#123;</span><br><span class="line">                <span class="type">Byte</span> <span class="variable">value</span> <span class="operator">=</span> memoryData.get(i + j);</span><br><span class="line">                <span class="keyword">if</span> (value == <span class="literal">null</span> || value != data[j]) &#123;</span><br><span class="line">                    found = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (found) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printAddress</span><span class="params">(<span class="type">long</span>[] range)</span> &#123;</span><br><span class="line">        Collection&lt;Pointer&gt; pointers = searchMemory(range[<span class="number">0</span>], range[<span class="number">1</span>], data);</span><br><span class="line">        System.out.println(<span class="string">&quot;Search data matches &quot;</span> + pointers.size() + <span class="string">&quot; count&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Pointer pointer : pointers) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;data address: &quot;</span> + pointer);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Collection&lt;Pointer&gt; <span class="title function_">searchMemory</span><span class="params">(<span class="type">long</span> start, <span class="type">long</span> end, <span class="type">byte</span>[] data)</span> &#123;</span><br><span class="line">        List&lt;Pointer&gt; pointers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (end - start &gt;= data.length) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">long</span> <span class="variable">i</span> <span class="operator">=</span> start, max = end - data.length; i &lt;= max; i++) &#123;</span><br><span class="line">                <span class="type">boolean</span> <span class="variable">found</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; data.length; j++) &#123;</span><br><span class="line">                    <span class="type">Byte</span> <span class="variable">value</span> <span class="operator">=</span> memoryData.get(i + j);</span><br><span class="line">                    <span class="keyword">if</span> (value == <span class="literal">null</span> || value != data[j]) &#123;</span><br><span class="line">                        found = <span class="literal">false</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (found) &#123;</span><br><span class="line">                    pointers.add(UnidbgPointer.pointer(emulator, i));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pointers;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateActivePlace</span><span class="params">(<span class="type">long</span> address, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">newAddress</span> <span class="operator">=</span> address + i;</span><br><span class="line">            <span class="keyword">if</span> (addressUsed.add(newAddress)) &#123;</span><br><span class="line">                updateActivePlace(newAddress);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateActivePlace</span><span class="params">(<span class="type">long</span> address)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">lower</span> <span class="operator">=</span> addressUsed.lower(address);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">higher</span> <span class="operator">=</span> addressUsed.higher(address);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">connectToLower</span> <span class="operator">=</span> lower != <span class="literal">null</span> &amp;&amp; lower + <span class="number">1</span> == address;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">connectToHigher</span> <span class="operator">=</span> higher != <span class="literal">null</span> &amp;&amp; address + <span class="number">1</span> == higher;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span>[] lowerRange = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">long</span>[] higherRange = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span>[] range : activePlace) &#123;</span><br><span class="line">            <span class="keyword">if</span> (connectToLower &amp;&amp; range[<span class="number">1</span>] == lower) &#123;</span><br><span class="line">                lowerRange = range;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connectToHigher &amp;&amp; range[<span class="number">0</span>] == higher) &#123;</span><br><span class="line">                higherRange = range;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connectToLower &amp;&amp; connectToHigher) &#123;</span><br><span class="line">            <span class="keyword">assert</span> lowerRange != <span class="literal">null</span>;</span><br><span class="line">            lowerRange[<span class="number">1</span>] = higherRange[<span class="number">1</span>];</span><br><span class="line">            activePlace.remove(higherRange);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (connectToLower) &#123;</span><br><span class="line">            <span class="keyword">assert</span> lowerRange != <span class="literal">null</span>;</span><br><span class="line">            lowerRange[<span class="number">1</span>] = address;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (connectToHigher) &#123;</span><br><span class="line">            <span class="keyword">assert</span> higherRange != <span class="literal">null</span>;</span><br><span class="line">            higherRange[<span class="number">0</span>] = address;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            activePlace.add(<span class="keyword">new</span> <span class="title class_">long</span>[]&#123;address, address&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å®ƒä½¿ç”¨ä¸Šéå¸¸ç®€å•ï¼Œåœ¨ loadlibaray å‰æ·»åŠ ä¸‹é¢ä¸€è¡Œä»£ç å³å¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">DataSearch</span>(Emulator&lt;?&gt; emulator, String data);</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ data æ˜¯ä½ æ‰€éœ€è¦æœç´¢å†…å®¹çš„ hexstring å½¢å¼ï¼ŒåŠ ä¸åŠ ç©ºæ ¼éƒ½è¡Œã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">DataSearch</span>(emulator, <span class="string">&quot;cd 8e ec&quot;</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">DataSearch</span>(emulator, <span class="string">&quot;cd8eec&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>DataSearch é»˜è®¤çš„æœç´¢é¢‘ç‡æ˜¯æ¯ 100æŒ‡ä»¤æµï¼Œå¦‚æœå¤„ç†åƒä¸‡çº§æˆ–äº¿çº§çš„æŒ‡ä»¤æµï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ DataSearch çš„å¦å¤–ä¸€ä¸ªæ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">DataSearch</span>(Emulator&lt;?&gt; emulator, String data, <span class="type">int</span> interval);</span><br></pre></td></tr></table></figure>
<p>interval ç”¨äºæŒ‡å®šæ¯éš”å¤šå°‘ä¸ªåŸºæœ¬å—åšä¸€æ¬¡å†…å­˜æ£€ç´¢ï¼Œå»ºè®®åƒä¸‡çº§æŒ‡ä»¤æµé€‰æ‹© 500 å·¦å³ï¼Œäº¿çº§æŒ‡ä»¤æµé€‰æ‹© 2000 å·¦å³ã€‚æ£€ç´¢é¢‘ç‡è¶Šé«˜ï¼Œæœç´¢çš„å‡†ç¡®åº¦è¶Šé«˜ï¼Œè¶Šå¯èƒ½å‘ç°æ•°æ®çš„ç¬¬ä¸€ç”Ÿæˆç°åœºï¼›æ£€ç´¢è¶Šç¨€ç–ï¼Œæœç´¢çš„è€—æ—¶å°±è¶Šå°ï¼Œä½†å¯èƒ½ä¼šé”™è¿‡ç¬¬ä¸€ç”Ÿæˆç°åœºã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ€§èƒ½å’Œå‡†ç¡®åº¦ä¹‹é—´æ‰¾ä¸ªå‡è¡¡ç‚¹ã€‚<br>DataSearch å¹¶éä¸‡èƒ½ï¼Œå¦‚æœæ•°æ®è¿‡çŸ­å°ï¼Œæ¯”å¦‚ä¸¤ä¸‰ä¸ªå­—èŠ‚ï¼Œé‚£ä¹ˆåœ¨å†…å­˜ä¸­å°±ä¸å…·æœ‰æ ‡è¯†æ€§å’Œå”¯ä¸€æ€§ï¼Œæ— æ³•ç”¨å®ƒå¤„ç†ã€‚è¿™ç§æƒ…æ™¯è¯·ä½¿ç”¨æ±¡ç‚¹åˆ†ææˆ–ç±»ä¼¼çš„å…¶å®ƒåˆ†ææŠ€æœ¯ã€‚<br>é™¤äº†æœç´¢æŸä¸ªæŒ‡å®šå­—èŠ‚æ•°ç»„å¤–ï¼ŒDataSearch ç¨åŠ ä¿®æ”¹ï¼Œå¯ä»¥ç”¨äºæœç´¢ Keyã€å­—ç¬¦ä¸²ç­‰ç­‰ï¼Œæ¯”å¦‚ä¸‹é¢æ˜¯ StringSearchï¼Œå®ƒä¼šæ‰“å°å†…å­˜ä¸­å‡ºç°è¿‡çš„æ‰€æœ‰å¯è§å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.unidbg.Emulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.sun.jna.Pointer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileNotFoundException;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.PrintWriter;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StringSearch</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Emulator&lt;?&gt; emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> TreeSet&lt;Long&gt; addressUsed = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;Long, Byte&gt; memoryData = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> Set&lt;String&gt; foundStrings = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> interval;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> minLength;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> List&lt;<span class="type">long</span>[]&gt; activePlace = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> PrintWriter output;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringSearch</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">int</span> minLength, String outputFile)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emulator = emulator;</span><br><span class="line">        <span class="built_in">this</span>.interval = <span class="number">100</span>;</span><br><span class="line">        <span class="built_in">this</span>.minLength = minLength;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        hookReadAndWrite();</span><br><span class="line">        hookBlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">StringSearch</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">int</span> minLength, <span class="type">int</span> interval, String outputFile)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.emulator = emulator;</span><br><span class="line">        <span class="built_in">this</span>.interval = interval;</span><br><span class="line">        <span class="built_in">this</span>.minLength = minLength;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.output = <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(outputFile));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">        hookReadAndWrite();</span><br><span class="line">        hookBlock();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">hookReadAndWrite</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">WriteHook</span> <span class="variable">writeHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WriteHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, <span class="type">long</span> value, Object user)</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>; offset &lt; size; offset++) &#123;</span><br><span class="line">                    memoryData.put(address + offset, (<span class="type">byte</span>) (value &gt;&gt;&gt; (offset * <span class="number">8</span>)));</span><br><span class="line">                &#125;</span><br><span class="line">                updateActivePlace(address, size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">ReadHook</span> <span class="variable">readHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReadHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">                <span class="type">byte</span>[] readBytes = emulator.getBackend().mem_read(address, size);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">offset</span> <span class="operator">=</span> <span class="number">0</span>; offset &lt; size; offset++) &#123;</span><br><span class="line">                    memoryData.put(address + offset, readBytes[offset]);</span><br><span class="line">                &#125;</span><br><span class="line">                updateActivePlace(address, size);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        emulator.getBackend().hook_add_new(writeHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">        emulator.getBackend().hook_add_new(readHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">hookBlock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">BlockHook</span> <span class="variable">blockHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BlockHook</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookBlock</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">                count++;</span><br><span class="line">                <span class="keyword">if</span> (count % interval == <span class="number">0</span>)&#123;</span><br><span class="line">                    searchString();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        emulator.getBackend().hook_add_new(blockHook, <span class="number">1</span>, <span class="number">0</span>, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">searchString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span>[] range : activePlace) &#123;</span><br><span class="line">            searchStringInRange(range);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">searchStringInRange</span><span class="params">(<span class="type">long</span>[] range)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> (<span class="type">int</span>) (range[<span class="number">1</span>] - range[<span class="number">0</span>] + <span class="number">1</span>);</span><br><span class="line">        <span class="type">byte</span>[] codes = <span class="keyword">new</span> <span class="title class_">byte</span>[length];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">            codes[i] = memoryData.get(i + range[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        searchVisibleStringsInMemory(codes, range[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">searchVisibleStringsInMemory</span><span class="params">(<span class="type">byte</span>[] memory, <span class="type">long</span> addr)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; memory.length; i++) &#123;</span><br><span class="line">            <span class="type">byte</span> <span class="variable">b</span> <span class="operator">=</span> memory[i];</span><br><span class="line">            <span class="keyword">if</span> (b &gt;= <span class="number">32</span> &amp;&amp; b &lt;= <span class="number">126</span>) &#123;</span><br><span class="line">                sb.append((<span class="type">char</span>) b);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                processVisibleString(sb, addr + i - sb.length());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        processVisibleString(sb, addr + memory.length - sb.length());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">processVisibleString</span><span class="params">(StringBuilder sb, <span class="type">long</span> addr)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (sb.length() &gt;= minLength) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">visibleString</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">            <span class="keyword">if</span> (foundStrings.add(visibleString)) &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;Address: 0x&quot;</span> + Long.toHexString(addr) + <span class="string">&quot;, String: &quot;</span> + visibleString;</span><br><span class="line">                output.println(result);</span><br><span class="line">                output.flush();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        sb.setLength(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateActivePlace</span><span class="params">(<span class="type">long</span> address, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">newAddress</span> <span class="operator">=</span> address + i;</span><br><span class="line">            <span class="keyword">if</span> (addressUsed.add(newAddress)) &#123;</span><br><span class="line">                updateActivePlace(newAddress);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">updateActivePlace</span><span class="params">(<span class="type">long</span> address)</span> &#123;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">lower</span> <span class="operator">=</span> addressUsed.lower(address);</span><br><span class="line">        <span class="type">Long</span> <span class="variable">higher</span> <span class="operator">=</span> addressUsed.higher(address);</span><br><span class="line"></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">connectToLower</span> <span class="operator">=</span> lower != <span class="literal">null</span> &amp;&amp; lower + <span class="number">1</span> == address;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">connectToHigher</span> <span class="operator">=</span> higher != <span class="literal">null</span> &amp;&amp; address + <span class="number">1</span> == higher;</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span>[] lowerRange = <span class="literal">null</span>;</span><br><span class="line">        <span class="type">long</span>[] higherRange = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">long</span>[] range : activePlace) &#123;</span><br><span class="line">            <span class="keyword">if</span> (connectToLower &amp;&amp; range[<span class="number">1</span>] == lower) &#123;</span><br><span class="line">                lowerRange = range;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (connectToHigher &amp;&amp; range[<span class="number">0</span>] == higher) &#123;</span><br><span class="line">                higherRange = range;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (connectToLower &amp;&amp; connectToHigher) &#123;</span><br><span class="line">            <span class="keyword">assert</span> lowerRange != <span class="literal">null</span>;</span><br><span class="line">            lowerRange[<span class="number">1</span>] = higherRange[<span class="number">1</span>];</span><br><span class="line">            activePlace.remove(higherRange);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (connectToLower) &#123;</span><br><span class="line">            <span class="keyword">assert</span> lowerRange != <span class="literal">null</span>;</span><br><span class="line">            lowerRange[<span class="number">1</span>] = address;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (connectToHigher) &#123;</span><br><span class="line">            <span class="keyword">assert</span> higherRange != <span class="literal">null</span>;</span><br><span class="line">            higherRange[<span class="number">0</span>] = address;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            activePlace.add(<span class="keyword">new</span> <span class="title class_">long</span>[]&#123;address, address&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨ä¸Šä¹Ÿå¾ˆç®€å•ï¼Œå‚æ•° 1 æ˜¯æ¨¡æ‹Ÿå™¨å®ä¾‹ï¼Œå‚æ•° 2 æ˜¯å¯è§å­—ç¬¦ä¸²çš„æœ€çŸ­é•¿åº¦ï¼Œå‚æ•° 3 æ˜¯è¾“å‡ºçš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">StringSearch</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">int</span> minLength, String outputFile)</span></span><br></pre></td></tr></table></figure>
<p>å®ƒçš„é»˜è®¤æœç´¢é¢‘ç‡æ˜¯ 100 ä¸ªåŸºæœ¬å—ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„é‡è½½æ–¹æ³•ï¼Œä¿®æ”¹è¿™ä¸ªå€¼ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">StringSearch</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">int</span> minLength, <span class="type">int</span> interval, String outputFile)</span></span><br></pre></td></tr></table></figure>
<p>å…·ä½“ä½¿ç”¨ä¸Šï¼Œæ¯”å¦‚ä¸‹é¢è¿™æ ·</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">StringSearch</span>(emulator, <span class="number">5</span>,<span class="string">&quot;unidbg-android/src/test/resources/trace/strings.log&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>æ•ˆæœå¦‚ä¸‹ï¼Œè¿è¡Œæ—¶çš„å­—ç¬¦ä¸²å¯ä»¥ç»™å‡ºå¾ˆå¤šæŒ‡å¼•ã€‚<br><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/28.png"
                     
                ></p>
<h3 id="findCryptInTrace"><a href="#findCryptInTrace" class="headerlink" title="findCryptInTrace"></a>findCryptInTrace</h3><p>å“ˆå¸Œç®—æ³•ä¸»è¦å…³æ³¨ä¸‹é¢è¿™å‡ ç‚¹ã€‚<br>â— ä½¿ç”¨äº†å“ªç§å“ˆå¸Œç®—æ³•<br>â— å“ˆå¸Œçš„è¾“å…¥æ˜¯ä»€ä¹ˆ<br>â— å“ˆå¸Œçš„è¾“å‡ºæ˜¯ä»€ä¹ˆ<br>â— å“ˆå¸Œç®—æ³•æ˜¯å¦é­”æ”¹<br>é¦–å…ˆè¦ç¡®å®šä½¿ç”¨äº†ä»€ä¹ˆå“ˆå¸Œç®—æ³•ï¼Œä¸Šé¢ç”¨ IDA Findcrypt æ’ä»¶çœ‹åˆ°ï¼Œæ ·æœ¬é‡Œæœ‰ SHA256 çš„é­”æ•°ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°å°±ä½¿ç”¨äº†è¿™ä¸ªç®—æ³•ï¼Œå¯¹å§ã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬èƒ½åœ¨ trace é‡Œæ‰¾åˆ° SHA256 ç®—æ³•çš„ç›¸å…³é­”æ•°ï¼Œé‚£å°±è¯å®äº† SHA256 çš„å­˜åœ¨ã€‚æˆ‘å†™è¿‡ä¸€ä¸ª 010Editor å°è„šæœ¬ï¼Œå« findCryptInTrace.1scï¼Œå…¶å†…å®¹å¦‚ä¸‹ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> md5[<span class="number">4</span>] = &#123;<span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>&#125;;</span><br><span class="line"><span class="type">int</span> sha1[<span class="number">4</span>] = &#123;<span class="number">0x5A827999</span>, <span class="number">0x6ED9EBA1</span>, <span class="number">0x8F1BBCDC</span>, <span class="number">0xCA62C1D6</span>&#125;;</span><br><span class="line"><span class="type">int</span> sha256[<span class="number">4</span>] = &#123;<span class="number">0x428a2f98</span>, <span class="number">0x71374491</span>, <span class="number">0xb5c0fbcf</span>, <span class="number">0xe9b5dba5</span>&#125;;</span><br><span class="line"><span class="type">int</span> sm3[<span class="number">2</span>] = &#123;<span class="number">0x79cc4519</span>, <span class="number">0x7a879d8a</span>&#125;;</span><br><span class="line"><span class="type">int</span> crc32[<span class="number">2</span>] = &#123;<span class="number">0x77073096</span>, <span class="number">0xEE0E612C</span>&#125;;</span><br><span class="line"><span class="type">int</span> chacha20[<span class="number">2</span>] = &#123;<span class="number">0x61707865</span>, <span class="number">0x3320646e</span>&#125;;</span><br><span class="line"><span class="type">int</span> hmac[<span class="number">2</span>] = &#123;<span class="number">0x36363636</span>, <span class="number">0x5C5C5C5C</span>&#125;;</span><br><span class="line"><span class="type">int</span> tea[<span class="number">1</span>] = &#123;<span class="number">0x9e3779b9</span>&#125;;</span><br><span class="line"><span class="type">int</span> twofish[<span class="number">4</span>] = &#123;<span class="number">0xBCBC3275</span>, <span class="number">0xECEC21F3</span>, <span class="number">0x202043C6</span>, <span class="number">0xB3B3C9F4</span>&#125;;</span><br><span class="line"><span class="type">int</span> salsa20[<span class="number">4</span>] = &#123;<span class="number">0x61707865</span>, <span class="number">0x3320646e</span>, <span class="number">0x79622d32</span>, <span class="number">0x6b206574</span>&#125;;</span><br><span class="line"><span class="type">int</span> blowfish[<span class="number">2</span>] = &#123;<span class="number">0x243f6a88</span>, <span class="number">0x85a308d3</span>&#125;;</span><br><span class="line"><span class="type">int</span> rc6[<span class="number">2</span>] = &#123;<span class="number">0xb7e15163</span>, <span class="number">0x9e3779b9</span>&#125;;</span><br><span class="line"><span class="type">int</span> aes[<span class="number">2</span>] = &#123;<span class="number">0xC66363A5</span>, <span class="number">0xF87C7C84</span>&#125;;</span><br><span class="line"><span class="type">int</span> aplib[<span class="number">1</span>] = &#123;<span class="number">0x32335041</span>&#125;;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span> arr[], string name)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> sizeof(arr)/sizeof(arr[<span class="number">0</span>]);</span><br><span class="line">    local <span class="type">int</span> i;</span><br><span class="line">    local string s;</span><br><span class="line">    local <span class="type">uchar</span> <span class="variable">exist</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>( i = <span class="number">0</span>; i &lt; num; i++ )&#123;</span><br><span class="line">        SPrintf(s, <span class="string">&quot;%X&quot;</span>, arr[i]);</span><br><span class="line">        <span class="keyword">if</span>(FindFirst(s, <span class="literal">false</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            exist = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(exist)&#123;</span><br><span class="line">        Printf(<span class="string">&quot;Find &quot;</span>+name +<span class="string">&quot;, num:0x&quot;</span>+s+<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Printf(<span class="string">&quot;***********Findcrypt Search Start****************\n&quot;</span>);</span><br><span class="line">search(md5, <span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">search(sha1, <span class="string">&quot;SHA1&quot;</span>);</span><br><span class="line">search(sha256, <span class="string">&quot;SHA256&quot;</span>);</span><br><span class="line">search(sm3, <span class="string">&quot;sm3&quot;</span>);</span><br><span class="line">search(crc32, <span class="string">&quot;crc32&quot;</span>);</span><br><span class="line">search(chacha20, <span class="string">&quot;chacha20&quot;</span>);</span><br><span class="line">search(hmac, <span class="string">&quot;hmac&quot;</span>);</span><br><span class="line">search(tea, <span class="string">&quot;tea&quot;</span>);</span><br><span class="line">search(twofish,<span class="string">&quot;twofish&quot;</span>);</span><br><span class="line">search(salsa20, <span class="string">&quot;salsa20&quot;</span>);</span><br><span class="line">search(blowfish, <span class="string">&quot;blowfish&quot;</span>);</span><br><span class="line">search(rc6,<span class="string">&quot;rc6&quot;</span>);</span><br><span class="line">search(aes,<span class="string">&quot;aes&quot;</span>);</span><br><span class="line">search(aplib,<span class="string">&quot;aplib&quot;</span>);</span><br><span class="line">Printf(<span class="string">&quot;***********Findcrypt Search Over****************\n&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>åŸç†å’Œ Findcrypt ç±»ä¼¼ï¼Œæœç´¢å„ç§å¸¸è§ç®—æ³•æ‰€ä½¿ç”¨çš„å¸¸é‡ï¼Œä¸‹é¢æ¼”ç¤ºå®ƒçš„ä½¿ç”¨ã€‚<br><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/29.png"
                     
                ><br>æ‰“å¼€æˆ‘ä»¬çš„è„šæœ¬ï¼Œé€‰æ‹©è¿è¡Œã€‚<br><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/30.png"
                     
                ><br>trace é‡Œæ˜ç¡®æ‰¾åˆ°äº† SHA256 ç®—æ³•ä»¥åŠ HMAC æ–¹æ¡ˆçš„ç‰¹å¾ã€‚è¿™è¯´æ˜æ ·æœ¬å¯èƒ½ä½¿ç”¨äº† HMAC-SHA256ï¼Œä¹Ÿå¯èƒ½æ˜¯ SHA256 + HMAC-SHA256ï¼Œæˆ–è€…å…¶å®ƒï¼Œè¿™éƒ½è¯´ä¸æ¸…ï¼Œéœ€è¦è¿›ä¸€æ­¥åˆ†æã€‚</p>
<!-- ## ç®—æ³•åˆ†æä¸­çš„HOOKæ€è·¯  

- å¿«é€ŸéªŒè¯ç”¨Console Debugger 
- æŒä¹…åŒ–ç”¨HookZz 
- ç¨³å®šHook ç”¨Unicorn Hook   -->


<h2 id="ååˆ¶unidng"><a href="#ååˆ¶unidng" class="headerlink" title="ååˆ¶unidng"></a>ååˆ¶unidng</h2><p>å¦‚ä½•å¢åŠ è·‘é€šUnidbgæ¨¡æ‹Ÿæ‰§è¡Œçš„æˆæœ¬  ï¼Ÿ</p>
<h4 id="ä¸€ã€JNIäº¤äº’"><a href="#ä¸€ã€JNIäº¤äº’" class="headerlink" title="ä¸€ã€JNIäº¤äº’"></a>ä¸€ã€JNIäº¤äº’</h4><p>ä¸»è¦æœ‰ä¸¤ç‚¹ </p>
<ol>
<li>å°½å¯èƒ½å¢åŠ è¡¥JAVAç¯å¢ƒæ‰€éœ€çš„æ—¶é—´æˆæœ¬</li>
</ol>
<p>æ‰“ä¸ªæ¯”æ–¹ï¼Œåœ¨SOä¸­ç¼–å†™1000ä¸ªå¯¹JAVAå±‚çš„è®¿é—®å’Œè°ƒç”¨å‡½æ•°ï¼Œæ¯æ¬¡è®¡ç®—æ—¶æ ¹æ®æ—¶é—´æˆ³ä½¿ç”¨å…¶ä¸­çš„50 ä¸ªï¼Œè¿™æ ·åšçš„è¯ï¼Œè¿ç®—çš„æ—¶é—´æˆæœ¬ä¸é«˜ï¼Œä½†å› ä¸ºæ—¶é—´æˆ³ä¸€ç›´åœ¨å˜ï¼Œæ‰€ä»¥å¾—åœ¨Unidbgä¸­è¡¥é½å…¨é‡çš„ JAVAè®¿é—®ã€‚ </p>
<ol start="2">
<li>ä½¿ç”¨Unidbgæš‚ä¸æ”¯æŒçš„JNIè°ƒç”¨</li>
</ol>
<p>src&#x2F;main&#x2F;java&#x2F;com&#x2F;github&#x2F;unidbg&#x2F;linux&#x2F;android&#x2F;dvm&#x2F;DalvikVM.java æ˜¯Unidbgä¸­å®ç°JNIæ–¹æ³• çš„ç±»ï¼Œå¯ä»¥å‘ç°ï¼Œåªå®ç°äº†æœ€å¸¸ç”¨çš„é‚£éƒ¨åˆ†JNIæ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ ·æœ¬ä¸­ä½¿ç”¨è¿™äº›Unidbgå°šæœªå®ç° çš„JNIæ–¹æ³•ã€‚ </p>
<h4 id="äºŒã€ç³»ç»Ÿè°ƒç”¨"><a href="#äºŒã€ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="äºŒã€ç³»ç»Ÿè°ƒç”¨"></a>äºŒã€ç³»ç»Ÿè°ƒç”¨</h4><p>Unidbgå®ç°äº†è®¸å¤šå¸¸è§çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä½†è¿˜æœ‰ä¸€äº›åå†·é—¨çš„ç³»ç»Ÿè°ƒç”¨æœªå®ç°ï¼Œä»¥åŠä¸ååƒ»ä½†è¾ƒéš¾å®Œç¾å®ç° çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¸å‹ä»£è¡¨â€”â€”forkç›¸å…³ç³»ç»Ÿè°ƒç”¨ã€‚ </p>
<h4 id="ä¸‰ã€æ–‡ä»¶è®¿é—®"><a href="#ä¸‰ã€æ–‡ä»¶è®¿é—®" class="headerlink" title="ä¸‰ã€æ–‡ä»¶è®¿é—®"></a>ä¸‰ã€æ–‡ä»¶è®¿é—®</h4><p>å°½å¯èƒ½å¤šçš„æ–‡ä»¶è®¿é—®å’Œäº¤äº’ </p>
<h4 id="å››ã€æ£€æµ‹Unidbg"><a href="#å››ã€æ£€æµ‹Unidbg" class="headerlink" title="å››ã€æ£€æµ‹Unidbg"></a>å››ã€æ£€æµ‹Unidbg</h4><p>æ ·æœ¬å¯ä»¥æ„ŸçŸ¥å¹¶æ£€æµ‹è‡ªå·±è¿è¡Œåœ¨Unidbgç¯å¢ƒä¸­ï¼Œå¹¶èµ°å‘é”™è¯¯çš„åˆ†æ”¯ã€‚è¿™ä¸€å—æˆ‘çš„äº†è§£ä¸å¤šï¼Œä½†ç¡®å®æ˜¯å¯ ä»¥çš„ï¼ŒUnidbgçš„æ‰§è¡Œç¯å¢ƒå’ŒçœŸæœºæ˜¯æœ‰å¾ˆå¤§å·®è·çš„ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œæ¯ä¸ªAndroidè¿›ç¨‹éƒ½æœ‰ä¸€äº›åˆå§‹åŒ–ç¯å¢ƒå˜ é‡ï¼ŒAndroidç³»ç»Ÿå¯åŠ¨æ—¶é€šè¿‡setEnvè®¾ç½®ï¼ŒUnidbgä¸­åˆ™æ²¡æœ‰ã€‚ </p>
<h4 id="äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ"><a href="#äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ" class="headerlink" title="äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ"></a>äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ</h4><p>å°½å…¶æ‰€èƒ½çš„å¢åŠ ç›®æ ‡å‡½æ•°è¢«æ‰§è¡Œçš„â€å‰ç½®æ¡ä»¶â€œï¼Œæˆ–è€…è¯´åˆå§‹åŒ–å‡½æ•°ã€‚è¿™é‡Œé¢å¯ä»¥ç©çš„èŠ±æ‹›ã€é˜´æ‹›å¤ªå¤š äº†ã€‚è¿™åº”è¯¥ä½œä¸ºä¸€ä¸ªä¸»è¦çš„åUnidbgçš„æ–¹å‘ï¼Œå®ƒæ˜¯æœ‰æ•ˆä¸”æ€ä¼¤åŠ›å·¨å¤§çš„  </p>
<h4 id="å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•"><a href="#å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•" class="headerlink" title="å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•"></a>å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•</h4><p>åœ¨çœŸæœºä¸Šï¼Œä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œç³»ç»Ÿä¼šè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚åœ¨unidbgä¸­ä½¿ç”¨GetStaticMethodIDï¼Œåƒæ˜¯æ— è®ºå­˜ä¸å­˜åœ¨éƒ½ä¼šæ¨¡æ‹Ÿä¸€ä¸ªjmethodIDè¿”å›ç»™so<br />å…³äºè¿™ä¸ªåunidbgçš„æ€è·¯å’Œå½¢æˆï¼Œå¦‚æœjavaå±‚ä¸å­˜åœ¨æŸä¸ªç±»æˆ–è€…æ–¹æ³•ï¼Œjniä¸­ä½¿ç”¨findclassæˆ–è€…getmethodidå°±ä¼šæŠ¥é”™ï¼ˆè¿™å¾ˆåˆç†å˜›ï¼Œå› ä¸ºæ‰¾ä¸åˆ°ï¼‰ï¼Œè€ŒUnidbgå› ä¸ºæ²¡åŠæ³•äº†è§£Javaç¯å¢ƒå…·ä½“å’‹æ ·ï¼Œæ‰€ä»¥ä¸ç®¡ä½ findå•¥classè¿˜æ˜¯getä»€ä¹ˆmethodï¼Œå®ƒéƒ½å½“åšè¿™æ˜¯å­˜åœ¨çš„ã€‚<br />è§£å†³ï¼Œå¦‚æœä½ æƒ³è®©Unidbg findclassæ‰¾ä¸åˆ°ä¸€ä¸ªç±»ï¼Œå¯ä»¥ä½¿ç”¨BaseVMçš„addNotFoundClassæ–¹æ³•ï¼Œå¦‚æœæƒ³è®©Unidbgæ‰¾ä¸åˆ°æŸä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä¿®æ”¹AbstractJniä¸­çš„acceptMethodæ–¹æ³•ã€‚</p>
<h2 id="UnidbgæŠ¥é”™"><a href="#UnidbgæŠ¥é”™" class="headerlink" title="UnidbgæŠ¥é”™"></a>UnidbgæŠ¥é”™</h2><h3 id="Illegal-JNI-version"><a href="#Illegal-JNI-version" class="headerlink" title="Illegal JNI version"></a>Illegal JNI version</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/16.png"
                      alt="image.png"
                ><br /> JNIç‰ˆæœ¬é”™è¯¯ï¼Œè€Œåªæ„å‘³ JNIOnLoad è¿è¡Œè¿‡ç¨‹ä¸­å‡ºäº†é”™ã€‚è‡³äºå…·ä½“å‡ºé”™çš„åŸå› æœ‰å¾ˆå¤šï¼Œä¸€ä¸ªå¸¸è§çš„é—®é¢˜æ˜¯SOçš„ä¾èµ–åº“ç¼ºå¤±ã€‚  <br /> æˆ‘ä»¬çš„ç›®æ ‡SOä¾èµ–äº† libc++_shared.so ï¼Œè¿™ä¸ªåº“æ˜¯C++çš„æ”¯æŒåº“ï¼Œä½†ä¸åœ¨Unidbgé»˜è®¤æ”¯æŒçš„SOé‡Œã€‚ æˆ‘ä»¬è¦åœ¨apkçš„libé‡ŒæŠŠå®ƒæ‹·è´å‡ºæ¥ã€‚  <br /> è¿˜æœ‰å¦ä¸€ä¸ªæ›´é€šç”¨çš„åŠæ³• ï¼Œå½“æŠ¥é”™æ—¶ï¼Œå°±æŠŠ traceCodeæ‰“å¼€ï¼Œè®°å½•æ‰§è¡Œæµï¼Œçœ‹æœ€ååœ¨å“ªå„¿åœä¸‹æ¥ã€‚  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/17.png"
                      alt="image.png"
                ><br /> æ¯”å¦‚æ­¤å¤„ï¼Œæˆ‘åœ¨JNI_OnLoadå‰é¢æ‰“å¼€traceCodeï¼Œåœ¨IDAä¸­è·³è½¬åˆ°æœ€åä¸€æ¡è¿è¡Œåœ°å€ 0x177C  <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/18.png"
                      alt="image.png"
                ><br /> å¯ä»¥å‘ç°æ­£æ˜¯C++çš„æ ‡å‡†åº“å‡½æ•°ï¼Œç¬¦åˆä¸Šé¢çš„çŒœæµ‹ã€‚  <br />æ·»åŠ ä¹‹åæ­£å¸¸åŠ è½½<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/19.png"
                      alt="image.png"
                ></p>
<h3 id="appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨"><a href="#appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨" class="headerlink" title="appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨"></a>appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨</h3><p>è¿è¡Œæ ·æœ¬åï¼Œå‘ç°å†…å­˜é”™è¯¯<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/20.png"
                      alt="image.png"
                ><br />ç¬¬ä¸€ç§å°è¯•ï¼ŒæŠŠUnidbgçš„æ—¥å¿—å…¨å¼€ï¼Œsrc&#x2F;test&#x2F;resources&#x2F;log4j.propertiesä¸­çš„INFOå…¨é…ç½®æ”¹ä¸ºDEBUG<br />å†æ¬¡è¿è¡Œåä¼šåœ¨æŠ¥é”™çš„åœ°æ–¹åœä¸‹æ¥ã€‚è¾“å…¥btæŸ¥çœ‹è°ƒç”¨æ ˆ<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/21.png"
                      alt="image.png"
                ><br />unidbgæä¾›äº†å¤§é‡è¯¦æƒ…çš„è°ƒç”¨å›æº¯ä¿¡æ¯ï¼Œç›´æ¥æ‹‰åˆ°åº•éƒ¨ï¼Œçœ‹ç›®æ ‡æ ·æœ¬æ˜¯ä»å“ªé‡Œè°ƒç”¨ã€‚ç”¨IDAè·³åˆ°0xabf<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/22.png"
                      alt="image.png"
                ><br />å¥‡äº†æ€ªäº†ï¼Œæ‰“ä¸ªæ—¥å¿—è¿˜æŠ¥é”™ï¼ŸæŠŠæ—¥å¿—ç­‰çº§æ”¹ä¸ºINFOï¼Œåœ¨æ­¤å¤„ä¸‹ä¸ªæ–­ç‚¹åˆ†æã€‚<br />emulator.attach().addBreakPoint(module.base+0x00abf);<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/23.png"
                      alt="image.png"
                ><br />_android_log_printæ˜¯å¸¸ç”¨å‡½æ•°ï¼Œå‚æ•°1æ˜¯æ­¤æ—¥å¿—çš„ä¼˜å…ˆçº§ï¼Œå‚æ•°2æ˜¯tagï¼Œå‚æ•°3æ˜¯æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œä¹‹åçš„éƒ½æ˜¯å†…å®¹ã€‚éƒ½å¯ä»¥åœ¨Console Debuggerä¸­éªŒè¯<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/24.png"
                      alt="image.png"
                ><br />å‚æ•°1æ˜¯6ï¼Œå¯ä»¥ç›´æ¥çœ‹ï¼Œé€šè¿‡mrxæŸ¥çœ‹å…¶ä½™å‚æ•°ï¼Œå‚æ•°23ä¹Ÿéƒ½æ­£å¸¸ï¼Œé‚£å‚æ•°4å‘¢<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/25.png"
                      alt="image.png"
                ><br />å†…å­˜å¼‚å¸¸äº†ï¼Œè¿”å›IDAæŸ¥çœ‹ä»£ç <br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/26.png"
                      alt="image.png"
                ><br />å¯ä»¥çœ‹åˆ°ä¸Šé¢é‡Šæ”¾äº†å˜é‡ï¼Œä¸‹é¢è¿˜åœ¨è°ƒç”¨ã€‚<br />æ€ä¹ˆè§£å†³ï¼Ÿ<br />ç›´æ¥patchï¼Œæ”¹ä¸ºä¸¤æ¡æ— æ•ˆæŒ‡ä»¤ï¼Œéœ€è¦ä¿®æ”¹4ä¸ªå­—èŠ‚<br /><img  
                     lazyload
                     alt="image"
                     data-src="/../images/24643/27.png"
                      alt="image.png"
                ><br />é¦–å…ˆå†™å…¥0046ï¼Œdebugå‘ç°ä¸å¯¹ï¼Œè°ƒæ•´äº†ä¸€ä¸‹å¤§å°ç«¯åºï¼Œå†DEBUGä¼¼ä¹OKäº†</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">patchCode</span> <span class="operator">=</span> <span class="number">0x46004600</span>;</span><br><span class="line">	emulator.getMemory().pointer(<span class="keyword">module</span>.base + <span class="number">0xABE</span>).setInt(<span class="number">0</span>,patchCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¦ä¸€ç§å¡«å…¥ä¸¤ä¸ªnopä¹Ÿå¯ä»¥</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Pointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator, <span class="keyword">module</span>.base + <span class="number">0xABE</span>);</span><br><span class="line">    <span class="keyword">assert</span> pointer != <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Keystone</span> <span class="variable">keystone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Keystone</span>(KeystoneArchitecture.Arm,KeystoneMode.ArmThumb)) &#123;</span><br><span class="line">		<span class="type">KeystoneEncoded</span> <span class="variable">encoded</span> <span class="operator">=</span> keystone.assemble(<span class="string">&quot;nop&quot;</span>);</span><br><span class="line">		<span class="type">byte</span>[] patch = encoded.getMachineCode();</span><br><span class="line">        pointer.write(<span class="number">0</span>, patch, <span class="number">0</span>, patch.length);</span><br><span class="line">        pointer.write(<span class="number">2</span>, patch, <span class="number">0</span>, patch.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œå‰é¢ä¸¤ç§éƒ½æ˜¯é™æ€æ‰“patchï¼Œå’Œç”¨IDAçš„KeyPatchç›´æ¥æ‰“patchæ²¡å•¥åŒºåˆ«</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog2</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0xABE</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">        	emulator.getBackend().reg_write(ArmConst.UC_ARM_REG_PC,(address)+<span class="number">5</span>);</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>è§£é‡Šä¸€ä¸‹åšäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬åœ¨logçš„è°ƒç”¨å¤„ä¸‹äº†ä¸€ä¸ªæ–­ç‚¹ï¼Œinline hook éƒ½æ˜¯åœ¨è°ƒç”¨å‰æ–­ä¸‹æ¥äº†ï¼Œæ‰€ä»¥åœ¨æ‰§ è¡Œå‰æ–­äº†ä¸‹æ¥ï¼Œç„¶ååŠ äº†BreakPointCallbackå›è°ƒï¼Œåœ¨è¿™ä¸ªæ—¶æœºåšå¤„ç†ï¼Œæˆ‘ä»¬å°†PCæŒ‡é’ˆç›´æ¥å¾€å‰åŠ äº† 5ï¼ŒPCæŒ‡å‘å“ªé‡Œï¼Œå‡½æ•°å°±æ‰§è¡Œå“ªé‡Œï¼Œæœ¬æ¥PCæŒ‡å‘â€œblx logâ€è¿™ä¸ªåœ°å€ï¼Œç¨‹åºå³å°†å»æ‰§è¡Œlogå‡½æ•°ã€‚ä½†æˆ‘ä»¬ç›´ æ¥å°†PCåŠ äº†5ï¼Œä¸ºä»€ä¹ˆåŠ 5ï¼Ÿ<br />æˆ‘ä»¬çŸ¥é“è¿™é‡Œçš„logæ˜¯ä¸ªå‘ï¼Œå®ƒé•¿å››ä¸ªå­—èŠ‚ï¼Œæˆ‘ä»¬è¦è¶Šè¿‡è¿™ä¸ªå‘ï¼Œä½†åŠ 4ä¸å¤Ÿï¼Œæˆ‘ä»¬æ˜¯thumbæ¨¡å¼ï¼Œå†+1ï¼Œæ‰€ä»¥å°±æ˜¯+5ã€‚</p>

                </div>

                
                        <div class="article-copyright-info-container border-box">
    <div class="copyright-info-content border-box">
        <div class="copyright-info-top border-box">
            <div class="post-title border-box text-ellipsis">
                Unidbgæ“ä½œè¯´æ˜
            </div>

            <div class="post-link border-box text-ellipsis">
                posts/24643/
            </div>
        </div>

        <div class="copyright-info-bottom border-box">
            <div class="post-author bottom-item">
                <div class="type">
                    ä½œè€…
                </div>
                <div class="content">zsk</div>
            </div>

            <div class="post-time bottom-item">
                <div class="type">
                    å‘å¸ƒäº
                </div>
                <div class="content">2022-10-19 00:00</div>
            </div>


            <div class="post-license bottom-item">
                <div class="type">
                    è®¸å¯
                </div>
                <div class="content tooltip" data-tooltip-content="CC BY-NC-SA 4.0">
                    <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">
                        <i class="fa-brands fa-creative-commons"></i>
                        <i class="fa-brands fa-creative-commons-by"></i>
                        <i class="fa-brands fa-creative-commons-nc"></i>
                        <i class="fa-brands fa-creative-commons-sa"></i>
                    </a>
                </div>
            </div>
        </div>

        <i class="copyright-bg fa-solid fa-copyright"></i>
    </div>
    <div class="copy-copyright-info flex-center tooltip" data-tooltip-content="å¤åˆ¶ç‰ˆæƒä¿¡æ¯" data-tooltip-offset-y="-2px">
        <i class="fa-solid fa-copy"></i>
    </div>
</div>

                

                <div class="post-bottom-tags-and-share border-box">
                    <div>
                        
                            <ul class="post-tags-box border-box">
                                
                                    <li class="tag-item border-box">
                                        <i class="icon fas fa-hashtag"></i>&nbsp;<a href="/tags/Unidbg/">Unidbg</a>
                                    </li>
                                
                            </ul>
                        
                    </div>
                    <div>
                        
                            <div class="post-share-container border-box">
    <ul class="share-list-wrap border-box">
        <li class="qq share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ° QQ"
        >
            <i class="fa-brands fa-qq"></i>
        </li>
        <li class="wechat share-item border-box flex-center tooltip tooltip-img"
            data-tooltip-content="åˆ†äº«åˆ°å¾®ä¿¡"
            data-tooltip-img-tip="å¾®ä¿¡æ‰«ä¸€æ‰«"
            data-tooltip-img-style="background-color: #fff; top: -10px; padding: 0.6rem 0.6rem 0.1rem 0.6rem;"
        >
            <i class="fa-brands fa-weixin"></i>
        </li>
        <li class="weibo share-item border-box flex-center tooltip"
            data-tooltip-content="åˆ†äº«åˆ°å¾®åš"
        >
            <i class="fa-brands fa-weibo"></i>
        </li>
    </ul>
</div>

                        
                    </div>
                </div>

                

                
                    <div class="article-nav">
                        
                            <div class="article-prev">
                                <a class="prev"
                                   rel="prev"
                                   href="/posts/48808/"
                                   title="unidbgè¸©å‘è®°å½•ï¼Œgetobjectclasså¯¹è±¡ä¸ºnull"
                                >
                                    <span class="left arrow-icon flex-center">
                                      <i class="fas fa-chevron-left"></i>
                                    </span>
                                            <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">unidbgè¸©å‘è®°å½•ï¼Œgetobjectclasså¯¹è±¡ä¸ºnull</span>
                                        <span class="post-nav-item">ä¸Šä¸€ç¯‡</span>
                                    </span>
                                </a>
                            </div>
                        
                        
                            <div class="article-next">
                                <a class="next"
                                   rel="next"
                                   href="/posts/3538/"
                                   title="å¯¹ç§°åŠ è§£å¯†ç®—æ³•RC4åŸç†è¿‡ç¨‹åŠå®ç°"
                                >
                                    <span class="title flex-center">
                                        <span class="post-nav-title-item text-ellipsis">å¯¹ç§°åŠ è§£å¯†ç®—æ³•RC4åŸç†è¿‡ç¨‹åŠå®ç°</span>
                                        <span class="post-nav-item">ä¸‹ä¸€ç¯‡</span>
                                    </span>
                                            <span class="right arrow-icon flex-center">
                                      <i class="fas fa-chevron-right"></i>
                                    </span>
                                </a>
                            </div>
                        
                    </div>
                

                
                    


    <div class="comments-container border-box">
        <div id="comments-anchor" class="comment-area-title border-box">
            <i class="fas fa-comments"></i>&nbsp;è¯„è®º
        </div>
        
            

    <div class="valine-container">
        <script data-pjax src="//cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js"></script>
        <div id="vcomments"></div>
        <script data-pjax>
          function loadValine() {

            const config = {
              el: '#vcomments',
              appId: 'WxNQs5QEQtykF82Sb7nAjXRO-gzGzoHsz',
              appKey: '4rZ6NwH5zAu6VEspHwVrgqOq',
              meta: ['nick', 'mail', 'link'],
              avatar: 'wavatar',
              enableQQ: true,
              placeholder: 'ğŸ˜œ å°½æƒ…åæ§½å§~',
              lang: 'zh-CN'.toLowerCase()
            }

            if ('') {
              config.serverURLs = ''
            }

            new Valine(config)

            function getAuthor(language) {
              switch (language) {
                case 'en':
                  return 'Author'
                case 'zh-CN':
                  return 'åšä¸»'
                case 'zh-TW':
                  return 'ç«™é•·'
                default:
                  return 'Master'
              }
            }

            // Add "Author" identify
            const getValineDomTimer = setInterval(() => {
              const vcards = document.querySelectorAll('#vcomments .vcards .vcard')
              if (vcards.length > 0) {
                let author = 'zsk'

                if (author) {
                  for (let vcard of vcards) {
                    const vnick_dom = vcard.querySelector('.vhead .vnick')
                    const vnick = vnick_dom.innerHTML
                    if (vnick === author) {
                      vnick_dom.innerHTML = `${vnick} <span class="author">${getAuthor(KEEP.hexo_config.language)}</span>`
                    }
                  }
                }
                clearInterval(getValineDomTimer)
              } else {
                clearInterval(getValineDomTimer)
              }
            }, 2000)
          }

          if ('true' === 'true') {
            const loadValineTimeout = setTimeout(() => {
              loadValine()
              clearTimeout(loadValineTimeout)
            }, 1000)
          } else {
            window.addEventListener('DOMContentLoaded', loadValine)
          }
        </script>
    </div>


        
    </div>





                
            </div>
        </div>

        
            <div class="pc-post-toc right-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%89%E6%9D%A1%E5%87%86%E5%88%99"><span class="nav-number">1.</span> <span class="nav-text">è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">2.</span> <span class="nav-text">ç›®å½•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">åŸºæœ¬æ¡†æ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AndroidEmulator"><span class="nav-number">4.</span> <span class="nav-text">AndroidEmulator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroidEmulator%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.</span> <span class="nav-text">AndroidEmulatorä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAAndroidEmulator%E5%AE%9E%E4%BE%8B"><span class="nav-number">4.2.</span> <span class="nav-text">åˆ›å»ºAndroidEmulatorå®ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroidEmulator%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.3.</span> <span class="nav-text">AndroidEmulatoræ“ä½œæ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getMemory"><span class="nav-number">4.3.1.</span> <span class="nav-text">getMemory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getPid"><span class="nav-number">4.3.2.</span> <span class="nav-text">getPid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createDalvikVM"><span class="nav-number">4.3.3.</span> <span class="nav-text">createDalvikVM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#loadLibrary"><span class="nav-number">4.3.4.</span> <span class="nav-text">loadLibrary</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getDalvikVM"><span class="nav-number">4.3.5.</span> <span class="nav-text">getDalvikVM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#showRegs"><span class="nav-number">4.3.6.</span> <span class="nav-text">showRegs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getBackend"><span class="nav-number">4.3.7.</span> <span class="nav-text">getBackend</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getProcessName"><span class="nav-number">4.3.8.</span> <span class="nav-text">getProcessName</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getContext"><span class="nav-number">4.3.9.</span> <span class="nav-text">getContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isRunning"><span class="nav-number">4.3.10.</span> <span class="nav-text">isRunning</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Trace"><span class="nav-number">4.3.11.</span> <span class="nav-text">Trace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Set-x2F-Get"><span class="nav-number">4.3.12.</span> <span class="nav-text">Set&#x2F;Get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SyscallHandler"><span class="nav-number">4.3.13.</span> <span class="nav-text">SyscallHandler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Debugger"><span class="nav-number">4.3.14.</span> <span class="nav-text">Debugger</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#emulateSignal"><span class="nav-number">4.3.15.</span> <span class="nav-text">emulateSignal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#disassemble"><span class="nav-number">4.3.16.</span> <span class="nav-text">disassemble</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#close"><span class="nav-number">4.3.17.</span> <span class="nav-text">close</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getUnwinder"><span class="nav-number">4.3.18.</span> <span class="nav-text">getUnwinder</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory"><span class="nav-number">5.</span> <span class="nav-text">Memory</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.1.</span> <span class="nav-text">Memoryä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.</span> <span class="nav-text">Memoryæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Memory%E5%AE%9E%E4%BE%8B"><span class="nav-number">5.2.1.</span> <span class="nav-text">è·å–Memoryå®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setLibraryResolver"><span class="nav-number">5.2.2.</span> <span class="nav-text">setLibraryResolver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findModule"><span class="nav-number">5.2.3.</span> <span class="nav-text">findModule</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#allocateStack"><span class="nav-number">5.2.4.</span> <span class="nav-text">allocateStack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#malloc"><span class="nav-number">5.2.5.</span> <span class="nav-text">malloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setErrno"><span class="nav-number">5.2.6.</span> <span class="nav-text">setErrno</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getStackPoint"><span class="nav-number">5.2.7.</span> <span class="nav-text">getStackPoint</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#disableCallInitFunction"><span class="nav-number">5.2.8.</span> <span class="nav-text">disableCallInitFunction</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getMemoryMap"><span class="nav-number">5.2.9.</span> <span class="nav-text">getMemoryMap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pointer"><span class="nav-number">5.2.10.</span> <span class="nav-text">pointer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#addModuleListener"><span class="nav-number">5.2.11.</span> <span class="nav-text">addModuleListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#load"><span class="nav-number">5.2.12.</span> <span class="nav-text">load</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E6%80%BB%E7%BB%93"><span class="nav-number">5.3.</span> <span class="nav-text">Memoryæ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VM"><span class="nav-number">6.</span> <span class="nav-text">VM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.1.</span> <span class="nav-text">VMä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E5%88%9B%E5%BB%BA"><span class="nav-number">6.2.</span> <span class="nav-text">VMåˆ›å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E6%8E%A5%E5%8F%A3"><span class="nav-number">6.3.</span> <span class="nav-text">VMæ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%8E%A7%E5%88%B6"><span class="nav-number">6.3.1.</span> <span class="nav-text">æ—¥å¿—æ§åˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEJNI"><span class="nav-number">6.3.2.</span> <span class="nav-text">è®¾ç½®JNI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E7%94%A8JNI-OnLoad%E5%87%BD%E6%95%B0"><span class="nav-number">6.3.3.</span> <span class="nav-text">è°ƒç”¨JNI_OnLoadå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.4.</span> <span class="nav-text">è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96APK%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="nav-number">6.3.5.</span> <span class="nav-text">è·å–APKç›¸å…³ä¿¡æ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="nav-number">6.3.6.</span> <span class="nav-text">åŠ è½½æ¨¡å—</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E6%80%BB%E7%BB%93"><span class="nav-number">6.4.</span> <span class="nav-text">VMæ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CallMethod"><span class="nav-number">7.</span> <span class="nav-text">CallMethod</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8CJNI%E5%87%BD%E6%95%B0"><span class="nav-number">7.1.</span> <span class="nav-text">æ‰§è¡ŒJNIå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%87%BD%E6%95%B0"><span class="nav-number">7.2.</span> <span class="nav-text">æ‰§è¡Œä»»æ„å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8Cmain%E5%87%BD%E6%95%B0"><span class="nav-number">7.3.</span> <span class="nav-text">æ‰§è¡Œmainå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85"><span class="nav-number">7.4.</span> <span class="nav-text">JNIæ–¹æ³•å°è£…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#void"><span class="nav-number">7.4.1.</span> <span class="nav-text">void</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boolean"><span class="nav-number">7.4.2.</span> <span class="nav-text">boolean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#int"><span class="nav-number">7.4.3.</span> <span class="nav-text">int</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#long"><span class="nav-number">7.4.4.</span> <span class="nav-text">long</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#float"><span class="nav-number">7.4.5.</span> <span class="nav-text">float</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#double"><span class="nav-number">7.4.6.</span> <span class="nav-text">double</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.4.7.</span> <span class="nav-text">å¯¹è±¡ç±»å‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="nav-number">7.5.</span> <span class="nav-text">JNIæ–¹æ³•ç­¾å</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook"><span class="nav-number">8.</span> <span class="nav-text">Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook%E4%BB%8B%E7%BB%8D"><span class="nav-number">8.1.</span> <span class="nav-text">Hookä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB"><span class="nav-number">8.2.</span> <span class="nav-text">Hookæ¡†æ¶åˆ†ç±»</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HookZz"><span class="nav-number">8.2.1.</span> <span class="nav-text">HookZz</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96HookZz%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.1.1.</span> <span class="nav-text">è·å–HookZzå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HookZz-API"><span class="nav-number">8.2.1.2.</span> <span class="nav-text">HookZz API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#wrap"><span class="nav-number">8.2.1.2.1.</span> <span class="nav-text">wrap</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#replace"><span class="nav-number">8.2.1.2.2.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#instrument"><span class="nav-number">8.2.1.2.3.</span> <span class="nav-text">instrument</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dobby"><span class="nav-number">8.2.2.</span> <span class="nav-text">Dobby</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Dobby%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.2.1.</span> <span class="nav-text">è·å–Dobbyå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dobby-API"><span class="nav-number">8.2.2.2.</span> <span class="nav-text">Dobby API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#replace-1"><span class="nav-number">8.2.2.2.1.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#instrument-1"><span class="nav-number">8.2.2.2.2.</span> <span class="nav-text">instrument</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xHook"><span class="nav-number">8.2.3.</span> <span class="nav-text">xHook</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96xHook%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.3.1.</span> <span class="nav-text">è·å–xHookå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#xHook-API"><span class="nav-number">8.2.3.2.</span> <span class="nav-text">xHook API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#register"><span class="nav-number">8.2.3.2.1.</span> <span class="nav-text">register</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#refresh"><span class="nav-number">8.2.3.2.2.</span> <span class="nav-text">refresh</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Whale"><span class="nav-number">8.2.4.</span> <span class="nav-text">Whale</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Whale%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.4.1.</span> <span class="nav-text">è·å–Whaleå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Whale-API"><span class="nav-number">8.2.4.2.</span> <span class="nav-text">Whale API</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%94%9Fhook"><span class="nav-number">8.2.5.</span> <span class="nav-text">åŸç”Ÿhook</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch"><span class="nav-number">8.3.</span> <span class="nav-text">patch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JNI"><span class="nav-number">9.</span> <span class="nav-text">JNI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E4%BB%8B%E7%BB%8D"><span class="nav-number">9.1.</span> <span class="nav-text">JNIä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB-x2F-%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.2.</span> <span class="nav-text">ç±»&#x2F;ç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B"><span class="nav-number">9.3.</span> <span class="nav-text">å¯¹è±¡&#x2F;å®ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E8%A3%85%E5%AF%B9%E8%B1%A1"><span class="nav-number">9.4.</span> <span class="nav-text">åŒ…è£…å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String"><span class="nav-number">9.4.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Array"><span class="nav-number">9.4.2.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">9.4.3.</span> <span class="nav-text">List</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Module"><span class="nav-number">10.</span> <span class="nav-text">Module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Module%E4%BB%8B%E7%BB%8D"><span class="nav-number">10.1.</span> <span class="nav-text">Moduleä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Module%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">10.2.</span> <span class="nav-text">Moduleå¸¸ç”¨çš„å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#base"><span class="nav-number">10.2.1.</span> <span class="nav-text">base</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#name"><span class="nav-number">10.2.2.</span> <span class="nav-text">name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#callEntry"><span class="nav-number">10.2.3.</span> <span class="nav-text">callEntry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findSymbolByName"><span class="nav-number">10.2.4.</span> <span class="nav-text">findSymbolByName</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Backend"><span class="nav-number">11.</span> <span class="nav-text">Backend</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E4%BB%8B%E7%BB%8D"><span class="nav-number">11.1.</span> <span class="nav-text">Backendä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E5%88%97%E8%A1%A8"><span class="nav-number">11.2.</span> <span class="nav-text">Backendåˆ—è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Unicorn-x2F-Unicorn2"><span class="nav-number">11.2.1.</span> <span class="nav-text">Unicorn&#x2F;Unicorn2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Unicorn2%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.1.1.</span> <span class="nav-text">ä½¿ç”¨Unicorn2åç«¯:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Unicorn%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.1.2.</span> <span class="nav-text">Unicornåç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynarmic"><span class="nav-number">11.2.2.</span> <span class="nav-text">Dynarmic</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Dynarmic%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.2.1.</span> <span class="nav-text">ä½¿ç”¨Dynarmicåç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dynarmic%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.2.2.</span> <span class="nav-text">Dynarmicåç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hypervisor"><span class="nav-number">11.2.3.</span> <span class="nav-text">Hypervisor</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Hypervisor%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.3.1.</span> <span class="nav-text">ä½¿ç”¨Hypervisoråç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hypervisor%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.3.2.</span> <span class="nav-text">Hypervisoråç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kvm"><span class="nav-number">11.2.4.</span> <span class="nav-text">Kvm</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Kvm%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.4.1.</span> <span class="nav-text">ä½¿ç”¨Kvmåç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kvm%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.4.2.</span> <span class="nav-text">Kvmåç«¯ç‰¹ç‚¹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E6%8E%A5%E5%8F%A3"><span class="nav-number">11.3.</span> <span class="nav-text">Backendæ¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deggbuer"><span class="nav-number">12.</span> <span class="nav-text">Deggbuer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugger%E4%BB%8B%E7%BB%8D"><span class="nav-number">12.1.</span> <span class="nav-text">Debuggerä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConsoleDebugger"><span class="nav-number">12.2.</span> <span class="nav-text">ConsoleDebugger</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">12.2.1.</span> <span class="nav-text">ä½¿ç”¨æ­¥éª¤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E9%9B%B6%E6%AD%A5"><span class="nav-number">12.2.1.1.</span> <span class="nav-text">ç¬¬é›¶æ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="nav-number">12.2.1.2.</span> <span class="nav-text">ç¬¬ä¸€æ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5"><span class="nav-number">12.2.1.3.</span> <span class="nav-text">ç¬¬äºŒæ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5"><span class="nav-number">12.2.1.4.</span> <span class="nav-text">ç¬¬ä¸‰æ­¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%8C%87%E4%BB%A4"><span class="nav-number">12.2.2.</span> <span class="nav-text">è°ƒè¯•æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#help"><span class="nav-number">12.2.2.1.</span> <span class="nav-text">help</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shr"><span class="nav-number">12.2.3.</span> <span class="nav-text">shr</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#show-disassemble"><span class="nav-number">12.2.3.1.</span> <span class="nav-text">show disassemble</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#continue"><span class="nav-number">12.2.3.2.</span> <span class="nav-text">continue</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-over"><span class="nav-number">12.2.3.3.</span> <span class="nav-text">step over</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-into"><span class="nav-number">12.2.3.4.</span> <span class="nav-text">step into</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#next-block"><span class="nav-number">12.2.3.5.</span> <span class="nav-text">next block</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b"><span class="nav-number">12.2.3.6.</span> <span class="nav-text">b</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#r"><span class="nav-number">12.2.3.7.</span> <span class="nav-text">r</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#blr"><span class="nav-number">12.2.3.8.</span> <span class="nav-text">blr</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vbs"><span class="nav-number">12.2.3.9.</span> <span class="nav-text">vbs</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#back-trace"><span class="nav-number">12.2.3.10.</span> <span class="nav-text">back trace</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#show-memory"><span class="nav-number">12.2.3.11.</span> <span class="nav-text">show memory</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#write-memory"><span class="nav-number">12.2.3.12.</span> <span class="nav-text">write memory</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-stack"><span class="nav-number">12.2.3.13.</span> <span class="nav-text">search stack</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-writable-heap"><span class="nav-number">12.2.3.14.</span> <span class="nav-text">search writable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-readable-heap"><span class="nav-number">12.2.3.15.</span> <span class="nav-text">search readable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-executable-heap"><span class="nav-number">12.2.3.16.</span> <span class="nav-text">search executable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#where"><span class="nav-number">12.2.3.17.</span> <span class="nav-text">where</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vm"><span class="nav-number">12.2.3.18.</span> <span class="nav-text">vm</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#stop"><span class="nav-number">12.2.3.19.</span> <span class="nav-text">stop</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#patch-1"><span class="nav-number">12.2.3.20.</span> <span class="nav-text">patch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#trace"><span class="nav-number">12.2.3.21.</span> <span class="nav-text">trace</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GDB-SERVER"><span class="nav-number">12.3.</span> <span class="nav-text">GDB_SERVER</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ANDROID-SERVER-V7"><span class="nav-number">12.4.</span> <span class="nav-text">ANDROID_SERVER_V7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Block"><span class="nav-number">12.5.</span> <span class="nav-text">Block</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RegisterContext"><span class="nav-number">13.</span> <span class="nav-text">RegisterContext</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SyscallHandler-1"><span class="nav-number">14.</span> <span class="nav-text">SyscallHandler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SyscallHandler%E4%BB%8B%E7%BB%8D"><span class="nav-number">14.1.</span> <span class="nav-text">SyscallHandlerä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">14.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96SyscallHandler%E5%AE%9E%E4%BE%8B"><span class="nav-number">14.2.1.</span> <span class="nav-text">è·å–SyscallHandlerå®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setVerbose"><span class="nav-number">14.2.2.</span> <span class="nav-text">setVerbose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#addIOResolver"><span class="nav-number">14.2.3.</span> <span class="nav-text">addIOResolver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setEnableThreadDispatcher"><span class="nav-number">14.2.4.</span> <span class="nav-text">setEnableThreadDispatcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setFileListener"><span class="nav-number">14.2.5.</span> <span class="nav-text">setFileListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getFileIO"><span class="nav-number">14.2.6.</span> <span class="nav-text">getFileIO</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="nav-number">14.3.</span> <span class="nav-text">è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FileResult"><span class="nav-number">14.4.</span> <span class="nav-text">FileResult</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#success"><span class="nav-number">14.4.1.</span> <span class="nav-text">success</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#failed"><span class="nav-number">14.4.2.</span> <span class="nav-text">failed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fallback"><span class="nav-number">14.4.3.</span> <span class="nav-text">fallback</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VirtualModule"><span class="nav-number">15.</span> <span class="nav-text">VirtualModule</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VirtualModulem%E4%BB%8B%E7%BB%8D"><span class="nav-number">15.1.</span> <span class="nav-text">VirtualModulemä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unidbg%E8%87%AA%E5%B8%A6%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">15.2.</span> <span class="nav-text">unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">15.3.</span> <span class="nav-text">è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E5%9C%BA%E6%99%AF"><span class="nav-number">15.3.1.</span> <span class="nav-text">æ¨¡æ‹Ÿåœºæ™¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A6%96%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="nav-number">15.3.2.</span> <span class="nav-text">é¦–æ¬¡å°è¯•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="nav-number">15.3.3.</span> <span class="nav-text">å¤„ç†é—®é¢˜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">15.3.4.</span> <span class="nav-text">å®Œæ•´ä»£ç </span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jnitrace"><span class="nav-number">16.</span> <span class="nav-text">Jnitrace</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">16.1.</span> <span class="nav-text">ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jnitrace%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E6%97%B6%E5%80%99"><span class="nav-number">16.2.</span> <span class="nav-text">jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B"><span class="nav-number">16.3.</span> <span class="nav-text">å †æ ˆæ£€æµ‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8objection%E6%9F%A5%E7%9C%8B%E5%A0%86%E6%A0%88"><span class="nav-number">16.3.1.</span> <span class="nav-text">æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">17.</span> <span class="nav-text">å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E8%B0%83%E7%94%A8"><span class="nav-number">17.1.</span> <span class="nav-text">ç¬¦å·è°ƒç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E8%B0%83%E7%94%A8"><span class="nav-number">17.2.</span> <span class="nav-text">åœ°å€è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%B1%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">18.</span> <span class="nav-text">æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E7%BB%A7%E6%89%BF%E7%9A%84%E5%86%99%E6%B3%95"><span class="nav-number">19.</span> <span class="nav-text">ç±»ç»§æ‰¿çš„å†™æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7"><span class="nav-number">20.</span> <span class="nav-text">unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E5%AE%9E%E7%8E%B0-IOResolver"><span class="nav-number">21.</span> <span class="nav-text">æ–‡ä»¶é‡å®šå‘ï¼Œå®ç° IOResolver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="nav-number">22.</span> <span class="nav-text">ä¸€äº›å¸¸ç”¨åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E5%86%85%E5%AD%98%EF%BC%8Chexdump"><span class="nav-number">22.1.</span> <span class="nav-text">æ‰“å°å†…å­˜ï¼Œhexdump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unidbg%E4%B8%8B%E6%96%AD%E7%82%B9"><span class="nav-number">22.2.</span> <span class="nav-text">unidbgä¸‹æ–­ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%89%80%E6%9C%89%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">22.3.</span> <span class="nav-text">å¼€å¯æ‰€æœ‰çš„æ—¥å¿—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%B1%87%E7%BC%96%E7%9A%84%E8%A1%8C%E6%95%B0"><span class="nav-number">22.4.</span> <span class="nav-text">è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E6%88%96%E4%BF%AE%E6%94%B9%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">22.5.</span> <span class="nav-text">æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%9B%BA%E5%AE%9A"><span class="nav-number">22.6.</span> <span class="nav-text">éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-Trace"><span class="nav-number">22.7.</span> <span class="nav-text">è·å– Trace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81"><span class="nav-number">22.8.</span> <span class="nav-text">è·å–å‡½æ•°è°ƒç”¨æµ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">22.9.</span> <span class="nav-text">åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findCryptInTrace"><span class="nav-number">22.10.</span> <span class="nav-text">findCryptInTrace</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%88%B6unidng"><span class="nav-number">23.</span> <span class="nav-text">ååˆ¶unidng</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E3%80%81JNI%E4%BA%A4%E4%BA%92"><span class="nav-number">23.0.1.</span> <span class="nav-text">ä¸€ã€JNIäº¤äº’</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="nav-number">23.0.2.</span> <span class="nav-text">äºŒã€ç³»ç»Ÿè°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE"><span class="nav-number">23.0.3.</span> <span class="nav-text">ä¸‰ã€æ–‡ä»¶è®¿é—®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%A3%80%E6%B5%8BUnidbg"><span class="nav-number">23.0.4.</span> <span class="nav-text">å››ã€æ£€æµ‹Unidbg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0%E6%97%A0%E6%B3%95%E8%A2%AB%E5%8D%95%E7%8B%AC%E6%89%A7%E8%A1%8C"><span class="nav-number">23.0.5.</span> <span class="nav-text">äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%9C%A8%E7%9C%9F%E6%9C%BA%E4%B8%8A%E4%BD%BF%E7%94%A8GetStaticMethodID%E5%AF%BB%E6%89%BE%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">23.0.6.</span> <span class="nav-text">å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unidbg%E6%8A%A5%E9%94%99"><span class="nav-number">24.</span> <span class="nav-text">UnidbgæŠ¥é”™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Illegal-JNI-version"><span class="nav-number">24.1.</span> <span class="nav-text">Illegal JNI version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%A4%B1%E8%AF%AF%EF%BC%8C%E9%87%8A%E6%94%BE%E5%8F%98%E9%87%8F%E5%90%8E%E8%BF%98%E8%B0%83%E7%94%A8"><span class="nav-number">24.2.</span> <span class="nav-text">appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        
    </div>
</div>


                
            </div>

        </div>

        <div class="page-main-content-bottom border-box">
            
<footer class="footer border-box">
    <div class="border-box website-info-box default">
        
            <div class="copyright-info info-item default">
                &copy;&nbsp;<span>2021</span>&nbsp;-&nbsp;2025
                
                    &nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;&nbsp;<a href="/">zsk</a>
                
            </div>

            <div class="theme-info info-item default">
                ç”±&nbsp;<a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;é©±åŠ¨&nbsp;&&nbsp;ä¸»é¢˜&nbsp;<a class="keep-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep</a>
            </div>

            

            
                <div class="deploy-info info-item default">
                    
                        æœ¬ç«™ç”± <span class="tooltip" data-tooltip-content="GitHub Pages"><img src="/images/deploy-provider/github.png"></span> æä¾›éƒ¨ç½²æœåŠ¡
                        
                </div>
            
        

        <div class="count-item info-item default">
            
                <span class="count-box border-box word">
                    <span class="item-type border-box">æ€»å­—æ•°</span>
                    <span class="item-value border-box word">138.2k</span>
                </span>
            

            
                <span class="count-box border-box uv">
                    <span class="item-type border-box">è®¿å®¢æ•°</span>
                    <span class="item-value border-box uv" id="busuanzi_value_site_uv"></span>
                </span>
            

            
                <span class="count-box border-box pv">
                    <span class="item-type border-box">è®¿é—®é‡</span>
                    <span class="item-value border-box pv" id="busuanzi_value_site_pv"></span>
                </span>
            
        </div>
    </div>
</footer>

        </div>
    </div>

    <!-- post tools -->
    
        <div class="post-tools right-toc">
            <div class="post-tools-container border-box">
    <ul class="tools-list border-box">
        <!-- PC TOC show toggle -->
        
            <li class="tools-item flex-center toggle-show-toc">
                <i class="fas fa-list"></i>
            </li>
        

        <!-- PC go comment -->
        
            <li class="tools-item flex-center go-to-comments">
                <i class="fas fa-comment"></i>
                <span class="post-comments-count"></span>
            </li>
        
    </ul>
</div>

        </div>
    

    <!-- side tools -->
    <div class="side-tools">
        <div class="side-tools-container border-box ">
    <ul class="side-tools-list side-tools-show-handle border-box">
        <li class="tools-item tool-font-adjust-plus flex-center">
            <i class="fas fa-search-plus"></i>
        </li>

        <li class="tools-item tool-font-adjust-minus flex-center">
            <i class="fas fa-search-minus"></i>
        </li>

        <li class="tools-item tool-dark-light-toggle flex-center">
            <i class="fas fa-moon"></i>
        </li>

        <!-- rss -->
        

        <li class="tools-item tool-scroll-to-bottom flex-center">
            <i class="fas fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="exposed-tools-list border-box">
        
            <li class="tools-item toggle-show-toc-tablet flex-center">
                <i class="fas fa-list"></i>
            </li>
        

        
            <li class="tools-item go-to-comments-tablet flex-center">
                <i class="fas fa-comment"></i>
            </li>
        

        <li class="tools-item tool-toggle-show flex-center">
            <i class="fas fa-cog fa-spin"></i>
        </li>

        <li class="tools-item tool-scroll-to-top flex-center show-arrow">
            <i class="arrow fas fa-arrow-up"></i>
            <span class="percent"></span>
        </li>
    </ul>
</div>

    </div>

    <!-- image mask -->
    <div class="zoom-in-image-mask">
    <img class="zoom-in-image">
</div>


    <!-- local search -->
    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fas fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="æœç´¢..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="close-popup-btn">
                <i class="fas fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

    <!-- tablet toc -->
    
        <div class="tablet-post-toc-mask">
            <div class="tablet-post-toc">
                <div class="post-toc-wrap border-box">
    <div class="post-toc border-box">
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%A5%E7%8E%AF%E5%A2%83%E7%9A%84%E4%B8%89%E6%9D%A1%E5%87%86%E5%88%99"><span class="nav-number">1.</span> <span class="nav-text">è¡¥ç¯å¢ƒçš„ä¸‰æ¡å‡†åˆ™</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">2.</span> <span class="nav-text">ç›®å½•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%A1%86%E6%9E%B6"><span class="nav-number">3.</span> <span class="nav-text">åŸºæœ¬æ¡†æ¶</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#AndroidEmulator"><span class="nav-number">4.</span> <span class="nav-text">AndroidEmulator</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroidEmulator%E4%BB%8B%E7%BB%8D"><span class="nav-number">4.1.</span> <span class="nav-text">AndroidEmulatorä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAAndroidEmulator%E5%AE%9E%E4%BE%8B"><span class="nav-number">4.2.</span> <span class="nav-text">åˆ›å»ºAndroidEmulatorå®ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#AndroidEmulator%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3"><span class="nav-number">4.3.</span> <span class="nav-text">AndroidEmulatoræ“ä½œæ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#getMemory"><span class="nav-number">4.3.1.</span> <span class="nav-text">getMemory</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getPid"><span class="nav-number">4.3.2.</span> <span class="nav-text">getPid</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#createDalvikVM"><span class="nav-number">4.3.3.</span> <span class="nav-text">createDalvikVM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#loadLibrary"><span class="nav-number">4.3.4.</span> <span class="nav-text">loadLibrary</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getDalvikVM"><span class="nav-number">4.3.5.</span> <span class="nav-text">getDalvikVM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#showRegs"><span class="nav-number">4.3.6.</span> <span class="nav-text">showRegs</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getBackend"><span class="nav-number">4.3.7.</span> <span class="nav-text">getBackend</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getProcessName"><span class="nav-number">4.3.8.</span> <span class="nav-text">getProcessName</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getContext"><span class="nav-number">4.3.9.</span> <span class="nav-text">getContext</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#isRunning"><span class="nav-number">4.3.10.</span> <span class="nav-text">isRunning</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Trace"><span class="nav-number">4.3.11.</span> <span class="nav-text">Trace</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Set-x2F-Get"><span class="nav-number">4.3.12.</span> <span class="nav-text">Set&#x2F;Get</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SyscallHandler"><span class="nav-number">4.3.13.</span> <span class="nav-text">SyscallHandler</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Debugger"><span class="nav-number">4.3.14.</span> <span class="nav-text">Debugger</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#emulateSignal"><span class="nav-number">4.3.15.</span> <span class="nav-text">emulateSignal</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#disassemble"><span class="nav-number">4.3.16.</span> <span class="nav-text">disassemble</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#close"><span class="nav-number">4.3.17.</span> <span class="nav-text">close</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getUnwinder"><span class="nav-number">4.3.18.</span> <span class="nav-text">getUnwinder</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Memory"><span class="nav-number">5.</span> <span class="nav-text">Memory</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E4%BB%8B%E7%BB%8D"><span class="nav-number">5.1.</span> <span class="nav-text">Memoryä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E6%93%8D%E4%BD%9C"><span class="nav-number">5.2.</span> <span class="nav-text">Memoryæ“ä½œ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Memory%E5%AE%9E%E4%BE%8B"><span class="nav-number">5.2.1.</span> <span class="nav-text">è·å–Memoryå®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setLibraryResolver"><span class="nav-number">5.2.2.</span> <span class="nav-text">setLibraryResolver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findModule"><span class="nav-number">5.2.3.</span> <span class="nav-text">findModule</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#allocateStack"><span class="nav-number">5.2.4.</span> <span class="nav-text">allocateStack</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#malloc"><span class="nav-number">5.2.5.</span> <span class="nav-text">malloc</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setErrno"><span class="nav-number">5.2.6.</span> <span class="nav-text">setErrno</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getStackPoint"><span class="nav-number">5.2.7.</span> <span class="nav-text">getStackPoint</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#disableCallInitFunction"><span class="nav-number">5.2.8.</span> <span class="nav-text">disableCallInitFunction</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getMemoryMap"><span class="nav-number">5.2.9.</span> <span class="nav-text">getMemoryMap</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#pointer"><span class="nav-number">5.2.10.</span> <span class="nav-text">pointer</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#addModuleListener"><span class="nav-number">5.2.11.</span> <span class="nav-text">addModuleListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#load"><span class="nav-number">5.2.12.</span> <span class="nav-text">load</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Memory%E6%80%BB%E7%BB%93"><span class="nav-number">5.3.</span> <span class="nav-text">Memoryæ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VM"><span class="nav-number">6.</span> <span class="nav-text">VM</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E4%BB%8B%E7%BB%8D"><span class="nav-number">6.1.</span> <span class="nav-text">VMä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E5%88%9B%E5%BB%BA"><span class="nav-number">6.2.</span> <span class="nav-text">VMåˆ›å»º</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E6%8E%A5%E5%8F%A3"><span class="nav-number">6.3.</span> <span class="nav-text">VMæ¥å£</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E6%8E%A7%E5%88%B6"><span class="nav-number">6.3.1.</span> <span class="nav-text">æ—¥å¿—æ§åˆ¶</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BE%E7%BD%AEJNI"><span class="nav-number">6.3.2.</span> <span class="nav-text">è®¾ç½®JNI</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E7%94%A8JNI-OnLoad%E5%87%BD%E6%95%B0"><span class="nav-number">6.3.3.</span> <span class="nav-text">è°ƒç”¨JNI_OnLoadå‡½æ•°</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">6.3.4.</span> <span class="nav-text">è·å–æ¨¡æ‹Ÿå™¨å®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96APK%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF"><span class="nav-number">6.3.5.</span> <span class="nav-text">è·å–APKç›¸å…³ä¿¡æ¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97"><span class="nav-number">6.3.6.</span> <span class="nav-text">åŠ è½½æ¨¡å—</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VM%E6%80%BB%E7%BB%93"><span class="nav-number">6.4.</span> <span class="nav-text">VMæ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#CallMethod"><span class="nav-number">7.</span> <span class="nav-text">CallMethod</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8CJNI%E5%87%BD%E6%95%B0"><span class="nav-number">7.1.</span> <span class="nav-text">æ‰§è¡ŒJNIå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%87%BD%E6%95%B0"><span class="nav-number">7.2.</span> <span class="nav-text">æ‰§è¡Œä»»æ„å‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8Cmain%E5%87%BD%E6%95%B0"><span class="nav-number">7.3.</span> <span class="nav-text">æ‰§è¡Œmainå‡½æ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85"><span class="nav-number">7.4.</span> <span class="nav-text">JNIæ–¹æ³•å°è£…</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#void"><span class="nav-number">7.4.1.</span> <span class="nav-text">void</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#boolean"><span class="nav-number">7.4.2.</span> <span class="nav-text">boolean</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#int"><span class="nav-number">7.4.3.</span> <span class="nav-text">int</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#long"><span class="nav-number">7.4.4.</span> <span class="nav-text">long</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#float"><span class="nav-number">7.4.5.</span> <span class="nav-text">float</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#double"><span class="nav-number">7.4.6.</span> <span class="nav-text">double</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B"><span class="nav-number">7.4.7.</span> <span class="nav-text">å¯¹è±¡ç±»å‹</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D"><span class="nav-number">7.5.</span> <span class="nav-text">JNIæ–¹æ³•ç­¾å</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hook"><span class="nav-number">8.</span> <span class="nav-text">Hook</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook%E4%BB%8B%E7%BB%8D"><span class="nav-number">8.1.</span> <span class="nav-text">Hookä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hook%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB"><span class="nav-number">8.2.</span> <span class="nav-text">Hookæ¡†æ¶åˆ†ç±»</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#HookZz"><span class="nav-number">8.2.1.</span> <span class="nav-text">HookZz</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96HookZz%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.1.1.</span> <span class="nav-text">è·å–HookZzå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#HookZz-API"><span class="nav-number">8.2.1.2.</span> <span class="nav-text">HookZz API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#wrap"><span class="nav-number">8.2.1.2.1.</span> <span class="nav-text">wrap</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#replace"><span class="nav-number">8.2.1.2.2.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#instrument"><span class="nav-number">8.2.1.2.3.</span> <span class="nav-text">instrument</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dobby"><span class="nav-number">8.2.2.</span> <span class="nav-text">Dobby</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Dobby%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.2.1.</span> <span class="nav-text">è·å–Dobbyå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dobby-API"><span class="nav-number">8.2.2.2.</span> <span class="nav-text">Dobby API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#replace-1"><span class="nav-number">8.2.2.2.1.</span> <span class="nav-text">replace</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#instrument-1"><span class="nav-number">8.2.2.2.2.</span> <span class="nav-text">instrument</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#xHook"><span class="nav-number">8.2.3.</span> <span class="nav-text">xHook</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96xHook%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.3.1.</span> <span class="nav-text">è·å–xHookå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#xHook-API"><span class="nav-number">8.2.3.2.</span> <span class="nav-text">xHook API</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#register"><span class="nav-number">8.2.3.2.1.</span> <span class="nav-text">register</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#refresh"><span class="nav-number">8.2.3.2.2.</span> <span class="nav-text">refresh</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Whale"><span class="nav-number">8.2.4.</span> <span class="nav-text">Whale</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96Whale%E5%AE%9E%E4%BE%8B"><span class="nav-number">8.2.4.1.</span> <span class="nav-text">è·å–Whaleå®ä¾‹</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Whale-API"><span class="nav-number">8.2.4.2.</span> <span class="nav-text">Whale API</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E7%94%9Fhook"><span class="nav-number">8.2.5.</span> <span class="nav-text">åŸç”Ÿhook</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#patch"><span class="nav-number">8.3.</span> <span class="nav-text">patch</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#JNI"><span class="nav-number">9.</span> <span class="nav-text">JNI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#JNI%E4%BB%8B%E7%BB%8D"><span class="nav-number">9.1.</span> <span class="nav-text">JNIä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB-x2F-%E7%B1%BB%E5%9E%8B"><span class="nav-number">9.2.</span> <span class="nav-text">ç±»&#x2F;ç±»å‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B"><span class="nav-number">9.3.</span> <span class="nav-text">å¯¹è±¡&#x2F;å®ä¾‹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E8%A3%85%E5%AF%B9%E8%B1%A1"><span class="nav-number">9.4.</span> <span class="nav-text">åŒ…è£…å¯¹è±¡</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#String"><span class="nav-number">9.4.1.</span> <span class="nav-text">String</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Array"><span class="nav-number">9.4.2.</span> <span class="nav-text">Array</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#List"><span class="nav-number">9.4.3.</span> <span class="nav-text">List</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Module"><span class="nav-number">10.</span> <span class="nav-text">Module</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Module%E4%BB%8B%E7%BB%8D"><span class="nav-number">10.1.</span> <span class="nav-text">Moduleä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Module%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-number">10.2.</span> <span class="nav-text">Moduleå¸¸ç”¨çš„å±æ€§</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#base"><span class="nav-number">10.2.1.</span> <span class="nav-text">base</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#name"><span class="nav-number">10.2.2.</span> <span class="nav-text">name</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#callEntry"><span class="nav-number">10.2.3.</span> <span class="nav-text">callEntry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#findSymbolByName"><span class="nav-number">10.2.4.</span> <span class="nav-text">findSymbolByName</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Backend"><span class="nav-number">11.</span> <span class="nav-text">Backend</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E4%BB%8B%E7%BB%8D"><span class="nav-number">11.1.</span> <span class="nav-text">Backendä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E5%88%97%E8%A1%A8"><span class="nav-number">11.2.</span> <span class="nav-text">Backendåˆ—è¡¨</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Unicorn-x2F-Unicorn2"><span class="nav-number">11.2.1.</span> <span class="nav-text">Unicorn&#x2F;Unicorn2</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Unicorn2%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.1.1.</span> <span class="nav-text">ä½¿ç”¨Unicorn2åç«¯:</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Unicorn%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.1.2.</span> <span class="nav-text">Unicornåç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Dynarmic"><span class="nav-number">11.2.2.</span> <span class="nav-text">Dynarmic</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Dynarmic%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.2.1.</span> <span class="nav-text">ä½¿ç”¨Dynarmicåç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Dynarmic%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.2.2.</span> <span class="nav-text">Dynarmicåç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Hypervisor"><span class="nav-number">11.2.3.</span> <span class="nav-text">Hypervisor</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Hypervisor%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.3.1.</span> <span class="nav-text">ä½¿ç”¨Hypervisoråç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hypervisor%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.3.2.</span> <span class="nav-text">Hypervisoråç«¯ç‰¹ç‚¹</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Kvm"><span class="nav-number">11.2.4.</span> <span class="nav-text">Kvm</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8Kvm%E5%90%8E%E7%AB%AF"><span class="nav-number">11.2.4.1.</span> <span class="nav-text">ä½¿ç”¨Kvmåç«¯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Kvm%E5%90%8E%E7%AB%AF%E7%89%B9%E7%82%B9"><span class="nav-number">11.2.4.2.</span> <span class="nav-text">Kvmåç«¯ç‰¹ç‚¹</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Backend%E6%8E%A5%E5%8F%A3"><span class="nav-number">11.3.</span> <span class="nav-text">Backendæ¥å£</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Deggbuer"><span class="nav-number">12.</span> <span class="nav-text">Deggbuer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Debugger%E4%BB%8B%E7%BB%8D"><span class="nav-number">12.1.</span> <span class="nav-text">Debuggerä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConsoleDebugger"><span class="nav-number">12.2.</span> <span class="nav-text">ConsoleDebugger</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4"><span class="nav-number">12.2.1.</span> <span class="nav-text">ä½¿ç”¨æ­¥éª¤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E9%9B%B6%E6%AD%A5"><span class="nav-number">12.2.1.1.</span> <span class="nav-text">ç¬¬é›¶æ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E6%AD%A5"><span class="nav-number">12.2.1.2.</span> <span class="nav-text">ç¬¬ä¸€æ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%BA%8C%E6%AD%A5"><span class="nav-number">12.2.1.3.</span> <span class="nav-text">ç¬¬äºŒæ­¥</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AC%AC%E4%B8%89%E6%AD%A5"><span class="nav-number">12.2.1.4.</span> <span class="nav-text">ç¬¬ä¸‰æ­¥</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%8C%87%E4%BB%A4"><span class="nav-number">12.2.2.</span> <span class="nav-text">è°ƒè¯•æŒ‡ä»¤</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#help"><span class="nav-number">12.2.2.1.</span> <span class="nav-text">help</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#shr"><span class="nav-number">12.2.3.</span> <span class="nav-text">shr</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#show-disassemble"><span class="nav-number">12.2.3.1.</span> <span class="nav-text">show disassemble</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#continue"><span class="nav-number">12.2.3.2.</span> <span class="nav-text">continue</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-over"><span class="nav-number">12.2.3.3.</span> <span class="nav-text">step over</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#step-into"><span class="nav-number">12.2.3.4.</span> <span class="nav-text">step into</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#next-block"><span class="nav-number">12.2.3.5.</span> <span class="nav-text">next block</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#b"><span class="nav-number">12.2.3.6.</span> <span class="nav-text">b</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#r"><span class="nav-number">12.2.3.7.</span> <span class="nav-text">r</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#blr"><span class="nav-number">12.2.3.8.</span> <span class="nav-text">blr</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vbs"><span class="nav-number">12.2.3.9.</span> <span class="nav-text">vbs</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#back-trace"><span class="nav-number">12.2.3.10.</span> <span class="nav-text">back trace</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#show-memory"><span class="nav-number">12.2.3.11.</span> <span class="nav-text">show memory</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#write-memory"><span class="nav-number">12.2.3.12.</span> <span class="nav-text">write memory</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-stack"><span class="nav-number">12.2.3.13.</span> <span class="nav-text">search stack</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-writable-heap"><span class="nav-number">12.2.3.14.</span> <span class="nav-text">search writable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-readable-heap"><span class="nav-number">12.2.3.15.</span> <span class="nav-text">search readable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#search-executable-heap"><span class="nav-number">12.2.3.16.</span> <span class="nav-text">search executable heap</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#where"><span class="nav-number">12.2.3.17.</span> <span class="nav-text">where</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#vm"><span class="nav-number">12.2.3.18.</span> <span class="nav-text">vm</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#stop"><span class="nav-number">12.2.3.19.</span> <span class="nav-text">stop</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#patch-1"><span class="nav-number">12.2.3.20.</span> <span class="nav-text">patch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#trace"><span class="nav-number">12.2.3.21.</span> <span class="nav-text">trace</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GDB-SERVER"><span class="nav-number">12.3.</span> <span class="nav-text">GDB_SERVER</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ANDROID-SERVER-V7"><span class="nav-number">12.4.</span> <span class="nav-text">ANDROID_SERVER_V7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Block"><span class="nav-number">12.5.</span> <span class="nav-text">Block</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RegisterContext"><span class="nav-number">13.</span> <span class="nav-text">RegisterContext</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SyscallHandler-1"><span class="nav-number">14.</span> <span class="nav-text">SyscallHandler</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SyscallHandler%E4%BB%8B%E7%BB%8D"><span class="nav-number">14.1.</span> <span class="nav-text">SyscallHandlerä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#API"><span class="nav-number">14.2.</span> <span class="nav-text">API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96SyscallHandler%E5%AE%9E%E4%BE%8B"><span class="nav-number">14.2.1.</span> <span class="nav-text">è·å–SyscallHandlerå®ä¾‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setVerbose"><span class="nav-number">14.2.2.</span> <span class="nav-text">setVerbose</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#addIOResolver"><span class="nav-number">14.2.3.</span> <span class="nav-text">addIOResolver</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setEnableThreadDispatcher"><span class="nav-number">14.2.4.</span> <span class="nav-text">setEnableThreadDispatcher</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setFileListener"><span class="nav-number">14.2.5.</span> <span class="nav-text">setFileListener</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#getFileIO"><span class="nav-number">14.2.6.</span> <span class="nav-text">getFileIO</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="nav-number">14.3.</span> <span class="nav-text">è‡ªå¤„ç†ç³»ç»Ÿè°ƒç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FileResult"><span class="nav-number">14.4.</span> <span class="nav-text">FileResult</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#success"><span class="nav-number">14.4.1.</span> <span class="nav-text">success</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#failed"><span class="nav-number">14.4.2.</span> <span class="nav-text">failed</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#fallback"><span class="nav-number">14.4.3.</span> <span class="nav-text">fallback</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#VirtualModule"><span class="nav-number">15.</span> <span class="nav-text">VirtualModule</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VirtualModulem%E4%BB%8B%E7%BB%8D"><span class="nav-number">15.1.</span> <span class="nav-text">VirtualModulemä»‹ç»</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unidbg%E8%87%AA%E5%B8%A6%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">15.2.</span> <span class="nav-text">unidbgè‡ªå¸¦è™šæ‹Ÿæ¨¡å—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97"><span class="nav-number">15.3.</span> <span class="nav-text">è‡ªå®šä¹‰è™šæ‹Ÿæ¨¡å—</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%8B%9F%E5%9C%BA%E6%99%AF"><span class="nav-number">15.3.1.</span> <span class="nav-text">æ¨¡æ‹Ÿåœºæ™¯</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A6%96%E6%AC%A1%E5%B0%9D%E8%AF%95"><span class="nav-number">15.3.2.</span> <span class="nav-text">é¦–æ¬¡å°è¯•</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="nav-number">15.3.3.</span> <span class="nav-text">å¤„ç†é—®é¢˜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81"><span class="nav-number">15.3.4.</span> <span class="nav-text">å®Œæ•´ä»£ç </span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Jnitrace"><span class="nav-number">16.</span> <span class="nav-text">Jnitrace</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8"><span class="nav-number">16.1.</span> <span class="nav-text">ä½¿ç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#jnitrace%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E6%97%B6%E5%80%99"><span class="nav-number">16.2.</span> <span class="nav-text">jnitraceå‡½æ•°è°ƒç”¨è¿”å›çš„æ˜¯åœ°å€çš„æ—¶å€™</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B"><span class="nav-number">16.3.</span> <span class="nav-text">å †æ ˆæ£€æµ‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A8%E8%8D%90%E4%BD%BF%E7%94%A8objection%E6%9F%A5%E7%9C%8B%E5%A0%86%E6%A0%88"><span class="nav-number">16.3.1.</span> <span class="nav-text">æ¨èä½¿ç”¨objectionæŸ¥çœ‹å †æ ˆ</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">17.</span> <span class="nav-text">å‡½æ•°è°ƒç”¨ä¸¤ç§æ–¹å¼</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E8%B0%83%E7%94%A8"><span class="nav-number">17.1.</span> <span class="nav-text">ç¬¦å·è°ƒç”¨</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%B0%E5%9D%80%E8%B0%83%E7%94%A8"><span class="nav-number">17.2.</span> <span class="nav-text">åœ°å€è°ƒç”¨</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%84%E5%BB%BA%E7%B1%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="nav-number">18.</span> <span class="nav-text">æ„å»ºç±»çš„ä¸¤ç§æ–¹å¼</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E7%BB%A7%E6%89%BF%E7%9A%84%E5%86%99%E6%B3%95"><span class="nav-number">19.</span> <span class="nav-text">ç±»ç»§æ‰¿çš„å†™æ³•</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7"><span class="nav-number">20.</span> <span class="nav-text">unidbgè¡¥è·å–ç³»ç»Ÿå±æ€§</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E5%AE%9E%E7%8E%B0-IOResolver"><span class="nav-number">21.</span> <span class="nav-text">æ–‡ä»¶é‡å®šå‘ï¼Œå®ç° IOResolver</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD"><span class="nav-number">22.</span> <span class="nav-text">ä¸€äº›å¸¸ç”¨åŠŸèƒ½</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E5%86%85%E5%AD%98%EF%BC%8Chexdump"><span class="nav-number">22.1.</span> <span class="nav-text">æ‰“å°å†…å­˜ï¼Œhexdump</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#unidbg%E4%B8%8B%E6%96%AD%E7%82%B9"><span class="nav-number">22.2.</span> <span class="nav-text">unidbgä¸‹æ–­ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%80%E5%90%AF%E6%89%80%E6%9C%89%E7%9A%84%E6%97%A5%E5%BF%97"><span class="nav-number">22.3.</span> <span class="nav-text">å¼€å¯æ‰€æœ‰çš„æ—¥å¿—</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97%E6%B1%87%E7%BC%96%E7%9A%84%E8%A1%8C%E6%95%B0"><span class="nav-number">22.4.</span> <span class="nav-text">è®¡ç®—æ±‡ç¼–çš„è¡Œæ•°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%93%E5%8D%B0%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E6%88%96%E4%BF%AE%E6%94%B9%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="nav-number">22.5.</span> <span class="nav-text">æ‰“å°å‡½æ•°è¿”å›å€¼æˆ–ä¿®æ”¹è¿”å›å€¼</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9A%8F%E6%9C%BA%E6%95%B0%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%80%BC%E5%9B%BA%E5%AE%9A"><span class="nav-number">22.6.</span> <span class="nav-text">éšæœºæ•°å‡½æ•°è¿”å›å€¼å›ºå®š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96-Trace"><span class="nav-number">22.7.</span> <span class="nav-text">è·å– Trace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E6%B5%81"><span class="nav-number">22.8.</span> <span class="nav-text">è·å–å‡½æ•°è°ƒç”¨æµ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8%E5%86%85%E5%AD%98%E4%B8%AD%E6%90%9C%E7%B4%A2%E6%95%B0%E6%8D%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="nav-number">22.9.</span> <span class="nav-text">åœ¨å†…å­˜ä¸­æœç´¢æ•°æ®å‡ºç°çš„ä½ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#findCryptInTrace"><span class="nav-number">22.10.</span> <span class="nav-text">findCryptInTrace</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%8D%E5%88%B6unidng"><span class="nav-number">23.</span> <span class="nav-text">ååˆ¶unidng</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E3%80%81JNI%E4%BA%A4%E4%BA%92"><span class="nav-number">23.0.1.</span> <span class="nav-text">ä¸€ã€JNIäº¤äº’</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8"><span class="nav-number">23.0.2.</span> <span class="nav-text">äºŒã€ç³»ç»Ÿè°ƒç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E6%96%87%E4%BB%B6%E8%AE%BF%E9%97%AE"><span class="nav-number">23.0.3.</span> <span class="nav-text">ä¸‰ã€æ–‡ä»¶è®¿é—®</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%A3%80%E6%B5%8BUnidbg"><span class="nav-number">23.0.4.</span> <span class="nav-text">å››ã€æ£€æµ‹Unidbg</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E7%9B%AE%E6%A0%87%E5%87%BD%E6%95%B0%E6%97%A0%E6%B3%95%E8%A2%AB%E5%8D%95%E7%8B%AC%E6%89%A7%E8%A1%8C"><span class="nav-number">23.0.5.</span> <span class="nav-text">äº”ã€ç›®æ ‡å‡½æ•°æ— æ³•è¢«å•ç‹¬æ‰§è¡Œ</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%9C%A8%E7%9C%9F%E6%9C%BA%E4%B8%8A%E4%BD%BF%E7%94%A8GetStaticMethodID%E5%AF%BB%E6%89%BE%E4%B8%80%E4%B8%AA%E4%B8%8D%E5%AD%98%E5%9C%A8%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">23.0.6.</span> <span class="nav-text">å…­ã€åœ¨çœŸæœºä¸Šä½¿ç”¨GetStaticMethodIDå¯»æ‰¾ä¸€ä¸ªä¸å­˜åœ¨çš„æ–¹æ³•</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Unidbg%E6%8A%A5%E9%94%99"><span class="nav-number">24.</span> <span class="nav-text">UnidbgæŠ¥é”™</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Illegal-JNI-version"><span class="nav-number">24.1.</span> <span class="nav-text">Illegal JNI version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#app%E5%BC%80%E5%8F%91%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E5%A4%B1%E8%AF%AF%EF%BC%8C%E9%87%8A%E6%94%BE%E5%8F%98%E9%87%8F%E5%90%8E%E8%BF%98%E8%B0%83%E7%94%A8"><span class="nav-number">24.2.</span> <span class="nav-text">appå¼€å‘è¿‡ç¨‹ä¸­çš„å¤±è¯¯ï¼Œé‡Šæ”¾å˜é‡åè¿˜è°ƒç”¨</span></a></li></ol></li></ol>
    </div>
</div>

            </div>
        </div>
    
</main>



<!-- common -->
<script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/libs/anime.min.js"></script>

<!-- local-search -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/local-search.js"></script>


<!-- code-block -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/code-block.js"></script>


<!-- lazyload -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/lazyload.js"></script>


<div class="pjax">
    
        <!-- post-helper -->
        <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/post/post-helper.js"></script>

        <!-- toc -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/post/toc.js"></script>
        

        <!-- copyright-info -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/post/copyright-info.js"></script>
        

        <!-- share -->
        
            <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/post/share.js"></script>
        
    

    <!-- category-page -->
    

    <!-- links-page -->
    
</div>

<!-- pjax -->

    <script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.8.1/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax'
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            KEEP.utils.pjaxProgressBarStart()
        });

        document.addEventListener('pjax:complete', () => {
            KEEP.utils.pjaxProgressBarEnd()
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'))
            KEEP.initExecute()
        });
    });
</script>




    
        
    
        
            
<script class="custom-inject-js" src="/js/custom-1.js" data-pjax></script>

        
    

</body>
</html>
