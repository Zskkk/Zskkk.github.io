<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>HTTP TCP/IP协议与抓包原理</title>
    <url>/2021/06/01/HTTP-TCP-IP%E5%8D%8F%E8%AE%AE%E4%B8%8E%E6%8A%93%E5%8C%85%E5%8E%9F%E7%90%86/</url>
    <content><![CDATA[<h1 id="网络基础-TCP-x2F-IP"><a href="#网络基础-TCP-x2F-IP" class="headerlink" title="网络基础 TCP&#x2F;IP"></a>网络基础 TCP&#x2F;IP</h1><p>在说Http之前，先来说一下TCP&#x2F;IP协议。</p>
<p>TCP&#x2F;IP协议是众多协议的统称，像HTTP，TCP,UDP,DNS等都包括在里面</p>
<p>TCP&#x2F;IP 协议会把这些进行分层，按层次分为4层：应用层、传输层、网络层、数据链路层。</p>
<p>也有细分为7层的，<font color="red">应用层、表示层、会话层、传输层、网络层、数据链路层、物理层<br>像HTTP、FTP、DNS就属于应用层，TCP、UDP在传输层，IP在网络层</font> </p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/01.webp"
                     
                ></p>
<br>

<h1 id="TCP-x2F-IP通信传输流"><a href="#TCP-x2F-IP通信传输流" class="headerlink" title="TCP&#x2F;IP通信传输流"></a>TCP&#x2F;IP通信传输流</h1><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/02.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/03.webp"
                     
                ></p>
<font color="red">
以HTTP来举例，首先作为发送端的客户端在应用层以HTTP协议发出一个想看某个Web页面的HTTP请求。在应用层会经过DNS解析，通过域名查找IP地址

<p>接着，为了传输方便，在传输层用了TCP协议把从应用层处收到的数据HTTP请求的报文进行分割，并在各个报文上打上标记序号及端口号转发给网络层</p>
<p>在网络层IP协议，增加作为通信目的地的MAC地址后转发给链路层。</p>
<p>接收端的服务器在链路层接受数据，按序往上层发送，一直到应用层。在传输到传输层的时候，会把接收到的数据包按原来的顺序重组请求报文。当传输到应用层，才算真正接受到由客户端发送过来的HTTP请求。</p>
<p>作为接收端的服务器收到发送端的请求后，会把对应的页面以同样的TCP&#x2F;IP通信协议进行回传。</p>
<p>发送端在层与层之间传输数据时，每经过一层时会被打上该层所属的首部信息，反之，接受端在层与层传输数据时，每经过一层时会把对应的首部消去。<br></font></p>
<br>

<h1 id="TCP协议的可靠性（三次握手）"><a href="#TCP协议的可靠性（三次握手）" class="headerlink" title="TCP协议的可靠性（三次握手）"></a>TCP协议的可靠性（三次握手）</h1><p>TCP位于传输层，提供可靠的字节流服务。<br>所谓字节流服务指，为了方便传输，将大块数据分割成报文段为单位的数据包进行管理，可靠性指能够准确可靠的传输给对方。一言以蔽之，<font color="red">TCP协议为了更容易传输大数据才把数据分割，而且TCP协议能够确认数据最终是否送达对方。</font></p>
<p>确保数据能到达目标<br>为了准确无误的将数据送达目标处，TCP协议采用了三次握手策略。用TCP协议把数据包送出去后，TCP不会对传送后的情况置之不理，它一定会向对方确认是否成功送达，握手过程中使用了TCP的标志SYN和ACK。</p>
<font color="red">
发送端首先发送一个带SYN标志的数据包给对方。
接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息。
最后，发送端再回传一个带ACK标志的数据包，代表握手结束。
若在握手过程中某个阶段莫名中断，TCP协议会再次以相同的顺序发送相同的数据包。
</font>

<br>

<h1 id="为什么不是二次，四次握手，而是三次？"><a href="#为什么不是二次，四次握手，而是三次？" class="headerlink" title="为什么不是二次，四次握手，而是三次？"></a>为什么不是二次，四次握手，而是三次？</h1><h2 id="四次？"><a href="#四次？" class="headerlink" title="四次？"></a>四次？</h2><p>很显然1.2和1.3 这两个步骤可以合并，<strong>只需要三次握手</strong>，可以提高连接的速度与效率。</p>
<br>

<h2 id="二次？"><a href="#二次？" class="headerlink" title="二次？"></a>二次？</h2><p>现假定出现一种异常情况，即A发出的第一个请求连接报文段并没有丢失，而是<strong>在某些网络结点长时间滞留了</strong>，以至到连接释放以后的某个时间才到达B。本来这是一个已失效的报文段。但B收到此失效的连接请求报文段后，就<strong>误认为</strong>是A又发出一次新的连接请求。于是就向A发出确认报文段，同意建立连接。<strong>假定不采用三次握手，那么只要B发出确认，新的连接就建立了。</strong></p>
<p>由于现在A并没有发出建立请求的连接，因此<strong>不会理睬B的确认，也不会向B发送数据</strong>，但B却以为新的运输连接已经建立了，并<strong>一直等待A发来的数据。B的许多资源就这样白白浪费了。</strong></p>
<p>采用三次握手的办法可以防止上述现象发生。例如在刚才的情况下，A不会向B的确认发出确认。<strong>B由于收不到确认，就知道A并没有要求建立连接，所以就不会分配资源给这个连接</strong></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/04.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/05.webp"
                     
                ></p>
<br>

<h1 id="HTTP-是不保存状态的协议"><a href="#HTTP-是不保存状态的协议" class="headerlink" title="HTTP 是不保存状态的协议"></a>HTTP 是不保存状态的协议</h1><p>HTTP 是一种不保存状态，即无状态（stateless）协议。HTTP 协议自 身不对请求和响应之间的通信状态进行保存。也就是说在 HTTP 这个 级别，协议对于发送过的请求或响应都不做持久化处理。</p>
<p>虽然是无状态协议，但为了实现期望的保持状态功能，于是引入了Cookie 技术。有了 Cookie 再用 HTTP 协议通信，就可以管 理状态了。</p>
<br>

<h2 id="持久连接"><a href="#持久连接" class="headerlink" title="持久连接"></a>持久连接</h2><p>HTTP&#x2F;1.1 和一部分的HTTP&#x2F;1.0 想出了 持久连接（HTTP Persistent Connections，也称为 HTTP keep-alive 或 HTTP connection reuse）的方法。持久连接的特点是，只要任意一端 没有明确提出断开连接，则保持 TCP 连接状态。</p>
<p>持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额 外开销，减轻了服务器端的负载。另外，减少开销的那部分时间，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相 应提高了。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/06.webp"
                     
                ></p>
<p>持久连接的好处在于减少了 TCP 连接的重复建立和断开所造成的额 外开销，减轻了服务器端的负载。另外，减少开销的那部分时间，使 HTTP 请求和响应能够更早地结束，这样 Web 页面的显示速度也就相 应提高了。</p>
<br>

<h1 id="四次挥手："><a href="#四次挥手：" class="headerlink" title="四次挥手："></a>四次挥手：</h1><p><font color="red">TCP连接是双向传输的对等的模式，就是说双方都可以同时向对方发送或接收数据。当有一方要关闭连接时，会发送指令告知对方，我要关闭连接了。这时对方会回一个ACK，此时一个方向的连接关闭。但是另一个方向仍然可以继续传输数据，等到发送完了所有的数据后，会发送一个FIN段来关闭此方向上的连接。接收方发送ACK确认关闭连接。</font></p>
<br>

<h1 id="HTTP的缺点"><a href="#HTTP的缺点" class="headerlink" title="HTTP的缺点"></a>HTTP的缺点</h1><font color="red">
通信使用明文（不加密），内容可能会被窃听

<p>不验证通信方的身份，因此有可能遭遇伪装</p>
<p>无法证明报文的完整性，所以有可能已遭篡改<br></font></p>
<p>对于 HTTP 来说，服务器也好，客户端也好，都是没有办法确认通信方的。因为很有可能并不是和原本预想的通信方在实际通信。 并且还需要考虑到接收到的报文在通信途中已经遭到篡改这一可能性。</p>
<p>为了统一解决上述这些问题，<font color="red">需要在 HTTP 上再加入加密处理和认证 等机制。我们把添加了加密及认证机制的 HTTP 称为 HTTPS</font></p>
<h2 id="通信的加密"><a href="#通信的加密" class="headerlink" title="通信的加密"></a>通信的加密</h2><p>一种方式就是将通信加密。<font color="red">HTTP 协议中没有加密机制，但可以通过和 SSL（Secure Socket Layer，安全套接层）或 TLS（Transport Layer Security，安全层传输协议）的组合使用， 加密 HTTP 的通信内容。</font></p>
<p>用 SSL建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信了。与 <font color="red">SSL组合使用的HTTP 被称为 HTTPS</font>（HTTP Secure，超文本传输安全协议）。</p>
<br>

<h1 id="HTTP-加密-认证-完整性保护-x3D-HTTPS"><a href="#HTTP-加密-认证-完整性保护-x3D-HTTPS" class="headerlink" title="HTTP+ 加密 + 认证 + 完整性保护 &#x3D;HTTPS"></a>HTTP+ 加密 + 认证 + 完整性保护 &#x3D;HTTPS</h1><p><font color="red">可以说HTTPS 是身披 SSL 外壳的 HTTP</font></p>
<p>HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL和TLS协议代 替而已。</p>
<p>通常，<font color="red">HTTP 直接和 TCP 通信。当使用 SSL时，则演变成先和 SSL通信</font>，再由 SSL和 TCP 通信了。简言之，所谓HTTPS，其实就是身披 SSL协议这层外壳的 HTTP。</p>
<p><font color="red">在采用 SSL后，HTTP 就拥有了 HTTPS 的加密、证书和完整性保护 这些功能。</font><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/07.webp"
                     
                ></p>
<br>

<h2 id="SSL-x2F-TLS加密"><a href="#SSL-x2F-TLS加密" class="headerlink" title="SSL&#x2F;TLS加密"></a>SSL&#x2F;TLS加密</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/08.webp"
                     
                ><br><font color="red"><br>第一次访问采用非对称加解密（非对称指客户端和服务器都有自己的公钥和私钥）<br>客户端访问服务器，</p>
<p>服务器收到客户端访问返回服务器的公钥，</p>
<p>客户端收到服务器的公钥，用服务器的公钥对客户端的公钥进行加密发送给服务器，</p>
<p>服务器收到加密后的公钥，用服务器的私钥进行解密取得客户端的公钥，</p>
<p>将session key用客户端的公钥进行加密发送给客户端，</p>
<p>客户端用自己的私钥进行解密获取session key<br></font></p>
<br>

<p>后续通信使用对称加解密（对称加密指客户端和服务器使用同一套公钥私钥）<br>对session key加密后发送session key进行通信</p>
<p>非对称加解密只是用于session key安全的在两者之间进行传递，因为非对称加解密的开销很大。session key是有时效性的</p>
<br>

<h2 id="加入了抓包软件后SSL-x2F-TLS加密"><a href="#加入了抓包软件后SSL-x2F-TLS加密" class="headerlink" title="加入了抓包软件后SSL&#x2F;TLS加密"></a>加入了抓包软件后SSL&#x2F;TLS加密</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/09.webp"
                     
                ><br><font color="red"><br>Charles对客户端来说是服务器，对服务器来说是客户端</p>
<p>1.客户端去访问Charles，Charles去访问服务器</p>
<p>2.服务器会给Charles发送服务器的公钥，Charles会给客户端发送Charles的公钥</p>
<p>3.客户端用Charles的公钥对自己的公钥进行加密发送给Charles，Charles用服务器的公钥对自己的公钥进行加密发送给服务器</p>
<p>4.服务器用自己的私钥解开得到Charles的公钥，Charles用自己的私钥解开得到客户端的公钥</p>
<p>5.服务器得到Charles的公钥对session key加密发送给Charles，Charles用自己的私钥解开得到session key</p>
<p>6.Charles把session key用客户端的公钥对session key加密后发送给客户端，客户端用自己的私钥解开得到session key<br>到这里客户端，Charles，服务器的session key就统一了。<br></font></p>
<h2 id="Charles抓不到包"><a href="#Charles抓不到包" class="headerlink" title="Charles抓不到包"></a>Charles抓不到包</h2><p>打开Charles抓不到包，为什么导入Charles的证书之后，app抓包就正常了呢？<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/10.webp"
                     
                ></p>
<font color="red">
有了Charles置于中间之后，本来c/s架构的通信过程会“分裂”为两个独立的通信过程，app本来验证的是服务器的证书，服务器的证书手机的根证书是认可的，直接内置的；但是分裂成两个独立的通信过程之后，app验证的是Charles的证书，它的证书手机根证书并不认可，它并不是由手机内置的权威根证书签发机构签发的，所以手机不认，然后app也不认；所以我们要把Charles的证书导入到手机根证书目录中去，这样手机就会认可，如果app没有进行额外的校验（比如在代码中对该证书进行校验，也就是SSL pinning系列API)的话，app也会直接认可接受。

<br>

<p>在高版本的安卓上，用户安装的证书不会直接安装到系统根证书目录<br>中，需要root手机后将证书移动到系统根证书目录中去。<br></font></p>
<p> 当Charles的证书安装到系统根目录中去之后，系统就会信任来自Charles的流量包了，我们的抓包过程就会回归正常</p>
<p> 1.安装个人证书<br> 通过VPN连接到Charles，然后用浏览器访问chls.pro&#x2F;ssl，会自动弹出安装个人证书。</p>
<p> 个人证书安装在手机的 &#x2F;data&#x2F;misc&#x2F;user&#x2F;0&#x2F;cacerts-added 目录下</p>
<p> 2.复制个人证书到系统目录（安卓8以上需要）<br> <figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /data/misc/user/0/cacerts-added/ </span><br><span class="line">mount -o remount,rw /system</span><br><span class="line">mv * /etc/security/cacerts/ </span><br><span class="line">cd  /etc/security/cacerts/</span><br><span class="line">ls -alit </span><br><span class="line">mount -o remount,ro /system</span><br></pre></td></tr></table></figure></p>
<br>

<h2 id="SSL-Pinning（情况更少）"><a href="#SSL-Pinning（情况更少）" class="headerlink" title="SSL Pinning（情况更少）"></a>SSL Pinning（情况更少）</h2> <font color="red">
 就是客户端并不会默认信任系统根证书目录中的证书，而是在代码里再加一层校验，这就是证书绑定机制——SSL pinning，如果这段代码的校验过不了，那么客户端还是会报证书错误。
 </font>

 <br>

<h2 id="Https客户端代码校验服务器证书"><a href="#Https客户端代码校验服务器证书" class="headerlink" title="Https客户端代码校验服务器证书"></a>Https客户端代码校验服务器证书</h2><p> 案例：滴答清单</p>
<p>遇到这种情况的时候，有这两种方式，当然目标是一样的，都是hook住这段校验的代码，使这段判断的机制失效即可。</p>
<ol>
<li>hook住checkServerTrusted，将其所有重载都置空；</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_ssl</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ClassName</span> = <span class="string">&quot;com.android.org.conscrypt.Platform&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Platform</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">ClassName</span>);</span><br><span class="line">        <span class="keyword">var</span> targetMethod = <span class="string">&quot;checkServerTrusted&quot;</span>;</span><br><span class="line">        <span class="keyword">var</span> len = <span class="title class_">Platform</span>[targetMethod].<span class="property">overloads</span>.<span class="property">length</span>;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(len);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="title class_">Platform</span>[targetMethod].<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;class:&quot;</span>, <span class="title class_">ClassName</span>, <span class="string">&quot;target:&quot;</span>, targetMethod, <span class="string">&quot; i:&quot;</span>, i, <span class="variable language_">arguments</span>);</span><br><span class="line">                <span class="comment">//printStack(ClassName + &quot;.&quot; + targetMethod);</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<br>

<ol start="2">
<li>使用objection，直接将SSL pinning给disable掉  android sslpinning disable</li>
</ol>
<br>

<ol start="3">
<li>如果还有一些情况没有覆盖的话，可以来看看<br><a class="link"   href="https://github.com/WooyunDota/DroidSSLUnpinning" >https://github.com/WooyunDota/DroidSSLUnpinning<i class="fas fa-external-link-alt"></i></a></li>
</ol>
<ul>
<li><p>目录ObjectionUnpinningPlus增加了ObjectionUnpinning没覆盖到的锁定场景.(objection)</p>
<ul>
<li><p>使用方法1 attach : frida -U com.example.mennomorsink.webviewtest2 —no-pause -l hooks.js</p>
</li>
<li><p>使用方法2 spawn : python application.py com.example.mennomorsink.webviewtest2</p>
</li>
</ul>
</li>
<li><p>ObjectionUnpinningPlus hook list:</p>
<ul>
<li><p>SSLcontext(ART only)</p>
</li>
<li><p>okhttp</p>
</li>
<li><p>webview</p>
</li>
<li><p>XUtils(ART only)</p>
</li>
<li><p>httpclientandroidlib</p>
</li>
<li><p>JSSE</p>
</li>
<li><p>network_security_config (android 7.0+)</p>
</li>
<li><p>Apache Http client (support partly)</p>
</li>
<li><p>OpenSSLSocketImpl</p>
</li>
<li><p>TrustKit</p>
</li>
</ul>
</li>
</ul>
<p>应该可以覆盖到目前已知的所有种类的证书绑定了。</p>
<br>

<h2 id="服务器校验客户端证书（情况少）"><a href="#服务器校验客户端证书（情况少）" class="headerlink" title="服务器校验客户端证书（情况少）"></a>服务器校验客户端证书（情况少）</h2> <font color="red">
既然app客户端会校验服务器证书，那么服务器可不可能校验app客户端证书呢？答案是肯定的。

<p>单一通信已经分裂成两个互相独立的通信，这时候与服务器进行通信的已经不是app、而是Charles了，所以我们要将app中内置的证书导入到Charles中去。</p>
<p>这个操作通常需要完成两项内容：</p>
<ol>
<li>找到证书文件</li>
<li>找到证书密码</li>
</ol>
</font>

<br>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_KeyStore_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">StringClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">KeyStore</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore&quot;</span>);</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.KeyStore$LoadStoreParameter&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0</span>) &#123;</span><br><span class="line">            <span class="comment">//printStack(&quot;KeyStore.load1&quot;);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load1:&quot;</span>, arg0);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.io.InputStream&#x27;</span>, <span class="string">&#x27;[C&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0, arg1</span>) &#123;</span><br><span class="line">            <span class="comment">//printStack(&quot;KeyStore.load2&quot;);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load2:&quot;</span>, arg0, arg1 ? <span class="title class_">StringClass</span>.$new(arg1) : <span class="literal">null</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0, arg1);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook_KeyStore_load...&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(hook_KeyStore_load)</span><br></pre></td></tr></table></figure>
 <font color="red">
找到证书文件很简单，一般apk进行解包，直接过滤搜索后缀名为p12的文件即可，一般常用的命令为 tree -NCfhl |grep -i p12，直接打印出p12文件的路径

<p>想要拿到密码也很简单，一般解密会调用现成的API，java.security.KeyStore ，直接使用frida打印出来，也可以hook系统文件库</p>
</font>

<br>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">objection -g cn.soulapp.android explore</span><br><span class="line">//android hooking watch class_method java.io.File.$init - -dump-args --dump-backtrace --dump-return</span><br><span class="line">android hooking watch class_method java.io.File.$init - -dump-args</span><br></pre></td></tr></table></figure>

<p>有了证书和密码之后，就可以将其导入到抓包软件中</p>
<br>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210601/11.webp"
                     
                ></p>
<font color="red">
一般HTTPS：大部分只采用客户端检验服务器

<p>双向绑定：很少会有服务器校验客户端</p>
</font>

<p>SSL cert Pinning：更少（案例：趣充）</p>
<br>

<h2 id="推荐使用Postern-Charles组合进行抓包"><a href="#推荐使用Postern-Charles组合进行抓包" class="headerlink" title="推荐使用Postern+Charles组合进行抓包"></a>推荐使用Postern+Charles组合进行抓包</h2><p>我们平时用代理的时候，都是通过给wifi设置http代理的方式进行抓包，只是在应用层抓包，所以会被很轻易的检测到和绕过的。</p>
<p> 很多应用会通过</p>
<p>System.getProperty(“http.proxyHost”)</p>
<p>System.getProperty(“http.proxyPort”);</p>
<p>这两个API来查看当前系统是否挂了http代理，会很轻松的让你的抓包失效。</p>
<p>这时候只能用Frida或Xposed来hook这个接口、修改其返回值</p>
<br>
所以我们需要换一种方式来设置代理。就是设置vpn代理，vpn是属于网络层的，设置了vpn后，你的手机上ifconfig后会多一个tun0的接口，等于加了一个虚拟网卡，所有的流量都会从这走。应用层和传输层的请求都可以拿到，还不会被上面提及的两个api所检测。

<br>

<p>输入ip route show table 0 |grep defalut查看路由表</p>
<p>路由表的第一条就指向了tun0，可以说开vpn的效果就和直连的效果一摸一样。</p>
]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>对称加密算法AES的原理及分析</title>
    <url>/2022/12/27/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95AES%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/000.webp"></p>
<h2 id="AES算法简述"><a href="#AES算法简述" class="headerlink" title="AES算法简述"></a>AES算法简述</h2><p><strong>分组加密有几种方式分别是：</strong><br></p>
<p>ECB：是一种基础的加密方式，密文被分割成分组长度相等的块（不足补齐），然后单独一个个加密，一个个输出组成密文。<font color="red">将整个明文分成若干段相同的小段，然后对每一小段进行加密</font><br>00112233445566778899aabbccddee 还差2位hex（1个字节），填充01：00112233445566778899aabbccddee01<br>00112233445566778899aabbccddeeff 等于128比特，需要填充一整个分组：00112233445566778899aabbccddeeff(hex)==&gt; 00112233445566778899aabbccddeeff10101010101010101010101010101010<br>最少填充一字节，最多填充一整个分组，不能不填充。<br></p>
<p>CBC：是一种循环模式，前一个分组的密文和当前分组的明文异或操作后再加密，这样做的目的是增强破解难度。<font color="red">先将明文切分成若干小段，然后每一小段与初始块或者上一段的密文段进行异或运算后，再与密钥进行加密</font><br></p>
<p>CFB/OFB实际上是一种反馈模式，目的也是增强破解的难度。<font color="red">密码算法的输出（指密码key而不是密文）会反馈到密码算法的输入中，OFB模式并不是通过密码算法对明文直接加密，而是通过将明文分组和密码算法的输出进行XOR来产生密文分组。</font><br></p>
<p>ECB和CBC的加密结果是不一样的，两者的模式不同，而且CBC会在第一个密码块运算时加入一个初始化向量。</p>
<br>
AES-128接收16字节的明文输入，16字节的密钥，输出16字节的密文结果。<br>

<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/01.webp"></p>
<p>入参：<br>明文：128比特（32个十六进制数、16个字节）<br>KEY：128比特（32十六进制数、16个字节）<br>出参：128比特（32个十六进制数、16个字节）</p>
<p>明文：7a68656e677368616f6b756e79796473（hex）<br>密钥：0123456789abcdef0123456789abcdef（hex）</p>
<p>下方是整体流程图：<br><br><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/02.webp"></p>
<p>首先看整体的流程图，我们发现，AES的整体图景可以分成左右两块，即明文的处理和密钥的编排。明文的处理主体是一个初始化轮密钥加和十轮运算，在初始化轮密钥加十轮运算中都需要使用密钥编排的结果。密钥编排将16个字节经过运算推演出11组轮密钥，每一组16个字节，称之为K0,K1,K2…K10<br><br></p>
<h2 id="密钥编排"><a href="#密钥编排" class="headerlink" title="密钥编排"></a>密钥编排</h2><p>下面我们看一下密钥扩展是如何算出来的，这是我们的密钥Key <strong>0123456789abcdef0123456789abcdef</strong>。为了区分密钥和密钥编排后的轮密钥，我们将此时的密钥叫主密钥。</p>
<p>在AES-128中，密钥扩展后得16*11共176字节，使用时<strong>逐十六个字节</strong>划分成K0,K1,…K10使用，但是在生成时，它是<strong>逐四个字节</strong>生成的，即44*4。我们不妨用数组来描述它，即一个包含了44个元素的数组,叫W。</p>
<p>这四十四个元素的生成规则有三种，如下图所示：</p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/03.webp"></p>
<p>不同颜色代表了不同规则。最上方的W0,W1,W2,W3 就是主密钥本身切成四段。<br>Key = 0123456789abcdef0123456789abcdef<br>W0 = 01234567<br>W1 = 89abcdef<br>W2 = 01234567<br>W3 = 89abcdef</p>
<p>左侧的红色部分，W4,W8,W12,….W40的生成复杂一点。<br>Wn=g(Wn−1) xor Wn−4<br>xor 是异或运算，比如 W4=g(W3) xor W0。g(当前元素前面那个元素) 异或 当前元素头顶上那个元素。</p>
<p><strong><font color="red">那么关键点就是这个 g 函数了， g 函数一共三个步骤——循环左移、S盒替换、字节异或。</font></strong> 我们以W4运算中所需的W3为例。<br>W3=89abcdef</p>
<h3 id="g函数——循环左移、S盒替换、字节异或"><a href="#g函数——循环左移、S盒替换、字节异或" class="headerlink" title="g函数——循环左移、S盒替换、字节异或"></a>g函数——循环左移、S盒替换、字节异或</h3><h4 id="循环左移"><a href="#循环左移" class="headerlink" title="循环左移"></a>循环左移</h4><p>首先是循环左移，规则固定—— <strong><font color="red">将最左边的一个字节挪到右边即可</font></strong> <br></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/04.webp"></p>
<p><br>循环左移后为 <strong>abcdef89</strong></p>
<h4 id="S盒替换"><a href="#S盒替换" class="headerlink" title="S盒替换"></a>S盒替换</h4><p>第二步是S盒替换，S盒替换听着很高级，但操作上很简单——将数值本身作为索引取出S数组中对用的值。S盒是固定的。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SBox = [</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">num = <span class="number">0xab</span></span><br><span class="line">result = SBox[num]</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(result))</span><br><span class="line"><span class="comment"># 0x62</span></span><br></pre></td></tr></table></figure>

<p>S盒的背后有十分复杂的知识，但好在我们并不需要去了解。<br><br><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/05.webp"></p>
<p><br><strong>AB CD EF 89</strong> 经过S盒替换后为 <strong>62 BD DF A7</strong></p>
<h4 id="最高字节和一个固定常量异或"><a href="#最高字节和一个固定常量异或" class="headerlink" title="最高字节和一个固定常量异或"></a>最高字节和一个固定常量异或</h4><p>最后一个步骤更简单，将上一步结果中的最高字节和一个固定常量异或。W4的生成是第一个，用如下rcon表的第一个元素0x1。W40即第十次，用最后一个元素0x36.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rcon = [<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]</span><br><span class="line"><span class="comment">#        W4    W8    W12   W16   W20   W24   W28   W32   W36   W40</span></span><br></pre></td></tr></table></figure>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/06.webp"></p>
<p><br><strong>62 BD DF A7 <strong>最高位62与rcon第一个元素，即0x01异或后为：</strong>63 BD DF A7</strong> <br>W4 = g(W3) xor W0<br>   = g(0x89abcdef) xor 0x01234567<br>   = 0x63BDDFA7 xor 0x01234567<br>   = 0x629e9ac0<br>最后一步可以直接用python算: </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="number">0x63BDDFA7</span> ^ <span class="number">0x01234567</span>))</span><br></pre></td></tr></table></figure>
<p>上图中蓝色和红色的部分都讲完了，那么橙色部分呢？相当的简单，和红色部分类似，去掉g函数即可<br><em><strong>Wn=Wn−1 xor Wn−4</strong></em><br>打个比方，<em>W5 = W4 ^ W1</em> = 0x629e9ac0 ^ 0x89abcdef = 0xeb35572f<br> <br>如下是完整的密钥编排部分的Python代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Sbox = (</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Rcon = (<span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text2matrix</span>(<span class="params">text</span>):</span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        byte = (text &gt;&gt; (<span class="number">8</span> * (<span class="number">15</span> - i))) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            matrix.append([byte])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            matrix[i // <span class="number">4</span>].append(byte)</span><br><span class="line">    <span class="keyword">return</span> matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shiftRound</span>(<span class="params">array, num</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param array: 需要循环左移的数组</span></span><br><span class="line"><span class="string">    :param num: 循环左移的位数</span></span><br><span class="line"><span class="string">    :return: 使用Python切片，返回循环左移num个单位的array</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> array[num:] + array[:num]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">array, index</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    g 函数</span></span><br><span class="line"><span class="string">    :param array: 待处理的四字节数组</span></span><br><span class="line"><span class="string">    :index:从1-10，每次使用Rcon中不同的数</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># 首先循环左移1位</span></span><br><span class="line">    array = shiftRound(array, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 字节替换</span></span><br><span class="line">    array = [Sbox[i] <span class="keyword">for</span> i <span class="keyword">in</span> array]</span><br><span class="line">    <span class="comment"># 首字节和rcon中对应元素异或</span></span><br><span class="line">    array = [(Rcon[index] ^ array[<span class="number">0</span>])] + array[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">return</span> array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorTwoArray</span>(<span class="params">array1, array2</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    返回两个数组逐元素异或的新数组</span></span><br><span class="line"><span class="string">    :param array1: 一个array</span></span><br><span class="line"><span class="string">    :param array2: 另一个array</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(array1) == <span class="built_in">len</span>(array2)</span><br><span class="line">    <span class="keyword">return</span> [array1[i] ^ array2[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array1))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showRoundKeys</span>(<span class="params">kList</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(kList)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"K%02d:"</span> %i +<span class="string">""</span>.join(<span class="string">"%02x"</span> % k <span class="keyword">for</span> k <span class="keyword">in</span> kList[i]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keyExpand</span>(<span class="params">key</span>):</span><br><span class="line">    master_key = text2matrix(key)</span><br><span class="line">    round_keys = [[<span class="number">0</span>] * <span class="number">4</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>)]</span><br><span class="line">    <span class="comment"># 规则一(图中红色部分)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        round_keys[i] = master_key[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">4</span> * <span class="number">11</span>):</span><br><span class="line">        <span class="comment"># 规则二(图中红色部分)</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            round_keys[i] = xorTwoArray(g(round_keys[i - <span class="number">1</span>], i // <span class="number">4</span>), round_keys[i - <span class="number">4</span>])</span><br><span class="line">        <span class="comment"># 规则三(图中橙色部分)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            round_keys[i] = xorTwoArray(round_keys[i - <span class="number">1</span>], round_keys[i - <span class="number">4</span>])</span><br><span class="line">    <span class="comment"># 将轮密钥从44*4转成11*16,方便后面在明文的运算里使用</span></span><br><span class="line">    kList = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(round_keys)):</span><br><span class="line">        kList[i//<span class="number">4</span>] += round_keys[i]</span><br><span class="line"></span><br><span class="line">    showRoundKeys(kList)</span><br><span class="line">    <span class="keyword">return</span> kList</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_bytes = <span class="number">0x00112233445566778899aabbccddeeff</span></span><br><span class="line">key = <span class="number">0x2b7e151628aed2a6abf7158809cf4f3c</span></span><br><span class="line">kList = keyExpand(key)</span><br></pre></td></tr></table></figure>
<p>运行结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">K00:0123456789abcdef0123456789abcdef</span><br><span class="line">K01:629e9ac0eb35572fea16124863bddfa7</span><br><span class="line">K02:1a00c63bf13591141b23835c789e5cfb</span><br><span class="line">K03:154ac987e47f5893ff5cdbcf87c28734</span><br><span class="line">K04:385dd190dc228903237e52cca4bcd5f8</span><br><span class="line">K05:4d5e90d9917c19dab2024b1616be9eee</span><br><span class="line">K06:c355b89e5229a144e02bea52f69574bc</span><br><span class="line">K07:a9c7dddcfbee7c981bc596caed50e276</span><br><span class="line">K08:7a5fe58981b199119a740fdb7724edad</span><br><span class="line">K09:570a707cd6bbe96d4ccfe6b63beb0b1b</span><br><span class="line">K10:8821df9e5e9a36f31255d04529bedb5e</span><br></pre></td></tr></table></figure>
<p>我们对AES密钥编排部分的学习就基本完成了。</p>
<h2 id="明文运算"><a href="#明文运算" class="headerlink" title="明文运算"></a>明文运算</h2><p>现在开始学习明文的运算，即图中左边的部分。首先，我们要调整明文的格式，在AES中，数据以state的形式计算、中间存储和传输，中文名即<strong>状态</strong>。<br>从明文转到state形式很简单，以我们的明文<strong>7a68656e677368616f6b756e79796473</strong>为例。从上到下，从左到右。千万不要颠倒顺序，第一行不是“7a 68 65 6e”。除此之外，<strong>state中的数，我们一般用十六进制表示，且不加0x前缀，这样看着比较舒服。除非特意强调是十进制，否则下文均为十六进制。</strong><br></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/07.webp"></p>
<p><br>接下来是轮密钥加步骤，因为是第一次轮密钥加步骤，所以也叫初始轮密钥加。轮密钥加步骤听着很怪，但实质很简单。只需要将对应的轮密钥和 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="4.946ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 2186 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(830,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1720,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg></mjx-container>  一样从上到下，从左到右排列。两个矩阵逐字节异或，这就是轮密钥加步骤。为什么要叫轮密钥加而不是轮密钥异或？我们卖个关子，后面再说。<br>初始的轮密钥加使用 K0 ，0123456789abcdef0123456789abcdef。<br></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/08.webp"></p>
<p><br>接下来就是十轮主运算，看如下的伪代码，我们可以清楚看到一轮运算中有什么，以及第十轮和前九轮有什么区别。<br></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/09.webp"></p>
<p><br>初始的明文转<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="4.946ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 2186 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(830,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1720,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg></mjx-container>和最后的<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="4.946ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 2186 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(830,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1720,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg></mjx-container>转明文自不必说，然后是初始轮密钥，使用 K0 。<br>前九轮运算中，包含四个步骤： <strong><font color="red">字节替换，循环左移，列混淆，轮密钥加。</font></strong> <br>第十轮中，包含三个步骤：字节替换，循环左移，轮密钥加。相比前九轮缺一个列混淆，其余相同。<br>十轮运算中的轮密钥加，和初始轮密钥加相比，除了使用的轮密钥不同外，并无不同，分别为K1…..K10。<br>而 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="9.482ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 4191 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(645,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1217,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1646,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2405,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2895,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3256,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(3722,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container> <strong>字节替换步骤，和密钥编排中的S盒替换完全一致。</strong><br> <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="9.482ex" height="2.059ex" role="img" focusable="false" viewBox="0 -705 4191 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(645,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(1217,0)"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mi" transform="translate(1646,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mi" transform="translate(2405,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(2895,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(3256,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(3722,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container> 即循环左移，和密钥编排中的循环左移类似，但有差异。密钥编排中， g 函数中也需循环左移，但其中待处理的数据仅有一行，而明文编排中 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="4.946ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 2186 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(830,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1720,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg></mjx-container> 是四行。<br>其循环左移规则如下：<strong>第一行不循环左移，第二行循环左移1字节，第三行循环左移2字节，第四行循环左移3字节。</strong></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221227/10.webp"></p>
<p><br>相对复杂的是列混淆步骤，列混淆步骤涉及两块知识，1是矩阵乘法，2是伽罗瓦域的加法和乘法。前者还好，后者属于抽象代数的内容，比较复杂。<br>先看第一块——矩阵乘法。首先演示简单的矩阵相乘，<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.149ex;" xmlns="http://www.w3.org/2000/svg" width="29.02ex" height="5.43ex" role="img" focusable="false" viewBox="0 -1450 12827 2400"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2750,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g><g data-mml-node="mo" transform="translate(3722.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mrow" transform="translate(4444.4,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2750,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g><g data-mml-node="mo" transform="translate(8222.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(9278,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g></g><g data-mml-node="mtd" transform="translate(1574.5,0)"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(48,0)"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g></g><g data-mml-node="mtd" transform="translate(1529,0)"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2799,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g></g></g></svg></mjx-container><br>左边准备相乘的两个矩阵，我们称它俩为矩阵A和矩阵B，如何求结果矩阵中的abcd ？规则如下：第m行第n列的值等于<strong>矩阵</strong>A的第m行的元素与<strong>矩阵</strong>B的第n列对应元素乘积之和。<br>a是第一行第一列，那么就是A的第一行和B的第一列元素<strong>乘积之和</strong><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.058ex" height="1.715ex" role="img" focusable="false" viewBox="0 -676 9307.4 758"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mo" transform="translate(806.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1862.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2584.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3307,0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g><g data-mml-node="mo" transform="translate(4029.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(5029.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(5751.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(6473.9,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(7251.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(8307.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br>同理可得<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="20.831ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 9207.4 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44F" d="M73 647Q73 657 77 670T89 683Q90 683 161 688T234 694Q246 694 246 685T212 542Q204 508 195 472T180 418L176 399Q176 396 182 402Q231 442 283 442Q345 442 383 396T422 280Q422 169 343 79T173 -11Q123 -11 82 27T40 150V159Q40 180 48 217T97 414Q147 611 147 623T109 637Q104 637 101 637H96Q86 637 83 637T76 640T73 647ZM336 325V331Q336 405 275 405Q258 405 240 397T207 376T181 352T163 330L157 322L136 236Q114 150 114 114Q114 66 138 42Q154 26 178 26Q211 26 245 58Q270 81 285 114T318 219Q336 291 336 325Z"></path></g><g data-mml-node="mo" transform="translate(706.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1762.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2484.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3207,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(3929.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4929.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(5651.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(6373.9,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(7151.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(8207.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="20.84ex" height="1.717ex" role="img" focusable="false" viewBox="0 -677 9211.4 759"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D450" d="M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"></path></g><g data-mml-node="mo" transform="translate(710.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1766.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(2488.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3211,0)"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g><g data-mml-node="mo" transform="translate(3933.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4933.4,0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mo" transform="translate(5655.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(6377.9,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(7155.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(8211.4,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.037ex" height="1.756ex" role="img" focusable="false" viewBox="0 -694 9298.4 776"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mo" transform="translate(797.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(1853.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(2575.8,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(3298,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mo" transform="translate(4020.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(5020.4,0)"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g><g data-mml-node="mo" transform="translate(5742.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(6464.9,0)"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g><g data-mml-node="mo" transform="translate(7242.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(8298.4,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br>即<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -2.149ex;" xmlns="http://www.w3.org/2000/svg" width="31.172ex" height="5.43ex" role="img" focusable="false" viewBox="0 -1450 13778 2400"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2750,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g><g data-mml-node="mo" transform="translate(3722.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mrow" transform="translate(4444.4,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(2750,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g><g data-mml-node="mo" transform="translate(8222.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mrow" transform="translate(9278,0)"><g data-mml-node="mo" transform="translate(0 -0.5)"><path data-c="7B" d="M618 -943L612 -949H582L568 -943Q472 -903 411 -841T332 -703Q327 -682 327 -653T325 -350Q324 -28 323 -18Q317 24 301 61T264 124T221 171T179 205T147 225T132 234Q130 238 130 250Q130 255 130 258T131 264T132 267T134 269T139 272T144 275Q207 308 256 367Q310 436 323 519Q324 529 325 851Q326 1124 326 1154T332 1205Q369 1358 566 1443L582 1450H612L618 1444V1429Q618 1413 616 1411L608 1406Q599 1402 585 1393T552 1372T515 1343T479 1305T449 1257T429 1200Q425 1180 425 1152T423 851Q422 579 422 549T416 498Q407 459 388 424T346 364T297 318T250 284T214 264T197 254L188 251L205 242Q290 200 345 138T416 3Q421 -18 421 -48T423 -349Q423 -397 423 -472Q424 -677 428 -694Q429 -697 429 -699Q434 -722 443 -743T465 -782T491 -816T519 -845T548 -868T574 -886T595 -899T610 -908L616 -910Q618 -912 618 -928V-943Z"></path></g><g data-mml-node="mtable" transform="translate(750,0)"><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g><g data-mml-node="mtd" transform="translate(2000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path></g></g><g data-mml-node="mtd" transform="translate(2000,0)"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></g><g data-mml-node="mo" transform="translate(3750,0) translate(0 -0.5)"><path data-c="7D" d="M131 1414T131 1429T133 1447T148 1450H153H167L182 1444Q276 1404 336 1343T415 1207Q421 1184 421 1154T423 851L424 531L426 517Q434 462 460 415T518 339T571 296T608 274Q615 270 616 267T618 251Q618 241 618 238T615 232T608 227Q542 194 491 132T426 -15L424 -29L423 -350Q422 -622 422 -652T415 -706Q397 -780 337 -841T182 -943L167 -949H153Q137 -949 134 -946T131 -928Q131 -914 132 -911T144 -904Q146 -903 148 -902Q299 -820 323 -680Q324 -663 325 -349T327 -19Q355 145 541 241L561 250L541 260Q356 355 327 520Q326 537 325 850T323 1181Q315 1227 293 1267T244 1332T193 1374T151 1401T132 1413Q131 1414 131 1429Z"></path></g></g></g></g></svg></mjx-container><br><br> </p>
<p>所谓乘积之和，指乘法和加法。<br>再来看AES列混淆中的矩阵乘法，我们的 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="4.946ex" height="1.441ex" role="img" focusable="false" viewBox="0 -626 2186 637"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g><g data-mml-node="mi" transform="translate(469,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(830,0)"><path data-c="1D44E" d="M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"></path></g><g data-mml-node="mi" transform="translate(1359,0)"><path data-c="1D461" d="M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"></path></g><g data-mml-node="mi" transform="translate(1720,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g></g></g></svg></mjx-container> ，<strong>左边乘如下所示固定矩阵</strong><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.317ex;" xmlns="http://www.w3.org/2000/svg" width="36.553ex" height="11.765ex" role="img" focusable="false" viewBox="0 -2850 16156.4 5200"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z" transform="translate(0,1951)"></path><path data-c="23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z" transform="translate(0,-1451)"></path><path data-c="23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g><g data-mml-node="mtable" transform="translate(889,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g></g><g data-mml-node="mtd" transform="translate(1500,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(3000,0)"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><g data-mml-node="mtd" transform="translate(4500,0)"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(5889,0)"><path data-c="23AB" d="M170 875Q170 892 172 895T189 899H194H211L222 893Q345 826 420 715T503 476Q504 467 504 230Q504 51 504 21T499 -9H498Q496 -10 444 -10Q402 -10 394 -9T385 -4Q384 -2 384 240V311V366Q384 469 380 513T358 609Q342 657 319 698T271 767T227 812T189 843T171 856T170 875Z" transform="translate(0,1951)"></path><path data-c="23AD" d="M384 -239V-57Q384 4 389 9Q391 10 455 10Q496 10 498 9Q501 8 502 5Q504 -5 504 -230Q504 -261 504 -311T505 -381Q505 -486 492 -551T435 -691Q357 -820 222 -893L211 -899H195Q176 -899 173 -896T170 -874Q170 -858 171 -855T184 -846Q262 -793 312 -709T378 -525Q378 -524 379 -522Q383 -493 384 -351Q384 -345 384 -334Q384 -276 384 -239Z" transform="translate(0,-1451)"></path><path data-c="23AC" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 925V782Q504 676 511 616T546 490Q563 446 587 408T633 345T674 304T705 278T717 268Q718 267 718 250T717 232Q717 231 697 216T648 169T588 93T534 -24T505 -179Q504 -191 504 -425Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -424Q384 -191 385 -182Q394 -49 463 61T645 241L659 250L645 259Q539 325 467 434T385 682Q384 692 384 873Q384 1153 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g></g><g data-mml-node="mo" transform="translate(7000.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mrow" transform="translate(7722.4,0)"><g data-mml-node="mo"><path data-c="23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z" transform="translate(0,1951)"></path><path data-c="23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z" transform="translate(0,-1451)"></path><path data-c="23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g><g data-mml-node="mtable" transform="translate(889,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd" transform="translate(39,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g></g><g data-mml-node="mtd" transform="translate(1890,0)"><g data-mml-node="mi"><path data-c="1D438" d="M492 213Q472 213 472 226Q472 230 477 250T482 285Q482 316 461 323T364 330H312Q311 328 277 192T243 52Q243 48 254 48T334 46Q428 46 458 48T518 61Q567 77 599 117T670 248Q680 270 683 272Q690 274 698 274Q718 274 718 261Q613 7 608 2Q605 0 322 0H133Q31 0 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H757Q764 676 764 669Q764 664 751 557T737 447Q735 440 717 440H705Q698 445 698 453L701 476Q704 500 704 528Q704 558 697 578T678 609T643 625T596 632T532 634H485Q397 633 392 631Q388 629 386 622Q385 619 355 499T324 377Q347 376 372 376H398Q464 376 489 391T534 472Q538 488 540 490T557 493Q562 493 565 493T570 492T572 491T574 487T577 483L544 351Q511 218 508 216Q505 213 492 213Z"></path></g></g><g data-mml-node="mtd" transform="translate(3908.5,0)"><g data-mml-node="mi"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"></path></g></g><g data-mml-node="mtd" transform="translate(5605,0)"><g data-mml-node="mi"><path data-c="1D440" d="M289 629Q289 635 232 637Q208 637 201 638T194 648Q194 649 196 659Q197 662 198 666T199 671T201 676T203 679T207 681T212 683T220 683T232 684Q238 684 262 684T307 683Q386 683 398 683T414 678Q415 674 451 396L487 117L510 154Q534 190 574 254T662 394Q837 673 839 675Q840 676 842 678T846 681L852 683H948Q965 683 988 683T1017 684Q1051 684 1051 673Q1051 668 1048 656T1045 643Q1041 637 1008 637Q968 636 957 634T939 623Q936 618 867 340T797 59Q797 55 798 54T805 50T822 48T855 46H886Q892 37 892 35Q892 19 885 5Q880 0 869 0Q864 0 828 1T736 2Q675 2 644 2T609 1Q592 1 592 11Q592 13 594 25Q598 41 602 43T625 46Q652 46 685 49Q699 52 704 61Q706 65 742 207T813 490T848 631L654 322Q458 10 453 5Q451 4 449 3Q444 0 433 0Q418 0 415 7Q413 11 374 317L335 624L267 354Q200 88 200 79Q206 46 272 46H282Q288 41 289 37T286 19Q282 3 278 1Q274 0 267 0Q265 0 255 0T221 1T157 2Q127 2 95 1T58 0Q43 0 39 2T35 11Q35 13 38 25T43 40Q45 46 65 46Q135 46 154 86Q158 92 223 354T289 629Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd" transform="translate(34.5,0)"><g data-mml-node="mi"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g><g data-mml-node="mtd" transform="translate(1897.5,0)"><g data-mml-node="mi"><path data-c="1D439" d="M48 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q146 66 215 342T285 622Q285 629 281 629Q273 632 228 634H197Q191 640 191 642T193 659Q197 676 203 680H742Q749 676 749 669Q749 664 736 557T722 447Q720 440 702 440H690Q683 445 683 453Q683 454 686 477T689 530Q689 560 682 579T663 610T626 626T575 633T503 634H480Q398 633 393 631Q388 629 386 623Q385 622 352 492L320 363H375Q378 363 398 363T426 364T448 367T472 374T489 386Q502 398 511 419T524 457T529 475Q532 480 548 480H560Q567 475 567 470Q567 467 536 339T502 207Q500 200 482 200H470Q463 206 463 212Q463 215 468 234T473 274Q473 303 453 310T364 317H309L277 190Q245 66 245 60Q245 46 334 46H359Q365 40 365 39T363 19Q359 6 353 0H336Q295 2 185 2Q120 2 86 2T48 1Z"></path></g></g><g data-mml-node="mtd" transform="translate(3844,0)"><g data-mml-node="mi"><path data-c="1D43D" d="M447 625Q447 637 354 637H329Q323 642 323 645T325 664Q329 677 335 683H352Q393 681 498 681Q541 681 568 681T605 682T619 682Q633 682 633 672Q633 670 630 658Q626 642 623 640T604 637Q552 637 545 623Q541 610 483 376Q420 128 419 127Q397 64 333 21T195 -22Q137 -22 97 8T57 88Q57 130 80 152T132 174Q177 174 182 130Q182 98 164 80T123 56Q115 54 115 53T122 44Q148 15 197 15Q235 15 271 47T324 130Q328 142 387 380T447 625Z"></path></g></g><g data-mml-node="mtd" transform="translate(5686.5,0)"><g data-mml-node="mi"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(34,0)"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g></g><g data-mml-node="mtd" transform="translate(1879,0)"><g data-mml-node="mi"><path data-c="1D43A" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g></g><g data-mml-node="mtd" transform="translate(3716,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g></g><g data-mml-node="mtd" transform="translate(5749,0)"><g data-mml-node="mi"><path data-c="1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g></g><g data-mml-node="mtd" transform="translate(1828,0)"><g data-mml-node="mi"><path data-c="1D43B" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 219 683Q260 681 355 681Q389 681 418 681T463 682T483 682Q499 682 499 672Q499 670 497 658Q492 641 487 638H485Q483 638 480 638T473 638T464 637T455 637Q416 636 405 634T387 623Q384 619 355 500Q348 474 340 442T328 395L324 380Q324 378 469 378H614L615 381Q615 384 646 504Q674 619 674 627T617 637Q594 637 587 639T580 648Q580 650 582 660Q586 677 588 679T604 682Q609 682 646 681T740 680Q802 680 835 681T871 682Q888 682 888 672Q888 645 876 638H874Q872 638 869 638T862 638T853 637T844 637Q805 636 794 634T776 623Q773 618 704 340T634 58Q634 51 638 51Q646 48 692 46H723Q729 38 729 37T726 19Q722 6 716 0H701Q664 2 567 2Q533 2 504 2T458 2T437 1Q420 1 420 10Q420 15 423 24Q428 43 433 45Q437 46 448 46H454Q481 46 514 49Q520 50 522 50T528 55T534 64T540 82T547 110T558 153Q565 181 569 198Q602 330 602 331T457 332H312L279 197Q245 63 245 58Q245 51 253 49T303 46H334Q340 38 340 37T337 19Q333 6 327 0H312Q275 2 178 2Q144 2 115 2T69 2T48 1Q31 1 31 10Q31 12 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g><g data-mml-node="mtd" transform="translate(3820,0)"><g data-mml-node="mi"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"></path></g></g><g data-mml-node="mtd" transform="translate(5755,0)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(7545,0)"><path data-c="23AB" d="M170 875Q170 892 172 895T189 899H194H211L222 893Q345 826 420 715T503 476Q504 467 504 230Q504 51 504 21T499 -9H498Q496 -10 444 -10Q402 -10 394 -9T385 -4Q384 -2 384 240V311V366Q384 469 380 513T358 609Q342 657 319 698T271 767T227 812T189 843T171 856T170 875Z" transform="translate(0,1951)"></path><path data-c="23AD" d="M384 -239V-57Q384 4 389 9Q391 10 455 10Q496 10 498 9Q501 8 502 5Q504 -5 504 -230Q504 -261 504 -311T505 -381Q505 -486 492 -551T435 -691Q357 -820 222 -893L211 -899H195Q176 -899 173 -896T170 -874Q170 -858 171 -855T184 -846Q262 -793 312 -709T378 -525Q378 -524 379 -522Q383 -493 384 -351Q384 -345 384 -334Q384 -276 384 -239Z" transform="translate(0,-1451)"></path><path data-c="23AC" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 925V782Q504 676 511 616T546 490Q563 446 587 408T633 345T674 304T705 278T717 268Q718 267 718 250T717 232Q717 231 697 216T648 169T588 93T534 -24T505 -179Q504 -191 504 -425Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -424Q384 -191 385 -182Q394 -49 463 61T645 241L659 250L645 259Q539 325 467 434T385 682Q384 692 384 873Q384 1153 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g></g></g></g></svg></mjx-container><br><br><br>看起来有些复杂，小例子中是2*2的矩阵要算4个值，这里是4*4的矩阵要算16个值。我们这里只管第一列，其他列的计算类似。</p>
<p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -5.317ex;" xmlns="http://www.w3.org/2000/svg" width="36.331ex" height="11.765ex" role="img" focusable="false" viewBox="0 -2850 16058.3 5200"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mrow"><g data-mml-node="mo"><path data-c="23A7" d="M712 899L718 893V876V865Q718 854 704 846Q627 793 577 710T510 525Q510 524 509 521Q505 493 504 349Q504 345 504 334Q504 277 504 240Q504 -2 503 -4Q502 -8 494 -9T444 -10Q392 -10 390 -9Q387 -8 386 -5Q384 5 384 230Q384 262 384 312T383 382Q383 481 392 535T434 656Q510 806 664 892L677 899H712Z" transform="translate(0,1951)"></path><path data-c="23A9" d="M718 -893L712 -899H677L666 -893Q542 -825 468 -714T385 -476Q384 -466 384 -282Q384 3 385 5L389 9Q392 10 444 10Q486 10 494 9T503 4Q504 2 504 -239V-310V-366Q504 -470 508 -513T530 -609Q546 -657 569 -698T617 -767T661 -812T699 -843T717 -856T718 -876V-893Z" transform="translate(0,-1451)"></path><path data-c="23A8" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 924Q504 691 503 682Q494 549 425 439T243 259L229 250L243 241Q349 175 421 66T503 -182Q504 -191 504 -424Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -425V-282Q384 -176 377 -116T342 10Q325 54 301 92T255 155T214 196T183 222T171 232Q170 233 170 250T171 268Q171 269 191 284T240 331T300 407T354 524T383 679Q384 691 384 925Q384 1152 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g><g data-mml-node="mtable" transform="translate(889,0)"><g data-mml-node="mtr" transform="translate(0,2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(500,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mo" transform="translate(1472.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(2472.4,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(2972.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(3953.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(4953.9,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(5936.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(6936.3,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g></g><g data-mml-node="mtd" transform="translate(8764.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(10936.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(13108.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,700)"><g data-mml-node="mtd"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(1972.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(2472.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(3453.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(4453.9,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(4953.9,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(5936.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(6936.3,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g></g><g data-mml-node="mtd" transform="translate(8764.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(10936.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(13108.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-700)"><g data-mml-node="mtd" transform="translate(0,0)"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mo" transform="translate(972.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(1972.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(2953.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(3953.9,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(4453.9,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(5436.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(6436.3,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(6936.3,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g></g><g data-mml-node="mtd" transform="translate(8764.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(10936.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(13108.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g></g><g data-mml-node="mtr" transform="translate(0,-2100)"><g data-mml-node="mtd"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mi" transform="translate(500,0)"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mo" transform="translate(1472.2,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(2472.4,0)"><path data-c="1D435" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g><g data-mml-node="mo" transform="translate(3453.7,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(4453.9,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(5436.1,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(6436.3,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mi" transform="translate(6936.3,0)"><path data-c="1D437" d="M287 628Q287 635 230 637Q207 637 200 638T193 647Q193 655 197 667T204 682Q206 683 403 683Q570 682 590 682T630 676Q702 659 752 597T803 431Q803 275 696 151T444 3L430 1L236 0H125H72Q48 0 41 2T33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM703 469Q703 507 692 537T666 584T629 613T590 629T555 636Q553 636 541 636T512 636T479 637H436Q392 637 386 627Q384 623 313 339T242 52Q242 48 253 48T330 47Q335 47 349 47T373 46Q499 46 581 128Q617 164 640 212T683 339T703 469Z"></path></g></g><g data-mml-node="mtd" transform="translate(8764.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(10936.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g><g data-mml-node="mtd" transform="translate(13108.3,0)"><g data-mml-node="mo"><path data-c="2026" d="M78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60ZM525 60Q525 84 542 102T585 120Q609 120 627 104T646 61Q646 36 629 18T586 0T543 17T525 60ZM972 60Q972 84 989 102T1032 120Q1056 120 1074 104T1093 61Q1093 36 1076 18T1033 0T990 17T972 60Z"></path></g></g></g></g><g data-mml-node="mo" transform="translate(15169.3,0)"><path data-c="23AB" d="M170 875Q170 892 172 895T189 899H194H211L222 893Q345 826 420 715T503 476Q504 467 504 230Q504 51 504 21T499 -9H498Q496 -10 444 -10Q402 -10 394 -9T385 -4Q384 -2 384 240V311V366Q384 469 380 513T358 609Q342 657 319 698T271 767T227 812T189 843T171 856T170 875Z" transform="translate(0,1951)"></path><path data-c="23AD" d="M384 -239V-57Q384 4 389 9Q391 10 455 10Q496 10 498 9Q501 8 502 5Q504 -5 504 -230Q504 -261 504 -311T505 -381Q505 -486 492 -551T435 -691Q357 -820 222 -893L211 -899H195Q176 -899 173 -896T170 -874Q170 -858 171 -855T184 -846Q262 -793 312 -709T378 -525Q378 -524 379 -522Q383 -493 384 -351Q384 -345 384 -334Q384 -276 384 -239Z" transform="translate(0,-1451)"></path><path data-c="23AC" d="M389 1159Q391 1160 455 1160Q496 1160 498 1159Q501 1158 502 1155Q504 1145 504 925V782Q504 676 511 616T546 490Q563 446 587 408T633 345T674 304T705 278T717 268Q718 267 718 250T717 232Q717 231 697 216T648 169T588 93T534 -24T505 -179Q504 -191 504 -425Q504 -600 504 -629T499 -659H498Q496 -660 444 -660T390 -659Q387 -658 386 -655Q384 -645 384 -424Q384 -191 385 -182Q394 -49 463 61T645 241L659 250L645 259Q539 325 467 434T385 682Q384 692 384 873Q384 1153 385 1155L389 1159Z" transform="translate(0,0)"></path><svg width="889" height="981" y="1060" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg><svg width="889" height="981" y="-1541" x="0" viewBox="0 172.9 889 981"><path data-c="23AA" d="M384 150V266Q384 304 389 309Q391 310 455 310Q496 310 498 309Q502 308 503 298Q504 283 504 150Q504 32 504 12T499 -9H498Q496 -10 444 -10T390 -9Q386 -8 385 2Q384 17 384 150Z" transform="scale(1,4.825)"></path></svg></g></g></g></g></svg></mjx-container></p>
<br>
列混淆中的的加法和乘法并不是小例子或日常中的那样，其中的加法指 <font color="red">异或运算</font> 。2A + 3B + C + D 即 2A ^ 3B ^ C ^ D，这也是 <mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="15.928ex" height="2.084ex" role="img" focusable="false" viewBox="0 -716 7040 921"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D434" d="M208 74Q208 50 254 46Q272 46 272 35Q272 34 270 22Q267 8 264 4T251 0Q249 0 239 0T205 1T141 2Q70 2 50 0H42Q35 7 35 11Q37 38 48 46H62Q132 49 164 96Q170 102 345 401T523 704Q530 716 547 716H555H572Q578 707 578 706L606 383Q634 60 636 57Q641 46 701 46Q726 46 726 36Q726 34 723 22Q720 7 718 4T704 0Q701 0 690 0T651 1T578 2Q484 2 455 0H443Q437 6 437 9T439 27Q443 40 445 43L449 46H469Q523 49 533 63L521 213H283L249 155Q208 86 208 74ZM516 260Q516 271 504 416T490 562L463 519Q447 492 400 412L310 260L413 259Q516 259 516 260Z"></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(1270,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(1790,0)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path></g><g data-mml-node="mi" transform="translate(2549,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3034,0)"><path data-c="1D462" d="M21 287Q21 295 30 318T55 370T99 420T158 442Q204 442 227 417T250 358Q250 340 216 246T182 105Q182 62 196 45T238 27T291 44T328 78L339 95Q341 99 377 247Q407 367 413 387T427 416Q444 431 463 431Q480 431 488 421T496 402L420 84Q419 79 419 68Q419 43 426 35T447 26Q469 29 482 57T512 145Q514 153 532 153Q551 153 551 144Q550 139 549 130T540 98T523 55T498 17T462 -8Q454 -10 438 -10Q372 -10 347 46Q345 45 336 36T318 21T296 6T267 -6T233 -11Q189 -11 155 7Q103 38 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(3606,0)"><path data-c="1D45B" d="M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(4206,0)"><path data-c="1D451" d="M366 683Q367 683 438 688T511 694Q523 694 523 686Q523 679 450 384T375 83T374 68Q374 26 402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487H491Q506 153 506 145Q506 140 503 129Q490 79 473 48T445 8T417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157Q33 205 53 255T101 341Q148 398 195 420T280 442Q336 442 364 400Q369 394 369 396Q370 400 396 505T424 616Q424 629 417 632T378 637H357Q351 643 351 645T353 664Q358 683 366 683ZM352 326Q329 405 277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q233 26 290 98L298 109L352 326Z"></path></g><g data-mml-node="mi" transform="translate(4726,0)"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(5615,0)"><path data-c="1D452" d="M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"></path></g><g data-mml-node="mi" transform="translate(6081,0)"><path data-c="1D466" d="M21 287Q21 301 36 335T84 406T158 442Q199 442 224 419T250 355Q248 336 247 334Q247 331 231 288T198 191T182 105Q182 62 196 45T238 27Q261 27 281 38T312 61T339 94Q339 95 344 114T358 173T377 247Q415 397 419 404Q432 431 462 431Q475 431 483 424T494 412T496 403Q496 390 447 193T391 -23Q363 -106 294 -155T156 -205Q111 -205 77 -183T43 -117Q43 -95 50 -80T69 -58T89 -48T106 -45Q150 -45 150 -87Q150 -107 138 -122T115 -142T102 -147L99 -148Q101 -153 118 -160T152 -167H160Q177 -167 186 -165Q219 -156 247 -127T290 -65T313 -9T321 21L315 17Q309 13 296 6T270 -6Q250 -11 231 -11Q185 -11 150 11T104 82Q103 89 103 113Q103 170 138 262T173 379Q173 380 173 381Q173 390 173 393T169 400T158 404H154Q131 404 112 385T82 344T65 302T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mi" transform="translate(6571,0)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"></path></g></g></g></svg></mjx-container> 叫轮密钥加而不是轮密钥异或的原因——加法就是异或。那么其中的乘法呢？乘法复杂一些，想真正理解的可以网上冲浪搜索<font color="red">伽罗瓦域内乘法</font>。我们这里仅考虑如下三种情况，因为AES-128加密中，列混淆的乘法中，仅涉及这三个数。
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.019ex" height="1.781ex" role="img" focusable="false" viewBox="0 -705 3544.2 787"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(794.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1516.4,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(2294.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(3072.2,0)"><path data-c="3F" d="M226 668Q190 668 162 656T124 632L114 621Q116 621 119 620T130 616T145 607T157 591T162 567Q162 544 147 529T109 514T71 528T55 566Q55 625 100 661T199 704Q201 704 210 704T224 705H228Q281 705 320 692T378 656T407 612T416 567Q416 503 361 462Q267 395 247 303Q242 279 242 241V224Q242 205 239 202T222 198T205 201T202 218V249Q204 320 220 371T255 445T292 491T315 537Q317 546 317 574V587Q317 604 315 615T304 640T277 661T226 668ZM162 61Q162 89 180 105T224 121Q247 119 264 104T281 61Q281 31 264 16T222 1Q197 1 180 16T162 61Z"></path></g></g></g></svg></mjx-container>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.019ex" height="1.781ex" role="img" focusable="false" viewBox="0 -705 3544.2 787"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(794.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1516.4,0)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="mo" transform="translate(2294.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(3072.2,0)"><path data-c="3F" d="M226 668Q190 668 162 656T124 632L114 621Q116 621 119 620T130 616T145 607T157 591T162 567Q162 544 147 529T109 514T71 528T55 566Q55 625 100 661T199 704Q201 704 210 704T224 705H228Q281 705 320 692T378 656T407 612T416 567Q416 503 361 462Q267 395 247 303Q242 279 242 241V224Q242 205 239 202T222 198T205 201T202 218V249Q204 320 220 371T255 445T292 491T315 537Q317 546 317 574V587Q317 604 315 615T304 640T277 661T226 668ZM162 61Q162 89 180 105T224 121Q247 119 264 104T281 61Q281 31 264 16T222 1Q197 1 180 16T162 61Z"></path></g></g></g></svg></mjx-container>
<mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="8.019ex" height="1.781ex" role="img" focusable="false" viewBox="0 -705 3544.2 787"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mo" transform="translate(794.2,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mn" transform="translate(1516.4,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path></g><g data-mml-node="mo" transform="translate(2294.2,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mo" transform="translate(3072.2,0)"><path data-c="3F" d="M226 668Q190 668 162 656T124 632L114 621Q116 621 119 620T130 616T145 607T157 591T162 567Q162 544 147 529T109 514T71 528T55 566Q55 625 100 661T199 704Q201 704 210 704T224 705H228Q281 705 320 692T378 656T407 612T416 567Q416 503 361 462Q267 395 247 303Q242 279 242 241V224Q242 205 239 202T222 198T205 201T202 218V249Q204 320 220 371T255 445T292 491T315 537Q317 546 317 574V587Q317 604 315 615T304 640T277 661T226 668ZM162 61Q162 89 180 105T224 121Q247 119 264 104T281 61Q281 31 264 16T222 1Q197 1 180 16T162 61Z"></path></g></g></g></svg></mjx-container>
结合Python代码可以更清晰，函数名中 mul 是multiply（乘）的缩写。<br>

<br>

<p><strong>x * 1，结果为x本身</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mul_by_01</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> num</span><br></pre></td></tr></table></figure>
<p><strong>x * 2，首先切换到二进制形式，最高位为0时，比特串左移1比特，最右边补0即可。如果最高位为1，比特串左移1比特，最右边补0，最后再异或上 0x1B</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mul_by_02</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num &lt; <span class="number">0x80</span>:</span><br><span class="line">        res = (num &lt;&lt; <span class="number">1</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    res = (num &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1b</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res % <span class="number">0x100</span></span><br></pre></td></tr></table></figure>
<p><strong>x * 3 = (x * 02) + x，注意”加“是异或哦</strong>。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mul_by_03</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> (mul_by_02(num) ^ num)</span><br></pre></td></tr></table></figure>
<p>列混淆，就这么讲完了。下面看完整的AES代码实现<br> </p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Sbox = (</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">Rcon = (<span class="number">0x00</span>, <span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">text2matrix</span>(<span class="params">text</span>):</span><br><span class="line">    matrix = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        byte = (text &gt;&gt; (<span class="number">8</span> * (<span class="number">15</span> - i))) &amp; <span class="number">0xFF</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            matrix.append([byte])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            matrix[i // <span class="number">4</span>].append(byte)</span><br><span class="line">    <span class="keyword">return</span> matrix</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shiftRound</span>(<span class="params">array, num</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param array: 需要循环左移的数组</span></span><br><span class="line"><span class="string">    :param num: 循环左移的位数</span></span><br><span class="line"><span class="string">    :return: 使用Python切片，返回循环左移num个单位的array</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">return</span> array[num:] + array[:num]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">g</span>(<span class="params">array, index</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    g 函数</span></span><br><span class="line"><span class="string">    :param array: 待处理的四字节数组</span></span><br><span class="line"><span class="string">    :index:从1-10，每次使用Rcon中不同的数</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment"># 首先循环左移1位</span></span><br><span class="line">    array = shiftRound(array, <span class="number">1</span>)</span><br><span class="line">    <span class="comment"># 字节替换</span></span><br><span class="line">    array = [Sbox[i] <span class="keyword">for</span> i <span class="keyword">in</span> array]</span><br><span class="line">    <span class="comment"># 首字节和rcon中对应元素异或</span></span><br><span class="line">    array = [(Rcon[index] ^ array[<span class="number">0</span>])] + array[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">return</span> array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xorTwoArray</span>(<span class="params">array1, array2</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    返回两个数组逐元素异或的新数组</span></span><br><span class="line"><span class="string">    :param array1: 一个array</span></span><br><span class="line"><span class="string">    :param array2: 另一个array</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(array1) == <span class="built_in">len</span>(array2)</span><br><span class="line">    <span class="keyword">return</span> [array1[i] ^ array2[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(array1))]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showRoundKeys</span>(<span class="params">round_keys</span>):</span><br><span class="line">    <span class="comment"># 将轮密钥从44*4转成11*16</span></span><br><span class="line">    kList = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">11</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(round_keys)):</span><br><span class="line">        kList[i // <span class="number">4</span>] += round_keys[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(kList)):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"K%02d:"</span> % i + <span class="string">""</span>.join(<span class="string">"%02x"</span> % k <span class="keyword">for</span> k <span class="keyword">in</span> kList[i]))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keyExpand</span>(<span class="params">key</span>):</span><br><span class="line">    master_key = text2matrix(key)</span><br><span class="line">    round_keys = [[<span class="number">0</span>] * <span class="number">4</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">44</span>)]</span><br><span class="line">    <span class="comment"># 规则一(图中红色部分)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        round_keys[i] = master_key[i]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">4</span> * <span class="number">11</span>):</span><br><span class="line">        <span class="comment"># 规则二(图中红色部分)</span></span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            round_keys[i] = xorTwoArray(g(round_keys[i - <span class="number">1</span>], i // <span class="number">4</span>), round_keys[i - <span class="number">4</span>])</span><br><span class="line">        <span class="comment"># 规则三(图中橙色部分)</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            round_keys[i] = xorTwoArray(round_keys[i - <span class="number">1</span>], round_keys[i - <span class="number">4</span>])</span><br><span class="line">    showRoundKeys(round_keys)</span><br><span class="line">    <span class="keyword">return</span> round_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">AddRoundKeys</span>(<span class="params">state, roundKey</span>):</span><br><span class="line">    result = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        result[i] = xorTwoArray(state[i], roundKey[i])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">SubBytes</span>(<span class="params">state</span>):</span><br><span class="line">    result = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        result[i] = [Sbox[i] <span class="keyword">for</span> i <span class="keyword">in</span> state[i]]</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ShiftRows</span>(<span class="params">s</span>):</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>] = s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>], s[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>], s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>] = s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>], s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>] = s[<span class="number">3</span>][<span class="number">3</span>], s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul_by_02</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">if</span> num &lt; <span class="number">0x80</span>:</span><br><span class="line">        res = (num &lt;&lt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res = (num &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1b</span></span><br><span class="line">    <span class="keyword">return</span> res % <span class="number">0x100</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul_by_03</span>(<span class="params">num</span>):</span><br><span class="line">    <span class="keyword">return</span> mul_by_02(num) ^ num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">MixColumns</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        s0 = mul_by_02(state[i][<span class="number">0</span>]) ^ mul_by_03(state[i][<span class="number">1</span>]) ^ state[i][<span class="number">2</span>] ^ state[i][<span class="number">3</span>]</span><br><span class="line">        s1 = state[i][<span class="number">0</span>] ^ mul_by_02(state[i][<span class="number">1</span>]) ^ mul_by_03(state[i][<span class="number">2</span>]) ^ state[i][<span class="number">3</span>]</span><br><span class="line">        s2 = state[i][<span class="number">0</span>] ^ state[i][<span class="number">1</span>] ^ mul_by_02(state[i][<span class="number">2</span>]) ^ mul_by_03(state[i][<span class="number">3</span>])</span><br><span class="line">        s3 = mul_by_03(state[i][<span class="number">0</span>]) ^ state[i][<span class="number">1</span>] ^ state[i][<span class="number">2</span>] ^ mul_by_02(state[i][<span class="number">3</span>])</span><br><span class="line">        state[i][<span class="number">0</span>] = s0</span><br><span class="line">        state[i][<span class="number">1</span>] = s1</span><br><span class="line">        state[i][<span class="number">2</span>] = s2</span><br><span class="line">        state[i][<span class="number">3</span>] = s3</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">state2Text</span>(<span class="params">state</span>):</span><br><span class="line">    text = <span class="built_in">sum</span>(state, [])</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>.join(<span class="string">"%02x"</span> % k <span class="keyword">for</span> k <span class="keyword">in</span> text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">input_bytes, kList</span>):</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param input_bytes: 输入的明文</span></span><br><span class="line"><span class="string">    :param kList: K0-K10</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    plainState = text2matrix(input_bytes)</span><br><span class="line">    <span class="comment"># 初始轮密钥加</span></span><br><span class="line">    state = AddRoundKeys(plainState, kList[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">        state = SubBytes(state)</span><br><span class="line">        state = ShiftRows(state)</span><br><span class="line">        state = MixColumns(state)</span><br><span class="line">        state = AddRoundKeys(state, kList[<span class="number">4</span> * i:<span class="number">4</span> * (i + <span class="number">1</span>)])</span><br><span class="line"></span><br><span class="line">    state = SubBytes(state)</span><br><span class="line">    state = ShiftRows(state)</span><br><span class="line">    state = AddRoundKeys(state, kList[<span class="number">40</span>:<span class="number">44</span>])</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">input_bytes = <span class="number">0x7a68656e677368616f6b756e79796473</span></span><br><span class="line">key = <span class="number">0x0123456789abcdef0123456789abcdef</span></span><br><span class="line">kList = keyExpand(key)</span><br><span class="line">cipherState = encrypt(input_bytes, kList)</span><br><span class="line">cipher = state2Text(cipherState)</span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><br> <br> </p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>对称加密算法DES的原理及分析</title>
    <url>/2022/07/07/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95DES%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h3 id="图解"><a href="#图解" class="headerlink" title="图解"></a>图解</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/01.webp"
                     
                ></p>
<h3 id="手算DES"><a href="#手算DES" class="headerlink" title="手算DES"></a>手算DES</h3><p>入参：<br />明文：64比特（16个十六进制数、8个字节）<br />KEY：64比特（16个十六进制数、8个字节）<br />出参：64比特（16个十六进制数、8个字节）</p>
<p>明文：0123456789ABCDEF（hex）<br />密钥：133457799BBCDFF1（hex）<br />结果：85e813540f0ab405fdf2e174492922f8<br />因为模式的原因，会进行填充，这里先把结果当成 85e813540f0ab405（hex）</p>
<h4 id="1-对明文初始置换（重排）"><a href="#1-对明文初始置换（重排）" class="headerlink" title="1.对明文初始置换（重排）"></a>1.对明文初始置换（重排）</h4><p>PI置换表（IP表）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PI = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">      <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">      <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">      <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">      <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">      <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">      <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">      <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>]</span><br></pre></td></tr></table></figure>
<p>根据置换表的索引对明文进行重新排列（例如明文第58的位置放到第一位）<br />明文 0123456789ABCDEF（hex）<br />转为二进制 00000001 00100011 01000101 01100111 10001001 10101011 11001101 11101111<br />重新排列后 11001100 00000000 11001100 11111111 11110000 10101010 11110000 10101010<br />排列顺序如图所示：<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/02.webp"
                     
                ></p>
<h4 id="2-对密钥进行编排"><a href="#2-对密钥进行编排" class="headerlink" title="2.对密钥进行编排"></a>2.对密钥进行编排</h4><p><strong>PC1（CP_1）（置换选择一表）</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CP_1 = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>,</span><br><span class="line">        <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">        <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>,</span><br><span class="line">        <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>,</span><br><span class="line">        <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<p>密钥：133457799BBCDFF1（hex）<br />转为二进制：00010011 00110100 01010111 01111001 10011011 10111100 11011111 11110001<br />重新排列后：1111000 0110011 0010101 0101111 0101010 1011001 1001111 0001111<br />对DES来说，密钥64位，只有56位被使用，每8个比特的最后一位被舍弃掉<br />对重新编排后的拆分成左右两部分<br />L0：1111000 0110011 0010101 0101111<br />R0：0101010 1011001 1001111 0001111</p>
<h4 id="3-对编排后的密钥进行16轮循环左移生成16个子密钥"><a href="#3-对编排后的密钥进行16轮循环左移生成16个子密钥" class="headerlink" title="3.对编排后的密钥进行16轮循环左移生成16个子密钥"></a>3.对编排后的密钥进行16轮循环左移生成16个子密钥</h4><p>对L0和R0进行16轮循环左移，每轮根据上一轮左移n位+本次左移的位数（或者是本次左移索引+前面左移索引位数），左移后加在一起LnRn，然后根据PC2（CP_2）表重新编排为K，只有48位，生成16个子密钥（注：索引是从1开始）。<br /><br><font color="red">生成的16个子密钥subkeys会对应明文处理16轮每轮的key</font></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">SHIFT = [<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">CP_2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">        <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">        <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>,</span><br><span class="line">        <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>]</span><br></pre></td></tr></table></figure>
<p>L1：1110000 1100110 0101010 1011111<br />R1：1010101 0110011 0011110 0011110<br />L1R1：1110000 1100110 0101010 1011111 1010101 0110011 0011110 0011110<br />编排后K1：00011011 00000010 11101111 11111100 01110000 01110010</p>
<p>第二次左移2位（对L0和R0左移2位，或者对L1和R1左移1位）<br />L2：1100001 1001100 1010101 0111111<br />R2：0101010 1100110 0111100 0111101<br />L2R2：1100001 1001100 1010101 0111111 0101010 1100110 0111100 0111101<br />编排后K2：01111001 10101110 11011001 11011011 11001001 11100101</p>
<p>第三次左移4位（对L0和R0左移4位，或者对L2和R2左移2位）<br />L3：0000110 0110010 1010101 1111111<br />R3：0101011 0011001 1110001 1110101<br />L3R3：0000110 0110010 1010101 1111111 0101011 0011001 1110001 1110101<br />编排后K3：010101 011111 110010 001010 010000 101100 111110 011001<br />…</p>
<p>K1 &#x3D; 000110 110000 001011 101111 111111 000111 000001 110010<br />K2 &#x3D; 011110 011010 111011 011001 110110 111100 100111 100101<br />K3 &#x3D; 010101 011111 110010 001010 010000 101100 111110 011001<br />K4 &#x3D; 011100 101010 110111 010110 110110 110011 010100 011101<br />K5 &#x3D; 011111 001110 110000 000111 111010 110101 001110 101000<br />K6 &#x3D; 011000 111010 010100 111110 010100 000111 101100 101111<br />K7 &#x3D; 111011 001000 010010 110111 111101 100001 100010 111100<br />K8 &#x3D; 111101 111000 101000 111010 110000 010011 101111 111011<br />K9 &#x3D; 111000 001101 101111 101011 111011 011110 011110 000001<br />K10 &#x3D; 101100 011111 001101 000111 101110 100100 011001 001111<br />K11 &#x3D; 001000 010101 111111 010011 110111 101101 001110 000110<br />K12 &#x3D; 011101 010111 000111 110101 100101 000110 011111 101001<br />K13 &#x3D; 100101 111100 010111 010001 111110 101011 101001 000001<br />K14 &#x3D; 010111 110100 001110 110111 111100 101110 011100 111010<br />K15 &#x3D; 101111 111001 000110 001101 001111 010011 111100 001010<br />K16 &#x3D; 110010 110011 110110 001011 000011 100001 011111 110101</p>
<h4 id="4-对明文进行16轮运算加密"><a href="#4-对明文进行16轮运算加密" class="headerlink" title="4.对明文进行16轮运算加密"></a>4.对明文进行16轮运算加密</h4><p>明文重新编排后的 11001100 00000000 11001100 11111111 11110000 10101010 11110000 10101010<br />拆分成左右两部分<br />L0：11001100 00000000 11001100 11111111<br />R0：11110000 10101010 11110000 10101010<br />每一轮运算只对R进行改变<br />加密：<br />Li+1&#x3D;Ri<br />Ri+1&#x3D;Li⊕F(Ri,Ki)<br /><br />解密：<br>Ri&#x3D;Li+1<br>Li&#x3D;Ri+1⊕F(Li+1,Ki)<br /></p>
<font color="red">
f函数：
1. f函数首先将输入经过E表扩展置换，将32位的输入扩展为48位。</br>
2. 将48位结果与第i轮第密钥ki进行XOR(异或)操作</br>
3. 将异或操作第结果送入S盒进行压缩，压缩成32位</br>
4. 将32位的结果送入P盒置换</font>
</br>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/03.webp"
                     
                ></p>
</br>

<p>Expand表</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">E = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">     <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,</span><br><span class="line">     <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>,</span><br><span class="line">     <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">     <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">     <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>,</span><br><span class="line">     <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<p>S盒（S_BOX，8组）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">S_BOX = [    </span><br><span class="line">[[<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line"> [<span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line"> [<span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>],</span><br><span class="line"> [<span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>],</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">[[<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>],</span><br><span class="line"> [<span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>],</span><br><span class="line"> [<span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>],</span><br><span class="line"> [<span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">[[<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>],</span><br><span class="line"> [<span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>],</span><br><span class="line"> [<span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>],</span><br><span class="line"> [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>],</span><br><span class="line">],</span><br><span class="line"></span><br><span class="line">[[<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>],</span><br><span class="line"> [<span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line"> [<span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>],</span><br><span class="line"> [<span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>],</span><br><span class="line">],  </span><br><span class="line"></span><br><span class="line">[[<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line"> [<span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line"> [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>],</span><br><span class="line"> [<span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>],</span><br><span class="line">], </span><br><span class="line"></span><br><span class="line">[[<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line"> [<span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line"> [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>],</span><br><span class="line"> [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>],</span><br><span class="line">], </span><br><span class="line"></span><br><span class="line">[[<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>],</span><br><span class="line"> [<span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line"> [<span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line"> [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>],</span><br><span class="line">],</span><br><span class="line">   </span><br><span class="line">[[<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>],</span><br><span class="line"> [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line"> [<span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line"> [<span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>],</span><br><span class="line">]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>P盒</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">P = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">     <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">     <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>,</span><br><span class="line">     <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">25</span>]</span><br></pre></td></tr></table></figure>

<p>第一轮为例：<br />R1&#x3D; L0⊕f(R0，K1)<br />F函数	P(S(E(Ri)⊕Ki))：<br />R0：11110000 10101010 11110000 10101010<br />经过E表编排：01111010 00010101 01010101 01111010 00010101 01010101<br />与K1异或后：011000 010001 011110 111010 100001 100110 010100 100111<br /><br><font color="red">把异或后的拆分8组，进行8轮S盒运算</font><br><br />B1 &#x3D; 011000 <br />B2 &#x3D; 010001 <br />B3 &#x3D; 011110 <br />B4 &#x3D; 111010 <br />B5 &#x3D; 100001 <br />B6 &#x3D; 100110 <br />B7 &#x3D; 010100 <br />B8 &#x3D; 100111<br /><br><font color="red">将每一组前后1个比特拼接为row转十进制，中间4个比特为column转十进制，然后去S盒映射第i个row行column列</font><br><br />B1	0 1100 0 <br />row：00 &#x3D;&#x3D;&gt; 0  （十进制）<br />column：1100 &#x3D;&#x3D;&gt; 12  （十进制）<br />(0, 12) &#x3D;&#x3D;&gt; S[0][0][12]&#x3D;&#x3D;&gt;5<br />B1 &#x3D; 5 &#x3D;&#x3D;&gt; 0101 （二进制）</p>
<p>B2 	0 1000 1<br />row：01 &#x3D;&#x3D;&gt; 1  （十进制）<br />column：1000 &#x3D;&#x3D;&gt; 8  （十进制）<br />(1, 8) &#x3D;&#x3D;&gt; S[1][1][8]&#x3D;&#x3D;&gt;12<br />B1 &#x3D;12&#x3D;&#x3D;&gt; 1100（二进制）</p>
<p>B3 	0 1111 0 <br />row：00 &#x3D;&#x3D;&gt; 0  （十进制）<br />column：1111&#x3D;&#x3D;&gt; 15  （十进制）<br />(0, 15) &#x3D;&#x3D;&gt; S[2][0][15]&#x3D;&#x3D;&gt;8<br />B1 &#x3D;8&#x3D;&#x3D;&gt; 1000（二进制）<br />…<br />6<em>8&#x3D;48bit 经过8轮 4</em>8&#x3D;32bit<br />把B1-B8拼接起来：<br />01011100 10000010 10110101 10010111</p>
<p>经过P盒置换后：00100011 01001010 10101001 10111011<br />F函数结束，结果异或L0<br />R1：11101111 01001010 01100101 01000100<br />L1：R0<br />…<br />16轮后<br />R16：00001010 01001100 11011001 10010101<br />L16：01000011 01000010 00110010 00110100<br />R16L16拼接（R在前），再经过末置换表（PI_1）（64位）：<br />R16L16：00001010 01001100 11011001 10010101 01000011 01000010 00110010 00110100<br />置换后：10000101 11101000 00010011 01010100 00001111 00001010 10110100 00000101<br />转为hex就是结果了：85e813540f0ab405<br /></p>
<p><strong>PI_1表</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">PI_1 = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line">        <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">        <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">        <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">        <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">        <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">        <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>]</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/04.webp"
                     
                ></p>
<h3 id="分组密码的填充"><a href="#分组密码的填充" class="headerlink" title="分组密码的填充"></a>分组密码的填充</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/05.webp"
                     
                ><br><br /><br><font color="red">Passing只用于CBC和ECB模式，默认采用PKCS#7进行填充</font><br><br />DES 64比特明文，64比特密钥，结果64比特输出<br />那为什么明文刚好是64比特，如果输入是56比特？20比特？或者什么都不输入呢？<br />明文会切割成每64比特为一组进行des加密，最后一组小于或等于64都会进行填充<br />如果传入的是utf，需先转hex<br /></p>
<p>小于64比特：<br /><br>123456789（hex）&#x3D;&#x3D;&gt; 1234567809（hex）<br /><br>还差6位hex（3个字节），填充030303：1234567809030303</p>
<p>123456789abcd（hex）&#x3D;&#x3D;&gt;123456789abc0d（hex）<br />还差2位hex（1个字节），填充01：123456789abc0d01</p>
<br />

<p>等于64比特，需要填充一整个分组0808080808080808：<br />0123456789abcdef（hex）&#x3D;&#x3D;&gt; 0123456789abcdef0808080808080808</p>
<p>最少填充一字节，最多填充一整个分组，不能不填充。<br /></p>
<h3 id="分组密码的工作模式"><a href="#分组密码的工作模式" class="headerlink" title="分组密码的工作模式"></a>分组密码的工作模式</h3><h4 id="ECB"><a href="#ECB" class="headerlink" title="ECB"></a>ECB</h4><p>相同的分组输入，计算后的结果是完全一致的，每个分组单独处理，叫ECB工作模式<br />这种模式有很多好处，我们可以直接for 循环，将很长的输入分成对应个数的分组，每个分组得到结果后拼接在一起就行，而且这也意味着可以并行计算。 <br />如果ECB模式是可行的、安全的，那么我们一定选择它，因为最简单和高效。那也就不会出现别的工作模式了，可惜的是它并不安全。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/06.webp"
                     
                ></p>
<h4 id="CBC"><a href="#CBC" class="headerlink" title="CBC"></a>CBC</h4><p>最常用的模式<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/07.webp"
                     
                ><br />其实想法也很朴素，每个明文分组在加密前多一个步骤，和上一个分组的密文块进行异或运算。因为第一个明文块没有所谓的“上一个分组的密文块“，所以需要人给一个64比特，或者说8字节的输入，我们叫它初始化向量，IV。<br />在cyberchef中验证一下</p>
<blockquote>
<p>明文：123456789ABCDEF0（hex）<br /><br>密钥：133457799BBCDFF1（hex）<br /><br>使用CBC模式<br /><br>IV：0123456789ABCDEF<br /><br>计算结果：0ecb68bac16aece07cbadcfa7a974bcc（hex）</p>
</blockquote>
<p>按照我们上面的说法<br /><br><font color="red">0ecb68bac16aece0</font>的明文应该就是<font color="red">123456789ABCDEF0</font>和<font color="red">0123456789ABCDEF</font>异或的结果<br /><br>得到结果<font color="red">1317131f1317131f</font><br /><br>使用cyberchef计算<font color="red">123456789ABCDEF0 ^ 0123456789ABCDEF</font> 得到结果<font color="red">1317131f1317131f</font>，单独计算其DES加密结果，注意这儿要用ECB模式: <font color="red">0ecb68bac16aece0 fdf2e174492922f8</font>，因为<font color="red">1317131f1317131f</font>是一个分组的长度，所以要填充0808080808080808， <font color="red">fdf2e174492922f8</font>是08的结果，所以不用管。可以发现，第一块加密结果<font color="red">0ecb68bac16aece0</font>正是我们所预期的。<br /></p>
<p>接下来看一下第二块，第二块即0808080808080808，按照CBC的规则计算 <font color="red">0ecb68bac16aece0 ^ 0808080808080808 &#x3D; 06c360b2c962e4e8</font>，单独计算ECB下的<font color="red">06c360b2c962e4e8</font> 结果为<font color="red">7cbadcfa7a974bcc fdf2e174492922f8</font>，第二块结果<font color="red">7cbadcfa7a974bcc</font>也完全正确。</p>
<h4 id="CFB"><a href="#CFB" class="headerlink" title="CFB"></a>CFB</h4><blockquote>
<p>明文：123456789ABCDEF0<br /><br>密钥：133457799BBCDFF1<br /><br>IV：0123456789ABCDEF<br /><br>模式：CFB<br /><br>结果: 97dc452c95b66af5<br /><br>IV即0123456789ABCDEF的des加密结果85e813540f0ab405<br /><br>85e813540f0ab405 与 123456789ABCDEF0 的异或结果是97dc452c95b66af5</p>
</blockquote>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/08.webp"
                     
                ></p>
<h4 id="OFB"><a href="#OFB" class="headerlink" title="OFB"></a>OFB</h4><blockquote>
<p>明文：123456789ABCDEF0<br /><br>密钥：133457799BBCDFF1<br /><br>IV：0123456789ABCDEF<br /><br>模式：OFB<br /><br>结果: 97dc452c95b66af5<br /><br>即一个分组的OFB与CFB是一样一样的<br /></p>
</blockquote>
<p>两个分组的计算：</p>
<blockquote>
<p>明文：123456789ABCDEF0 123456789ABCDEF0<br /><br>密钥：133457799BBCDFF1<br /><br>IV：0123456789ABCDEF<br /><br>模式：OFB<br /><br>结果：97dc452c95b66af5 759a2c51fb637db5</p>
</blockquote>
<p>直接观察第二个分组759a2c51fb637db5是如何计算出来呢?<br />它是明文和加密两次的IV的异或结果<br />明文：123456789ABCDEF0 加密第一次：85e813540f0ab405 加密第二次 67ae7a2961dfa345f，最后异或 67ae7a2961dfa345f ^ 123456789ABCDEF0 &#x3D; 759a2c51fb637db5<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220707/09.webp"
                     
                ></p>
<h4 id="CTR"><a href="#CTR" class="headerlink" title="CTR"></a>CTR</h4>]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>某音web端X-Bogus 逆向分析算法</title>
    <url>/2023/03/08/%E6%9F%90%E9%9F%B3web%E7%AB%AFX-Bogus-%E9%80%86%E5%90%91%E5%88%86%E6%9E%90%E7%AE%97%E6%B3%95/</url>
    <content><![CDATA[<p>目标：视频评论接口X-Bogus参数<br />接口地址：’aHR0cHM6Ly93d3cuZG91eWluLmNvbS9hd2VtZS92MS93ZWIvY29tbWVudC9saXN0Lw&#x3D;&#x3D;’</p>
<h3 id="抓包"><a href="#抓包" class="headerlink" title="抓包"></a>抓包</h3><p>该接口是xhr请求，使用xhr下断点，当url中包含X-Bogus时就断下<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/01.png"
                      alt="image.png"
                ><br />看调用栈上一层是在webmssdk.es5.js文件里，其实这个文件就是生成参数的，通过查阅知道这就是jsvmp，而且整体上也做了混淆。<br />这里使用v_jstools插件进行变量的压缩计算。<br />还原后使用浏览器的 Overrides 替换功能将 webmssdk.es5.js替换掉。<br />往上跟栈也就是跟到上图的堆栈b那里，X-Bogus参数是在this.openArgs[1]里面，直接打一个条件断点在b那<br /><code>this.openArgs[1].indexOf(&quot;X-Bogus&quot;) != -1</code><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/02.png"
                      alt="image.png"
                ><br />翻页评论重新触发请求，如图所示，到这里就已经生成了X-Bogus<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/03.png"
                      alt="image.png"
                ><br />如图所示，$函数这里就已经生成了X-Bogus，this.openArgs[1]就是携带了xb的完整url<br />仔细观察这段代码，有很多三元表达式，当 M 的值为 15 时，就会走到这段逻辑，执行完函数后赋值给K，K 的值生成之后，有一个 O[S] &#x3D; K 的操作。<br />再往上看代码，O初始化的地方<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/04.png"
                      alt="image.png"
                ><br />O 是一个数组，单步调试的话会发现代码会一直走这个 if-else 的逻辑，几乎每一步都有 O 数组的参与，不断往里面增删改查值，for 循环里面的 j 值，决定着后续 if 语句的走向，这里也就是插桩的关键所在。</p>
<h3 id="插桩分析"><a href="#插桩分析" class="headerlink" title="插桩分析"></a>插桩分析</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/05.png"
                      alt="image.png"
                ><br />大的 for 循环和 if-else 逻辑有两个地方，为了保证最后的日志更加详细完整，在这两个地方都下个日志断点（右键 Add logpoint），断点内容为：<br />“位置 1”, “索引j”, j, “索引A”, A, “值O: “, JSON.stringify(O, function(key, value) {if (value &#x3D;&#x3D; window) {return undefined} return value})<br />“位置 2”, “索引j”, j, “索引A”, A, “值O: “, JSON.stringify(O, function(key, value) {if (value &#x3D;&#x3D; window) {return undefined} return value})<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/06.png"
                      alt="image.png"
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/07.png"
                      alt="image.png"
                ><br />插桩输出 O 的时候为什么要写这么长一串呢？首先 JSON.stringify() 方法的作用是将 JavaScript 值转换为 JSON 字符串，基础语法是 JSON.stringify(value[, replacer [, space]])，如果不将其转换成 JSON，那么 O 的值，输出可能是这样的：[empty, Array(26), 1, Array(0)]，你看不到 Array 数组里面具体的值，该方法有个可选参数 replacer，如果 replacer 为函数，则 JSON.stringify 将调用该函数，并传入每个成员的键和值，在函数中可以对成员进行处理，最后返回处理后的值，如果此函数返回 undefined，则排除该成员。<br />下好日志断点后，注意前面我们下的 XHR 断点不要取消，然后进行翻页出发请求，控制台就开始打印日志了，如果 XHR 断点取消了，日志就会一直打印直到卡死。日志输出完毕后，右键Save as保存下来到本地进行分析<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/08.png"
                      alt="image.png"
                ><br />顺便记录下当前已经生成的xb，<code>DFSzswVupV0ANJPItap8URXAIQ5f</code><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/09.png"
                      alt="image.png"
                ><br />xb由DFSzswVupV0ANJPItap8URXAIQ5f这28位字符组成的，现在看是怎么来的，打开刚才的日志，在里面搜索，找到第一次出现的地方。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/10.png"
                      alt="image.png"
                ><br />可以看到是逐个生成的，在9047行，xb后面的元素是null，到了下一行9048就生了下一个字符f，那么在这两步之间就是f的生成逻辑，这个时候我们看第9047行的日志断点是 位置 2 索引j 16 索引A 716，那么我们回到原网页，在位置2，下一个条件断点（右键 Add conditional breakpoint），当 j&#x3D;&#x3D;16 &amp;&amp; A&#x3D;&#x3D;716 &amp;&amp; O[7] &#x3D;&#x3D; 21 时就断下。之所以要加 O[7] 是因为 索引j 16 索引A 716 的位置有很多，多加个限制条件就可以缩小范围，当然有可能加了多个条件仍然有多个位置都满足，就需要自己筛选了，通过断点断下的时候看看控制台前面输出的日志来判断是不是我们想要的位置。<br />继续翻页，断下之后开始单步跟，来到下图所示的地方：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/11.png"
                      alt="image.png"
                ><br />到这里之后，就不要下一步了，再下一步有可能整个语句就执行完毕了，其中的细节你看不到，所以这里我们在控制台挨个输入看看：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/12.png"
                      alt="image.png"
                ><br />可以看到实际上的逻辑就是返回指定位置的字符，w 的值就是 O[5]，m 的值就是 O[4]，经过多次调试发现 m 的值是固定的，P 就是 charAt() 方法。我们再看看我们本地的日志，O[5] 的值为 [16]，charAt() 取值出来就是f，逻辑完全正确。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/13.png"
                      alt="image.png"
                ><br />现在我们还需要知道这个16是怎么来的，继续往上看，找到16第一次出现的地方，在第9046行，那么我们就要使其在上一步断下，也就是第9045行，如下图所示：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/14.png"
                      alt="image.png"
                ><br />第9045行的索引信息为 位置 2 索引j 47 索引A 708，同样的下条件断点观察怎么生成的：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/15.png"
                      alt="image.png"
                ><br />可以看到逻辑是 O[5] &amp; O[6]，再把值赋给O[5]，再看我们之前本地的日志<br />O[5] &#x3D; 5809808<br />O[6] &#x3D; 63<br />5809808 &amp; 63 &#x3D; 16，逻辑正确，16就是这么来的。接下来又开始找 5809808 和 63 是怎么生成的，先看看63是怎么来的，同样在生成的上一步，也就是第9044行下个条件断点，这行的索引为 位置 2 索引j 72 索引A 704。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/16.png"
                      alt="image.png"
                ><br /> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/17.png"
                      alt="image.png"
                ><br />可以看到 63 是直接 F[A] 生成的，F 是一个大数组，A 就是索引为 704，F 这个大数组怎么来的先不用管，经过几次测试发现是固定的。<br />5809808后面再说，再逐个找倒数的字符串的生成，记录下来<br />xb &#x3D; “DFSzswVupV0ANJPItap8URXAIQ5f”<br />m &#x3D; “Dkdpgh4ZKsQB80&#x2F;Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe&#x3D;”<br />第28字符串 &#x3D;&#x3D;&gt; f&#x3D;m[16]，16&#x3D;5809808&amp;63，63&#x3D;F[704]<br />第27字符串 &#x3D;&#x3D;&gt; 5&#x3D;m[26]，26&#x3D;1664&gt;&gt;6，6&#x3D;F[646]<br />第26字符串 &#x3D;&#x3D;&gt; Q&#x3D;m[10]，10&#x3D;40960&gt;&gt;12，12&#x3D;F[580]<br />第25字符串 &#x3D;&#x3D;&gt; I&#x3D;m[22]，22&#x3D;5767168&gt;&gt;18，18&#x3D;F[510]<br />第24字符串 &#x3D;&#x3D;&gt; A&#x3D;m[30]，30&#x3D;7701854&amp;63，63&#x3D;F[704]<br />第23字符串 &#x3D;&#x3D;&gt; X&#x3D;m[21]，21&#x3D;1344&gt;&gt;6，6&#x3D;F[646]<br />第22字符串 &#x3D;&#x3D;&gt; R&#x3D;m[24]，24&#x3D;98304&gt;&gt;12，12&#x3D;F[580]<br />第21字符串 &#x3D;&#x3D;&gt; U&#x3D;m[29]，29&#x3D;7602176&gt;&gt;18，18&#x3D;F[510]<br />第20字符串 &#x3D;&#x3D;&gt; 8&#x3D;m[12]，12&#x3D;16232652&amp;63，63&#x3D;F[704]</p>
<p>把xb &#x3D; DFSz swVu pV0A NJPI tap8 URXA IQ5f，将其看成每四个为一组，从上面的规律可以得到，每4个字符串为一组，每组的字符生成流程都是一样的</p>
<p>就差大数字是怎么来的，搜本地日志5809808第一次出现的位置，x直接定位到第一次出现的地方第8979行的上一行第8978行，位置 2 索引j 48 索引A 454<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/18.png"
                      alt="image.png"
                ><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/19.png"
                      alt="image.png"
                ><br />可以看出大数字是O[2]|O[3]计算而来，那我们本地5809808就是5809664|144</p>
<p>找到144第一次出现的地方，同样的操作<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/20.png"
                      alt="image.png"
                ><br />114是由O[4].charCodeAt(O[5])生成，O[4]&#x3D;’\x02ÿ-%.,2\x10^\x8F\x1AÖ÷°cÛ\x85^X¦?’，O[5]&#x3D;20<br />经过几次测试知道乱码字符串是跟url有关，生成过程后面说。用我们本地的O[4]试一下<br />“\u0002ÿ-%.,\u000F^\u001AÖ÷°Ìu^X¦”.charCodeAt(20)<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/25.png"
                      alt="image.png"
                ><br />经过后面8位字符的跟进后，记录了一下规则<br />xb &#x3D; “DFSzswVupV0ANJPItap8URXAIQ5f”<br />m &#x3D; “Dkdpgh4ZKsQB80&#x2F;Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe&#x3D;”<br /></p>
<ul>
<li><p>第28字符串f：	<br>  f&#x3D;m[16]<br>  16&#x3D;5809808&amp;63<br /> 63&#x3D;F[704]<br />	5809808&#x3D;5809664|144<br />	144&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(20)<br />	5809664&#x3D;5767168|42496<br /> 42496&#x3D;166&lt;&lt;8<br />	8&#x3D;F[386]<br />	166&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(19)<br />	5767168&#x3D;88&lt;&lt;16<br />	16&#x3D;F[320]<br />	88&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(18)<br /></p>
</li>
<li><p>第27字符串5：<br />	5&#x3D;m[26]<br />	26&#x3D;1664&gt;&gt;6<br />	6&#x3D;F[646]<br />	1664&#x3D;5809808&amp;4032<br />	4032&#x3D;F[638]<br /></p>
</li>
<li><p>第26字符串Q：<br />	Q&#x3D;m[10]<br />	10&#x3D;40960&gt;&gt;12<br />	12&#x3D;F[580]<br />	40960&#x3D;5809808&amp;258048<br />	258048&#x3D;F[568]<br /></p>
</li>
<li><p>第25字符串I：<br />	I&#x3D;m[22]<br />	22&#x3D;5767168&gt;&gt;18<br />	18&#x3D;F[510]<br />	5767168&#x3D;5809808&amp;16515072<br />	16515072&#x3D;F[498]</p>
</li>
<li><p>第24字符串A:<br />	A&#x3D;m[30]<br />	30&#x3D;7701854&amp;63<br />	63&#x3D;F[704]<br />	7701854&#x3D;7701760|94<br />	94&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(17)<br />	7701760&#x3D;7667712|34048<br />	34048&#x3D;133&lt;&lt;8<br />	8&#x3D;F[386]<br />	133&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(16)<br />	7667712&#x3D;117&lt;&lt;16<br />	16&#x3D;F[320]<br />	117&#x3D;”\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(15)<br /></p>
</li>
<li><p>第23字符串X：<br />	X&#x3D;m[21]<br />	21&#x3D;1344&gt;&gt;6<br />	6&#x3D;F[646]<br />	1344&#x3D;7701854&amp;4032<br />	4032&#x3D;F[638]<br /></p>
</li>
<li><p>第22字符串R：<br />	R&#x3D;m[24]<br />	24&#x3D;98304&gt;&gt;12<br />	12&#x3D;F[580]<br />	98304&#x3D;7701854&amp;258048<br />	258048&#x3D;F[568]<br /></p>
</li>
<li><p>第21字符串U：<br />	U&#x3D;m[29]<br />	29&#x3D;7602176&gt;&gt;18<br />	18&#x3D;F[510]<br />	7602176&#x3D;7701854&amp;16515072<br />	16515072&#x3D;F[498]</p>
</li>
</ul>
<p>正序整理了一下，大致的流程就是<br />m &#x3D; “Dkdpgh4ZKsQB80&#x2F;Mfvw36XI1R25-WUAlEi7NLboqYTOPuzmFjJnryx9HVGcaStCe&#x3D;”<br />xb &#x3D; “DFSz swVu pV0A NJPI tap8 URXA IQ5f”<br /><strong>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;第6组 URXA &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</strong><br />“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(15) &#x3D; 117<br />F[320] &#x3D; 16<br />117 &lt;&lt; 16 &#x3D; 7667712</p>
<p>“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(16) &#x3D; 133<br />F[386] &#x3D; 8<br />133 &lt;&lt; 8 &#x3D; 34048<br />7667712|34048 &#x3D; 7701760</p>
<p>“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(17) &#x3D; 94<br />7701760 | 94 &#x3D; 7701854</p>
<p>F[498] &#x3D; 16515072<br />7701854 &amp; 16515072 &#x3D; 7602176<br />F[510] &#x3D; 18<br />7602176 &gt;&gt; 18 &#x3D; 29<br />m.charAt(29) &#x3D; ‘U’</p>
<p>F[568] &#x3D; 258048<br />7701854 &amp; 258048 &#x3D; 98304<br />F[580] &#x3D; 12<br />98304 &gt;&gt; 12 &#x3D; 24<br />m.charAt(24) &#x3D; ‘R’<br />	<br />F[638] &#x3D; 4032<br />7701854 &amp; 4032 &#x3D; 1344<br />F[646] &#x3D; 6<br />1344 &gt;&gt; 6 &#x3D; 21<br />m.charAt(21) &#x3D; ‘X’</p>
<p>F[704] &#x3D; 63<br />7701854 &amp; 63 &#x3D; 30<br />m.charAt(30) &#x3D; ‘A’<br />	<br /><strong>&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;第7组 IQ5f &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</strong><br />“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(18) &#x3D; 88<br />F[320] &#x3D; 16<br />88 &lt;&lt; 16 &#x3D; 5767168</p>
<p>“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(19) &#x3D; 166<br />F[386] &#x3D; 8<br />166 &lt;&lt; 8 &#x3D; 42496<br />5767168 | 42496 &#x3D; 5809664</p>
<p>“\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu^X¦”.charCodeAt(20) &#x3D; 144<br />5809664 | 144 &#x3D; 5809808</p>
<p>F[498] &#x3D; 16515072<br />5809808 &amp; 16515072 &#x3D; 5767168<br />F[510] &#x3D; 18<br />5767168 &gt;&gt; 18 &#x3D; 22<br />m.charAt(22) &#x3D; ‘I’</p>
<p>F[568] &#x3D; 258048<br />5809808 &amp; 258048 &#x3D; 40960<br />F[580] &#x3D; 12<br />40960 &gt;&gt; 12 &#x3D; 10<br />m.charAt(10) &#x3D; ‘Q’</p>
<p>F[638] &#x3D; 4032<br />5809808 &amp; 4032 &#x3D; 1664<br />F[646] &#x3D; 6<br />1664 &gt;&gt; 6 &#x3D; 26<br />m.charAt(26) &#x3D; ‘5’</p>
<p>F[704] &#x3D; 63<br />5809808 &amp; 63 &#x3D; 16<br />m.charAt(16) &#x3D; ‘f’</p>
<p>将流程对比一下就可以发现，每个步骤 F 里面的取值都是一样的，这个可以直接写死，不同之处就在于最开始的 charCodeAt() 操作，也就是返回乱码字符串指定位置字符的 Unicode 编码，第7组依次是 18、19、20，第6组依次是15、16、17，以此类推，第1组刚好是0、1、2，如下图所示：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/21.png"
                      alt="image.png"
                ><br />每一组的逻辑都是一样的，依次生成七组字符串，最后拼接成完整的 X-Bogus。</p>
<h3 id="乱码字符串生成逻辑"><a href="#乱码字符串生成逻辑" class="headerlink" title="乱码字符串生成逻辑"></a>乱码字符串生成逻辑</h3><p>该样本对应的param_url &#x3D; “device_platform&#x3D;webapp&amp;aid&#x3D;6383&amp;channel&#x3D;channel_pc_web&amp;aweme_id&#x3D;7071984856741186853&amp;cursor&#x3D;0&amp;count&#x3D;20&amp;item_type&#x3D;0&amp;insert_ids&#x3D;&amp;rcFT&#x3D;&amp;pc_client_type&#x3D;1&amp;version_code&#x3D;170400&amp;version_name&#x3D;17.4.0&amp;cookie_enabled&#x3D;true&amp;screen_width&#x3D;2048&amp;screen_height&#x3D;1152&amp;browser_language&#x3D;zh-CN&amp;browser_platform&#x3D;Win32&amp;browser_name&#x3D;Chrome&amp;browser_version&#x3D;110.0.0.0&amp;browser_online&#x3D;true&amp;engine_name&#x3D;Blink&amp;engine_version&#x3D;110.0.0.0&amp;os_name&#x3D;Windows&amp;os_version&#x3D;10&amp;cpu_core_num&#x3D;20&amp;device_memory&#x3D;8&amp;platform&#x3D;PC&amp;downlink&#x3D;3.85&amp;effective_type&#x3D;4g&amp;round_trip_time&#x3D;100&amp;webid&#x3D;7206219799877142077&amp;msToken&#x3D;Z9-0y9elP0-Obz51QiLXg2qpd-dyJHammHH_0hNY48UFC3RxAx8bjxf2Hpmxmm52cmDQVfBP0lf1UwzvAtbOcW6RGQuSY_1W-plCkw-lP-OkNH00Ion2DohnZlsySAc&#x3D;”<br />在进行下一步之前，我们要注意两点：</p>
<ul>
<li>文章演示有些变量前后不对应，因为每次插桩的值都是会变的，看流程就行了，流程是正确的；</li>
<li>我们日志输出是经过 JSON.stringify 处理了的，有些步骤是向某个函数传入乱码字符串进行处理，你会发现处理后的结果和日志不一致，这是正常的。</li>
</ul>
<p>乱码字符串的生成相对来说稍微复杂一点，但思路仍然一样，这里就不一一截图展示了，直接用日志描述一下关键步骤，注意以下日志是正向的步骤，就不逆着推了，建议自己先逆着把流程走一走，再来看这个步骤就看得懂了。<br /></p>
<p><strong>Step1</strong>：首先对 URL 后面的参数，也就是 Query String Parameters 进行两次 MD5、两次转 Uint8Array 处理，最后得到的 Uint8Array 对象在后面的步骤中用得到，步骤如下：<br />位置 1 索引j 4 索引A 134：将 URL 后面的参数进行 MD5 加密得到字符串<br />位置 1 索引j 16 索引A 494：将上一步的字符串转换为 Uint8Array 对象<br />位置 1 索引j 4 索引A 134：将上一步的 Uint8Array 对象进行 MD5 加密，得到字符串<br />位置 1 索引j 16 索引A 504：将上一步的字符串转换为 Uint8Array 对象</p>
<p>上述步骤中，我们将最终得到的结果命名为 uint8Array，md5字符串转uint8Array，跟进到相应位置把函数抠出来即可<br /></p>
<p><strong>Step2</strong>：生成两个大数，一个是时间戳，我们称之为 fixedString1，另一个调用某个方法生成，我们称之为 fixedString2。<br />fixedString1<br />位置 1 索引j 43 索引A 1032：1677985818608 &#x2F; 1000 &#x3D; 1677985818.608<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/22.png"
                      alt="image.png"
                ><br />fixedString2<br />位置 1 索引j 16 索引A 1060：P.apply(null, []) &#x3D; 1489154074<br />上述步骤中，P 对应以下方法，缺失的方法自行补齐：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">_0x17dd8c</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> _0x2fc47d || (_0xeb6638.<span class="property">perf</span> ? -<span class="number">1</span> : _0x2fc47d = <span class="title function_">_0x5bc542</span>(<span class="number">3735928559</span>));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (a) &#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">_0x5bc542</span>(<span class="params">a</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> b, c = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;canvas&quot;</span>);</span><br><span class="line">    c.<span class="property">width</span> = <span class="number">48</span>, c.<span class="property">height</span> = <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">var</span> e = c.<span class="title function_">getContext</span>(<span class="string">&quot;2d&quot;</span>);</span><br><span class="line">    e.<span class="property">font</span> = <span class="string">&quot;14px serif&quot;</span>, e.<span class="title function_">fillText</span>(<span class="string">&quot;龘ฑภ경&quot;</span>, <span class="number">2</span>, <span class="number">12</span>), e.<span class="property">shadowBlur</span> = <span class="number">2</span>, e.<span class="property">showOffsetX</span> = <span class="number">1</span>, </span><br><span class="line">    e.<span class="property">showColor</span> = <span class="string">&quot;lime&quot;</span>, e.<span class="title function_">arc</span>(<span class="number">8</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">2</span>), e.<span class="title function_">stroke</span>(), b = c.<span class="title function_">toDataURL</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> d = <span class="number">0</span>; d &lt; <span class="number">32</span>; d++) &#123;</span><br><span class="line">        a = <span class="number">65599</span> * a + b.<span class="title function_">charCodeAt</span>(a % b.<span class="property">length</span>) &gt;&gt;&gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Step3</strong>：先后生成两个数组，我们称之为 array1、array2，array2 就是由 array1 的元素位置变换后得来的，严格来讲，array1 不是一个完整的数组，而是一个个数字，这一点可以在日志中体现出来，为了方便我们就直接将其视为一个数组，两个数组都有19个元素，步骤如下：<br />array1[0] 至 array1[3] 为定值  [64,0.00390625,1,8]<br />array1[4]<br />位置 1 索引j 25 索引A 1172：uint8Array[14] &#x3D; 127<br />array1[5]<br />位置 1 索引j 25 索引A 1196：uint8Array[15] &#x3D; 208</p>
<p>array1[6]、array1[7] 可以直接写死<br /></p>
<p>array1[8]、array1[9]  与 ua 有关, 可以直接写死<br /></p>
<p>array1[10]<br />位置 1 索引j 52 索引A 1316：fixedString1 &gt;&gt; 24 &#x3D; 100<br />位置 1 索引j 47 索引A 1324：100 &amp; 255 &#x3D; 100</p>
<p>array1[11]<br />位置 1 索引j 52 索引A 1348：fixedString1 &gt;&gt; 16 &#x3D; 25604<br />位置 1 索引j 47 索引A 1356：25604 &amp; 255 &#x3D; 4</p>
<p>array1[12]<br />位置 1 索引j 52 索引A 1380：fixedString1 &gt;&gt; 8 &#x3D; 6554632<br />位置 1 索引j 47 索引A 1388：6554632 &amp; 255 &#x3D; 8</p>
<p>array1[13]<br />位置 1 索引j 52 索引A 1412：fixedString1 &gt;&gt; 0 &#x3D; 1677985818<br />位置 1 索引j 47 索引A 1420：1677985818 &amp; 255 &#x3D; 26</p>
<p>array1[14]<br />位置 1 索引j 52 索引A 1444：fixedString2 &gt;&gt; 24 &#x3D; 88<br />位置 1 索引j 47 索引A 1452 ：88 &amp; 255 &#x3D; 88</p>
<p>array1[15]<br />位置 1 索引j 52 索引A 1476：fixedString2 &gt;&gt; 16 &#x3D; 22722<br />位置 1 索引j 47 索引A 1484：22722 &amp; 255 &#x3D; 194</p>
<p>array1[16]<br />位置 1 索引j 52 索引A 1508：fixedString2 &gt;&gt; 8 &#x3D; 5817008<br />位置 1 索引j 47 索引A 1516：5817008 &amp; 255 &#x3D; 176</p>
<p>array1[17]<br />位置 1 索引j 52 索引A 1540：fixedString2 &gt;&gt; 0 &#x3D; 1489154074<br />位置 1 索引j 47 索引A 1548：1489154074 &amp; 255 &#x3D; 26</p>
<p>array1[18]<br />前面18个字符全部进行亦或<br />位置 1 索引j 49 索引A 1736：array1.reduce(function(a, b) { return a ^ b; }); &#x3D; 96</p>
<p>array1 完整值如下<br />位置 1 索引j 16 索引A 1932：<br />array1 &#x3D; [64,0.00390625,1,8,127,208,69,63,35,157,100,4,8,26,88,194,176,26,96]<br />array2 由 array1 元素交换位置而来：<br />array2 &#x3D; [array1[0], array1[2], array1[4], array1[6], array1[8], array1[10], array1[12], array1[14], array1[16], array1[18], array1[1], array1[3], array1[5], array1[7], array1[9], array1[11], array1[13], array1[15], array1[17]]<br />array2 完整值如下<br />array2 &#x3D; [64, 1, 127, 69, 35, 100, 8, 88, 176, 96, 0.00390625, 8, 208, 63, 157, 4, 26, 194, 26]</p>
<p><strong>Step4</strong>：将 Step3 得到的 array2 经过转换得到乱码字符串，步骤如下：<br />位置 1 索引j 16 索引A 1932：<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/23.png"
                      alt="image.png"
                ><br />_0x398111.apply(null, array2) &#x3D; ‘@\u0000\u0001\bÐE?#d\u0004\b\u001aXÂ°\u001a&#96;’</p>
<!-- ```javascript
function _0x398111(a, b, c, e, d, t, f, r, n, o, i, _, x, u, s, l, v, h, p) {
    var y = new Uint8Array(19);
    return y[0] = a, y[1] = i, y[2] = b, y[3] = _, y[4] = c, y[5] = x, y[6] = e, y[7] = u, 
    y[8] = d, y[9] = s, y[10] = t, y[11] = l, y[12] = f, y[13] = v, y[14] = r, y[15] = h, 
    y[16] = n, y[17] = p, y[18] = o, String.fromCharCode.apply(null, y);
}
``` -->

<p>位置 1 索引j 16 索引A 1986：<br />_0x25788b.apply(null, [‘ÿ’,‘@\x00\x01\bïwE?#\x9Dd\x074\x89XÂ°\x1Aû’]) &#x3D; ‘-%.,\u000f^\u001aÖ÷°Ìu�^X¦’</p>
<!-- ```javascript
function _0x25788b(a, b) {
    for (var c, e = [], d = 0, t = "", f = 0; f < 256; f++) {
        e[f] = f;
    }
    for (var r = 0; r < 256; r++) {
        d = (d + e[r] + a.charCodeAt(r % a.length)) % 256, c = e[r], e[r] = e[d], e[d] = c;
    }
    var n = 0;
    d = 0;
    for (var o = 0; o < b.length; o++) {
        d = (d + e[n = (n + 1) % 256]) % 256, c = e[n], e[n] = e[d], e[d] = c, t += String.fromCharCode(b.charCodeAt(o) ^ e[(e[n] + e[d]) % 256]);
    }
    return t;
}
``` -->
<p> <br />位置 1 索引j 16 索引A 2038：<br />_0x94582.apply(null, [2,255,’-%.,\u000f^\u001aÖ÷°Ìu�^X¦’]) &#x3D; “\u0002ÿ-%.,\u000f^\u001aÖ÷°Ìu�^X¦”</p>
<!-- ```javascript
function _0x86cb82(a) {
    return String.fromCharCode(a);
}
function _0x94582(a, b, c) {
    return _0x86cb82(a) + _0x86cb82(b) + c;
}
``` -->
<p>至此乱码字符串的流程就结束了。<br>以上缺的函数根据相应的索引根据到代码位置抠出来即可</p>
<p>测试成功，我这里把生成方式封装成api接口<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230308/24.png"
                      alt="image.png"
                ></p>
]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>谷歌Pixel3刷机以及magisk的安装</title>
    <url>/2023/02/11/%E8%B0%B7%E6%AD%8CPixel3%E5%88%B7%E6%9C%BA%E4%BB%A5%E5%8F%8Amagisk%E7%9A%84%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h3 id="一、刷机"><a href="#一、刷机" class="headerlink" title="一、刷机"></a>一、刷机</h3><p>1、首先找到对应自己手机的镜像版本，进行下载，<a class="link"   href="https://developers.google.cn/android/images#blueline" >https://developers.google.cn/android/images#blueline<i class="fas fa-external-link-alt"></i></a><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/01.webp"
                      alt="image.png"
                ><br />新建个文件夹shuaji，下载完解压到刷机里面<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/02.webp"
                      alt="image.png"
                ><br />2、下载刷机工具platform-tools.zip，<a class="link"   href="https://developer.android.com/studio/releases/platform-tools?hl=zh-cn" >https://developer.android.com/studio/releases/platform-tools?hl=zh-cn<i class="fas fa-external-link-alt"></i></a>，根据操作系统下载，链接需要翻墙才能打开，我也把下载链接放出来，可以直接下载<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/03.webp"
                      alt="image.png"
                ></p>
<ul>
<li><a class="link"   href="https://dl.google.com/android/repository/platform-tools_r33.0.3-windows.zip" >下载适用于 Windows 的 SDK Platform-Tools<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="https://dl.google.com/android/repository/platform-tools_r33.0.3-darwin.zip" >下载适用于 Mac 的 SDK Platform-Tools<i class="fas fa-external-link-alt"></i></a></li>
<li><a class="link"   href="https://dl.google.com/android/repository/platform-tools_r33.0.3-linux.zip" >下载适用于 Linux 的 SDK Platform-Tools<i class="fas fa-external-link-alt"></i></a></li>
</ul>
<p>下载完，同样解压到shuaji目录下<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/04.webp"
                      alt="image.png"
                ><br />3、手机关机，关机后 长按住 关键键+音量减键（或者开机界面执行adb reboot bootloader），手机进入bootloader<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/05.webp"
                     
                ><br />4、winfows运行shuaji目录下flash-all.bat，mac则需要运行flash-all.sh文件，整个过程会自动处理完成，伴随着重启几次。<br /> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/06.webp"
                      alt="image.png"
                ><br />过了几分钟后，到这里就刷机成功了<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/07.webp"
                     
                ><br />5.修改手机配置<br />（1）点击English，换成简体中文，然后点击开始，能跳过的则跳过。<br />（2）点击设置，点击关于手机，多次点击版本号，开启开发者模式，在开发者模式开启USB调式。<br />（3）在设置修改手机日期时间为当前日期时间（不弄可能没网）</p>
<h3 id="二、解锁root"><a href="#二、解锁root" class="headerlink" title="二、解锁root"></a>二、解锁root</h3><p>下载Magisk，<a class="link"   href="https://github.com/topjohnwu/Magisk/tags" >https://github.com/topjohnwu/Magisk/tags<i class="fas fa-external-link-alt"></i></a>，我这下载的是v24.0的<br /><br>1.usb连接电脑后，使用命令 adb install Magisk-v24.0.apk 进行安装。<br /><br>2.解压上面shuaji文件目录下的image-xxxx.zip，把boot.img 通过adb push到手机&#x2F;sdcard&#x2F;download&#x2F;<br />命令：adb push boot.img &#x2F;sdcard&#x2F;download&#x2F;<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/08.webp"
                      alt="image.png"
                ><br /><br>3.手机上如下操作magisk，生成 magisk_patched-24000_xxxxx.img 文件<img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/09.webp"
                      alt="image.png"
                ><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/10.webp"
                      alt="image.png"
                ><br />选择刚才上传的boot.img 然后点击开始，接着会在目录下生成带magisk的文件<img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230211/11.webp"
                      alt="image.png"
                ><br />4.把生成的magisk_patched-24000_xxxxx.img 通过 adb pull 到电脑fastboot.exe所在的目录，也就是shuaji目录，命令如下 adb pull &#x2F;sdcard&#x2F;Download&#x2F;magisk_patched-24000_qJQvu.img .<br />5. 执行 adb reboot bootloader 手机进入bootloader<br />6. 执行命令 fastboot flash boot magisk_patched-24000_qJQvu.img 刷magisk fastboot reboot<br />7. 手机点击电源键让手机正常启动，magisk安装成功，root完成</p>
]]></content>
      <tags>
        <tag>刷机</tag>
      </tags>
  </entry>
  <entry>
    <title>ProtoBuf逆向之某公交app</title>
    <url>/2023/02/07/ProtoBuf%E9%80%86%E5%90%91%E4%B9%8B%E6%9F%90%E5%85%AC%E4%BA%A4app/</url>
    <content><![CDATA[<p>上一篇是web端的ProtoBuf逆向，这篇就找了个app的ProtoBuf看看练练手<br />目标app：aHR0cHM6Ly93d3cud2FuZG91amlhLmNvbS9hcHBzLzc0NTAxNjM&#x3D;</p>
<h3 id="抓包分析"><a href="#抓包分析" class="headerlink" title="抓包分析"></a>抓包分析</h3><p>随便搜索一个线路点进去，看到请求头和响应都是加密的<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/01.webp"
                     
                ><br />用jadx分析下请求头的加密参数request<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/02.webp"
                     
                ><br />记住这里其他两个函数，有”&#x2F;protoc.Request.Sequence”，还引用了proto的包<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/03.webp"
                     
                ><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/04.webp"
                     
                ><br />到这可以知道request的值是经过native函数加密后再由base64得到的。<br />用ida打开native so文件，定位encode2函数<br />!<img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/05.webp"
                     
                ><br />可以看到是用了aes_cbc_128加密，那就是需要拿到密钥和iv<br />直接frida hook这两个函数</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">ByteString</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.okhttp.okio.ByteString&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">UtilsClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.shjt.map.tool.Native&quot;</span>);</span><br><span class="line">        <span class="title class_">UtilsClass</span>.<span class="property">encode2</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">a</span>)&#123;</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;入参: &quot;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(a).<span class="title function_">hex</span>());</span><br><span class="line">          <span class="keyword">var</span> value = <span class="variable language_">this</span>.<span class="title function_">encode2</span>(a);</span><br><span class="line">          <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;结果: &#x27;</span>, <span class="title class_">ByteString</span>.<span class="title function_">of</span>(value).<span class="title function_">hex</span>());</span><br><span class="line">          <span class="keyword">return</span> value;    </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_">inline_hook</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">inline_hook</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> libnative_lib_addr = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libnative.so&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (libnative_lib_addr) &#123;</span><br><span class="line">        <span class="keyword">var</span> aes_decrypt_cbc  = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libnative.so&quot;</span>, <span class="string">&quot;_Z15aes_encrypt_cbcPKhjPhPKjiS0_&quot;</span>)</span><br><span class="line">        <span class="keyword">var</span> aes_key_setup = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&#x27;libnative.so&#x27;</span>, <span class="string">&#x27;_Z13aes_key_setupPKhPji&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Native</span>_encode2 = <span class="title class_">Module</span>.<span class="title function_">getExportByName</span>(<span class="string">&#x27;libnative.so&#x27;</span>, <span class="string">&#x27;Java_com_shjt_map_tool_Native_encode2&#x27;</span>);</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(aes_key_setup, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>:<span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================aes_key_setup=================&quot;</span>)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg1:&#x27;</span>,args[<span class="number">0</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg2:&#x27;</span>,args[<span class="number">1</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg3:&#x27;</span>,args[<span class="number">2</span>].<span class="title function_">toInt32</span>())</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>:<span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(aes_decrypt_cbc, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;================aes_decrypt_cbc=================&quot;</span>)</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg1:&#x27;</span>,args[<span class="number">0</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg2:&#x27;</span>,args[<span class="number">1</span>].<span class="title function_">toInt32</span>())</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg3:&#x27;</span>,args[<span class="number">2</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg4:&#x27;</span>,args[<span class="number">3</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg5:&#x27;</span>,args[<span class="number">4</span>].<span class="title function_">toInt32</span>())</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;arg6:&#x27;</span>,args[<span class="number">5</span>].<span class="title function_">readByteArray</span>(<span class="number">16</span>))</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                 <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;retval is :&quot;</span>, retval) </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(main);</span><br></pre></td></tr></table></figure>
<p>结果</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">入参:  0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801</span><br><span class="line">================aes_key_setup=================</span><br><span class="line">arg1:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  2f d3 02 8e 14 a4 5d 1f 8b 6e b0 b2 ad b7 ca af  /.....]..n......</span><br><span class="line">arg2:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  39 39 37 34 20 49 ed f1 ff ff ff ff 00 00 00 00  9974 I..........</span><br><span class="line">arg3: 128</span><br><span class="line">================aes_decrypt_cbc=================</span><br><span class="line">arg1:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  0a 27 0a 18 2f 70 72 6f 74 6f 63 2e 52 65 71 75  .&#x27;../protoc.Requ</span><br><span class="line">arg2: 48</span><br><span class="line">arg3:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  00 6f 6d 2f 61 6e 64 72 6f 69 64 2f 6f 6b 68 74  .om/android/okht</span><br><span class="line">arg4:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  8e 02 d3 2f 1f 5d a4 14 b2 b0 6e 8b af ca b7 ad  .../.]....n.....</span><br><span class="line">arg5: 128</span><br><span class="line">arg6:            0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F  0123456789ABCDEF</span><br><span class="line">00000000  75 4c 8f d5 84 fa cf 62 10 37 6b 2b 72 b0 63 e4  uL.....b.7k+r.c.</span><br><span class="line">retval is : 0x1</span><br><span class="line">结果:  8d456e87c6801a2e18920732f80a1127e7a9548fd9f2f8b45edab8fd629e60bd804287b6fa4bb05fbc8b284ab0eb9783</span><br></pre></td></tr></table></figure>
<p>明文，密文有了<br />iv和密钥就在这几个之间，两两组合试一试</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2f d3 02 8e 14 a4 5d 1f 8b 6e b0 b2 ad b7 ca af</span><br><span class="line">39 39 37 34 20 49 ed f1 ff ff ff ff 00 00 00 00</span><br><span class="line">0a 27 0a 18 2f 70 72 6f 74 6f 63 2e 52 65 71 75</span><br><span class="line">00 6f 6d 2f 61 6e 64 72 6f 69 64 2f 6f 6b 68 74</span><br><span class="line">8e 02 d3 2f 1f 5d a4 14 b2 b0 6e 8b af ca b7 ad</span><br><span class="line">75 4c 8f d5 84 fa cf 62 10 37 6b 2b 72 b0 63 e4</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/06.webp"
                     
                ><br />所以这个aes是标准的算法，没经过魔改的，再把加密后的结果base64一下就是请求的参数了，过程算法知道了，那参数来源呢，是怎么得到的</p>
<h3 id="使用proto"><a href="#使用proto" class="headerlink" title="使用proto"></a>使用proto</h3><p>上面说了用了proto的包，看里面的函数过程，明文是经过了proto协议的才到aes加密<br />那就0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801转成二进制写进文件，再用proto解码器解码看看</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="comment"># hex字符串转二进制</span></span><br><span class="line">d = binascii.a2b_hex(<span class="string">&#x27;0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;req.bin&quot;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(d)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">protoc --decode_raw &lt; req.<span class="built_in">bin</span></span><br></pre></td></tr></table></figure>
<p>解码后得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1 &#123;</span><br><span class="line">  1: &quot;/protoc.Request.Sequence&quot;</span><br><span class="line">  2 &#123;</span><br><span class="line">    1: 1</span><br><span class="line">    2: &quot;90\350\267\257&quot;</span><br><span class="line">    3: 1</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>果不其然，那接下来如何模拟发请求呢<br />经过上一篇后，现在很快就能编写proto文件了</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg22</span> &#123;</span><br><span class="line">  <span class="type">int32</span> field1 = <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> field2 = <span class="number">2</span>;</span><br><span class="line">  <span class="type">int32</span> field3 = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg11</span> &#123;</span><br><span class="line">  <span class="type">string</span> field1 = <span class="number">1</span>;</span><br><span class="line">  Msg22 msg22 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchService</span>&#123;</span><br><span class="line">  Msg11 msg11 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译成python版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protoc --python_out=. ./req.proto</span><br></pre></td></tr></table></figure>
<p>目录下生成了req_pb2.py 拖入项目中，需要使用时就调用即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> req_pb2 <span class="keyword">as</span> pb</span><br><span class="line"></span><br><span class="line"><span class="comment"># hex字符串转二进制</span></span><br><span class="line"><span class="comment"># d = binascii.a2b_hex(&#x27;0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801&#x27;)</span></span><br><span class="line"><span class="comment"># with open(&quot;req.bin&quot;, &#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(d)</span></span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService.SearchRequest()  <span class="comment"># 实例化对象</span></span><br><span class="line">search_request.msg11.field1 = <span class="string">&#x27;/protoc.Request.Sequence&#x27;</span></span><br><span class="line">search_request.msg11.msg22.field1 = <span class="number">1</span></span><br><span class="line">search_request.msg11.msg22.field2 = <span class="string">&#x27;90路&#x27;</span></span><br><span class="line">search_request.msg11.msg22.field3 = <span class="number">1</span></span><br><span class="line"><span class="comment"># 序列化请求数据</span></span><br><span class="line">serialize_data = search_request.SerializeToString()</span><br><span class="line"><span class="comment"># print(serialize_data)</span></span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;my_req.bin&#x27;</span>, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(serialize_data)</span><br></pre></td></tr></table></figure>
<p>运行后生成my_req.bin文件，跟原来的对比一下<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/07.webp"
                     
                ><br />发送请求</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> req_pb2 <span class="keyword">as</span> pb</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(pad(ori, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> unpad(aes.decrypt(ori), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hex字符串转二进制</span></span><br><span class="line"><span class="comment"># d = binascii.a2b_hex(&#x27;0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801&#x27;)</span></span><br><span class="line"><span class="comment"># with open(&quot;req.bin&quot;, &#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(d)</span></span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService.SearchRequest()  <span class="comment"># 实例化对象</span></span><br><span class="line">search_request.msg1.field1 = <span class="string">&#x27;/protoc.Request.Sequence&#x27;</span></span><br><span class="line">search_request.msg1.msg2.field1 = <span class="number">1</span></span><br><span class="line">search_request.msg1.msg2.field2 = <span class="string">&#x27;90路&#x27;</span></span><br><span class="line">search_request.msg1.msg2.field3 = <span class="number">1</span></span><br><span class="line"><span class="comment"># 序列化请求数据</span></span><br><span class="line">serialize_data = search_request.SerializeToString()</span><br><span class="line"><span class="comment"># print(serialize_data)</span></span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="comment"># with open(&#x27;my_req.bin&#x27;, mode=&quot;wb&quot;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(serialize_data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对序列化后的数据aes加密</span></span><br><span class="line">aes_data = aes_encry(serialize_data)</span><br><span class="line"><span class="comment"># b64 aes加密数据</span></span><br><span class="line">b64_aes_data = base64.b64encode(aes_data)</span><br><span class="line"><span class="comment"># 请求体</span></span><br><span class="line">post_data = <span class="string">&#x27;request=&#x27;</span> + quote(b64_aes_data.decode(), safe=<span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;%0A&#x27;</span></span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json,application/xml,application/xhtml+xml,text/html;q=0.9,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; U; Android 6.0; zh-cn; Nexus 6P Build/MDA89D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;lbs.jt.sh.cn:8082&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://lbs.jt.sh.cn:8082/app/rls/monitor&quot;</span></span><br><span class="line">response = requests.post(url, headers=header, data=post_data)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<p>运行后响应内容跟抓包的一样是加密的，用aes尝试解密<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/08.webp"
                     
                ><br />解完后很像protobuf格式，写进bin文件，再用proto解码看看</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">decry_data = aes_decry(response.content)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;resp.bin&#x27;</span>, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(decry_data)</span><br></pre></td></tr></table></figure>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">D:\pythonProject\xxxx&gt;protoc --decode_raw &lt; resp.bin</span><br><span class="line"><span class="number">1</span> &#123;</span><br><span class="line">  <span class="number">1</span>: <span class="string">&quot;/protoc.Response.Dispatch&quot;</span></span><br><span class="line">  <span class="number">2</span> &#123;</span><br><span class="line">    <span class="number">1</span> &#123;</span><br><span class="line">      <span class="number">1</span>: <span class="string">&quot;90\350\267\257&quot;</span></span><br><span class="line">      <span class="number">2</span> &#123;</span><br><span class="line">        <span class="number">1</span> &#123;</span><br><span class="line">          <span class="number">1</span>: <span class="string">&quot;05:00&quot;</span></span><br><span class="line">          <span class="number">2</span>: <span class="string">&quot;23:41&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\235\226\345\256\207\345\215\227\350\267\257\346\216\247\346\261\237\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\216\247\346\261\237\346\226\260\346\235\221&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\273\204\345\205\264\350\267\257\345\233\275\346\235\203\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\273\204\345\205\264\350\267\257\345\233\275\351\241\272\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\272\224\350\247\222\345\234\272(\347\277\224\346\256\267\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\233\275\345\222\214\350\267\257\346\224\277\347\253\213\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\201\222\344\273\201\350\267\257\346\270\205\346\272\220\347\216\257\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\270\226\347\225\214\350\267\257\345\233\275\345\222\214\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\270\226\347\225\214\350\267\257\346\260\221\344\272\254\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\227\270\346\256\267\350\267\257\346\256\267\350\241\214\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\227\270\346\256\267\350\267\257\345\206\233\345\267\245\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\206\233\345\267\245\350\267\257\351\227\270\345\214\227\347\224\265\345\216\202&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\225\277\350\210\252\351\224\232\345\234\260&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\206\233\345\267\245\350\267\257\351\231\210\345\256\266\345\256\205&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\215\227\345\274\240\345\215\216\346\265\234(\351\200\270\344\273\231\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\214\227\345\274\240\345\215\216\346\265\234(\351\200\270\344\273\231\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\346\273\250\350\267\257\345\220\214\346\265\216\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\260\270\346\270\205\350\267\257\346\267\236\345\256\235\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\260\270\346\270\205\350\267\257\346\260\264\344\272\247\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\217\214\345\237\216\350\267\257\346\260\270\346\270\205\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\345\256\235\350\267\257\345\217\214\345\237\216\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\345\256\235\350\267\257\346\267\236\351\235\222\350\267\257&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="number">2</span> &#123;</span><br><span class="line">        <span class="number">1</span> &#123;</span><br><span class="line">          <span class="number">1</span>: <span class="string">&quot;05:00&quot;</span></span><br><span class="line">          <span class="number">2</span>: <span class="string">&quot;23:10&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\345\256\235\350\267\257\346\267\236\351\235\222\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\217\214\345\237\216\350\267\257\346\267\236\345\256\235\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\260\270\346\270\205\350\267\257\345\217\214\345\237\216\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\260\270\346\270\205\350\267\257\346\260\264\344\272\247\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\260\270\346\270\205\350\267\257\346\267\236\345\256\235\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\346\273\250\350\267\257\345\220\214\346\263\260\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\225\277\345\276\201\346\226\260\346\235\221&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\267\236\346\273\250\350\267\257\346\267\236\346\273\250\346\224\257\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\214\227\345\274\240\345\215\216\346\265\234(\351\200\270\344\273\231\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\215\227\345\274\240\345\215\216\346\265\234(\351\200\270\344\273\231\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\206\233\345\267\245\350\267\257\351\231\210\345\256\266\345\256\205&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\225\277\350\210\252\351\224\232\345\234\260&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\206\233\345\267\245\350\267\257\351\227\270\345\214\227\347\224\265\345\216\202&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\227\270\346\256\267\350\267\257\345\206\233\345\267\245\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\227\270\346\256\267\350\267\257\346\256\267\350\241\214\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\270\226\347\225\214\350\267\257\346\260\221\344\272\254\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\270\226\347\225\214\350\267\257\345\233\275\345\222\214\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\201\222\344\273\201\350\267\257\346\270\205\346\272\220\347\216\257\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\225\277\346\265\267\350\267\257\351\273\221\345\261\261\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\345\233\275\345\222\214\350\267\257\346\224\277\351\200\232\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\272\224\350\247\222\345\234\272(\347\277\224\346\256\267\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\344\272\224\350\247\222\345\234\272(\351\273\204\345\205\264\350\267\257)&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\273\204\345\205\264\350\267\257\345\233\275\351\241\272\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\273\204\345\205\264\350\267\257\345\233\275\346\235\203\350\267\257&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\346\216\247\346\261\237\346\226\260\346\235\221&quot;</span></span><br><span class="line">        <span class="number">2</span>: <span class="string">&quot;\351\235\226\345\256\207\345\215\227\350\267\257\346\216\247\346\261\237\350\267\257&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> &#123;</span><br><span class="line">      <span class="number">1</span>: <span class="string">&quot;\346\262\252A-30515D&quot;</span></span><br><span class="line">      <span class="number">2</span>: <span class="string">&quot;15:26&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> &#123;</span><br><span class="line">      <span class="number">1</span>: <span class="string">&quot;\346\262\252A-07660D&quot;</span></span><br><span class="line">      <span class="number">2</span>: <span class="string">&quot;15:33&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="number">2</span> &#123;</span><br><span class="line">      <span class="number">1</span>: <span class="string">&quot;\346\262\252A-33990D&quot;</span></span><br><span class="line">      <span class="number">2</span>: <span class="string">&quot;15:41&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编写proto文件并编译</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment">// 定义proto的版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg1</span> &#123;</span><br><span class="line">  <span class="type">string</span> field1 = <span class="number">1</span>;</span><br><span class="line">  Msg2 msg2 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg2</span> &#123;</span><br><span class="line">  <span class="keyword">repeated</span> Msg3 msg3 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Msg4 msg4 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg3</span> &#123;</span><br><span class="line">  <span class="type">string</span> field1 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> Msg5 msg5 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg4</span> &#123;</span><br><span class="line">  <span class="type">string</span> field1 = <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> field2 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg5</span> &#123;</span><br><span class="line">  Msg6 msg6 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">repeated</span> <span class="type">string</span> field1 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">Msg6</span> &#123;</span><br><span class="line">  <span class="type">string</span> field1 = <span class="number">1</span>;</span><br><span class="line">  <span class="type">string</span> field2 = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchResponse</span> &#123;</span><br><span class="line">  Msg1 msg1 = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/09.webp"
                     
                ><br />完整代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">from</span> google.protobuf.json_format <span class="keyword">import</span> MessageToJson</span><br><span class="line"><span class="keyword">import</span> req_pb2 <span class="keyword">as</span> pb</span><br><span class="line"><span class="keyword">import</span> resp_pb2 <span class="keyword">as</span> pb2</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(pad(ori, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> unpad(aes.decrypt(ori), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># hex字符串转二进制</span></span><br><span class="line"><span class="comment"># d = binascii.a2b_hex(&#x27;0a270a182f70726f746f632e526571756573742e53657175656e6365120b080112053930e8b7af1801&#x27;)</span></span><br><span class="line"><span class="comment"># with open(&quot;req.bin&quot;, &#x27;wb&#x27;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(d)</span></span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService()  <span class="comment"># 实例化对象</span></span><br><span class="line">search_request.msg11.field1 = <span class="string">&#x27;/protoc.Request.Sequence&#x27;</span></span><br><span class="line">search_request.msg11.msg22.field1 = <span class="number">1</span></span><br><span class="line">search_request.msg11.msg22.field2 = <span class="string">&#x27;90路&#x27;</span></span><br><span class="line">search_request.msg11.msg22.field3 = <span class="number">1</span></span><br><span class="line"><span class="comment"># 序列化请求数据</span></span><br><span class="line">serialize_data = search_request.SerializeToString()</span><br><span class="line"><span class="comment"># print(serialize_data)</span></span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="comment"># with open(&#x27;my_req.bin&#x27;, mode=&quot;wb&quot;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(serialize_data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 对序列化后的数据aes加密</span></span><br><span class="line">aes_data = aes_encry(serialize_data)</span><br><span class="line"><span class="comment"># b64 aes加密数据</span></span><br><span class="line">b64_aes_data = base64.b64encode(aes_data)</span><br><span class="line"><span class="comment"># 请求体</span></span><br><span class="line">post_data = <span class="string">&#x27;request=&#x27;</span> + quote(b64_aes_data.decode(), safe=<span class="string">&#x27;&#x27;</span>)+<span class="string">&#x27;%0A&#x27;</span></span><br><span class="line"></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json,application/xml,application/xhtml+xml,text/html;q=0.9,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; U; Android 6.0; zh-cn; Nexus 6P Build/MDA89D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;lbs.jt.sh.cn:8082&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;http://lbs.jt.sh.cn:8082/app/rls/monitor&quot;</span></span><br><span class="line">response = requests.post(url, headers=header, data=post_data)</span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"></span><br><span class="line">decry_data = aes_decry(response.content)</span><br><span class="line"><span class="comment"># with open(&#x27;resp.bin&#x27;, mode=&quot;wb&quot;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(decry_data)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用proto编写文件</span></span><br><span class="line">root = pb2.SearchResponse()</span><br><span class="line">root.ParseFromString(decry_data)</span><br><span class="line">data = json.loads(MessageToJson(root))</span><br><span class="line"><span class="built_in">print</span>(data)</span><br></pre></td></tr></table></figure>

<h3 id="使用blackboxprotobuf"><a href="#使用blackboxprotobuf" class="headerlink" title="使用blackboxprotobuf"></a>使用blackboxprotobuf</h3><p>还有一种更快的方式，使用blackboxprotobuf<br />读取请求的二进制文件，通过blackboxprotobuf转为json，直接把关键词修改掉再转回去<br />像响应内容的key只是一个符号，可以通过value大概知道它的含义就行了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> blackboxprotobuf</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> aes.encrypt(pad(ori, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decry</span>(<span class="params">ori</span>):</span><br><span class="line">    key = <span class="string">&#x27;2fd3028e14a45d1f8b6eb0b2adb7caaf&#x27;</span></span><br><span class="line">    iv = <span class="string">&#x27;754c8fd584facf6210376b2b72b063e4&#x27;</span></span><br><span class="line">    aes = AES.new(binascii.a2b_hex(key), AES.MODE_CBC, binascii.a2b_hex(iv))</span><br><span class="line">    <span class="keyword">return</span> unpad(aes.decrypt(ori), <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&quot;req.bin&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    data = fp.read()</span><br><span class="line">    message, typedef = blackboxprotobuf.protobuf_to_json(data, message_type=<span class="literal">None</span>)</span><br><span class="line">    bus_data = blackboxprotobuf.decode_message(data, message_type=<span class="literal">None</span>)[<span class="number">0</span>]</span><br><span class="line">    <span class="built_in">print</span>(message)</span><br><span class="line">    <span class="built_in">print</span>(bus_data)</span><br><span class="line">    <span class="built_in">print</span>(typedef)</span><br><span class="line">    bus_data[<span class="string">&#x27;1&#x27;</span>][<span class="string">&#x27;2&#x27;</span>][<span class="string">&#x27;2&#x27;</span>] = <span class="built_in">bytes</span>(<span class="string">&#x27;90路&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">serializedata = blackboxprotobuf.encode_message(bus_data, message_type=typedef)</span><br><span class="line"><span class="built_in">print</span>(serializedata)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 对序列化后的数据aes加密</span></span><br><span class="line">aesdata = aes_encry(serializedata)</span><br><span class="line"><span class="comment"># b64 aes加密数据</span></span><br><span class="line">b64_aes_data = base64.b64encode(aesdata)</span><br><span class="line"><span class="comment"># 抓取</span></span><br><span class="line">postdata = <span class="string">&#x27;request=&#x27;</span> + quote(b64_aes_data.decode(), safe=<span class="string">&#x27;&#x27;</span>) + <span class="string">&#x27;%0A&#x27;</span></span><br><span class="line">header = &#123;</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span>: <span class="string">&#x27;application/json,application/xml,application/xhtml+xml,text/html;q=0.9,image/webp,*/*;q=0.8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;zh-CN,zh&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded; charset=utf-8&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Linux; U; Android 6.0; zh-cn; Nexus 6P Build/MDA89D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;lbs.jt.sh.cn:8082&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(url=<span class="string">&#x27;http://lbs.jt.sh.cn:8082/app/rls/monitor&#x27;</span>, data=postdata, headers=header)</span><br><span class="line">decry_data = aes_decry(response.content)</span><br><span class="line"></span><br><span class="line">json_data, type_data = blackboxprotobuf.protobuf_to_json(decry_data, message_type=<span class="literal">None</span>)</span><br><span class="line"><span class="built_in">print</span>(json_data)</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230207/10.webp"
                     
                ></p>
]]></content>
      <tags>
        <tag>安卓逆向</tag>
        <tag>protobuf</tag>
      </tags>
  </entry>
  <entry>
    <title>ProtoBuf分析以及某方数据逆向</title>
    <url>/2023/02/01/ProtoBuf%E5%88%86%E6%9E%90%E4%BB%A5%E5%8F%8A%E6%9F%90%E6%96%B9%E6%95%B0%E6%8D%AE%E9%80%86%E5%90%91/</url>
    <content><![CDATA[<h3 id="什么是protobuf"><a href="#什么是protobuf" class="headerlink" title="什么是protobuf"></a>什么是protobuf</h3><p>一拿到网站，F12查看是否有相关数据的请求接口<br />请求体是这样的<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/01.webp"
                     
                ><br />请求头的类型也非常见的<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/02.webp"
                     
                ></p>
<ul>
<li>application&#x2F;json： JSON数据格式</li>
<li>application&#x2F;octet-stream ： 二进制流数据</li>
<li>application&#x2F;x-www-form-urlencoded ： 中默认的encType，form表单数据被编码为key&#x2F;value格式发送到服务器（表单默认的提交数据的格式）</li>
<li>multipart&#x2F;form-data ： 需要在表单中进行文件上传时，就需要使用该格式</li>
</ul>
<p>通过查询知道这是protobuf<br />参考文章：<a class="link"   href="https://blog.csdn.net/dideng7039/article/details/101869819" >https://blog.csdn.net/dideng7039/article/details/101869819<i class="fas fa-external-link-alt"></i></a><br />总结在图下了<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/03.webp"
                     
                ></p>
<h3 id="那如何使用protobuf？"><a href="#那如何使用protobuf？" class="headerlink" title="那如何使用protobuf？"></a>那如何使用protobuf？</h3><p>开发者需要先编写proto文件，在proto文件中编写预期的数据类型、数据字段、默认值等<br />然后，通过编译器生成，编程语言对应的开发包！开发时调开发包中的对应方法进行序列化和反序列化。<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/04.webp"
                     
                ><br /><br>所以请求的时候需要参数是序列化的字节序列，对接收到的返回值进行反序列化<br />而要实现序列化，就必须要有开发包，可是开发包是js版本的。而开发包是由proto编译而来，只要能拿到proto文件，就可以编译成任意编程的语言版本。<br />那就是需要通过编译好的包反编译出proto，再编译为python版本的</p>
<p>这里先写一个简单proto，在编译成js版本，看看里面大概的结构长什么样<br />下载编译器：<a class="link"   href="https://github.com/protocolbuffers/protobuf/releases/" >https://github.com/protocolbuffers/protobuf/releases/<i class="fas fa-external-link-alt"></i></a><br />解压后把bin目录路径添加到环境变量，就可以全局使用<br />注意，下载低于3.21.0 的proto版本，因为原项目已将它独立出来，下载最新版本的protoc，运行js_out会缺少插件<br />proto除了一些基础字段，还有一些特殊字段</p>
<table>
<thead>
<tr>
<th><strong>英文</strong></th>
<th><strong>中文</strong></th>
<th><strong>备注</strong></th>
</tr>
</thead>
<tbody><tr>
<td>enum</td>
<td>枚举(数字从零开始) 作用是为字段指定某”预定义值序列”</td>
<td>enum Type {DEFAULT &#x3D; 0;success &#x3D; 1; fail&#x3D; -1;}</td>
</tr>
<tr>
<td>message</td>
<td>消息体</td>
<td>message Student{}</td>
</tr>
<tr>
<td>repeated</td>
<td>数组&#x2F;集合</td>
<td>repeated Student student &#x3D; 1</td>
</tr>
<tr>
<td>import</td>
<td>导入定义</td>
<td>import “protos&#x2F;other_protos.proto”</td>
</tr>
<tr>
<td>&#x2F;&#x2F;</td>
<td>注释</td>
<td>&#x2F;&#x2F;用于注释</td>
</tr>
<tr>
<td>extend</td>
<td>扩展</td>
<td>extend Student {}</td>
</tr>
<tr>
<td>package</td>
<td>包名</td>
<td>相当于命名空间，用来防止不同消息类型的明明冲突</td>
</tr>
</tbody></table>
<p>现在写一个简单的proto文件</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment">// 定义proto的版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">enum </span><span class="title class_">Gender</span>&#123;</span><br><span class="line">  boy=<span class="number">0</span>;</span><br><span class="line">  girl=<span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">enum </span><span class="title class_">Score</span>&#123;</span><br><span class="line">  DEFAULT = <span class="number">0</span>;</span><br><span class="line">  success = <span class="number">1</span>; <span class="comment">// 及格</span></span><br><span class="line">  fail = -<span class="number">1</span>; <span class="comment">// 不及格</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">message </span><span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="type">string</span> name = <span class="number">1</span>; <span class="comment">// 姓名</span></span><br><span class="line">  <span class="type">int32</span> age = <span class="number">2</span>; <span class="comment">// 年龄</span></span><br><span class="line">  Gender gender = <span class="number">3</span>; <span class="comment">//性别</span></span><br><span class="line">  <span class="keyword">message </span><span class="title class_">Subject</span> &#123;</span><br><span class="line">    <span class="type">string</span> name = <span class="number">1</span>; <span class="comment">// 学科名称</span></span><br><span class="line">    Score score = <span class="number">2</span>; <span class="comment">// 分数</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">repeated</span> Subject subject = <span class="number">4</span>; <span class="comment">// 学科</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译为JS包</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">protoc --js_out=. .\test.proto3</span><br><span class="line">protoc --js_out=import_style=commonjs,binary:. test.proto</span><br></pre></td></tr></table></figure>
<p>两条语句都可以，第一条会拆分成多个文件，第二条是合并成一个，推荐使用第二条<br />头部就能看到定义好的几个大的对象<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/05.webp"
                     
                ><br />可以大概看下代码，截一段比较重要的</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Serializes the given message to binary data (in protobuf wire</span></span><br><span class="line"><span class="comment"> * format), writing to the given BinaryWriter.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">!proto.Student</span>&#125; <span class="variable">message</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> &#123;<span class="type">!jspb.BinaryWriter</span>&#125; <span class="variable">writer</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@suppress</span> &#123;<span class="type">unusedLocalVariables</span>&#125; f is only used for nested messages</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">proto.<span class="property">Student</span>.<span class="property">serializeBinaryToWriter</span> = <span class="keyword">function</span>(<span class="params">message, writer</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> f = <span class="literal">undefined</span>;</span><br><span class="line">  f = message.<span class="title function_">getName</span>();</span><br><span class="line">  <span class="keyword">if</span> (f.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    writer.<span class="title function_">writeString</span>(</span><br><span class="line">      <span class="number">1</span>,</span><br><span class="line">      f</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  f = message.<span class="title function_">getAge</span>();</span><br><span class="line">  <span class="keyword">if</span> (f !== <span class="number">0</span>) &#123;</span><br><span class="line">    writer.<span class="title function_">writeInt32</span>(</span><br><span class="line">      <span class="number">2</span>,</span><br><span class="line">      f</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  f = message.<span class="title function_">getGender</span>();</span><br><span class="line">  <span class="keyword">if</span> (f !== <span class="number">0.0</span>) &#123;</span><br><span class="line">    writer.<span class="title function_">writeEnum</span>(</span><br><span class="line">      <span class="number">3</span>,</span><br><span class="line">      f</span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">  f = message.<span class="title function_">getSubjectList</span>();</span><br><span class="line">  <span class="keyword">if</span> (f.<span class="property">length</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    writer.<span class="title function_">writeRepeatedMessage</span>(</span><br><span class="line">      <span class="number">4</span>,</span><br><span class="line">      f,</span><br><span class="line">      proto.<span class="property">Student</span>.<span class="property">Subject</span>.<span class="property">serializeBinaryToWriter</span></span><br><span class="line">    );</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这一段序列化的代码中出现了如下的方法名：</p>
<blockquote>
<p>getName, writeString<br>getAge, writeInt32<br>getGender, writeEnum<br>getSubjectList, writeRepeatedMessage</p>
</blockquote>
<p>这一整个判断，这意味 Student中定义了四个数据变量， 序号为1， 2，3，4，而数据类型和变量名可以根据其调用的方法推出</p>
<blockquote>
<p>序号为1的数据类型为String，变量名为name<br>序号为2的数据类型为Int32，变量名为age<br>序号为3的数据类型为Enum， 变量名为gender<br>序号为4的数据类型为Message，变量名为subject，Repeated下面讲</p>
</blockquote>
<p>字符串和整数型一看就明了，不做过多解释，下面了解<font color="red">Message</font>和<font color="red">Enum</font><br /><strong>Message是什么数据类型？</strong><br />简单的理解，可以把message看作是一个类，在其中定义的变量就是类属性<br />在序号为4的subject判断中有这样一行代码</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proto.Student.Subject.serializeBinaryToWriter</span><br></pre></td></tr></table></figure>
<p>再来看看Student的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">proto.Student.serializeBinaryToWriter</span><br></pre></td></tr></table></figure>
<p>到这里可知，Subject定义在Student里面且类型是Message<br />在定义序号为4的数据时，数据类型就是Subject，并且是可重复的！<br />所以才会出现这样一个方法writeRepeatedMessage，并且严格来说，序号为4的数据是自定义的Message数据类型，且是可重复的<br /><font color="red">Message</font>类型的Subject被<font color="red">repeated</font>修饰，即Subject是一个包含多个Subject实例的数组<br /><strong>Enum是什么数据类型？</strong><br />枚举类型，在值为限定的情况下，比如性别除了男就是女。可以理解为单选框，这里还有个注意的，枚举类型。<font color="red">必须要有为0的默认选项</font><br />总而言之呢，看见<font color="red">writeEnum</font>就知道这个数据为<font color="red">Enum类型</font><br /><font color="red">repeated</font>也可以修饰<font color="red">Enum</font>，其对应的JS写操作的方法为<font color="red">writePackedEnum</font><br />被repeated修饰的enum类型，<font color="red">则好似的多选框，至少选择一个，可选择多个</font><br /><strong>小结一下：</strong><br /><font color="red">被repeated修饰的message类型的数据，看作是一个包含任意个某message类型数据的数组</font><br /><font color="red">被repeated修饰的enum类型的数据，看作是一个包含任意个整数类型数据的整型数组</font></p>
<h3 id="调试JS反写proto"><a href="#调试JS反写proto" class="headerlink" title="调试JS反写proto"></a>调试JS反写proto</h3><p>目标网站：aHR0cHM6Ly9zLndhbmZhbmdkYXRhLmNvbS5jbi9wYXBlcj9xPXB5dGhvbg&#x3D;&#x3D;<br />将接口的请求地址复制 &#x2F;SearchService.SearchService&#x2F;search ，打 XHR&#x2F;fetch 断点<br />断住后查看堆栈，有SearchService跟进去打断点看看<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/06.webp"
                     
                ><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/07.webp"
                     
                ><br />看下这些方法的命名，序列化（serialize）、反序列化（deserialize），基本断定就在这个js文件里，但是这个js有几万行代码，不可能仔细去看也没必要。<br />看到明显的prototype字样，直接搜proto的特征</p>
<blockquote>
<p><strong><font color="red">toObject 将获取到的数据转成结构化数据</font></strong><br><strong><font color="red">deserializeBinary 二进制数据转换成数组结构（反序列化 | 获取到的数据需要Uint8Array转成二进制）</font></strong><br><strong><font color="red">deserializeBinaryFromReader 根据规则，将二进制数据转换成数组结构</font></strong><br><strong><font color="red">serializeBinary 将数据转成二进制（序列化）</font></strong><br><strong><font color="red">serializeBinaryToWriter 根据规则，将数据转换成二进制数据（序列化）</font></strong></p>
</blockquote>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/08.webp"
                     
                ><br />可以肯定就是proto了<br />一步步跟进后，到序列化发包的位置<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/09.webp"
                     
                ><br />在这里，直接就可以看出其基本结构</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line"><span class="keyword">message </span><span class="title class_">SearchService</span> &#123;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>继续调试。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/10.webp"
                     
                ><br />这里可以看出SearchRequest定义了两个变量，分别是序号为1的message类型的CommonRequest和序号为2的enum类型的InterfaceType。<br />根据SearchService.CommonRequest可知，CommonRequest定义在SearchService中<br />所以，proto文件现在是这样的：</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment">// 定义proto的版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchService</span> &#123;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">    CommonRequest commonRequest = <span class="number">1</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">    InterfaceType interfaceType = <span class="number">2</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">CommonRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">InterfaceType</span>&#123;</span><br><span class="line">    DEFAULT = <span class="number">0</span>;  <span class="comment">// 定义了什么不知道，但是enum必须有一个值就是0</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">关于变量名是什么，这个其实不重要</font><br />继续往下调试，进入到了CommonRequest<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/11.webp"
                     
                ><br />根据方法名，直接就可以反写出CommonRequest</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">  <span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">    CommonRequest commonRequest = <span class="number">1</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">    InterfaceType interfaceType = <span class="number">2</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">CommonRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> searchType = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> searchWord = <span class="number">2</span>;</span><br><span class="line">    SearchSort searchSort = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">repeated</span> Second second = <span class="number">4</span>;</span><br><span class="line">    <span class="type">int32</span> currentPage = <span class="number">5</span>;</span><br><span class="line">    <span class="type">int32</span> pageSize = <span class="number">6</span>;</span><br><span class="line">    SearchScope searchScope = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">repeated</span> SearchFilter searchFilter = <span class="number">8</span>;</span><br><span class="line">    <span class="type">bool</span> languageExpand = <span class="number">9</span>;</span><br><span class="line">    <span class="type">bool</span> topicExpand = <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">SearchSort</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">Second</span> &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">InterfaceType</span>&#123;</span><br><span class="line">    TypeDefault = <span class="number">0</span>;  <span class="comment">// 定义了什么不知道，但是enum必须有一个值就是0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">SearchScope</span>&#123;</span><br><span class="line">    ScopeDefault = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">SearchFilter</span> &#123;</span><br><span class="line">      FilterDefault = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SearchSort和Second都是在SearchService定义的，Ctrl + F搜索<br />SearchService.SearchSort.serializeBinaryToWriter<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/12.webp"
                     
                ><br />SearchService.Second.serializeBinaryToWriter<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/13.webp"
                     
                ><br />补齐字段，请求接口的proto文件就算写完了</p>
<figure class="highlight protobuf"><table><tr><td class="code"><pre><span class="line">syntax = <span class="string">&quot;proto3&quot;</span>; <span class="comment">// 定义proto的版本</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">message </span><span class="title class_">SearchService</span> &#123;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">SearchRequest</span> &#123;</span><br><span class="line">    CommonRequest commonRequest = <span class="number">1</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">    InterfaceType interfaceType = <span class="number">2</span>; <span class="comment">// 任意变量名</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">CommonRequest</span> &#123;</span><br><span class="line">    <span class="type">string</span> searchType = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> searchWord = <span class="number">2</span>;</span><br><span class="line">    SearchSort searchSort = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">repeated</span> Second second = <span class="number">4</span>;</span><br><span class="line">    <span class="type">int32</span> currentPage = <span class="number">5</span>;</span><br><span class="line">    <span class="type">int32</span> pageSize = <span class="number">6</span>;</span><br><span class="line">    SearchScope searchScope = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">repeated</span> SearchFilter searchFilter = <span class="number">8</span>;</span><br><span class="line">    <span class="type">bool</span> languageExpand = <span class="number">9</span>;</span><br><span class="line">    <span class="type">bool</span> topicExpand = <span class="number">10</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">SearchSort</span> &#123;</span><br><span class="line">    <span class="type">string</span> field = <span class="number">1</span>;</span><br><span class="line">    Order order = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">enum </span><span class="title class_">Order</span> &#123;</span><br><span class="line">      OrderDefault = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">message </span><span class="title class_">Second</span> &#123;</span><br><span class="line">    <span class="type">string</span> field = <span class="number">1</span>;</span><br><span class="line">    <span class="type">string</span> value = <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">InterfaceType</span>&#123;</span><br><span class="line">    TypeDefault = <span class="number">0</span>;  <span class="comment">// 定义了什么不知道，但是enum必须有一个值就是0</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">SearchScope</span>&#123;</span><br><span class="line">    ScopeDefault = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">enum </span><span class="title class_">SearchFilter</span> &#123;</span><br><span class="line">    FilterDefault = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><font color="red">对于所有的enum枚举类，至少填充一个默认值0，且变量名唯一</font><br />有的情况，枚举类含有哪些字段，可以在代码中直接看到，就照抄写进去。<br />看不到的，给个唯一变量名，默认值为0即可<br />现在还差一个源数据，即我们需要知道待编译的源数据是什么样子的？<br />使用fiddler进行抓包查看请求参数<br />抓到包后查看HexView，黑色部分就是请求体，里面也可以看到我们搜素的关键词python<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/14.webp"
                     
                ><br />选中，右键保存为字节文件也就是bin后缀，这里要注意，前5个字节表示请求体的长度，从第6个字节开始到结束刚好就是0x1A<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/15.webp"
                     
                ><br /><font color="red">字节数据是可以通过protoc编译器解码出来的</font></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&gt;protoc --decode_raw &lt; get_req.bin</span><br><span class="line">1 &#123;</span><br><span class="line">  1: &quot;paper&quot;</span><br><span class="line">  2: &quot;python&quot;</span><br><span class="line">  5: 2</span><br><span class="line">  6: 20</span><br><span class="line">  8: &quot;\000&quot;</span><br><span class="line">&#125;</span><br><span class="line">2: 1</span><br></pre></td></tr></table></figure>
<p>与上面编写好的proto文件进行对比<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/16.webp"
                     
                ><br />像有些没包含到的字段，是请求的时候页面没做一些条件筛选，就没触发到某些字段<br />实际传输时，简单的看，键就是proto中定义的序号，这就是之前提到的 变量名是什么根本不重要，变量名只是方便开发者开发时便于理解与调用。（传输一个数字远比传输一个字符串更有效率）<br />完全还原proto文件是不需要的，构造出这个请求参数，获取这个接口的响应内容就可以了</p>
<h3 id="实现请求"><a href="#实现请求" class="headerlink" title="实现请求"></a>实现请求</h3><p>编译proto为python包，构建参数，序列化参数，发送请求</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">protoc --python_out=. ./search.proto</span><br></pre></td></tr></table></figure>
<p>目录下生成了search_pb2.py 拖入项目中，需要使用时就调用即可</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> search_pb2 <span class="keyword">as</span> pb  <span class="comment"># 导入包</span></span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService.SearchRequest()  <span class="comment"># 实例化对象</span></span><br><span class="line"><span class="comment"># 按上面解析数据，按照对应的属性设置值</span></span><br><span class="line"><span class="comment"># 字符串，数字型的都是直接赋值</span></span><br><span class="line">search_request.commonRequest.searchType = <span class="string">&#x27;paper&#x27;</span></span><br><span class="line">search_request.commonRequest.searchWord = <span class="string">&#x27;python&#x27;</span></span><br><span class="line">search_request.commonRequest.currentPage = <span class="number">2</span></span><br><span class="line">search_request.commonRequest.pageSize = <span class="number">20</span></span><br><span class="line"><span class="comment"># repeated修饰的messsage类型和enum类型，则需要稍微多几个步骤</span></span><br><span class="line">search_request.commonRequest.searchFilter.append(<span class="number">0</span>)</span><br><span class="line">search_request.interfaceType = <span class="number">1</span></span><br><span class="line">form_data = search_request.SerializeToString()</span><br><span class="line"><span class="built_in">print</span>(form_data)</span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;me.bin&#x27;</span>, mode=<span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(form_data)</span><br><span class="line"><span class="built_in">print</span>(search_request.SerializeToString().decode())</span><br></pre></td></tr></table></figure>
<p>至此，请求参数的序列化已经是完成了<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/17.webp"
                     
                ><br />发送请求完整代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> search_pb2 <span class="keyword">as</span> pb  <span class="comment"># 导入包</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService.SearchRequest()  <span class="comment"># 实例化对象</span></span><br><span class="line"><span class="comment"># 按上面解析数据，按照对应的属性设置值</span></span><br><span class="line"><span class="comment"># 字符串，数字型的都是直接赋值</span></span><br><span class="line">search_request.commonRequest.searchType = <span class="string">&#x27;paper&#x27;</span></span><br><span class="line">search_request.commonRequest.searchWord = <span class="string">&#x27;python&#x27;</span></span><br><span class="line">search_request.commonRequest.currentPage = <span class="number">2</span></span><br><span class="line">search_request.commonRequest.pageSize = <span class="number">20</span></span><br><span class="line"><span class="comment"># repeated修饰的messsage类型和enum类型，则需要稍微多几个步骤</span></span><br><span class="line">search_request.commonRequest.searchFilter.append(<span class="number">0</span>)</span><br><span class="line">search_request.interfaceType = <span class="number">1</span></span><br><span class="line">form_data = search_request.SerializeToString()</span><br><span class="line"><span class="built_in">print</span>(form_data)</span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="comment"># with open(&#x27;me.bin&#x27;, mode=&quot;wb&quot;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(form_data)</span></span><br><span class="line"><span class="comment"># print(search_request.SerializeToString().decode())</span></span><br><span class="line"></span><br><span class="line">bytes_head = <span class="built_in">bytes</span>([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="built_in">len</span>(form_data)])</span><br><span class="line"><span class="built_in">print</span>(bytes_head+form_data)</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9,zh-TW;q=0.8&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/grpc-web+proto&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;https://*********/SearchService.SearchService/search&quot;</span></span><br><span class="line">response=requests.post(url,headers=headers,data=bytes_head+form_data)</span><br><span class="line"><span class="built_in">print</span>(response.content)</span><br></pre></td></tr></table></figure>

<h3 id="响应处理"><a href="#响应处理" class="headerlink" title="响应处理"></a>响应处理</h3><p>我们构造了请求的proto文件，并成功用python发包获得了数据，但是得到的数据和f12得到的数据是一样的乱码如下图<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/18.webp"
                     
                ><br />其实这个也是protobuf格式，发过去的是protobuf格式，收到的也是protobuf格式，只是它是以二进制序列化格式传输的，所以看上去像乱码.<br />接下来会带来两种方法：①直观但有点复杂，②便捷但不太直观</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p><strong>写对应的响应的proto文件，和发包一样。当然可以和发包写在一起。</strong><br />老规矩，还是打断点从堆栈进行分析，根据发包的堆栈主要看app开头的js，因为chunk开头的是基本库，很少在里面做手脚，一般都是在自写的js里面做加密或其他操作。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/19.webp"
                     
                ><br />一步步调试后，<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/20.webp"
                     
                ><br />异步然后获得了值去.toObject,这个toObject就是proto文件转js的时候会产生的一个api函数接口，可以简单使用protoc去尝试转化成js看看。<br />这里不好跟进，直接全局搜索一下：proto.SearchService.SearchResponse<br />这里接受响应后需要把二进制数据进行反序列化，那么就会用到下面的api<br /><strong><font color="red">deserializeBinary——deserializeBinaryFromReader</font><strong>（</strong>重点核心</strong>）<br />完整的就是 proto.SearchService.SearchResponse.deserializeBinaryFromReader<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/21.webp"
                     
                ><br />一下子就定位到了，和请求的一样理解，只是他现在变成了case语句来表示序号位置，read后面的类型来表示类型。<br />序号4有个message，进去查看<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/22.webp"
                     
                ><br />这个返回的数据量太大了，标号也特别的多，有没有什么更好的方法得到proto文件呢？<br />那就是自写ast，然后用ast来处理这种switch语句。这里直接使用渔歌写好的ats插件，文末附上链接，网站js有些小更新，之前的可能有些小报错，小小的修改了一下<br />这里把整个js复制出来命名为test.js，先安装babel解析库在当前目录下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">npm install @babel/core --save-dev</span><br></pre></td></tr></table></figure>
<p>执行ast代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> parser = <span class="built_in">require</span>(<span class="string">&quot;@babel/parser&quot;</span>);</span><br><span class="line"><span class="comment">// 为parser提供模板引擎</span></span><br><span class="line"><span class="keyword">const</span> template = <span class="built_in">require</span>(<span class="string">&quot;@babel/template&quot;</span>).<span class="property">default</span>;</span><br><span class="line"><span class="comment">// 遍历AST</span></span><br><span class="line"><span class="keyword">const</span> traverse = <span class="built_in">require</span>(<span class="string">&quot;@babel/traverse&quot;</span>).<span class="property">default</span>;</span><br><span class="line"><span class="comment">// 操作节点，比如判断节点类型，生成新的节点等</span></span><br><span class="line"><span class="keyword">const</span> t = <span class="built_in">require</span>(<span class="string">&quot;@babel/types&quot;</span>);</span><br><span class="line"><span class="comment">// 将语法树转换为源代码</span></span><br><span class="line"><span class="keyword">const</span> generator = <span class="built_in">require</span>(<span class="string">&quot;@babel/generator&quot;</span>);</span><br><span class="line"><span class="comment">// 操作文件</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&quot;fs&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义公共函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">wtofile</span>(<span class="params">path, flags, code</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> fd = fs.<span class="title function_">openSync</span>(path,flags);</span><br><span class="line">    fs.<span class="title function_">writeSync</span>(fd, code);</span><br><span class="line">    fs.<span class="title function_">closeSync</span>(fd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">dtofile</span>(<span class="params">path</span>) &#123;</span><br><span class="line">    fs.<span class="title function_">unlinkSync</span>(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> file_path = <span class="string">&#x27;test.js&#x27;</span>; <span class="comment">//你要处理的文件</span></span><br><span class="line"><span class="keyword">var</span> jscode = fs.<span class="title function_">readFileSync</span>(file_path, &#123;</span><br><span class="line">    <span class="attr">encoding</span>: <span class="string">&quot;utf-8&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 转换为AST语法树</span></span><br><span class="line"><span class="keyword">let</span> ast = parser.<span class="title function_">parse</span>(jscode);</span><br><span class="line"><span class="keyword">let</span> proto_text = <span class="string">`syntax = &quot;proto3&quot;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">// protoc --python_out=. app_proto2.proto</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">traverse</span>(ast, &#123;</span><br><span class="line">    <span class="title class_">MemberExpression</span>(path)&#123;</span><br><span class="line">        <span class="keyword">if</span>(path.<span class="property">node</span>.<span class="property">property</span>.<span class="property">type</span> === <span class="string">&#x27;Identifier&#x27;</span> &amp;&amp; path.<span class="property">node</span>.<span class="property">property</span>.<span class="property">name</span> === <span class="string">&#x27;deserializeBinaryFromReader&#x27;</span> &amp;&amp; path.<span class="property">parentPath</span>.<span class="property">type</span> === <span class="string">&#x27;AssignmentExpression&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">let</span> id_name = path.<span class="title function_">toString</span>().<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">slice</span>(<span class="number">1</span>, -<span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">            path.<span class="property">parentPath</span>.<span class="title function_">traverse</span>(&#123;</span><br><span class="line">                <span class="title class_">VariableDeclaration</span>(path_2)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(path_2.<span class="property">node</span>.<span class="property">declarations</span>.<span class="property">length</span> === <span class="number">1</span>)&#123;</span><br><span class="line">                        path_2.<span class="title function_">replaceWith</span>(t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">                            t.<span class="title function_">assignmentExpression</span>(</span><br><span class="line">                                <span class="string">&quot;=&quot;</span>,</span><br><span class="line">                                path_2.<span class="property">node</span>.<span class="property">declarations</span>[<span class="number">0</span>].<span class="property">id</span>,</span><br><span class="line">                                path_2.<span class="property">node</span>.<span class="property">declarations</span>[<span class="number">0</span>].<span class="property">init</span></span><br><span class="line">                            )</span><br><span class="line">                        ))</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title class_">SwitchStatement</span>(path_2)&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; path_2.<span class="property">node</span>.<span class="property">cases</span>.<span class="property">length</span> - <span class="number">1</span>; i++) &#123;</span><br><span class="line">                        <span class="keyword">let</span> item = path_2.<span class="property">node</span>.<span class="property">cases</span>[i];</span><br><span class="line">                        <span class="keyword">let</span> item2 = path_2.<span class="property">node</span>.<span class="property">cases</span>[i + <span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">if</span>(item.<span class="property">consequent</span>.<span class="property">length</span> === <span class="number">0</span> &amp;&amp; item2.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">type</span> === <span class="string">&#x27;SequenceExpression&#x27;</span>)&#123;</span><br><span class="line">                            item.<span class="property">consequent</span> = [</span><br><span class="line">                                item2.<span class="property">consequent</span>[<span class="number">0</span>],</span><br><span class="line">                                t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">                                    item2.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">expressions</span>[<span class="number">0</span>]</span><br><span class="line">                                ),</span><br><span class="line">                                item2.<span class="property">consequent</span>[<span class="number">2</span>]</span><br><span class="line">                            ];</span><br><span class="line">                            item2.<span class="property">consequent</span>[<span class="number">1</span>] = t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">                                item2.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">expressions</span>[<span class="number">1</span>]</span><br><span class="line">                            )</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">consequent</span>.<span class="property">length</span> === <span class="number">0</span>)&#123;</span><br><span class="line">                            item.<span class="property">consequent</span> = item2.<span class="property">consequent</span></span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(item.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">type</span> === <span class="string">&#x27;SequenceExpression&#x27;</span>)&#123;</span><br><span class="line">                            item.<span class="property">consequent</span>[<span class="number">1</span>] = t.<span class="title function_">expressionStatement</span>(</span><br><span class="line">                                item.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">expressions</span>[<span class="number">1</span>]</span><br><span class="line">                            )</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">let</span> id_text = <span class="string">&#x27;message &#x27;</span> + id_name + <span class="string">&#x27; &#123;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">            <span class="keyword">let</span> let_id_list = [];</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="comment">// console.log(path.parentPath.node.right.body.body[0].body.body[0].cases.length);</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; path.<span class="property">parentPath</span>.<span class="property">node</span>.<span class="property">right</span>.<span class="property">body</span>.<span class="property">body</span>[<span class="number">0</span>].<span class="property">body</span>.<span class="property">body</span>[<span class="number">0</span>].<span class="property">cases</span>.<span class="property">length</span>; i++) &#123;</span><br><span class="line">                    <span class="keyword">let</span> item = path.<span class="property">parentPath</span>.<span class="property">node</span>.<span class="property">right</span>.<span class="property">body</span>.<span class="property">body</span>[<span class="number">0</span>].<span class="property">body</span>.<span class="property">body</span>[<span class="number">0</span>].<span class="property">cases</span>[i];</span><br><span class="line">                    <span class="keyword">if</span>(item.<span class="property">test</span>)&#123;</span><br><span class="line">                        <span class="keyword">let</span> id_number = item.<span class="property">test</span>.<span class="property">value</span>;</span><br><span class="line">                        <span class="keyword">let</span> key = item.<span class="property">consequent</span>[<span class="number">1</span>].<span class="property">expression</span>.<span class="property">callee</span>.<span class="property">property</span>.<span class="property">name</span>;</span><br><span class="line">                        <span class="keyword">let</span> id_st, id_type;</span><br><span class="line">                        <span class="keyword">if</span>(key.<span class="title function_">startsWith</span>(<span class="string">&quot;set&quot;</span>))&#123;</span><br><span class="line">                            id_st = <span class="string">&quot;&quot;</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(key.<span class="title function_">startsWith</span>(<span class="string">&quot;add&quot;</span>))&#123;</span><br><span class="line">                            id_st = <span class="string">&quot;repeated&quot;</span>;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="comment">// map类型，因为案例中用不到，所以这里省略</span></span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        key = key.<span class="title function_">substring</span>(<span class="number">3</span>, key.<span class="property">length</span>);</span><br><span class="line">                        id_type = item.<span class="property">consequent</span>[<span class="number">0</span>];</span><br><span class="line">                        <span class="keyword">if</span>(id_type.<span class="property">expression</span>.<span class="property">right</span>.<span class="property">type</span> === <span class="string">&#x27;NewExpression&#x27;</span>)&#123;</span><br><span class="line">                            id_type = generator.<span class="title function_">default</span>(id_type.<span class="property">expression</span>.<span class="property">right</span>.<span class="property">callee</span>).<span class="property">code</span>.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="title function_">slice</span>(<span class="number">1</span>).<span class="title function_">join</span>(<span class="string">&#x27;_&#x27;</span>);</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="keyword">switch</span> (id_type.<span class="property">expression</span>.<span class="property">right</span>.<span class="property">callee</span>.<span class="property">property</span>.<span class="property">name</span>) &#123;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readString&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;string&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readDouble&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;double&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readInt32&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;int32&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readInt64&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;int64&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readFloat&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;float&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readBool&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;bool&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readPackedInt32&quot;</span>:</span><br><span class="line">                                    id_st = <span class="string">&quot;repeated&quot;</span>;</span><br><span class="line">                                    id_type = <span class="string">&quot;int32&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readBytes&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;bytes&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readEnum&quot;</span>:</span><br><span class="line">                                    id_type = <span class="string">&quot;readEnum&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                                <span class="keyword">case</span> <span class="string">&quot;readPackedEnum&quot;</span>:</span><br><span class="line">                                    id_st = <span class="string">&quot;repeated&quot;</span>;</span><br><span class="line">                                    id_type = <span class="string">&quot;readEnum&quot;</span>;</span><br><span class="line">                                    <span class="keyword">break</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(id_type === <span class="string">&#x27;readEnum&#x27;</span>)&#123;</span><br><span class="line">                            id_type = id_name + <span class="string">&#x27;_&#x27;</span> + key + <span class="string">&#x27;Enum&#x27;</span>;</span><br><span class="line">                            <span class="keyword">if</span>(let_id_list.<span class="title function_">indexOf</span>(id_number) === -<span class="number">1</span>)&#123;</span><br><span class="line">                                id_text += <span class="string">&#x27;\tenum &#x27;</span> + id_type + <span class="string">&#x27; &#123;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">                                <span class="keyword">for</span> (<span class="keyword">let</span> j = <span class="number">0</span>; j &lt; <span class="number">3</span>; j++) &#123;</span><br><span class="line">                                    id_text += <span class="string">&#x27;\t\t&#x27;</span> + id_type + <span class="string">&#x27;TYPE_&#x27;</span> + j + <span class="string">&#x27; = &#x27;</span> + j + <span class="string">&#x27;;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                id_text += <span class="string">&#x27;\t&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">                                id_text += <span class="string">&#x27;\t&#x27;</span> + id_st + <span class="string">&#x27; &#x27;</span> + id_type + <span class="string">&#x27; &#x27;</span> + key + <span class="string">&#x27; = &#x27;</span> + id_number + <span class="string">&#x27;;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">                                let_id_list.<span class="title function_">push</span>(id_number)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                            <span class="keyword">if</span>(let_id_list.<span class="title function_">indexOf</span>(id_number) === -<span class="number">1</span>)&#123;</span><br><span class="line">                                id_text += <span class="string">&#x27;\t&#x27;</span> + id_st + <span class="string">&#x27; &#x27;</span> + id_type + <span class="string">&#x27; &#x27;</span> + key + <span class="string">&#x27; = &#x27;</span> + id_number + <span class="string">&#x27;;</span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">                                let_id_list.<span class="title function_">push</span>(id_number)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            id_text += <span class="string">&#x27;&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;</span>;</span><br><span class="line">            proto_text += id_text</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="title function_">wtofile</span>(<span class="string">&#x27;app_proto3.proto&#x27;</span>, <span class="string">&#x27;w&#x27;</span>, proto_text);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>这个ast代码单纯只是针对这个站点，其他站点也是类似分析。<br />运行后生成了app_proto3.proto文件，打开看一面有一些报错，如下图，渔歌文章也讲清楚了原因，因为对象调用deserializeBinaryFromReader方法的时候，ast代码处理对象无法确定，所以就没加载到。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/23.webp"
                     
                ><br />我们在调试里面，搜索关键词ExportResponse.deserializeBinaryFromReader<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/24.webp"
                     
                ><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/25.webp"
                     
                ><br />跟进去就能找到s对象是什么，补上就行，其他的报错也是这样的操作<br />得到了proto文件后进行编译成python </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">protoc --python_out=. ./app_proto3.<span class="property">proto</span></span><br></pre></td></tr></table></figure>
<p>然后发个请求试一试</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> app_proto3_pb2 <span class="keyword">as</span> pb</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">search_request = pb.SearchService_SearchRequest()  <span class="comment"># 实例化对象</span></span><br><span class="line"><span class="comment"># 按上面解析数据，按照对应的属性设置值</span></span><br><span class="line"><span class="comment"># 字符串，数字型的都是直接赋值</span></span><br><span class="line">search_request.Commonrequest.SearchType = <span class="string">&#x27;paper&#x27;</span></span><br><span class="line">search_request.Commonrequest.SearchWord = <span class="string">&#x27;python&#x27;</span></span><br><span class="line">search_request.Commonrequest.CurrentPage = <span class="number">2</span></span><br><span class="line">search_request.Commonrequest.PageSize = <span class="number">20</span></span><br><span class="line"><span class="comment"># repeated修饰的messsage类型和enum类型，则需要稍微多几个步骤</span></span><br><span class="line">search_request.Commonrequest.SearchFilterList.append(<span class="number">0</span>)</span><br><span class="line">search_request.InterfaceType = <span class="number">1</span></span><br><span class="line">form_data = search_request.SerializeToString()</span><br><span class="line"><span class="built_in">print</span>(form_data)</span><br><span class="line"><span class="comment"># 保存数据玮bin文件供后续对比使用</span></span><br><span class="line"><span class="comment"># with open(&#x27;me.bin&#x27;, mode=&quot;wb&quot;) as f:</span></span><br><span class="line"><span class="comment">#     f.write(form_data)</span></span><br><span class="line"><span class="comment"># print(search_request.SerializeToString().decode())</span></span><br><span class="line"></span><br><span class="line">bytes_head = <span class="built_in">bytes</span>([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="built_in">len</span>(form_data)])</span><br><span class="line"><span class="built_in">print</span>(bytes_head + form_data)</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Accept-Language&quot;</span>: <span class="string">&quot;zh-CN,zh;q=0.9&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/grpc-web+proto&quot;</span>,</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/110.0.0.0 Safari/537.36&quot;</span>,</span><br><span class="line">&#125;</span><br><span class="line">url = <span class="string">&quot;https://*********.com.cn/SearchService.SearchService/search&quot;</span></span><br><span class="line">response = requests.post(url, headers=headers, data=bytes_head + form_data)</span><br><span class="line"><span class="comment"># print(response.text)</span></span><br><span class="line"></span><br><span class="line">search_response = pb.SearchService_SearchResponse()</span><br><span class="line">search_response.ParseFromString(response.content[<span class="number">5</span>:])</span><br><span class="line"><span class="built_in">print</span>(search_response)</span><br></pre></td></tr></table></figure>
<p>可以看到很直观，取值也方便。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/26.webp"
                     
                ><br />上面之所以从响应的第六位字节开启取，是跟上面发包一样的，前五个字节表示请求头的长度<br />下面是proto的核心，序列化和反序列化<br /><strong><font color="red">serializeBinary——serializeBinaryFromReader</font><strong>（</strong>重点核心</strong>）<br /><strong><font color="red">deserializeBinary——deserializeBinaryFromReader</font><strong>（</strong>重点核心</strong>）</p>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>使用python应对protobuf的第三方库：blackboxprotobuf<br />安装命令：pip install blackboxprotobuf<br />调用核心函数 ：blackboxprotobuf.decode_message(<strong>Byte类型数据</strong>)，进行解protobuf格式数据<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230201/27.webp"
                     
                ><br />上面是数据对应结构位置，下面是类型对应结构位置<br />虽然拿到了数据，只是位置序号加内容，我们其实要靠猜才能知道是什么，这种就不需要去写proto文件<br />两种方式都可以，喜欢哪种用哪种</p>
<h3 id="相关资料参考"><a href="#相关资料参考" class="headerlink" title="相关资料参考"></a>相关资料参考</h3><p><a class="link"   href="https://blog.csdn.net/dideng7039/article/details/101869819" >https://blog.csdn.net/dideng7039/article/details/101869819<i class="fas fa-external-link-alt"></i></a><br /><a class="link"   href="https://blog.csdn.net/qq_35491275/article/details/111721639" >https://blog.csdn.net/qq_35491275&#x2F;article&#x2F;details&#x2F;111721639<i class="fas fa-external-link-alt"></i></a><br /><a class="link"   href="https://mp.weixin.qq.com/s/DzCz66_Szc7vfG6bpl956w" >https://mp.weixin.qq.com/s/DzCz66_Szc7vfG6bpl956w<i class="fas fa-external-link-alt"></i></a><br /><a class="link"   href="https://blog.csdn.net/qq_56881388/article/details/128612717" >https://blog.csdn.net/qq_56881388&#x2F;article&#x2F;details&#x2F;128612717<i class="fas fa-external-link-alt"></i></a></p>
]]></content>
      <tags>
        <tag>js</tag>
        <tag>protobuf</tag>
      </tags>
  </entry>
  <entry>
    <title>AES知道某一轮次密钥反推主密钥</title>
    <url>/2023/01/31/AES%E7%9F%A5%E9%81%93%E6%9F%90%E4%B8%80%E8%BD%AE%E6%AC%A1%E5%AF%86%E9%92%A5%E5%8F%8D%E6%8E%A8%E4%B8%BB%E5%AF%86%E9%92%A5/</url>
    <content><![CDATA[<h4 id="从轮密钥逆推主密钥"><a href="#从轮密钥逆推主密钥" class="headerlink" title="从轮密钥逆推主密钥"></a>从轮密钥逆推主密钥</h4><p>首先讨论AES-128<br>这里用上上篇<a href="https://www.zskkk.cn/2022/12/27/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95AES%E7%9A%84%E5%8E%9F%E7%90%86%E5%8F%8A%E5%88%86%E6%9E%90/"><font color="blue">对称加密算法AES原理及分析</font></a>里面用到的密钥<strong>0123456789abcdef0123456789abcdef</strong>生成的10轮子密钥做分析</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">K00:0123456789abcdef0123456789abcdef</span><br><span class="line">K01:629e9ac0eb35572fea16124863bddfa7</span><br><span class="line">K02:1a00c63bf13591141b23835c789e5cfb</span><br><span class="line">K03:154ac987e47f5893ff5cdbcf87c28734</span><br><span class="line">K04:385dd190dc228903237e52cca4bcd5f8</span><br><span class="line">K05:4d5e90d9917c19dab2024b1616be9eee</span><br><span class="line">K06:c355b89e5229a144e02bea52f69574bc</span><br><span class="line">K07:a9c7dddcfbee7c981bc596caed50e276</span><br><span class="line">K08:7a5fe58981b199119a740fdb7724edad</span><br><span class="line">K09:570a707cd6bbe96d4ccfe6b63beb0b1b</span><br><span class="line">K10:8821df9e5e9a36f31255d04529bedb5e</span><br></pre></td></tr></table></figure>

<p>假如获取到的是K0，那不用说。如果获取到的是K10呢？<br>8821df9e5e9a36f31255d04529bedb5e，首先我们会到W数组的视图，看W10密钥怎么编排出来的<br><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230131/01.webp"></p>
<p>K10是W40,W41,W42,W43拼起来的，我们已知K10，即已知W40,W41,W42,W43有没有办法求K9？如果可以，那么同理可以逆推到K0，即求得了主密钥<br><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="24.3ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10740.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mo" transform="translate(3858.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4247.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(5295.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(6295.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mtext" transform="translate(6684.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(6934.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(7506.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(7991.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(8442.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(8692.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(9740.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container></p>
<p><br>我们不妨先复习一下异或的基本性质，<strong>异或作用与比特位上，对应的比特位相同则为0，相异则为1</strong>。<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="10.954ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 4841.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mtext" transform="translate(500,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1322,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1807,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2258,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mn" transform="translate(2508,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(3285.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4341.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="10.954ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 4841.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mtext" transform="translate(500,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1322,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1807,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2258,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mn" transform="translate(2508,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(3285.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4341.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="10.954ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 4841.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mtext" transform="translate(500,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1322,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1807,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2258,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mn" transform="translate(2508,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(3285.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4341.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="10.954ex" height="1.692ex" role="img" focusable="false" viewBox="0 -666 4841.6 748"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mtext" transform="translate(500,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(750,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1322,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(1807,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2258,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mn" transform="translate(2508,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g><g data-mml-node="mo" transform="translate(3285.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(4341.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g></g></svg></mjx-container></p>
<p>因为相同为0，相异为1，那么一个数和自身异或时，因为每个比特位都相同，所以结果为0。<br><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="12.547ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 5545.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mtext" transform="translate(852,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(1102,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1674,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2159,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2610,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(2860,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mo" transform="translate(3989.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(5045.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g></g></g></svg></mjx-container><br>而当某个数和0异或时，自身为0的比特0^0得0，自身为1的比特位1^0得1，这就导致结果和没异或前一样。<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="12.547ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 5545.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mtext" transform="translate(852,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(1102,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1674,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2159,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2610,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mn" transform="translate(2860,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(3637.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(4693.6,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></svg></mjx-container> </p>
<p>除此之外，异或并不看谁先谁后，A ^ B 与 B ^ A 显然无区别，即具有交换律。<br></p>
<p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="19.411ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 8579.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g><g data-mml-node="mtext" transform="translate(852,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(1102,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(1674,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(2159,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(2610,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(2860,0)"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="mo" transform="translate(3900.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(4956.6,0)"><path data-c="1D44C" d="M66 637Q54 637 49 637T39 638T32 641T30 647T33 664T42 682Q44 683 56 683Q104 680 165 680Q288 680 306 683H316Q322 677 322 674T320 656Q316 643 310 637H298Q242 637 242 624Q242 619 292 477T343 333L346 336Q350 340 358 349T379 373T411 410T454 461Q546 568 561 587T577 618Q577 634 545 637Q528 637 528 647Q528 649 530 661Q533 676 535 679T549 683Q551 683 578 682T657 680Q684 680 713 681T746 682Q763 682 763 673Q763 669 760 657T755 643Q753 637 734 637Q662 632 617 587Q608 578 477 424L348 273L322 169Q295 62 295 57Q295 46 363 46Q379 46 384 45T390 35Q390 33 388 23Q384 6 382 4T366 1Q361 1 324 1T232 2Q170 2 138 2T102 1Q84 1 84 9Q84 14 87 24Q88 27 89 30T90 35T91 39T93 42T96 44T101 45T107 45T116 46T129 46Q168 47 180 50T198 63Q201 68 227 171L252 274L129 623Q128 624 127 625T125 627T122 629T118 631T113 633T105 634T96 635T83 636T66 637Z"></path></g><g data-mml-node="mtext" transform="translate(5719.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5969.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6541.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(7026.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7477.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7727.6,0)"><path data-c="1D44B" d="M42 0H40Q26 0 26 11Q26 15 29 27Q33 41 36 43T55 46Q141 49 190 98Q200 108 306 224T411 342Q302 620 297 625Q288 636 234 637H206Q200 643 200 645T202 664Q206 677 212 683H226Q260 681 347 681Q380 681 408 681T453 682T473 682Q490 682 490 671Q490 670 488 658Q484 643 481 640T465 637Q434 634 411 620L488 426L541 485Q646 598 646 610Q646 628 622 635Q617 635 609 637Q594 637 594 648Q594 650 596 664Q600 677 606 683H618Q619 683 643 683T697 681T738 680Q828 680 837 683H845Q852 676 852 672Q850 647 840 637H824Q790 636 763 628T722 611T698 593L687 584Q687 585 592 480L505 384Q505 383 536 304T601 142T638 56Q648 47 699 46Q734 46 734 37Q734 35 732 23Q728 7 725 4T711 1Q708 1 678 1T589 2Q528 2 496 2T461 1Q444 1 444 10Q444 11 446 25Q448 35 450 39T455 44T464 46T480 47T506 54Q523 62 523 64Q522 64 476 181L429 299Q241 95 236 84Q232 76 232 72Q232 53 261 47Q262 47 267 47T273 46Q276 46 277 46T280 45T283 42T284 35Q284 26 282 19Q279 6 276 4T261 1Q258 1 243 1T201 2T142 2Q64 2 42 0Z"></path></g></g></g></svg></mjx-container></p>
<p><br>看看异或的多角度理解：<a href="https://www.zhihu.com/question/31116687"><font color="blue">如何理解「异或」的含义</font></a>。<br>下面做变换，左右W42异或<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="39.813ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 17597.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(2048,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(2298,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(2870,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3355,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(3806,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(4056,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(5104,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(6381.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(9485.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(9735.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(10307.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(10792.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(11243.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(11493.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(12541.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(13541.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(13791.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(14363.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(14848.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(15299.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(15549.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(16597.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="27.135ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 11993.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(2048,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(2298,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(2870,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(3355,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(3806,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(4056,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(5104,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(6381.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(7437.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mtext" transform="translate(7937.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(8187.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(8759.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(9244.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(9695.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(9945.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(10993.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container></p>
<p>K10中涉及到的四个式子均可以做变化<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="24.3ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 10740.6 1000"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"></path></g><g data-mml-node="mo" transform="translate(3858.6,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(4247.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(5295.6,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(6295.6,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mtext" transform="translate(6684.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(6934.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(7506.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(7991.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(8442.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(8692.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(9740.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="37" d="M55 458Q56 460 72 567L88 674Q88 676 108 676H128V672Q128 662 143 655T195 646T364 644H485V605L417 512Q408 500 387 472T360 435T339 403T319 367T305 330T292 284T284 230T278 162T275 80Q275 66 275 52T274 28V19Q270 2 255 -10T221 -22Q210 -22 200 -19T179 0T168 40Q168 198 265 368Q285 400 349 489L395 552H302Q128 552 119 546Q113 543 108 522T98 479L95 458V455H55V458Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container><br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="21.461ex" height="1.731ex" role="img" focusable="false" viewBox="0 -683 9485.6 765"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(1048,0)"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="39" d="M352 287Q304 211 232 211Q154 211 104 270T44 396Q42 412 42 436V444Q42 537 111 606Q171 666 243 666Q245 666 249 666T257 665H261Q273 665 286 663T323 651T370 619T413 560Q456 472 456 334Q456 194 396 97Q361 41 312 10T208 -22Q147 -22 108 7T68 93T121 149Q143 149 158 135T173 96Q173 78 164 65T148 49T135 44L131 43Q131 41 138 37T164 27T206 22H212Q272 22 313 86Q352 142 352 280V287ZM244 248Q292 248 321 297T351 430Q351 508 343 542Q341 552 337 562T323 588T293 615T246 625Q208 625 181 598Q160 576 154 546T147 441Q147 358 152 329T172 282Q197 248 244 248Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(2325.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mi" transform="translate(3381.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(4429.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500,0)"></path></g><g data-mml-node="mtext" transform="translate(5429.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(5679.6,0)"><path data-c="1D465" d="M52 289Q59 331 106 386T222 442Q257 442 286 424T329 379Q371 442 430 442Q467 442 494 420T522 361Q522 332 508 314T481 292T458 288Q439 288 427 299T415 328Q415 374 465 391Q454 404 425 404Q412 404 406 402Q368 386 350 336Q290 115 290 78Q290 50 306 38T341 26Q378 26 414 59T463 140Q466 150 469 151T485 153H489Q504 153 504 145Q504 144 502 134Q486 77 440 33T333 -11Q263 -11 227 52Q186 -10 133 -10H127Q78 -10 57 16T35 71Q35 103 54 123T99 143Q142 143 142 101Q142 81 130 66T107 46T94 41L91 40Q91 39 97 36T113 29T132 26Q168 26 194 71Q203 87 217 139T245 247T261 313Q266 340 266 352Q266 380 251 392T217 404Q177 404 142 372T93 290Q91 281 88 280T72 278H58Q52 284 52 289Z"></path></g><g data-mml-node="mi" transform="translate(6251.6,0)"><path data-c="1D45C" d="M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"></path></g><g data-mml-node="mi" transform="translate(6736.6,0)"><path data-c="1D45F" d="M21 287Q22 290 23 295T28 317T38 348T53 381T73 411T99 433T132 442Q161 442 183 430T214 408T225 388Q227 382 228 382T236 389Q284 441 347 441H350Q398 441 422 400Q430 381 430 363Q430 333 417 315T391 292T366 288Q346 288 334 299T322 328Q322 376 378 392Q356 405 342 405Q286 405 239 331Q229 315 224 298T190 165Q156 25 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 114 189T154 366Q154 405 128 405Q107 405 92 377T68 316T57 280Q55 278 41 278H27Q21 284 21 287Z"></path></g><g data-mml-node="mtext" transform="translate(7187.6,0)"><path data-c="A0" d=""></path></g><g data-mml-node="mi" transform="translate(7437.6,0)"><path data-c="1D44A" d="M436 683Q450 683 486 682T553 680Q604 680 638 681T677 682Q695 682 695 674Q695 670 692 659Q687 641 683 639T661 637Q636 636 621 632T600 624T597 615Q597 603 613 377T629 138L631 141Q633 144 637 151T649 170T666 200T690 241T720 295T759 362Q863 546 877 572T892 604Q892 619 873 628T831 637Q817 637 817 647Q817 650 819 660Q823 676 825 679T839 682Q842 682 856 682T895 682T949 681Q1015 681 1034 683Q1048 683 1048 672Q1048 666 1045 655T1038 640T1028 637Q1006 637 988 631T958 617T939 600T927 584L923 578L754 282Q586 -14 585 -15Q579 -22 561 -22Q546 -22 542 -17Q539 -14 523 229T506 480L494 462Q472 425 366 239Q222 -13 220 -15T215 -19Q210 -22 197 -22Q178 -22 176 -15Q176 -12 154 304T131 622Q129 631 121 633T82 637H58Q51 644 51 648Q52 671 64 683H76Q118 680 176 680Q301 680 313 683H323Q329 677 329 674T327 656Q322 641 318 637H297Q236 634 232 620Q262 160 266 136L501 550L499 587Q496 629 489 632Q483 636 447 637Q428 637 422 639T416 648Q416 650 418 660Q419 664 420 669T421 676T424 680T428 682T436 683Z"></path></g><g data-mml-node="mn" transform="translate(8485.6,0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z" transform="translate(500,0)"></path></g></g></g></svg></mjx-container> </p>
<p>K10 = 8821df9e5e9a36f31255d04529bedb5e，切成四块<br></p>
<center>W40 = 8821df9e</center>
<center>W41 = 5e9a36f3</center>
<center>W42 = 1255d045</center>
<center>W43 = 29bedb5e</center>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x8821df9e</span>^<span class="number">0x5e9a36f3</span>)</span><br><span class="line"><span class="string">'0xd6bbe96d'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x5e9a36f3</span>^<span class="number">0x1255d045</span>)</span><br><span class="line"><span class="string">'0x4ccfe6b6'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0x1255d045</span>^<span class="number">0x29bedb5e</span>)</span><br><span class="line"><span class="string">'0x3beb0b1b'</span></span><br></pre></td></tr></table></figure>

<p>所以<br>W37 = 0xd6bbe96d<br>W38 = 0x4ccfe6b6<br>W39 = 0x3beb0b1b<br>求出了W37,W38,W39，即K9的后大半部分，和真实情况比对后发现一致。<br>K09:570a707c<strong>d6bbe96d4ccfe6b63beb0b1b</strong><br>那么W36呢？再复习一下g函数吧<br>首先循环左移一字节，3beb0b1b 变成 eb0b1b3b<br>然后逐字节S盒替换，得e92bafe2</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>SBox = [</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line"><span class="meta">... </span>    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span></span><br><span class="line"><span class="meta">... </span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(SBox[<span class="number">0xeb</span>])</span><br><span class="line"><span class="string">'0xe9'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(SBox[<span class="number">0x0b</span>])</span><br><span class="line"><span class="string">'0x2b'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(SBox[<span class="number">0x1b</span>])</span><br><span class="line"><span class="string">'0xaf'</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(SBox[<span class="number">0x3b</span>])</span><br><span class="line"><span class="string">'0xe2'</span></span><br></pre></td></tr></table></figure>
<p>最后是首字节和Rcon中的一个字节异或，这是最后一次变换，即用0x36</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">rcon = [<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]</span><br></pre></td></tr></table></figure>
<p>即</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xe9</span>^<span class="number">0x36</span>)</span><br><span class="line"><span class="string">'0xdf'</span></span><br></pre></td></tr></table></figure>
<p>g函数的结果即是0xdf2bafe2<br>那上面W36=g(W39) xor W40 = 0xdf2bafe2 xor 0x8821df9e</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">hex</span>(<span class="number">0xdf2bafe2</span>^<span class="number">0x8821df9e</span>)</span><br><span class="line"><span class="string">'0x570a707c'</span></span><br></pre></td></tr></table></figure>
<p>所以完整的K9：570a707cd6bbe96d4ccfe6b63beb0b1b，就被我们分析出来了，跟一开始的K表里的K9是一致的。可以继续往上推出K0，获得主密钥。即AES可以依靠轮密钥逆推出主密钥。严肃的说，AES-128可以通过一轮轮密钥逆推出主密钥，AES-192需要一轮半，AES-256需要两轮轮密钥。</p>
<p>接下来顺便下讨论DES的<br><br>DES密钥长八字节，在密钥编排时，会舍弃每个字节的最后1比特。因此实际参与密钥编排的是56比特，我们可以验证这一点。<br>假设密钥是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">11</span> <span class="number">22</span> <span class="number">33</span> <span class="number">44</span> <span class="number">55</span> <span class="number">66</span> <span class="number">77</span> <span class="number">88</span> (<span class="built_in">hex</span>)</span><br></pre></td></tr></table></figure>
<p>二进制即 <br>0001000<strong>1</strong> 0010001<strong>0</strong> 0011001<strong>1</strong> 0100010<strong>0</strong> 0101010<strong>1</strong> 0110011<strong>0</strong> 0111011<strong>1</strong> 1000100<strong>0</strong><br>我们将末尾1比特翻转，即0变1，1变0。如果AES密钥中每个字节的最后一位被“丢弃”，那么翻转后也并不会对程序有任何影响，反之加密结果应该不同。<br>0001000<strong>0</strong> 0010001<strong>1</strong> 0011001<strong>0</strong> 0100010<strong>1</strong> 0101010<strong>0</strong> 0110011<strong>1</strong> 0111011<strong>0</strong> 1000100<strong>1</strong><br>转成十六进制即</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">10</span> <span class="number">23</span> <span class="number">32</span> <span class="number">45</span> <span class="number">54</span> <span class="number">67</span> <span class="number">76</span> <span class="number">89</span> (<span class="built_in">hex</span>)</span><br></pre></td></tr></table></figure>
<p>在Cyberchef中，使用这两个密钥进行DES加密，结果完全一致。<br></p>
<p><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230131/02.webp"><br><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230131/03.webp"></p>
<p>对于DES而言，已知<strong>两轮或两轮</strong>以上的<strong>子密钥</strong>，就可逆推出初始密钥，具体代码见 <a href="https://www.freebuf.com/column/219723.html"><font color="blue">DES 子密钥逆推初始密钥</font></a> 一文。对于主密钥中无法复原的八比特，随便补什么都行，反正不影响结果。<br>在实际场景中，当我们需要基于AES/DES的轮密钥恢复主密钥时，我们用 <a href="https://github.com/SideChannelMarvels/Stark"><font color="blue">SideChannelMarvels/Stark</font></a> 这个开源项目，用户体验很好。<br>在另外一些情况中，目标加密算法可以基于某个轮密钥逆推出全体轮密钥，但没法恢复出主密钥，那怎么办呢——这不就是一开始说的吗</p>
<h4 id="轮密钥所处的内存块可区分吗"><a href="#轮密钥所处的内存块可区分吗" class="headerlink" title="轮密钥所处的内存块可区分吗"></a>轮密钥所处的内存块可区分吗</h4><p>首先得考虑一个代码编写的问题，<strong>在大多数加密实现中，出于模块化以及效率的考量，密钥编排作为一个整体性的、前置的步骤，在明文的运算前就被完全算出来。</strong>以AES -128为例，Key 为 16字节，密钥编排后生成11个16字节的轮密钥，这是我们刚学的。很少有程序会在明文运算中，用到了Ki再去编排生成那16字节，而是像我们的Python代码那样，提前生成所有轮密钥，供后续明文运算时使用。在Android Native开发中而言，即K0-K10紧凑的在一块内存中，装在比如 uint8_t RoundKey[176]这样的数组里。我们将全体轮密钥称为轮密钥群，这么叫比较好听。<br>那么如果提供给我们一串字节数据，能否判断其为AES的轮密钥群？这里用上一篇<a href="https://www.zskkk.cn/2023/01/09/%E6%9F%90%E9%B1%BC%E7%9B%B4%E6%92%AD%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8unidbg%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/"><font color="blue">某鱼直播软件使用unidbg算法分析</font></a> 里面出面的轮密钥群做样例，比如如下的176字节</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span>: <span class="number">30</span> <span class="number">29</span> <span class="number">28</span> <span class="number">27</span> <span class="number">26</span> <span class="number">25</span> <span class="number">24</span> <span class="number">23</span> <span class="number">22</span> <span class="number">21</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="number">0</span>)(<span class="string">'&amp;%$#"!......</span></span><br><span class="line"><span class="string">0010: 52 4A 4B 44 74 6F 6F 67 56 4E 6F 67 56 4E 6F 67    RJKDtoogVNogVNog</span></span><br><span class="line"><span class="string">0020: 7F E2 CE F5 0B 8D A1 92 5D C3 CE F5 0B 8D A1 92    ........].......</span></span><br><span class="line"><span class="string">0030: 26 D0 81 DE 2D 5D 20 4C 70 9E EE B9 7B 13 4F 2B    &amp;...-] Lp...{.O+</span></span><br><span class="line"><span class="string">0040: 53 54 70 FF 7E 09 50 B3 0E 97 BE 0A 75 84 F1 21    STp.~.P.....u..!</span></span><br><span class="line"><span class="string">0050: 1C F5 8D 62 62 FC DD D1 6C 6B 63 DB 19 EF 92 FA    ...bb...lkc.....</span></span><br><span class="line"><span class="string">0060: E3 BA A0 B6 81 46 7D 67 ED 2D 1E BC F4 C2 8C 46    .....F}g.-.....F</span></span><br><span class="line"><span class="string">0070: 86 DE FA 09 07 98 87 6E EA B5 99 D2 1E 77 15 94    .......n.....w..</span></span><br><span class="line"><span class="string">0080: F3 87 D8 7B F4 1F 5F 15 1E AA C6 C7 00 DD D3 53    ...{.._........S</span></span><br><span class="line"><span class="string">0090: 29 E1 35 18 DD FE 6A 0D C3 54 AC CA C3 89 7F 99    ).5...j..T......</span></span><br><span class="line"><span class="string">00A0: B8 33 DB 36 65 CD B1 3B A6 99 1D F1 65 10 62 68    .3.6e..;....e.bh</span></span><br></pre></td></tr></table></figure>
<p>这个问题有什么意义？<br>一个比较小的作用在于，在重度混淆的样本里，我们没法自上而下的分析逻辑。那么如果发现某个参数指向这么一片内存，我们可能需要办法确认——这是不是编排后的轮密钥？<br><img lazyload="" alt="image" data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230131/01.webp"><br>比较取巧的办法是验证图中橙色部分，验证w5是否等于w4^w1，w6是否等于w5^w2等等。<br>那么比较体系化的办法呢？我们假定上面字节流的最后十六个字节是轮密钥最后一轮，然后逆推出整个轮密钥群，两相对比，如果一致就可确认是否是轮密钥群。<br>在stark中进行验证，传入的参数中，<strong>B833DB3665CDB13BA6991DF165106268</strong>是假设的轮密钥（字节流最后十六字节），10为第几轮。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">E:\Project\c_project\Stark&gt;aes_keyschedule B833DB3665CDB13BA6991DF165106268 10</span><br><span class="line">K00: 30292827262524232221000000000000</span><br><span class="line">K01: 524A4B44746F6F67564E6F67564E6F67</span><br><span class="line">K02: 7FE2CEF50B8DA1925DC3CEF50B8DA192</span><br><span class="line">K03: 26D081DE2D5D204C709EEEB97B134F2B</span><br><span class="line">K04: 535470FF7E0950B30E97BE0A7584F121</span><br><span class="line">K05: 1CF58D6262FCDDD16C6B63DB19EF92FA</span><br><span class="line">K06: E3BAA0B681467D67ED2D1EBCF4C28C46</span><br><span class="line">K07: 86DEFA090798876EEAB599D21E771594</span><br><span class="line">K08: F387D87BF41F5F151EAAC6C700DDD353</span><br><span class="line">K09: 29E13518DDFE6A0DC354ACCAC3897F99</span><br><span class="line">K10: B833DB3665CDB13BA6991DF165106268</span><br></pre></td></tr></table></figure>
<p>比对后可确认一致。AES中还有一个特殊之处，第一轮子密钥就是主密钥，所以密钥就是30292827262524232221000000000000。又因为AES”<strong>第一轮子密钥就是主密钥</strong>“，所以有个更简单和易懂的办法——假设可疑内存块的前十六个字节是主密钥，做密钥编排，对比两者结果是否一致。<br>现在也有开源的工具可以更快找到密钥，这里推荐龙哥的<a href="https://github.com/Pr0214/Unidbg_FindKey"><font color="blue">Unidbg_FindKey</font></a></p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>某鱼直播软件使用unidbg算法分析</title>
    <url>/2023/01/09/%E6%9F%90%E9%B1%BC%E7%9B%B4%E6%92%AD%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8unidbg%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/000.webp"
                     
                ></p>
<h2 id="Unidbg-模拟执行"><a href="#Unidbg-模拟执行" class="headerlink" title="Unidbg 模拟执行"></a>Unidbg 模拟执行</h2><p> 首先模拟执行，先搭个架子  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.douyu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.AbstractJni;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.DalvikModule;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.VM;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DouYu</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DouYu</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().build();</span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/douyu.apk&quot;</span>));</span><br><span class="line">        vm.setVerbose(<span class="literal">true</span>);</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libmakeurl2.5.0.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DouYu</span> <span class="variable">douYu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DouYu</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/01.webp"
                     
                ><br /> 报了一个 ”不合法的JNI版本“ 错误，具体出错的原因有很多，一个常见的问题是SO的依赖库缺失。即程 序调用依赖库中某个函数时，因为这个依赖库没加载到Unidbg虚拟内存中，进而发生寻址错误，比如上 图就是 0x1664 地址访问失败。在Unidbg日志的第三行我们看到， libc++_shared.so 加载失败，即库缺失报错。 我们的目标SO依赖了 libc++_shared.so ，这个库是C++的支持库，但不在Unidbg默认支持的SO里。 我们要在apk的lib里把它拷贝出来。<br />在加载so文件前添加这两行，目标so依赖的其他so文件要在其前面加载</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DalvikModule</span> <span class="variable">dm_shared</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libc++_shared.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">dm_shared.callJNI_OnLoad(emulator);</span><br></pre></td></tr></table></figure>
<p>再次运行就一切正常了<br />下面就到了今天的主角——native_makeUrl函数，Unidbg中先call它，参数很长，构造的很随意，因为只是学习用途。  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.douyu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.array.ArrayObject;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DouYu</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DouYu</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().build();</span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/douyu.apk&quot;</span>));</span><br><span class="line">        vm.setVerbose(<span class="literal">true</span>);</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm_shared</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libc++_shared.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        dm_shared.callJNI_OnLoad(emulator);</span><br><span class="line"></span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libmakeurl2.5.0.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        emulator.traceCode(module.base, module.base + module.size);</span></span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMakeUrl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// args list</span></span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// arg1 env</span></span><br><span class="line">        list.add(vm.getJNIEnv());</span><br><span class="line">        <span class="comment">// arg2 jobject/jclazz 一般用不到，直接填0</span></span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">        list.add(vm.addLocalObject(context));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;aid&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;client_sys&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;time&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input3_1);</span><br><span class="line">        vm.addLocalObject(input3_2);</span><br><span class="line">        vm.addLocalObject(input3_3);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input3_1, input3_2, input3_3)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;android1&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;android&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;1673232015&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input4_1);</span><br><span class="line">        vm.addLocalObject(input4_2);</span><br><span class="line">        vm.addLocalObject(input4_3);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input4_1, input4_2, input4_3)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_11</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_12</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_13</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input5_1);</span><br><span class="line">        vm.addLocalObject(input5_2);</span><br><span class="line">        vm.addLocalObject(input5_3);</span><br><span class="line">        vm.addLocalObject(input5_4);</span><br><span class="line">        vm.addLocalObject(input5_5);</span><br><span class="line">        vm.addLocalObject(input5_6);</span><br><span class="line">        vm.addLocalObject(input5_7);</span><br><span class="line">        vm.addLocalObject(input5_8);</span><br><span class="line">        vm.addLocalObject(input5_9);</span><br><span class="line">        vm.addLocalObject(input5_10);</span><br><span class="line">        vm.addLocalObject(input5_11);</span><br><span class="line">        vm.addLocalObject(input5_12);</span><br><span class="line">        vm.addLocalObject(input5_13);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input5_1, input5_2, input5_3,input5_4, input5_5, input5_6,input5_7, input5_8, input5_9,input5_10, input5_11, input5_12,input5_13)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input6_1);</span><br><span class="line">        vm.addLocalObject(input6_2);</span><br><span class="line">        vm.addLocalObject(input6_3);</span><br><span class="line">        vm.addLocalObject(input6_4);</span><br><span class="line">        vm.addLocalObject(input6_5);</span><br><span class="line">        vm.addLocalObject(input6_6);</span><br><span class="line">        vm.addLocalObject(input6_7);</span><br><span class="line">        vm.addLocalObject(input6_8);</span><br><span class="line">        vm.addLocalObject(input6_9);</span><br><span class="line">        vm.addLocalObject(input6_10);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input6_1, input6_2, input6_3,input6_4, input6_5, input6_6,input6_7, input6_8, input6_9,input6_10)));</span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 参数准备完成</span></span><br><span class="line">        <span class="comment">// call function</span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">module</span>.callFunction(emulator, <span class="number">0x2f91</span>, list.toArray());</span><br><span class="line">        <span class="keyword">return</span> vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DouYu</span> <span class="variable">douYu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DouYu</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">makeUrl</span> <span class="operator">=</span> douYu.getMakeUrl();</span><br><span class="line">        System.out.println(<span class="string">&quot;result:&quot;</span>+ makeUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p> 运行后直接出结果  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/02.webp"
                     
                ><br /> 可以发现，结果由四部分组成，前三个参数是我们 input4 传进去的内容，所以需要分析的只有auth的 来源。 多次运行会发现，auth 的值，恒为 3c179e17e8e9b06d7b18c68555b92220，长度 32 位。  </p>
<h2 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h2><p> 首先，确认函数执行流的汇编长度，如果行数过多上千万甚至上亿行，就只能放弃。如果几十万行，那就还可以看看。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">traceLength</span><span class="params">()</span> &#123;</span><br><span class="line">    emulator.getBackend().hook_add_new(<span class="keyword">new</span> <span class="title class_">CodeHook</span>() &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="keyword">module</span>.base, <span class="keyword">module</span>.size + <span class="keyword">module</span>.base, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/03.webp"
                     
                ><br />运行计数总共九十一万行， 不超过100w行的执行流，要么程序没怎么混淆，要么逻辑不 太复杂。两者任意一个复杂度高一些，都不会只有100w行汇编以内。  <br />使用findcrypt插件再确认一下样本大概使用了哪些加密算法<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/04.webp"
                     
                ><br /> SO中至少存在 AES&#x2F;BASE64，至于我们的函数中用了什么？这得具体分析，毕竟Findcrypt只是一个静态 的、加密特征匹配插件。 </p>
<ul>
<li>目标函数可能用了AES&#x2F;Base64，说“可能”是上述算法可能用于SO中其他函数而非目标函数。 </li>
<li>目标函数可能用了AES和Base64之外的其他加密算法，因为FIndCrypt提供了静态的、有限的分析，很容易遗漏。</li>
</ul>
<p>使用Unidbg处理算法，一般而言，自下而上分析更省时省力，这得益于Unidbg两方面的能力 </p>
<ul>
<li><strong><font color="red">强大方便的内存读写监控</font></strong></br> </li>
<li><strong><font color="red">无地址随机化</font></strong></li>
</ul>
<p>这让我们可以逆流而上，自结果推来源，分析算法和数据块十分轻松。 <br />重新看运行结果图<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/05.webp"
                     
                ><br />运算结果来自于NewStringUTF，这个JString从哪里来的？    <br /> 日志提示调用处在0x336f，这个地址实际上是LR（返回地址），所以NewStringUTF函数调用是 0x336f 的上一条 0x336C。  <br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/06.webp"
                     
                ><br><br /> 在 0x336C 下断点  <br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/07.webp"
                     
                ><br><br /> 回顾一下NewStringUTF 这个JNI方法，数据来源就是参数二字符数组  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">jstring <span class="title function_">NewStringUTF</span><span class="params">(JNIEnv *env, const <span class="type">char</span> *bytes)</span>;</span><br></pre></td></tr></table></figure>
<p> 数据从地址0x402d20a0开始，我们要监控auth&#x3D;后面的数据，即从0x402d20a0+len(aid&#x3D;android1&amp;client_sys&#x3D;android&amp;time&#x3D;1638452332&amp;auth&#x3D;)开始，数一下auth的32个字节所处的地址，监控对它的写入。  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator.traceWrite(<span class="number">0x401D20D5</span>, <span class="number">0x401D20D5</span>+<span class="number">0x20</span>);</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/08.webp"
                     
                ><br><br /> 从下往上寻找对内存最晚的操作，可以发现，这32个字节的赋值发生在libc里。一般数据在libc里赋值， 指的是调用了libc中memcpy等库函数做拷贝、转换、比较等处理，而非数据生成的第一现场。  <br /> 把Unidbg的libc.so拷贝一份出来，扔到IDA里。搜索0x17d3a，看具体是哪个函数。我们发现 是在strcat函数里，即做字符串拼接。  <br />hook strcat 函数，进行追踪  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">char</span> *strcat(<span class="type">char</span> *dest, const <span class="type">char</span> *src)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><font color="red">dest – 指向目标数组，该数组包含了一个 C 字符串，且足够容纳追加后的字符串。</strong></font> </li>
<li><strong><font color="red">src – 指向要追加的字符串，该字符串不会覆盖目标字符串。</strong></font></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookStrCat</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;strcat&quot;</span>,</span><br><span class="line">            <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">            <span class="type">UnidbgPointer</span> <span class="variable">r1</span> <span class="operator">=</span> emulator.getContext().getPointerArg(<span class="number">1</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;strcat:&quot;</span>+ r1);</span><br><span class="line">            System.out.println(r1.getString(<span class="number">0</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 运行，可以发现结果的四个字段就是strcat 逐步拼接的结果  <br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/09.webp"
                     
                ><br> <br /> 对来源 0xbffff69b 做traceWrite，千万记得加后缀L。  <br /> 发现依然来自于libc，这不是好事，说明我们还没到第一现场。  <br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/10.webp"
                     
                ><br> <br />从IDA跳到地址 0x176dc，看到是在_memcpy_base函数里</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall <span class="title function_">_memcpy_base</span><span class="params">(<span class="type">int</span> a1, <span class="type">char</span> *a2, unsigned <span class="type">int</span> a3, <span class="type">int</span> a4, <span class="type">int</span> a5,</span></span><br><span class="line"><span class="params"><span class="type">int</span> a6)</span></span><br></pre></td></tr></table></figure>
<p> 它应该是memcpy函数内部的子函数，我们Hook一下memcpy，其原型如下  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">void</span> *memcpy(<span class="keyword">void</span> *str1, const <span class="keyword">void</span> *str2, size_t n)</span><br></pre></td></tr></table></figure>

<ul>
<li><strong><font color="red">str1 – 指向用于存储复制内容的目标数组，类型强制转换为 void* 指针。</strong></font> </li>
<li><strong><font color="red">str2 – 指向要复制的数据源，类型强制转换为 void* 指针。</strong></font> </li>
<li><strong><font color="red">n – 要被复制的字节数。</strong></font></li>
</ul>
<p> 我们打印str2，长度为n  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookMemcpy</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;memcpy&quot;</span>,</span><br><span class="line">            <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">            <span class="type">UnidbgPointer</span> <span class="variable">r1</span> <span class="operator">=</span> emulator.getContext().getPointerArg(<span class="number">1</span>);</span><br><span class="line">            <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> emulator.getContext().getIntArg(<span class="number">2</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;memcpy&quot;</span>);</span><br><span class="line">            Inspector.inspect(r1.getByteArray(<span class="number">0</span>, length), r1.toString());</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 运行发现，程序逻辑上逐两个字节进行拷贝  <br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/11.webp"
                     
                ><br> <br />140处调用。看的头疼，所以我尝试性的搜索了下3c179e17e8e9b06d7b18c68555b92220，期待某次 memcpy可以看到它，那么我们就能找到它的产生之处了。  <br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/12.webp"
                     
                ><br> <br /> 打印memcpy的str2时，我采用了Unidbg的Inspect API，它会在 打印内存块时，顺带打印数据的MD5值，这个设计主要是为了比较两个内存块是否全然等值，但这里却 帮到了我们。  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="number">0000</span>: <span class="number">61</span> <span class="number">69</span> <span class="number">64</span> <span class="number">3D</span> <span class="number">61</span> 6E <span class="number">64</span> <span class="number">72</span> <span class="number">6F</span> <span class="number">69</span> <span class="number">64</span> <span class="number">31</span> <span class="number">26</span> <span class="number">63</span> 6C <span class="number">69</span>    aid=android1&amp;cli</span><br><span class="line"><span class="number">0010</span>: <span class="number">65</span> 6E <span class="number">74</span> <span class="number">5F</span> <span class="number">73</span> <span class="number">79</span> <span class="number">73</span> <span class="number">3D</span> <span class="number">61</span> 6E <span class="number">64</span> <span class="number">72</span> <span class="number">6F</span> <span class="number">69</span> <span class="number">64</span> <span class="number">26</span>    ent_sys=android&amp;</span><br><span class="line"><span class="number">0020</span>: <span class="number">74</span> <span class="number">69</span> <span class="number">6D</span> <span class="number">65</span> <span class="number">3D</span> <span class="number">31</span> <span class="number">36</span> <span class="number">37</span> <span class="number">33</span> <span class="number">32</span> <span class="number">33</span> <span class="number">32</span> <span class="number">30</span> <span class="number">31</span> <span class="number">35</span> <span class="number">76</span>    time=1673232015v</span><br><span class="line"><span class="number">0030</span>: <span class="number">71</span> <span class="number">34</span> <span class="number">37</span> <span class="number">48</span> <span class="number">64</span> <span class="number">39</span> 4A <span class="number">55</span> <span class="number">67</span> <span class="number">66</span> <span class="number">44</span> <span class="number">43</span> <span class="number">79</span> <span class="number">74</span> <span class="number">43</span>       q47Hd9JUgfDCytC</span><br></pre></td></tr></table></figure>
<p>vq47Hd9JUgfDCytC 这十个字节是未知的，其余三个字段是传进来的，我们结合上面的MD5会产生一种 明悟，这不就是加盐MD5吗？传进来的参数拼接后加上”vq47Hd9JUgfDCytC“，MD5后传出去。 <br />那么现在问题就变成了，vq47Hd9JUgfDCytC是哪里来的？  <br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/13.webp"
                     
                ><br><br /> 对0xbffff500L 做traceWrite  <br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/14.webp"
                     
                ><br><br /> ida打开libmakeurl.so，看一下来源0x8a88，十六个字节都来自这里  <br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/15.webp"
                     
                ><br><br /> 前面我们用过Findcrypt，有看到RijnDael_AES_LONG_inv_45FC4，它自动将0x8a9e所位于的函数中，一个数组标记为AES的S逆盒。这告诉我们，十六字节的生成处是AES的运算逻辑。换而言之，这十六字节大概率是AES加密或解密的输出。  <br />可是，样本使用了Ollvm，比如0x8a9e这一行，就是Ollvm中的指令替换。 <br />我们先不要陷入函数的细节里，因为如果是标准AES，那根本不用 分析加密程序的内部，自然也就不用考虑这些混淆了。  <br /> 0x8a88 位于 sub_8228 函数内，Hook sub_8228，顺利断下  <br /> 观察两个参数  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_8228</span><span class="params">(unsigned __int64 a1, _QWORD *a2)</span></span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/16.webp"
                     
                ><br><br /> 参数2像是buffer，存放加密结果。blr用于在函数返回处下断点，然后c继续跑，在函数运行结束后再次 查看参数2指向的内存。  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/17.webp"
                     
                ></p>
<p>可以发现确实是我们要分析的十六个字节。至于参数1是什么意思，硬看似乎看不出来。 <br />因此可以判断，sub_8228生成了我们要分析的十六个字节，而且它像AES的执行逻辑。 <br />AES 加密还是解密？什么工作模式？明文是什么？Key是什么？一概不知。我们得到sub_8228上层去看看。 <br />重新运行程序，bt 打印调用栈  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/18.webp"
                     
                ><br />跳到 0x08ba7 看一下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> __fastcall <span class="title function_">sub_8B3C</span><span class="params">(const <span class="type">char</span> *a1, <span class="type">int</span> a2, <span class="type">int</span> a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  signed <span class="type">int</span> i; <span class="comment">// r0</span></span><br><span class="line">  <span class="type">int</span> v7; <span class="comment">// r1</span></span><br><span class="line">  <span class="type">int</span> v8; <span class="comment">// r1</span></span><br><span class="line">  signed <span class="type">int</span> v10; <span class="comment">// [sp+4h] [bp-144h]</span></span><br><span class="line">  signed <span class="type">int</span> v11; <span class="comment">// [sp+Ch] [bp-13Ch]</span></span><br><span class="line">  <span class="type">char</span> v12[<span class="number">280</span>]; <span class="comment">// [sp+10h] [bp-138h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v13; <span class="comment">// [sp+128h] [bp-20h]</span></span><br><span class="line"></span><br><span class="line">  v10 = (strlen(a1) + <span class="number">15</span>) &gt;&gt; <span class="number">4</span>;</span><br><span class="line">  sub_72BC(v12, a2, <span class="number">128</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; ; i = v11 + <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = <span class="number">1590846758</span>;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v8 = v7 &amp; <span class="number">0x7FFFFFFF</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v8 != <span class="number">1590846758</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      v11 = i;</span><br><span class="line">      v7 = <span class="number">131555431</span>;</span><br><span class="line">      <span class="keyword">if</span> ( i &lt; v10 )</span><br><span class="line">        v7 = <span class="number">1574041125</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v8 == <span class="number">131555431</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">if</span> ( v8 != <span class="number">1574041125</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">    sub_8228(v12, a3 + <span class="number">16</span> * v11, &amp;a1[<span class="number">16</span> * v11]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> _stack_chk_guard - v13;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 首先我们知道，sub_8228是AES的具体运算程序，刚才Hook确认了这一点。而密钥编排一般发生在具 体运算前面，即早于sub_8228。整个函数体内，就只有sub_72BC 一个函数了，那也可能在sub_8B3C外层。更重要的线索是它的参数3，128。AES 存在128&#x2F;192&#x2F;256 三种密钥的规格，这里就是在指定AES的规格，并生成对应的轮密钥。 char v12[280]; v12是一个较大的数组，用于存放生成轮密钥的结果。<br />那么可以大胆猜测sub_8B3C的a2就是十六字节长的AES-128密钥。进而参数1就是 十六字节的输入。  <br />对 sub_8B3C 进行断点查看参数<br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/19.webp"
                     
                ><br> <br />密钥是30292827262524232221000000000000，暂时不知道是加密还是解密，结果是 767134374864394a5567664443797443（vq47Hd9JUgfDCytC）<br />看看加密过程对的上吗<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/20.webp"
                     
                ><br> <br />因为aes会对明文进行填充，它会自动按照PKCS7约定，再次填充一个分组的长度，输出也是两个分组的结果。  这里结果a7488462036f15054005472d6f487c67才是对的，后面是填充后的分组加密而来的可以不用管<br />跟我们上面的 sub_8B3C 的参数一是一致的，说明 vq47Hd9JUgfDCytC 是由明文a7488462036f15054005472d6f487c67，密钥30292827262524232221000000000000解密而来的</p>
<p>我们这里做一个讨论，如何从一个小的线索点，分析出AES的全貌。<br />以 sub_72BC(v12, a2, 128); 为例，我们猜测它是密钥编排函数，那么如何快速验证呢？ <br />我Hook 入参时a2指向的十六字节，以及函数结束后v13指向的176字节（因为是AES-128，所以轮密钥 是4*44）。  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook72bc</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x72bc</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        UnidbgPointer v12;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">            <span class="type">RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">            <span class="type">UnidbgPointer</span> <span class="variable">a2</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">1</span>);</span><br><span class="line">            v12 = registerContext.getPointerArg(<span class="number">0</span>);</span><br><span class="line">            Inspector.inspect(a2.getByteArray(<span class="number">0</span>, <span class="number">0x10</span>), <span class="string">&quot;key &quot;</span> + a2.toString());</span><br><span class="line">            <span class="comment">// 函数结束对v12hook查看</span></span><br><span class="line">            emulator.attach().addBreakPoint(registerContext.getLRPointer().peer, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                    Inspector.inspect(v12.getByteArray(<span class="number">0</span>, <span class="number">176</span>), <span class="string">&quot;Round Key &quot;</span>+v12.toString());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&gt;-----------------------------------------------------------------------------&lt;</span><br><span class="line">[<span class="number">17</span>:<span class="number">01</span>:<span class="number">35</span> <span class="number">327</span>]key unidbg@<span class="number">0xbffff3d8</span>, md5=037ff8eefc91404afaed9fa22e282e3f, hex=<span class="number">30292827262524232221000000000000</span></span><br><span class="line">size: <span class="number">16</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">30</span> <span class="number">29</span> <span class="number">28</span> <span class="number">27</span> <span class="number">26</span> <span class="number">25</span> <span class="number">24</span> <span class="number">23</span> <span class="number">22</span> <span class="number">21</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="number">0</span>)(<span class="string">&#x27;&amp;%$#&quot;!......</span></span><br><span class="line"><span class="string">^-----------------------------------------------------------------------------^</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;-----------------------------------------------------------------------------&lt;</span></span><br><span class="line"><span class="string">[17:01:35 336]Round Key unidbg@0xbffff290, md5=159aaceb29acbcbd8d87b091ce103546, hex=0a00000098f2ffbf30292827262524232221000000000000524a4b44746f6f67564e6f67564e6f677fe2cef50b8da1925dc3cef50b8da19226d081de2d5d204c709eeeb97b134f2b535470ff7e0950b30e97be0a7584f1211cf58d6262fcddd16c6b63db19ef92fae3baa0b681467d67ed2d1ebcf4c28c4686defa090798876eeab599d21e771594f387d87bf41f5f151eaac6c700ddd35329e13518ddfe6a0dc354accac3897f99b833db3665cdb13b</span></span><br><span class="line"><span class="string">size: 176</span></span><br><span class="line"><span class="string">0000: 0A 00 00 00 98 F2 FF BF 30 29 28 27 26 25 24 23    ........0)(&#x27;</span>&amp;%$#</span><br><span class="line"><span class="number">0010</span>: <span class="number">22</span> <span class="number">21</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">52</span> 4A 4B <span class="number">44</span> <span class="number">74</span> <span class="number">6F</span> <span class="number">6F</span> <span class="number">67</span>    <span class="string">&quot;!......RJKDtoog</span></span><br><span class="line"><span class="string">0020: 56 4E 6F 67 56 4E 6F 67 7F E2 CE F5 0B 8D A1 92    VNogVNog........</span></span><br><span class="line"><span class="string">0030: 5D C3 CE F5 0B 8D A1 92 26 D0 81 DE 2D 5D 20 4C    ].......&amp;...-] L</span></span><br><span class="line"><span class="string">0040: 70 9E EE B9 7B 13 4F 2B 53 54 70 FF 7E 09 50 B3    p...&#123;.O+STp.~.P.</span></span><br><span class="line"><span class="string">0050: 0E 97 BE 0A 75 84 F1 21 1C F5 8D 62 62 FC DD D1    ....u..!...bb...</span></span><br><span class="line"><span class="string">0060: 6C 6B 63 DB 19 EF 92 FA E3 BA A0 B6 81 46 7D 67    lkc..........F&#125;g</span></span><br><span class="line"><span class="string">0070: ED 2D 1E BC F4 C2 8C 46 86 DE FA 09 07 98 87 6E    .-.....F.......n</span></span><br><span class="line"><span class="string">0080: EA B5 99 D2 1E 77 15 94 F3 87 D8 7B F4 1F 5F 15    .....w.....&#123;.._.</span></span><br><span class="line"><span class="string">0090: 1E AA C6 C7 00 DD D3 53 29 E1 35 18 DD FE 6A 0D    .......S).5...j.</span></span><br><span class="line"><span class="string">00A0: C3 54 AC CA C3 89 7F 99 B8 33 DB 36 65 CD B1 3B    .T.......3.6e..;</span></span><br><span class="line"><span class="string">^-----------------------------------------------------------------------------^</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure>

<p> RoundKey 的结果像是一个结构体，两个int组成，第一个是0x0000000a，即代表了AES-128的十轮运 算，第二个是指针，值为0xbffff298，是v12往后偏移八个字节。  <br /> 我们不妨修改一下hook72bc，看一下0xbffff298具体打印什么  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook72bc</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x72bc</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        UnidbgPointer v12;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">            <span class="type">RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">            <span class="type">UnidbgPointer</span> <span class="variable">a2</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">1</span>);</span><br><span class="line">            v12 = registerContext.getPointerArg(<span class="number">0</span>);</span><br><span class="line">            Inspector.inspect(a2.getByteArray(<span class="number">0</span>, <span class="number">0x10</span>), <span class="string">&quot;key &quot;</span> + a2.toString());</span><br><span class="line">            <span class="comment">// 函数结束对v12hook查看</span></span><br><span class="line">            emulator.attach().addBreakPoint(registerContext.getLRPointer().peer, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                    <span class="comment">//Inspector.inspect(v12.getByteArray(0, 176), &quot;Round Key &quot;+v12.toString());</span></span><br><span class="line">                    Inspector.inspect(v12.getByteArray(<span class="number">8</span>, <span class="number">176</span>), <span class="string">&quot;Round Key &quot;</span>+v12.toString());</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 结果如下  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">[<span class="number">17</span>:<span class="number">20</span>:<span class="number">19</span> <span class="number">949</span>]key unidbg@<span class="number">0xbffff3d8</span>, md5=037ff8eefc91404afaed9fa22e282e3f, hex=<span class="number">30292827262524232221000000000000</span></span><br><span class="line">size: <span class="number">16</span></span><br><span class="line"><span class="number">0000</span>: <span class="number">30</span> <span class="number">29</span> <span class="number">28</span> <span class="number">27</span> <span class="number">26</span> <span class="number">25</span> <span class="number">24</span> <span class="number">23</span> <span class="number">22</span> <span class="number">21</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>    <span class="number">0</span>)(<span class="string">&#x27;&amp;%$#&quot;!......</span></span><br><span class="line"><span class="string">^-----------------------------------------------------------------------------^</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&gt;-----------------------------------------------------------------------------&lt;</span></span><br><span class="line"><span class="string">[17:20:19 957]Round Key unidbg@0xbffff290, md5=1a32868f8f948e426e209b5995588178, hex=30292827262524232221000000000000524a4b44746f6f67564e6f67564e6f677fe2cef50b8da1925dc3cef50b8da19226d081de2d5d204c709eeeb97b134f2b535470ff7e0950b30e97be0a7584f1211cf58d6262fcddd16c6b63db19ef92fae3baa0b681467d67ed2d1ebcf4c28c4686defa090798876eeab599d21e771594f387d87bf41f5f151eaac6c700ddd35329e13518ddfe6a0dc354accac3897f99b833db3665cdb13ba6991df165106268</span></span><br><span class="line"><span class="string">size: 176</span></span><br><span class="line"><span class="string">0000: 30 29 28 27 26 25 24 23 22 21 00 00 00 00 00 00    0)(&#x27;</span>&amp;%$#<span class="string">&quot;!......</span></span><br><span class="line"><span class="string">0010: 52 4A 4B 44 74 6F 6F 67 56 4E 6F 67 56 4E 6F 67    RJKDtoogVNogVNog</span></span><br><span class="line"><span class="string">0020: 7F E2 CE F5 0B 8D A1 92 5D C3 CE F5 0B 8D A1 92    ........].......</span></span><br><span class="line"><span class="string">0030: 26 D0 81 DE 2D 5D 20 4C 70 9E EE B9 7B 13 4F 2B    &amp;...-] Lp...&#123;.O+</span></span><br><span class="line"><span class="string">0040: 53 54 70 FF 7E 09 50 B3 0E 97 BE 0A 75 84 F1 21    STp.~.P.....u..!</span></span><br><span class="line"><span class="string">0050: 1C F5 8D 62 62 FC DD D1 6C 6B 63 DB 19 EF 92 FA    ...bb...lkc.....</span></span><br><span class="line"><span class="string">0060: E3 BA A0 B6 81 46 7D 67 ED 2D 1E BC F4 C2 8C 46    .....F&#125;g.-.....F</span></span><br><span class="line"><span class="string">0070: 86 DE FA 09 07 98 87 6E EA B5 99 D2 1E 77 15 94    .......n.....w..</span></span><br><span class="line"><span class="string">0080: F3 87 D8 7B F4 1F 5F 15 1E AA C6 C7 00 DD D3 53    ...&#123;.._........S</span></span><br><span class="line"><span class="string">0090: 29 E1 35 18 DD FE 6A 0D C3 54 AC CA C3 89 7F 99    ).5...j..T......</span></span><br><span class="line"><span class="string">00A0: B8 33 DB 36 65 CD B1 3B A6 99 1D F1 65 10 62 68    .3.6e..;....e.bh</span></span><br><span class="line"><span class="string">^-----------------------------------------------------------------------------^</span></span><br></pre></td></tr></table></figure>

<p> 首先我们就可以确定，这就是密钥编排的结果，这是我们根据AES-128的编排性质推断出来的。 </p>
<ul>
<li>轮密钥的前十六个字节就是主密钥，完全符合 </li>
<li>十六个字节后面的编排规则，以行为单位看的话，前四个字节较为复杂，后十二字节只是简单异 或。如下验证</li>
</ul>
<p>密钥 30 29 28 27 26 25 24 23 22 21 00 00 00 00 00 00<br />按照密钥的编排 4个字节一组<br />W0 30 29 28 27<br />W1 26 25 24 23<br />W2 22 21 00 00<br />W3 00 00 00 00<br />根据结果我们也可以看出<br />W4 &#x3D; 52 4A 4B 44<br />W5 &#x3D; 74 6F 6F 67<br />验证可以得到 W4 xor W1 &#x3D; W5</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">C:\Users\zsk&gt;python</span><br><span class="line">Python <span class="number">3.8</span><span class="number">.10</span> (tags/v3<span class="number">.8</span><span class="number">.10</span>:3d8993a, May  <span class="number">3</span> <span class="number">2021</span>, <span class="number">11</span>:<span class="number">48</span>:<span class="number">03</span>) [MSC v<span class="number">.1928</span> <span class="number">64</span> bit (AMD64)] on win32</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; hex(<span class="number">0x524A4B44</span>^<span class="number">0x26252423</span>)</span><br><span class="line"><span class="string">&#x27;0x746f6f67&#x27;</span></span><br></pre></td></tr></table></figure>
<p> 确实符合编排的规律。  <br /><br><strong><font color="red">因此可以认定 72bc 就是密钥编排函数，并确定了密钥。怎么仅从这个线索，推出输入呢？</strong></font></p>
<ul>
<li><strong><font color="red">如果是加密，那么对K0做traceRead可以定位到算法的输入，对K10做traceRead，其运算结果就是算法 的输出。</strong></font></li>
<li><strong><font color="red">如果是解密，那么对K0做traceRead可以定位算法的输出，对K10做traceRead，其运算结果就是算法的 输入。</strong></font></li>
</ul>
<p><strong><font color="red">换个情况，如果只知道算法的输入，该怎么确认密钥呢？</strong></font></p>
<ul>
<li><strong><font color="red">如果是加密，那么对算法的输入做traceRead，可以定位到K0，在AES-128上意味着主密钥；</strong></font></li>
<li><strong><font color="red">如果是CBC 模式，那么定位到IV。 如果是解密，那么对算法的输入做traceRead，可以定位到K10，使用stark 逆推主密钥。</strong></font></li>
</ul>
<p><strong><font color="red">再换个情况，如果只知道算法的输出，该怎么确认其他要素？</strong></font></p>
<ul>
<li><strong><font color="red">如果是加密过程，对算法的输出做traceWrite，运算的双方中有一方是K10。</strong></font> </li>
<li><strong><font color="red">如果是解密过程，对算法的输出做traceWrite，运算的双方中有一方是K0。</strong></font></li>
</ul>
<p>下面考虑Key和密文哪里来的 在sub_8B3C打断点，查看堆栈，发现都位于 sub_A298  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> __fastcall <span class="title">sub_A298</span><span class="params">(<span class="type">void</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">int</span> v1; <span class="comment">// r9</span></span><br><span class="line">    <span class="type">int</span> v3; <span class="comment">// r11</span></span><br><span class="line">    <span class="type">int</span> i; <span class="comment">// r0</span></span><br><span class="line">    <span class="type">int</span> v6; <span class="comment">// [sp+0h] [bp-78h]</span></span><br><span class="line">    <span class="type">int</span> v7; <span class="comment">// [sp+4h] [bp-74h]</span></span><br><span class="line">    _QWORD v8[<span class="number">2</span>]; <span class="comment">// [sp+8h] [bp-70h] BYREF</span></span><br><span class="line">    <span class="type">char</span> v9[<span class="number">20</span>]; <span class="comment">// [sp+18h] [bp-60h] BYREF</span></span><br><span class="line">    _QWORD v10[<span class="number">2</span>]; <span class="comment">// [sp+30h] [bp-48h] BYREF</span></span><br><span class="line">    <span class="type">char</span> v11[<span class="number">20</span>]; <span class="comment">// [sp+40h] [bp-38h] BYREF</span></span><br><span class="line">    <span class="type">int</span> v12; <span class="comment">// [sp+58h] [bp-20h]</span></span><br><span class="line"></span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    v10[<span class="number">0</span>] = unk_45688;</span><br><span class="line">    v10[<span class="number">1</span>] = unk_45690;</span><br><span class="line">    <span class="built_in">strcpy</span>(v11, <span class="string">&quot;                &quot;</span>);</span><br><span class="line">    v8[<span class="number">0</span>] = unk_45CF0;</span><br><span class="line">    v8[<span class="number">1</span>] = unk_45CF8;</span><br><span class="line">    <span class="built_in">strcpy</span>(v9, <span class="string">&quot;                &quot;</span>);</span><br><span class="line">    <span class="built_in">memset</span>(a1, <span class="number">0</span>, <span class="number">0x100</span>u);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">1282341844</span>; ; i = <span class="number">1282341844</span> )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> ( i != <span class="number">967467364</span> )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( i == <span class="number">1282341844</span> )</span><br><span class="line">                    &#123;</span><br><span class="line">                        v6 = v3;</span><br><span class="line">                        i = <span class="number">1618205161</span>;</span><br><span class="line">                        <span class="keyword">if</span> ( v3 &lt; <span class="number">32</span> )</span><br><span class="line">                            i = <span class="number">-1314423687</span>;</span><br><span class="line">                        <span class="keyword">if</span> ( i &lt;= <span class="number">967467363</span> )</span><br><span class="line">                            <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        v1 = <span class="number">0</span>;</span><br><span class="line">                        LABEL_14:</span><br><span class="line">                        i = <span class="number">967467364</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            v7 = v1;</span><br><span class="line">            i = <span class="number">-688078044</span>;</span><br><span class="line">            <span class="keyword">if</span> ( v1 &lt; <span class="number">32</span> )</span><br><span class="line">                i = <span class="number">-1194610101</span>;</span><br><span class="line">            LABEL_15:</span><br><span class="line">            <span class="keyword">if</span> ( i != <span class="number">-1314423687</span> )</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            *((_BYTE *)v8 + v6) = (*((_BYTE *)v8 + v6) &amp; <span class="number">0x8E</span> | ~*((_BYTE *)v8 + v6) &amp; <span class="number">0x71</span>) ^ <span class="number">0x51</span>;</span><br><span class="line">            v3 = v6 + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">if</span> ( i == <span class="number">-1194610101</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        *((_BYTE *)v10 + v7) = (~*((_BYTE *)v10 + v7) &amp; <span class="number">0xE9</span> | *((_BYTE *)v10 + v7) &amp; <span class="number">0x16</span>) ^ <span class="number">0xC9</span>;</span><br><span class="line">        v1 = v7 + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">sub_8B3C</span>((<span class="type">const</span> <span class="type">char</span> *)v10, (<span class="type">int</span>)v8, (<span class="type">int</span>)a1);</span><br><span class="line">    <span class="keyword">return</span> _stack_chk_guard - v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 其中v10 ， 前八个字节来自0x45688，后八个字节来自0x45690。因为这两个八字节是紧连着的，所以可 以一并看。  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">.rodata:<span class="number">00045688</span> <span class="number">87</span>                            unk_45688 DCB <span class="number">0x87</span>                      ; DATA XREF: sub_A298+E↑o</span><br><span class="line">.rodata:<span class="number">00045688</span>                                                                       ; sub_A298+<span class="number">18</span>↑o</span><br><span class="line">.rodata:<span class="number">00045688</span>                                                                       ; .text:off_A424↑o</span><br><span class="line">.rodata:<span class="number">00045689</span> <span class="number">68</span>                            DCB <span class="number">0x68</span> ; h</span><br><span class="line">.rodata:<span class="number">0004568</span>A A4                            DCB <span class="number">0xA4</span></span><br><span class="line">.rodata:<span class="number">0004568B</span> <span class="number">42</span>                            DCB <span class="number">0x42</span> ; B</span><br><span class="line">.rodata:<span class="number">0004568</span>C <span class="number">23</span>                            DCB <span class="number">0x23</span> ; #</span><br><span class="line">.rodata:<span class="number">0004568</span>D <span class="number">4F</span>                            DCB <span class="number">0x4F</span> ; O</span><br><span class="line">.rodata:<span class="number">0004568</span>E <span class="number">35</span>                            DCB <span class="number">0x35</span> ; <span class="number">5</span></span><br><span class="line">.rodata:<span class="number">0004568F</span> <span class="number">25</span>                            DCB <span class="number">0x25</span> ; %</span><br><span class="line">.rodata:<span class="number">00045690</span> <span class="number">60</span>                            unk_45690 DCB <span class="number">0x60</span> ; `</span><br><span class="line">.rodata:<span class="number">00045691</span> <span class="number">25</span>                            DCB <span class="number">0x25</span> ; %</span><br><span class="line">.rodata:<span class="number">00045692</span> <span class="number">67</span>                            DCB <span class="number">0x67</span> ; g</span><br><span class="line">.rodata:<span class="number">00045693</span> <span class="number">0</span>D                            DCB  <span class="number">0xD</span></span><br><span class="line">.rodata:<span class="number">00045694</span> <span class="number">4F</span>                            DCB <span class="number">0x4F</span> ; O</span><br><span class="line">.rodata:<span class="number">00045695</span> <span class="number">68</span>                            DCB <span class="number">0x68</span> ; h</span><br><span class="line">.rodata:<span class="number">00045696</span> <span class="number">5</span>C                            DCB <span class="number">0x5C</span> ; \</span><br><span class="line">.rodata:<span class="number">00045697</span> <span class="number">47</span>                            DCB <span class="number">0x47</span> ; G</span><br></pre></td></tr></table></figure>

<p> 在逐字节经过如下处理后成为我们的密文  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">*((_BYTE *)v10 + v7) = (~*((_BYTE *)v10 + v7) &amp; <span class="number">0xE9</span> | *((_BYTE *)v10 + v7) &amp; <span class="number">0x16</span>) ^ <span class="number">0xC9</span>;</span><br></pre></td></tr></table></figure>
<p> <br />而密钥也一样，前八个字节来自0x45CF0，后八个字节来自0x45CF8。</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">.rodata:<span class="number">00045</span>CF0 <span class="number">10</span>                            unk_45CF0 DCB <span class="number">0x10</span>                      ; DATA XREF: sub_A298+<span class="number">24</span>↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A298+<span class="number">2</span>C↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; .text:off_A428↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A430+<span class="number">50</span>↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A430+<span class="number">5</span>E↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; .text:off_A5D0↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A5D8+<span class="number">4</span>E↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A5D8+<span class="number">5</span>C↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; .text:off_A770↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A778+<span class="number">4</span>E↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A778+<span class="number">5</span>C↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; .text:off_A910↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A918+<span class="number">50</span>↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; sub_A918+<span class="number">5</span>E↑o</span><br><span class="line">.rodata:<span class="number">00045</span>CF0                                                                       ; .text:off_AAA4↑o ...</span><br><span class="line">.rodata:<span class="number">00045</span>CF1 <span class="number">09</span>                            DCB    <span class="number">9</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF2 <span class="number">08</span>                            DCB    <span class="number">8</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF3 <span class="number">07</span>                            DCB    <span class="number">7</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF4 <span class="number">06</span>                            DCB    <span class="number">6</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF5 <span class="number">05</span>                            DCB    <span class="number">5</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF6 <span class="number">04</span>                            DCB    <span class="number">4</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF7 <span class="number">03</span>                            DCB    <span class="number">3</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF8 <span class="number">02</span>                            unk_45CF8 DCB    <span class="number">2</span></span><br><span class="line">.rodata:<span class="number">00045</span>CF9 <span class="number">01</span>                            DCB    <span class="number">1</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFA <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFB <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFC <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFD <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFE <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br><span class="line">.rodata:<span class="number">00045</span>CFF <span class="number">20</span>                            DCB <span class="number">0x20</span></span><br></pre></td></tr></table></figure>
<p> 它经过了如下逐字节的处理  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">*((_BYTE *)v8 + v6) = (*((_BYTE *)v8 + v6) &amp; <span class="number">0x8E</span> | ~*((_BYTE *)v8 + v6) &amp; <span class="number">0x71</span>) ^ <span class="number">0x51</span>;</span><br></pre></td></tr></table></figure>
<p> 看起来有些云里雾里的，这是Ollvm中指令替换的功劳。  <br /> 真正功能上而言，只是SO中硬编码的两串十六进制字节，在异或0x20后，就成为了密文和Key，在运行 时AES解密出明文，作为MD5的盐。  <br /> 我们以Key为例，它的完整流程如下（下面均为十六进制字节）  <br /> 首先，Key是 30 29 28 27 26 25 24 23 22 21 00 00 00 00 00 00，开发者不希望硬编码在SO里，所以先 将它异或0x20，在SO中硬编码即 10 09 08 07 06 05 04 03 02 01 20 20 20 20 20 20。  <br /> 然后在使用时，将这么一串异或0x20，因为异或两次等于自身，所以Key重新变成30 29 28 27 26 25 24 23 22 21 00 00 00 00 00 00，正常参与运算。  </p>
<p> 那么下面这两种运算，其功能都等价于单字节异或0x20，怎么变成这个样子了呢？  </p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">*((_BYTE *)v10 + v7) = (~*((_BYTE *)v10 + v7) &amp; <span class="number">0xE9</span> | *((_BYTE *)v10 + v7) &amp; <span class="number">0x16</span>) ^ <span class="number">0xC9</span>;</span><br><span class="line">*((_BYTE *)v8 + v6) = (*((_BYTE *)v8 + v6) &amp; <span class="number">0x8E</span> | ~*((_BYTE *)v8 + v6) &amp; <span class="number">0x71</span>) ^ <span class="number">0x51</span>;</span><br></pre></td></tr></table></figure>
<p> <br />这就是指令替换的目的，将简单的加减乘除、异或、与等运算，替换成等价但更复杂的指令序列。  <br />演示一下这个过程 <br />S &#x3D; A ^ B <br />异或0不影响结果 <br />S &#x3D; A ^ B ^ 0 <br />0可以展开成C ^ C <br />S &#x3D; A ^ B ^ C ^ C <br />做一下简单的分配 <br />S &#x3D; (A^C)^(B^C) <br />两数异或时可以等价替换如下，可以自行验证。  <br /> </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">a ^ b =&gt; (~a &amp; b) | (a &amp; ~b) </span><br></pre></td></tr></table></figure>
<p>那么</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S = (~A &amp; C) | (A &amp; ~C) ^ (~B &amp; C) | (B &amp; ~C)</span><br></pre></td></tr></table></figure>
<br />  
 回到 S = A ^ B，假设A 就是我们的待处理数据，B是0x20，即将数据和0x20异或，我们再选择C为0xE9 
 
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S = (~A &amp; 0xE9) | (A &amp; ~0xE9) ^ (~0x20 &amp; 0xE9) | (0x20 &amp; ~0xE9)</span><br></pre></td></tr></table></figure>
<p> <br /> 0xE9 在取反后即 0x16，而异或的另外一方，因为不存在未知数，编译器会直接优化计算出结果  <br /></p>
<p> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230109/21.webp"
                     
                ></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">S = (~A &amp; 0xE9) | (A &amp; 0xE9) ^ 0xC9</span><br></pre></td></tr></table></figure>
<p>  <br /> A 代入 *((_BYTE *)v10 + v7) 不就是 <br /></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">*((_BYTE *)v10 + v7) = (~*((_BYTE *)v10 + v7) &amp; 0xE9) | (*((_BYTE *)v10 + v7) &amp; 0xE9) ^ 0xC9</span><br></pre></td></tr></table></figure>
<p>A 代入 *((_BYTE *)v8 + v6) ，C 为0x71时，就是 另一个式子。 <br />本质上，两者都是逐字节与0x20异或。  </p>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.douyu;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Emulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.Backend;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.CodeHook;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.backend.UnHook;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.context.RegisterContext;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.debugger.BreakPointCallback;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.array.ArrayObject;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.utils.Inspector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DouYu</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DouYu</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().build();</span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/douyu.apk&quot;</span>));</span><br><span class="line">        vm.setVerbose(<span class="literal">true</span>);</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm_shared</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libc++_shared.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        dm_shared.callJNI_OnLoad(emulator);</span><br><span class="line"></span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/demo/douyu/libmakeurl2.5.0.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// NewStringUTF断点</span></span><br><span class="line">        <span class="comment">//emulator.attach().addBreakPoint(module.base + 0x336c);</span></span><br><span class="line">        <span class="comment">// 监控地址写入, auth的32个字节所处的地址， 401d20a0 + len(aid=android1&amp;client_sys=android&amp;time=1638452332&amp;auth=)</span></span><br><span class="line">        <span class="comment">//emulator.traceWrite(0x401D20D5, 0x401D20D5+0x20);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 监控strcat函数，看结果是在哪里写入的</span></span><br><span class="line">        <span class="comment">//emulator.traceWrite(0xbffff69bL, 0xbffff69bL+0x20);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对 vq47Hd9JUgfDCytC 做traceWrite</span></span><br><span class="line">        <span class="comment">//emulator.traceWrite(0xbffff500L, 0xbffff69bL+0x20);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对 vq47Hd9JUgfDCytC 出现的位置函数 sub_8228(unsigned __int64 a1, _QWORD *a2) 进行断点</span></span><br><span class="line">        <span class="comment">//emulator.attach().addBreakPoint(module.base + 0x8228);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对调用生成 vq47Hd9JUgfDCytC 函数的上一级断点</span></span><br><span class="line">        emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x8B3C</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getMakeUrl</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// args list</span></span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">// arg1 env</span></span><br><span class="line">        list.add(vm.getJNIEnv());</span><br><span class="line">        <span class="comment">// arg2 jobject/jclazz 一般用不到，直接填0</span></span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="literal">null</span>);</span><br><span class="line">        list.add(vm.addLocalObject(context));</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;aid&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;client_sys&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input3_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;time&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input3_1);</span><br><span class="line">        vm.addLocalObject(input3_2);</span><br><span class="line">        vm.addLocalObject(input3_3);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input3_1, input3_2, input3_3)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;android1&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;android&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input4_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;1673232015&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input4_1);</span><br><span class="line">        vm.addLocalObject(input4_2);</span><br><span class="line">        vm.addLocalObject(input4_3);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input4_1, input4_2, input4_3)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_11</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_12</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input5_13</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input5_1);</span><br><span class="line">        vm.addLocalObject(input5_2);</span><br><span class="line">        vm.addLocalObject(input5_3);</span><br><span class="line">        vm.addLocalObject(input5_4);</span><br><span class="line">        vm.addLocalObject(input5_5);</span><br><span class="line">        vm.addLocalObject(input5_6);</span><br><span class="line">        vm.addLocalObject(input5_7);</span><br><span class="line">        vm.addLocalObject(input5_8);</span><br><span class="line">        vm.addLocalObject(input5_9);</span><br><span class="line">        vm.addLocalObject(input5_10);</span><br><span class="line">        vm.addLocalObject(input5_11);</span><br><span class="line">        vm.addLocalObject(input5_12);</span><br><span class="line">        vm.addLocalObject(input5_13);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input5_1, input5_2, input5_3,input5_4, input5_5, input5_6,input5_7, input5_8, input5_9,input5_10, input5_11, input5_12,input5_13)));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">input6_10</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        vm.addLocalObject(input6_1);</span><br><span class="line">        vm.addLocalObject(input6_2);</span><br><span class="line">        vm.addLocalObject(input6_3);</span><br><span class="line">        vm.addLocalObject(input6_4);</span><br><span class="line">        vm.addLocalObject(input6_5);</span><br><span class="line">        vm.addLocalObject(input6_6);</span><br><span class="line">        vm.addLocalObject(input6_7);</span><br><span class="line">        vm.addLocalObject(input6_8);</span><br><span class="line">        vm.addLocalObject(input6_9);</span><br><span class="line">        vm.addLocalObject(input6_10);</span><br><span class="line">        list.add(vm.addLocalObject(<span class="keyword">new</span> <span class="title class_">ArrayObject</span>(input6_1, input6_2, input6_3,input6_4, input6_5, input6_6,input6_7, input6_8, input6_9,input6_10)));</span><br><span class="line">        list.add(<span class="number">0</span>);</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 参数准备完成</span></span><br><span class="line">        <span class="comment">// call function</span></span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">module</span>.callFunction(emulator, <span class="number">0x2f91</span>, list.toArray());</span><br><span class="line">        <span class="keyword">return</span> vm.getObject(number.intValue()).getValue().toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">traceLength</span><span class="params">()</span> &#123;</span><br><span class="line">        emulator.getBackend().hook_add_new(<span class="keyword">new</span> <span class="title class_">CodeHook</span>() &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">                count += <span class="number">1</span>;</span><br><span class="line">                System.out.println(count);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="keyword">module</span>.base, <span class="keyword">module</span>.size + <span class="keyword">module</span>.base, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookStrCat</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;strcat&quot;</span>,</span><br><span class="line">                <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                <span class="type">UnidbgPointer</span> <span class="variable">r1</span> <span class="operator">=</span> emulator.getContext().getPointerArg(<span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;strcat:&quot;</span>+ r1);</span><br><span class="line">                System.out.println(r1.getString(<span class="number">0</span>));</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookMemcpy</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;memcpy&quot;</span>, <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                <span class="type">UnidbgPointer</span> <span class="variable">r1</span> <span class="operator">=</span> emulator.getContext().getPointerArg(<span class="number">1</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> emulator.getContext().getIntArg(<span class="number">2</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;memcpy&quot;</span>);</span><br><span class="line">                Inspector.inspect(r1.getByteArray(<span class="number">0</span>, length), r1.toString());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook72bc</span><span class="params">()</span>&#123;</span><br><span class="line">        emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x72bc</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">            UnidbgPointer v12;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                <span class="type">RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">                <span class="type">UnidbgPointer</span> <span class="variable">a2</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">1</span>);</span><br><span class="line">                v12 = registerContext.getPointerArg(<span class="number">0</span>);</span><br><span class="line">                Inspector.inspect(a2.getByteArray(<span class="number">0</span>, <span class="number">0x10</span>), <span class="string">&quot;key &quot;</span> + a2.toString());</span><br><span class="line">                <span class="comment">// 函数结束对v12hook查看</span></span><br><span class="line">                emulator.attach().addBreakPoint(registerContext.getLRPointer().peer, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                        <span class="comment">//Inspector.inspect(v12.getByteArray(0, 176), &quot;Round Key &quot;+v12.toString());</span></span><br><span class="line">                        Inspector.inspect(v12.getByteArray(<span class="number">8</span>, <span class="number">176</span>), <span class="string">&quot;Round Key &quot;</span>+v12.toString());</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DouYu</span> <span class="variable">douYu</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DouYu</span>();</span><br><span class="line">        <span class="comment">//douYu.traceLength();</span></span><br><span class="line">        <span class="comment">//douYu.hookStrCat();</span></span><br><span class="line">        <span class="comment">//douYu.hookMemcpy();</span></span><br><span class="line">        <span class="comment">//douYu.hook72bc();</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">makeUrl</span> <span class="operator">=</span> douYu.getMakeUrl();</span><br><span class="line">        System.out.println(<span class="string">&quot;result:&quot;</span>+ makeUrl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


]]></content>
      <tags>
        <tag>Unidbg</tag>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>unidbg补获取系统属性</title>
    <url>/2022/12/22/unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7/</url>
    <content><![CDATA[<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/000.webp"
                     
                ></p>
<h2 id="什么叫获取系统属性？"><a href="#什么叫获取系统属性？" class="headerlink" title="什么叫获取系统属性？"></a>什么叫获取系统属性？</h2><h3 id="Build类"><a href="#Build类" class="headerlink" title="Build类"></a>Build类</h3><p>第一种<br /> NDK中最常见的方式是通过JNI调用 ， 通过JNI调用JAVA方法获取本机的属性和信息，是最常见的做法，除了Build类，常见的还有 System.getProperty和Systemproperties.get等API。  <br />  Unidbg补环境过程中，最好补而且不会遗漏的就是这一类，因为Unidbg会给出清楚的报错，你没法对它置之不理。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">j<span class="keyword">class</span> <span class="title class_">androidBuildClass</span> = env-&gt;<span class="title class_">FindClass</span>(<span class="string">&quot;android/os/Build&quot;</span>);</span><br><span class="line">jfieldID <span class="variable constant_">SERIAL</span> = env-&gt;<span class="title class_">GetStaticFieldID</span>(androidBuildClass, <span class="string">&quot;SERIAL&quot;</span>,</span><br><span class="line"><span class="string">&quot;Ljava/lang/String;&quot;</span>);</span><br><span class="line">jstring serialNum = (jstring) env-&gt;<span class="title class_">GetStaticObjectField</span>(androidBuildClass,</span><br><span class="line"><span class="variable constant_">SERIAL</span>);</span><br></pre></td></tr></table></figure>

<h3 id="system-property-get"><a href="#system-property-get" class="headerlink" title="system_property_get"></a>system_property_get</h3><p>第二种常见方式是通过system_property_get 函数获取系统属性也是常见做法  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">char *key = <span class="string">&quot;ro.build.id&quot;</span>;</span><br><span class="line">char value[<span class="variable constant_">PROP_VALUE_MAX</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="title function_">__system_property_get</span>(key, value);</span><br></pre></td></tr></table></figure>
<p> 这类环境缺失容易被大家忽视，因为没有日志提示，即使src&#x2F;test&#x2F;resources&#x2F;log4j.properties中日志全 开，也不会打印相关信息。  </p>
<h3 id="通过文件访问"><a href="#通过文件访问" class="headerlink" title="通过文件访问"></a>通过文件访问</h3><p> 第三个常见方式是通过文件访问，比如读取&#x2F;proc&#x2F;pid&#x2F;maps，此种情况，Unidbg会提供日志输出，但 经常被大家忽视，事实上，不少朋友初学Unidbg时除了JAVA环境的报错，其他日志信息都不去管。  </p>
<h3 id="popen"><a href="#popen" class="headerlink" title="popen()"></a>popen()</h3><p> 第四个常见方式是通过popen()管道从shell中获取系统属性，其效果可以理解成在NDK中使用adb shell，popen参数一就是shell命令，返回值是一个fd文件描述符，可以read其内容，其中内容就是adb shell执行该命令应该返回的内容。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">char value[<span class="variable constant_">PROP_VALUE_MAX</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"><span class="attr">std</span>::string cmd = <span class="string">&quot;getprop ro.build.id&quot;</span>;</span><br><span class="line"><span class="variable constant_">FILE</span>* file = <span class="title function_">popen</span>(cmd.<span class="title function_">c_str</span>(), <span class="string">&quot;r&quot;</span>);</span><br><span class="line"><span class="title function_">fread</span>(value, <span class="variable constant_">PROP_VALUE_MAX</span>, <span class="number">1</span>, file);</span><br><span class="line"><span class="title function_">pclose</span>(file);</span><br></pre></td></tr></table></figure>


<h3 id="getenv函数"><a href="#getenv函数" class="headerlink" title="getenv函数"></a>getenv函数</h3><p>第五个常见方式是通过 getenv函数 获取进程环境变量，首先，Android系统层面存在一些默认的环境变 量，除此之外，样本可以设置自己进程内的环境变量。因此，样本可以在Native层获取系统环境变量或 者自身JAVA层设置的环境变量。 <br /> 我们可以通过ADB 查看环境变量有哪些，也可以查看环境变量的值。   </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">C</span>:\<span class="title class_">Users</span>\pr0214&gt;adb shell</span><br><span class="line"><span class="attr">bullhead</span>:/ $ <span class="keyword">export</span></span><br><span class="line"><span class="variable constant_">ANDROID_ASSETS</span></span><br><span class="line"><span class="variable constant_">ANDROID_BOOTLOGO</span></span><br><span class="line"><span class="variable constant_">ANDROID_DATA</span></span><br><span class="line"><span class="variable constant_">ANDROID_ROOT</span></span><br><span class="line">ANDROID_SOCKET_adbd</span><br><span class="line"><span class="variable constant_">ANDROID_STORAGE</span></span><br><span class="line"><span class="variable constant_">ASEC_MOUNTPOINT</span></span><br><span class="line"><span class="variable constant_">BOOTCLASSPATH</span></span><br><span class="line"><span class="variable constant_">DOWNLOAD_CACHE</span></span><br><span class="line"><span class="variable constant_">EXTERNAL_STORAGE</span></span><br><span class="line"><span class="variable constant_">HOME</span></span><br><span class="line"><span class="variable constant_">HOSTNAME</span></span><br><span class="line"><span class="variable constant_">LOGNAME</span></span><br><span class="line"><span class="variable constant_">PATH</span></span><br><span class="line"><span class="variable constant_">SHELL</span></span><br><span class="line"><span class="variable constant_">SYSTEMSERVERCLASSPATH</span></span><br><span class="line"><span class="variable constant_">TERM</span></span><br><span class="line"><span class="variable constant_">TMPDIR</span></span><br><span class="line"><span class="variable constant_">USER</span></span><br><span class="line"><span class="attr">bullhead</span>:/ $ echo $HOME</span><br><span class="line">/</span><br><span class="line"><span class="attr">bullhead</span>:/ $ echo $ANDROID_DATA</span><br><span class="line">/data</span><br><span class="line"><span class="attr">bullhead</span>:/ $ echo $SYSTEMSERVERCLASSPATH</span><br><span class="line">/system/framework/services.<span class="property">jar</span>:<span class="regexp">/system/</span>framework/ethernetservice.<span class="property">jar</span>:<span class="regexp">/system/</span>framework/wifiservice.<span class="property">jar</span>:<span class="regexp">/system/</span>framework/com.<span class="property">android</span>.<span class="property">location</span>.<span class="property">provider</span>.<span class="property">jar</span></span><br><span class="line"><span class="attr">bullhead</span>:/ $ echo $PATH</span><br><span class="line">/<span class="attr">sbin</span>:<span class="regexp">/system/</span><span class="attr">sbin</span>:<span class="regexp">/system/</span><span class="attr">bin</span>:<span class="regexp">/system/</span><span class="attr">xbin</span>:<span class="regexp">/vendor/</span><span class="attr">bin</span>:<span class="regexp">/vendor/</span>xbin</span><br><span class="line"><span class="attr">bullhead</span>:/ $</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> 第六个常见方式是使用系统调用获取相关属性，不管是通过syscall函数还是内联汇编，都属此类。 常见的比如uname系统调用  </p>
<blockquote>
<p> uname - 获取当前内核的名称和信息<br>返回的信息是一个结构体  </p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">struct utsname &#123;</span><br><span class="line">char sysname[]; <span class="comment">/* 操作系统名称 (例如 &quot;Linux&quot;) */</span></span><br><span class="line">char nodename[]; <span class="comment">/* &quot;一些实现了的网络”内的名称*/</span></span><br><span class="line">char release[]; <span class="comment">/* 操作系统版本 (例如 &quot;2.6.28&quot;)*/</span></span><br><span class="line">char version[]; <span class="comment">/* 操作系统发布日期 */</span></span><br><span class="line">char machine[]; <span class="comment">/* 硬件标识符 */</span></span><br><span class="line">#ifdef _GNU_SOURCE</span><br><span class="line">char domainname[]; <span class="comment">/* NIS或YP域名 */</span></span><br><span class="line">#endif</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p> 日志全开的情况下，系统调用的相关调用会被全部打印， Unidbg的uname系统调用实现是个很好也很简单的检测点，十分规范的表明了自己是Unidbg。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">protected int <span class="title function_">uname</span>(<span class="params">Emulator&lt;?&gt; emulator</span>) &#123;</span><br><span class="line">    <span class="title class_">RegisterContext</span> context = emulator.<span class="title function_">getContext</span>();</span><br><span class="line">    <span class="title class_">Pointer</span> buf = context.<span class="title function_">getPointerArg</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> (log.<span class="title function_">isDebugEnabled</span>()) &#123;</span><br><span class="line">        log.<span class="title function_">debug</span>(<span class="string">&quot;uname buf=&quot;</span> + buf);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    final int <span class="variable constant_">SYS_NMLN</span> = <span class="number">65</span>;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> sysName = buf.<span class="title function_">share</span>(<span class="number">0</span>);</span><br><span class="line">    sysName.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;Linux&quot;</span>); <span class="comment">/* Operating system name (e.g., &quot;Linux&quot;) */</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> nodeName = sysName.<span class="title function_">share</span>(<span class="variable constant_">SYS_NMLN</span>);</span><br><span class="line">    nodeName.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;localhost&quot;</span>); <span class="comment">/* Name within &quot;some implementation-defined network&quot; */</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> release = nodeName.<span class="title function_">share</span>(<span class="variable constant_">SYS_NMLN</span>);</span><br><span class="line">    release.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;1.0.0-unidbg&quot;</span>); <span class="comment">/* Operating system release (e.g., &quot;2.6.28&quot;) */</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> version = release.<span class="title function_">share</span>(<span class="variable constant_">SYS_NMLN</span>);</span><br><span class="line">    version.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;#1 SMP PREEMPT Thu Apr 19 14:36:58 CST 2018&quot;</span>); <span class="comment">/* Operating system version */</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> machine = version.<span class="title function_">share</span>(<span class="variable constant_">SYS_NMLN</span>);</span><br><span class="line">    machine.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;armv8l&quot;</span>); <span class="comment">/* Hardware identifier */</span></span><br><span class="line"></span><br><span class="line">    <span class="title class_">Pointer</span> domainName = machine.<span class="title function_">share</span>(<span class="variable constant_">SYS_NMLN</span>);</span><br><span class="line">    domainName.<span class="title function_">setString</span>(<span class="number">0</span>, <span class="string">&quot;localdomain&quot;</span>); <span class="comment">/* NIS or YP domain name */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 以上这些是较为常见的获取系统属性的方式，  </p>
<h2 id="如何解决？"><a href="#如何解决？" class="headerlink" title="如何解决？"></a>如何解决？</h2><h3 id="system-property-get的处理"><a href="#system-property-get的处理" class="headerlink" title="__system_property_get的处理"></a>__system_property_get的处理</h3><p>一般运行报IO错误，继承IOResolver实现文件重定向接口，打上自己的日志</p>
<blockquote>
<p> lilac path:&#x2F;dev&#x2F;properties<br>lilac path:&#x2F;proc&#x2F;stat  </p>
</blockquote>
<p>一般这前两个文件访问，不需要管，这是libc初始化的内部逻辑  <br /> 文件访问处理好了，接下来用第二种的方式，是__system_property_get 这个函数的处理 ，此Unidbg 在src&#x2F;main&#x2F;java&#x2F;com&#x2F;github&#x2F;unidbg&#x2F;linux&#x2F;android 目录下有相 关类对它进行了Hook和封装，我们可以直接拿来用  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">SystemPropertyHook</span> systemPropertyHook = <span class="keyword">new</span> <span class="title class_">SystemPropertyHook</span>(emulator);</span><br><span class="line">systemPropertyHook.<span class="title function_">setPropertyProvider</span>(<span class="keyword">new</span> <span class="title class_">SystemPropertyProvider</span>() &#123;</span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="title class_">String</span> <span class="title function_">getProperty</span>(<span class="params"><span class="built_in">String</span> key</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;lilac Systemkey:&quot;</span>+key);</span><br><span class="line">        <span class="keyword">switch</span> (key)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">memory.<span class="title function_">addHookListener</span>(systemPropertyHook);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>lilac Systemkey:ro.serialno<br>lilac Systemkey:ro.product.manufacturer<br>lilac Systemkey:ro.product.brand<br>lilac Systemkey:ro.product.model</p>
</blockquote>
<p> 通过adb shell 获取这些信息，一 一填入正确的值，建议使用Unidbg时，对应的测试机Android版本为 6.0，这样或许可以避免潜在的麻烦。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">C</span>:\<span class="title class_">Users</span>\zsk&gt;adb shell</span><br><span class="line"><span class="attr">angler</span>:/ $ su</span><br><span class="line"><span class="attr">angler</span>:/ # getprop ro.<span class="property">serialno</span></span><br><span class="line">84B5T15A04002645</span><br><span class="line"><span class="attr">angler</span>:/ # getprop ro.<span class="property">product</span>.<span class="property">manufacturer</span></span><br><span class="line"><span class="title class_">Huawei</span></span><br><span class="line"><span class="attr">angler</span>:/ # getprop ro.<span class="property">product</span>.<span class="property">brand</span></span><br><span class="line">google</span><br><span class="line"><span class="attr">angler</span>:/ # getprop ro.<span class="property">product</span>.<span class="property">model</span></span><br><span class="line"><span class="title class_">Nexus</span> 6P</span><br><span class="line"><span class="attr">angler</span>:/ #</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 注册绑定IO重定向</span></span><br><span class="line">emulator.<span class="title function_">getSyscallHandler</span>().<span class="title function_">addIOResolver</span>(<span class="variable language_">this</span>);</span><br><span class="line"><span class="title class_">SystemPropertyHook</span> systemPropertyHook = <span class="keyword">new</span> <span class="title class_">SystemPropertyHook</span>(emulator);</span><br><span class="line">systemPropertyHook.<span class="title function_">setPropertyProvider</span>(<span class="keyword">new</span> <span class="title class_">SystemPropertyProvider</span>() &#123;</span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public <span class="title class_">String</span> <span class="title function_">getProperty</span>(<span class="params"><span class="built_in">String</span> key</span>) &#123;</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;lilac Systemkey:&quot;</span>+key);</span><br><span class="line">        <span class="keyword">switch</span> (key)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ro.serialno&quot;</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;84B5T15A04002645&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ro.product.manufacturer&quot;</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Huawei&quot;</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ro.product.brand&quot;</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;google&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;ro.product.model&quot;</span>: &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Nexus 6P&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">memory.<span class="title function_">addHookListener</span>(systemPropertyHook);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Android虚拟机</span></span><br><span class="line">vm = emulator.<span class="title function_">createDalvikVM</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;xxx.apk&quot;</span>));</span><br></pre></td></tr></table></figure>

<h3 id="popen的处理"><a href="#popen的处理" class="headerlink" title="popen的处理"></a>popen的处理</h3><p>接下来是第四种和第五种， 管popen和getenv，它俩都是libc里的函数，所以放一起说。我的想法是Hook这两个函数， 如果产生调用就打印日志 ， 基于 Unidbg原生Hook封装的各种Hook。 </p>
<ul>
<li>HOOK时机要在什么时候？这个样本的popen调用发生在目标函数中，如果发生在init中呢？ </li>
<li>我们通过HOOK得到了其参数，那怎么给它返回正确的值呢？</li>
</ul>
<p>避免so存在init_proc 函数，或者init_array非空，需要在Loadlibrary加载so文件前面开始Hook，为了实现这个目标，我们提前将libc加载进Unidbg内存中。</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="title class_">DalvikModule</span> dmLibc = vm.<span class="title function_">loadLibrary</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/main/resources/android/sdk23/lib/libc.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="title class_">Module</span> moduleLibc = dmLibc.<span class="title function_">getModule</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// HOOK popen</span></span><br><span class="line">int popenAddress = (int) moduleLibc.<span class="title function_">findSymbolByName</span>(<span class="string">&quot;popen&quot;</span>).<span class="title function_">getAddress</span>();</span><br><span class="line"><span class="comment">// 函数原型：FILE *popen(const char *command, const char *type);</span></span><br><span class="line">emulator.<span class="title function_">attach</span>().<span class="title function_">addBreakPoint</span>(popenAddress, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    public boolean <span class="title function_">onHit</span>(<span class="params">Emulator&lt;?&gt; emulator, long address</span>) &#123;</span><br><span class="line">        <span class="title class_">RegisterContext</span> registerContext = emulator.<span class="title function_">getContext</span>();</span><br><span class="line">        <span class="title class_">String</span> command = registerContext.<span class="title function_">getPointerArg</span>(<span class="number">0</span>).<span class="title function_">getString</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;lilac popen command:&quot;</span>+command);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p> addBreakPoint 我们一般用于下断点，添加回调，在命中断点时打印输出popen的参数1(即传给shell的 命令)，并设置返回值为true，即做完打印程序继续跑，不用真断下来。  </p>
<p>第一个问题解决， 第二个问题，怎么给它合适的返回值呢？  <br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/02.webp"
                     
                ></p>
<p><br /> 其实下面奇怪的报错就是popen导致的，popen返回的是文件描述符 。<br /> NR &#x3D; 190，190是什么系统调用？Unidbg尚未实现  <br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/03.webp"
                     
                ><br><br /> 查一下表 <a class="link"   href="https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md#arm-32_bit_EABI" >https://chromium.googlesource.com/chromiumos/docs/+/master/constants/syscalls.md#arm-32_bit_EABI<i class="fas fa-external-link-alt"></i></a><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/04.webp"
                     
                ><br><br />而Unidbg提供了一种在底层修复和实现popen函数的法子。  <br />接着是 uname -a</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="attr">angler</span>:/ # uname -a</span><br><span class="line"><span class="title class_">Linux</span> localhost <span class="number">3.10</span><span class="number">.73</span>-g33ace82f84b #<span class="number">1</span> <span class="variable constant_">SMP</span> <span class="variable constant_">PREEMPT</span> <span class="title class_">Fri</span> <span class="title class_">Oct</span> <span class="number">13</span> <span class="number">04</span>:<span class="number">41</span>:<span class="number">33</span> <span class="variable constant_">UTC</span> <span class="number">2017</span> aarch64</span><br></pre></td></tr></table></figure>

<p>首先实现自己的ARM32SyscallHandler，完整代码如下，你可以把它当成固定讨论，它是针对 popen报错的官方解决方案。 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">package com.<span class="property">bailong</span>.<span class="property">qtt</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">Emulator</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">arm</span>.<span class="property">context</span>.<span class="property">EditableArm32RegisterContext</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">linux</span>.<span class="property">ARM32SyscallHandler</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">linux</span>.<span class="property">file</span>.<span class="property">ByteArrayFileIO</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">linux</span>.<span class="property">file</span>.<span class="property">DumpFileIO</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">memory</span>.<span class="property">SvcMemory</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">github</span>.<span class="property">unidbg</span>.<span class="property">pointer</span>.<span class="property">UnidbgPointer</span>;</span><br><span class="line"><span class="keyword">import</span> com.<span class="property">sun</span>.<span class="property">jna</span>.<span class="property">Pointer</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.<span class="property">util</span>.<span class="property">concurrent</span>.<span class="property">ThreadLocalRandom</span>;</span><br><span class="line"></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">qttSyscallHandler</span> <span class="keyword">extends</span> <span class="title class_ inherited__">ARM32SyscallHandler</span> &#123;</span><br><span class="line">    public <span class="title function_">qttSyscallHandler</span>(<span class="params">SvcMemory svcMemory</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(svcMemory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @<span class="title class_">Override</span></span><br><span class="line">    protected boolean <span class="title function_">handleUnknownSyscall</span>(<span class="params">Emulator&lt;?&gt; emulator, int NR</span>) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable constant_">NR</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">190</span>:</span><br><span class="line">                <span class="title function_">vfork</span>(emulator);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">114</span>:</span><br><span class="line">                <span class="title function_">wait4</span>(emulator);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">super</span>.<span class="title function_">handleUnknownSyscall</span>(emulator, <span class="variable constant_">NR</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">wait4</span>(<span class="params">Emulator&lt;?&gt; emulator</span>) &#123;</span><br><span class="line">        <span class="title class_">EditableArm32RegisterContext</span> context = (<span class="title class_">EditableArm32RegisterContext</span>) emulator.<span class="title function_">getContext</span>();</span><br><span class="line">        int pid = context.<span class="title function_">getR0Int</span>();</span><br><span class="line">        <span class="title class_">UnidbgPointer</span> wstatus = context.<span class="title function_">getR1Pointer</span>();</span><br><span class="line">        int options = context.<span class="title function_">getR2Int</span>();</span><br><span class="line">        <span class="title class_">Pointer</span> rusage = context.<span class="title function_">getR3Pointer</span>();</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;wait4 pid=&quot;</span> + pid + <span class="string">&quot;, wstatus=&quot;</span> + wstatus + <span class="string">&quot;, options=0x&quot;</span> + <span class="title class_">Integer</span>.<span class="title function_">toHexString</span>(options) + <span class="string">&quot;, rusage=&quot;</span> + rusage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private <span class="keyword">void</span> <span class="title function_">vfork</span>(<span class="params">Emulator&lt;?&gt; emulator</span>) &#123;</span><br><span class="line">        <span class="title class_">EditableArm32RegisterContext</span> context = (<span class="title class_">EditableArm32RegisterContext</span>) emulator.<span class="title function_">getContext</span>();</span><br><span class="line">        int childPid = emulator.<span class="title function_">getPid</span>() + <span class="title class_">ThreadLocalRandom</span>.<span class="title function_">current</span>().<span class="title function_">nextInt</span>(<span class="number">256</span>);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;vfork pid=&quot;</span> + childPid);</span><br><span class="line">        context.<span class="title function_">setR0</span>(childPid);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    protected int <span class="title function_">pipe2</span>(<span class="params">Emulator&lt;?&gt; emulator</span>) &#123;</span><br><span class="line">        <span class="title class_">EditableArm32RegisterContext</span> context = (<span class="title class_">EditableArm32RegisterContext</span>) emulator.<span class="title function_">getContext</span>();</span><br><span class="line">        <span class="title class_">Pointer</span> pipefd = context.<span class="title function_">getPointerArg</span>(<span class="number">0</span>);</span><br><span class="line">        int flags = context.<span class="title function_">getIntArg</span>(<span class="number">1</span>);</span><br><span class="line">        int write = <span class="title function_">getMinFd</span>();</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fdMap</span>.<span class="title function_">put</span>(write, <span class="keyword">new</span> <span class="title class_">DumpFileIO</span>(write));</span><br><span class="line">        int read = <span class="title function_">getMinFd</span>();</span><br><span class="line">        <span class="comment">// stdout中写入popen command 应该返回的结果</span></span><br><span class="line">        <span class="title class_">String</span> stdout = <span class="string">&quot;Linux localhost 3.10.73-g33ace82f84b #1 SMP PREEMPT Fri Oct 13 04:41:33 UTC 2017 aarch64</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">fdMap</span>.<span class="title function_">put</span>(read, <span class="keyword">new</span> <span class="title class_">ByteArrayFileIO</span>(<span class="number">0</span>, <span class="string">&quot;pipe2_read_side&quot;</span>, stdout.<span class="title function_">getBytes</span>()));</span><br><span class="line">        pipefd.<span class="title function_">setInt</span>(<span class="number">0</span>, read);</span><br><span class="line">        pipefd.<span class="title function_">setInt</span>(<span class="number">4</span>, write);</span><br><span class="line">        <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;pipe2 pipefd=&quot;</span> + pipefd + <span class="string">&quot;, flags=0x&quot;</span> + flags + <span class="string">&quot;, read=&quot;</span> + read + <span class="string">&quot;, write=&quot;</span> + write + <span class="string">&quot;, stdout=&quot;</span> + stdout);</span><br><span class="line">        context.<span class="title function_">setR0</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解释一下为什么不直接补在ARM32SyscallHandler中？因为Unidbg并没有真正实现wait4和fork这两个 系统调用，只不过对于popen而言，用上述方式可以“凑合用”，既然不是完美的实现，自然不能放到 ARM32SyscallHandler中去，免得出大问题。  </p>
<p> 在pipe2中注释下的stdout中传入正确返回值即可，比如uname -a就是，需要注意，结果都i要加换行 符，这是shell结果的返回习惯。</p>
<p> 接下来让我们的emulator使用我们自己的syscallHandler，emulator &#x3D; new AndroidARMEmulator(new File(“target&#x2F;rootfs”)); 由如下洋洋洒洒十来行取代。  <br />  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建模拟器实例，要模拟32位或者64位，在这里区分</span></span><br><span class="line"><span class="comment">//        emulator = AndroidEmulatorBuilder.for32Bit().build();</span></span><br><span class="line"><span class="title class_">AndroidEmulatorBuilder</span> builder = <span class="keyword">new</span> <span class="title class_">AndroidEmulatorBuilder</span>(<span class="literal">false</span>) &#123;</span><br><span class="line">    public <span class="title class_">AndroidEmulator</span> <span class="title function_">build</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AndroidARMEmulator</span>(processName, rootDir,backendFactories) &#123;</span><br><span class="line">            @<span class="title class_">Override</span></span><br><span class="line">            protected <span class="title class_">UnixSyscallHandler</span>&lt;<span class="title class_">AndroidFileIO</span>&gt;</span><br><span class="line">            <span class="title function_">createSyscallHandler</span>(<span class="params">SvcMemory svcMemory</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title function_">qttSyscallHandler</span>(svcMemory);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">emulator = builder.<span class="title function_">setRootDir</span>(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/rootfs&quot;</span>)).<span class="title function_">build</span>();</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/05.webp"
                     
                ><br /> 直接跑出了结果，但我们的任务其实还没有完成&#x3D; &#x3D;，tag中搜索lilac popen，发现一共调用了三次  </p>
<blockquote>
<p>lilac popen command:uname -a<br>lilac popen command:cd &#x2F;system&#x2F;bin &amp;&amp; ls -l<br>lilac popen command:stat &#x2F;root  </p>
</blockquote>
<p> 我们上面的代码，似乎只处理了uname -a应该返回的值，后面两次呢？怎么在pipe2中根据 popen输入的command返回合适的输出呢？  <br />我们可以使用emulator的全局变量来完成这一点  <br /><br> <img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/06.webp"
                     
                ><br> <br /> 对应的qttSyscallHandler代码，其中 cd &#x2F;system&#x2F;bin &amp;&amp; ls -l 和 stat &#x2F;root 的结果来自adb shell，大家 根据自己的测试机情况填入合适的结果。  </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">protected int <span class="title function_">pipe2</span>(<span class="params">Emulator&lt;?&gt; emulator</span>) &#123;</span><br><span class="line">    <span class="title class_">EditableArm32RegisterContext</span> context = (<span class="title class_">EditableArm32RegisterContext</span>) emulator.<span class="title function_">getContext</span>();</span><br><span class="line">    <span class="title class_">Pointer</span> pipefd = context.<span class="title function_">getPointerArg</span>(<span class="number">0</span>);</span><br><span class="line">    int flags = context.<span class="title function_">getIntArg</span>(<span class="number">1</span>);</span><br><span class="line">    int write = <span class="title function_">getMinFd</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fdMap</span>.<span class="title function_">put</span>(write, <span class="keyword">new</span> <span class="title class_">DumpFileIO</span>(write));</span><br><span class="line">    int read = <span class="title function_">getMinFd</span>();</span><br><span class="line">    <span class="title class_">String</span> stdout = <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">    <span class="comment">// stdout中写入popen command 应该返回的结果</span></span><br><span class="line">    <span class="title class_">String</span> command = emulator.<span class="title function_">get</span>(<span class="string">&quot;command&quot;</span>);</span><br><span class="line">    <span class="keyword">switch</span> (command) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;uname -a&quot;</span>: &#123;</span><br><span class="line">            stdout = <span class="string">&quot;Linux localhost 3.10.73-g33ace82f84b #1 SMP PREEMPT Fri Oct 13 04:41:33 UTC 2017 aarch64</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;cd /system/bin &amp;&amp; ls -l&quot;</span>: &#123;</span><br><span class="line">            stdout = <span class="string">&quot;total 25152</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-rwxr-xr-x 1 root shell 128688 2009-01-01 08:00 abb</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;lrwxr-xr-x 1 root shell 6 2009-01-01 08:00 acpi -&gt; toybox</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-rwxr-xr-x 1 root shell 30240 2009-01-01 08:00 adbd</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-rwxr-xr-x 1 root shell 207 2009-01-01 08:00 am</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-rwxr-xr-x 1 root shell 456104 2009-01-01 08:00 apexd</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;lrwxr-xr-x 1 root shell 13 2009-01-01 08:00 app_process -&gt; app_process64</span></span><br><span class="line"><span class="string">&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;-rwxr-xr-x 1 root shell 25212 2009-01-01 08:00 app_process32</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&quot;stat /root&quot;</span>: &#123;</span><br><span class="line">            stdout = <span class="string">&quot;stat: &#x27;/root&#x27;: No such file or directory</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;command do not match!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">fdMap</span>.<span class="title function_">put</span>(read, <span class="keyword">new</span> <span class="title class_">ByteArrayFileIO</span>(<span class="number">0</span>, <span class="string">&quot;pipe2_read_side&quot;</span>, stdout.<span class="title function_">getBytes</span>()));</span><br><span class="line">    pipefd.<span class="title function_">setInt</span>(<span class="number">0</span>, read);</span><br><span class="line">    pipefd.<span class="title function_">setInt</span>(<span class="number">4</span>, write);</span><br><span class="line">    <span class="title class_">System</span>.<span class="property">out</span>.<span class="title function_">println</span>(<span class="string">&quot;pipe2 pipefd=&quot;</span> + pipefd + <span class="string">&quot;, flags=0x&quot;</span> + flags + <span class="string">&quot;, read=&quot;</span> + read + <span class="string">&quot;, write=&quot;</span> + write + <span class="string">&quot;, stdout=&quot;</span> + stdout);</span><br><span class="line">    context.<span class="title function_">setR0</span>(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="getenv的处理"><a href="#getenv的处理" class="headerlink" title="getenv的处理"></a>getenv的处理</h3><p> getenv的出现频率也挺高， 首先我们看一下当前测试机有哪些环境变量    </p>
<blockquote>
<p>angler:&#x2F;system&#x2F;bin $ export<br>ANDROID_ASSETS<br>ANDROID_BOOTLOGO<br>ANDROID_DATA<br>ANDROID_ROOT<br>ANDROID_SOCKET_adbd<br>ANDROID_STORAGE<br>ASEC_MOUNTPOINT<br>BOOTCLASSPATH<br>DOWNLOAD_CACHE<br>EXTERNAL_STORAGE<br>HOME<br>HOSTNAME<br>LOGNAME<br>PATH<br>SHELL<br>SYSTEMSERVERCLASSPATH<br>TERM<br>TMPDIR<br>USER</p>
</blockquote>
<p> 看一下PATH的内容  </p>
<blockquote>
<p>angler:&#x2F;system&#x2F;bin $ echo $PATH<br>&#x2F;sbin:&#x2F;system&#x2F;sbin:&#x2F;system&#x2F;bin:&#x2F;system&#x2F;xbin:&#x2F;vendor&#x2F;bin:&#x2F;vendor&#x2F;xbin</p>
</blockquote>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/07.webp"
                     
                ><br /> getValue取不到结果，原因就是getenv没有返回值，那么该怎么办呢？   这里给env返回正确的值有几种办法呢？  </p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p> Unidbg提供了对环境变量的初始化，它在 src&#x2F;main&#x2F;java&#x2F;com&#x2F;github&#x2F;unidbg&#x2F;linux&#x2F;AndroidElfLoader.java中。  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/08.webp"
                     
                ><br /> 我们填上这一个就行，为了辨别不同方法是否生效，我们这里返回1  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="built_in">this</span>.environ = initializeTLS(<span class="keyword">new</span> <span class="title class_">String</span>[] &#123;</span><br><span class="line">        <span class="string">&quot;ANDROID_DATA=/data&quot;</span>,</span><br><span class="line">        <span class="string">&quot;ANDROID_ROOT=/system&quot;</span>,</span><br><span class="line">        <span class="comment">//&quot;PATH=/sbin:/vendor/bin:/system/sbin:/system/bin:/system/xbin&quot;,</span></span><br><span class="line">        <span class="string">&quot;NO_ADDR_COMPAT_LAYOUT_FIXUP=1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;PATH=1&quot;</span>,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p> libc 提供了setenv方法，可以设置环境变量。 <br />在调用函数前先调用该方法 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// setenv设置环境变量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setEnv</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Symbol</span> <span class="variable">setenv</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;setenv&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">    setenv.call(emulator, <span class="string">&quot;PATH&quot;</span>, <span class="string">&quot;2&quot;</span>, <span class="number">0</span>);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h4 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h4><p> 通过HookZz hook函数，替换结果  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookgetEnvByHookZz</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line">    hookZz.wrap(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;getenv&quot;</span>), <span class="keyword">new</span> <span class="title class_">WrapCallback</span>&lt;EditableArm32RegisterContext&gt;() &#123;</span><br><span class="line">        String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preCall</span><span class="params">(Emulator&lt;?&gt; emulator, EditableArm32RegisterContext ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">            name = ctx.getPointerArg(<span class="number">0</span>).getString(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, EditableArm32RegisterContext ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">            <span class="keyword">switch</span> (name)&#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;PATH&quot;</span>: &#123;</span><br><span class="line">                    <span class="type">MemoryBlock</span> <span class="variable">replaceBlock</span> <span class="operator">=</span> emulator.getMemory().malloc(<span class="number">0x100</span>, <span class="literal">true</span>);</span><br><span class="line">                    <span class="type">UnidbgPointer</span> <span class="variable">replacePtr</span> <span class="operator">=</span> replaceBlock.getPointer();</span><br><span class="line">                    <span class="type">String</span> <span class="variable">pathValue</span> <span class="operator">=</span> <span class="string">&quot;3&quot;</span>;</span><br><span class="line">                    replacePtr.write(<span class="number">0</span>, pathValue.getBytes(StandardCharsets.UTF_8), <span class="number">0</span>, pathValue.length());</span><br><span class="line">                    ctx.setR0(replacePtr.toIntPeer());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">super</span>.postCall(emulator, ctx, info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法四"><a href="#方法四" class="headerlink" title="方法四"></a>方法四</h4><p> 也可以通过断点的方式hook  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookgetEnvByBreakPointer</span><span class="params">()</span> &#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x7FE</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">            <span class="type">EditableArm32RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span></span><br><span class="line">                    emulator.getContext();</span><br><span class="line">            registerContext.getPointerArg(<span class="number">0</span>).setString(<span class="number">0</span>, <span class="string">&quot;4&quot;</span>);</span><br><span class="line">            emulator.getBackend().reg_write(ArmConst.UC_ARM_REG_PC,</span><br><span class="line">                    (address) + <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 直接让R0指针指向正确的值，并操纵PC寄存器跳过这条指令  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221223/09.webp"
                     
                ></p>
<h4 id="方法五"><a href="#方法五" class="headerlink" title="方法五"></a>方法五</h4><p> 仿照SystemPropertyHook写一下，代码如下  <br />在 vm.loadLibrary 加载so文件之前</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">EnvHook</span> <span class="variable">envHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EnvHook</span>(emulator);</span><br><span class="line">memory.addHookListener(envHook);</span><br></pre></td></tr></table></figure>
<p> EnvHook.java  </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.github.unidbg.Emulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.ArmHook;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.HookStatus;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.context.RegisterContext;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.hook.HookListener;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.SvcMemory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EnvHook</span> <span class="keyword">implements</span> <span class="title class_">HookListener</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Emulator&lt;?&gt; emulator;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EnvHook</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.emulator = emulator;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">hook</span><span class="params">(SvcMemory svcMemory, String libraryName, String symbolName,</span></span><br><span class="line"><span class="params">                     <span class="keyword">final</span> <span class="type">long</span> old)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;libc.so&quot;</span>.equals(libraryName) &amp;&amp; <span class="string">&quot;getenv&quot;</span>.equals(symbolName)) &#123;</span><br><span class="line">            <span class="keyword">if</span> (emulator.is32Bit()) &#123;</span><br><span class="line">                <span class="keyword">return</span> svcMemory.registerSvc(<span class="keyword">new</span> <span class="title class_">ArmHook</span>() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="keyword">protected</span> HookStatus <span class="title function_">hook</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">                        <span class="keyword">return</span> getenv(old);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).peer;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> HookStatus <span class="title function_">getenv</span><span class="params">(<span class="type">long</span> old)</span> &#123;</span><br><span class="line">        <span class="type">RegisterContext</span> <span class="variable">context</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> context.getPointerArg(<span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> pointer.getString(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">switch</span> (key)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="string">&quot;PATH&quot;</span>:&#123;</span><br><span class="line">                pointer.setString(<span class="number">0</span>, <span class="string">&quot;5&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span> HookStatus.LR(emulator, pointer.peer);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> HookStatus.RET(emulator, old);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>Unidbg</tag>
      </tags>
  </entry>
  <entry>
    <title>unidbg踩坑记录，getobjectclass对象为null</title>
    <url>/2022/11/27/unidbg%E8%B8%A9%E5%9D%91%E8%AE%B0%E5%BD%95%EF%BC%8Cgetobjectclass%E5%AF%B9%E8%B1%A1%E4%B8%BAnull/</url>
    <content><![CDATA[<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.dongchedi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.AndroidEmulator;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.virtualmodule.android.AndroidModule;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">dongchedi</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    dongchedi() &#123;</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.ARM32SyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.unix.UnixSyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.AbstractEmulator&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.DalvikVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.BaseVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">        Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line"></span><br><span class="line">        emulator = AndroidEmulatorBuilder.for32Bit().build();</span><br><span class="line">        <span class="keyword">final</span> <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android\\src\\test\\java\\com\\dongchedi\\dongchedi_6_5_1.apk&quot;</span>));</span><br><span class="line">        vm.setJni(<span class="built_in">this</span>);</span><br><span class="line">        vm.setVerbose(<span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">AndroidModule</span>(emulator, vm).register(memory);</span><br><span class="line">        <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="string">&quot;cjtfcc&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">        dm.callJNI_OnLoad(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">tfccDecrypt</span><span class="params">(<span class="type">int</span> param1, <span class="type">int</span> param2, String param3, String param4)</span> &#123;</span><br><span class="line">        <span class="comment">// com.bdcaijing.tfccsdk.Tfcc</span></span><br><span class="line">        <span class="comment">// private native String tfccDecrypt(int i, int i2, String str, String str2);</span></span><br><span class="line">        List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(vm.getJNIEnv()); <span class="comment">//第一个参数默认env</span></span><br><span class="line">        list.add(<span class="number">0</span>); <span class="comment">//第二个参数一般填0，一般用不到</span></span><br><span class="line">        list.add(param1);</span><br><span class="line">        list.add(param2);</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">stringObject1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, param3);</span><br><span class="line">        list.add(vm.addLocalObject(stringObject1));</span><br><span class="line">        <span class="type">StringObject</span> <span class="variable">stringObject2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, param4);</span><br><span class="line">        list.add(vm.addLocalObject(stringObject2));</span><br><span class="line">        <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">module</span>.callFunction(emulator, <span class="number">0xa2ac</span>, list.toArray());</span><br><span class="line">        System.out.println(vm.getObject(number.intValue()).getValue().toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">dongchedi</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">dongchedi</span>();</span><br><span class="line">        test.tfccDecrypt(<span class="number">9</span>, <span class="number">1</span>, <span class="string">&quot;14zRM+40n2UGVx0DlI7hqDFjsxGR6eJsnnxUME5ZDT8=&quot;</span>,</span><br><span class="line">                <span class="string">&quot;AQAAAIY8QCEBiAWgEHTCmugnR4hHWlbOmpfOHoYQ+gXQHXvSrCBlQtFmGM8T7eHljYYTD8vWOsQa8SuOaBwMTYOS03qjuUktB2dRu3+mWr4z5N3uMrb1Es/MTUrWx8JGHVoX1z7f6luarDvT9Wf0KKbfHRkqaJANlwVEqULsZU6HkJ0zkaFh3AnU5eQRsPoxttOPOhsVLv/kNjpm1&quot;</span> +</span><br><span class="line">                <span class="string">&quot;qBHkENXSedO4MN+PGybTCOKH3Ri6dvoX9EXCUr41o2W0ujI46nYn7vUrRkHgHNOOrGkIL7Acn0wrU6nj3cZuFpxb+W+u6r+MFI8ScE9XQya3322RRqOQUr1xWXpCucv/zknN7pjyzptYk8iWRfeaCT+iSjkmwa+3EStu3U/TQakF1xh46hjPOczx7elte6qV9ztDyF61Eu&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Nrz4K+9O4TgqDeg9FGv7k+sNXg4M8L+Vx2BzJ/9MfaOFF5YXlI2oeMk0FReBTV8cBdXv2j23ju5HUpNo45dYF+tLihymL3maOiuWYviIAk8OKjNG+juruF4YuYoAqJoJSvuZ9Avujl3mqL66AdZmzG7vTa29S1MWIwu3XYj96lcbGSav9m5g4yRb6zXcQDIpqAmYHVgRjX&quot;</span> +</span><br><span class="line">                <span class="string">&quot;7adt09SOuvrcuORpUh2jSt5smO+lpR7fuHk4tlCr6OlRr360IgJr82PmeAAKz1dV9tHGYlV+618tjgi36J4iLuWaw6Ix9iJ1R6cFJY6JIX8pU8NoGoUFDjK3Dm8Pm9j72J9cTQpEMR/HCT3BOw5YTTTQHl3eQgdZevUD8HFnECMvajFZxKe6obyPieE41WBk/EQ5WI2Bwtu&quot;</span> +</span><br><span class="line">                <span class="string">&quot;rmyzxEq/VPIm1UfoqE78T4QOa2ey82Mw6TCIzMSMhCwiA2huzSnlus9RicQaPCX1isa0BitIISMHeHRFqab9ORMnHKVxEX3AhZN3OwcPKntx43yxZrTp5GLYwndyqchZCpTXhu/j/7WfUZRnIc2aOhKegFCLNdeml0Kha9FPSXE8AxTMr6ldw2p5vhPmzn5p2iRvgXoqdr5J&quot;</span> +</span><br><span class="line">                <span class="string">&quot;6W6QgBCEb8fGCupV+gLibY5mcLabHBmcSEkdax1h341Qxyk6s8/LvUlpx6MZHPM+/NgWf8bUvvbPKLrD7xhKPtCaaaO1PSGiNTPrlRJaajiBpJcMwMkjRbKT76+kDCL00teodYNyFBEkYmGJM5Sg7fHY1f6e3FXRYny6bXnr0R/mTnxWDPDAc9gn2eiyHofLRaBjvtbdpMStn&quot;</span> +</span><br><span class="line">                <span class="string">&quot;MolS5ybQt8GfaVifsjfQe3jwLmFNCtsXn6unDo189udnL9iOwtwIhLUtUvIU9IejQ33rKAMWQjrlvA99KTLzdk6ewItUa4mI9sFcpcR/uIbQiiHYs1qvfrQiAmvzY+Z4AArPV1X20cZiVX7rXy2OCLfoniIu5ZrDojH2InVHpwUljokhfylTw2gahQUOMrcObw+b2PvYn1xNC&quot;</span> +</span><br><span class="line">                <span class="string">&quot;kQxH8cJPcE7DlhNNO1SUZeQb5H5IQYdROwNOj0gcN4YmN1P2S2PC6VQzGJu2x0+T9e7PeW2jjIl4qM0N23z+A9W3IX0+x4oUU/1MNdgaxMlucq9SRoPnuyW/LC+PkDTN1tk6oMbKoqQSYiKn0dVOZKma6PWO3UogNGhFJN+uzG8TN0Vh5YDTrpJ/AhzGdpNu0aDFGXrXqaCx5n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Lcxfiq9XMzz47/nNbJ5GD/sBg2anQ25uYJQqueFTZsej5Buy+PpsZ9UCUlZ3QDdC8Z2dGfQCnnzvosx3vb3nZVUtkxruvGaDtTueshIcL6OFF+liJQ1N3hjfsom7F74c4NYZo3SbrUSlOOLWi9YALqszQq+s6XvUNBbKWzeCU236tn7MmtlBkdA+ZAe95f1JPy63XwxkK6wtfF&quot;</span> +</span><br><span class="line">                <span class="string">&quot;n7uxDQKfv/HVeKjvzQ+IAHv3wQmGSSUuHtusWtwFzTMXKqur3KNdLDQZIo6UV74/uvG3/CQnX3JoK3AHydHKV+kkMd9W6Uzjy37PixjrW5IFST6+thqb/yrK1chGM9MPJ7AbNeq9Zfhi5igComglK+5n0C+6OXebfNiKoMkM2f/ezRyGcMxEkKmyG2g9cZwfeDjZjDVvPiMd8Jf&quot;</span> +</span><br><span class="line">                <span class="string">&quot;6XOoXT47iq7JcWZ8PM8FELOWjegOP9hXUMPdkn2waqXbJ7eFwfb1vI/kSsX6QdTF5cXYcScuqFjft/hLd/a+JaSwEyFqIbWnZkHMMNuAqCmBmzk8ZEXzYkflQBKnTdiEgsXVrf4RokNgd//cFo6ZfrcdMdtbpiOEM3k9iD9HABFcsV4boY89g1Uqmx66emYxoD1UUI7XlDyGFgvY&quot;</span> +</span><br><span class="line">                <span class="string">&quot;uRFN5vcANjq9wM4mIfNRx8xN5JNj5EIcZG6fE3mq0jEQlEQf8V89ngy2x/Klp7c8OHWV9YDy3v4QeSTmSCrg8EvCx71UD0mhOPjBoF0EsUt6JseIrcKH+ORtrfSyPjUPnhkCnkTLZpyidfqUCJz6YksBQ7Ak+tA9vKN7Y2xGkgy/8jpwMfRjnmERo3YMrgaawqhp5RZLB0V2ZPLUC&quot;</span> +</span><br><span class="line">                <span class="string">&quot;s5MqqsJDnIp2KnCV8hJVDTUdz6/XlAPCWACEfZAZpX38dS7RTVw/KzJf903a7pdrsPJ+fW4MVIaMzF98w0GCRjFSPw8V44sbHQbrcFLgZ+7bF6G2Dm0eez6L5xIs0ptZcX8tN7UE24KxYJK8/THH47mRDs/gyMFE4r5r5XzB1vgtPPWURrjzCtODTxtcsxDaQ89e7WHuBA7IVBzRC2&quot;</span> +</span><br><span class="line">                <span class="string">&quot;5+lKeAndp3VlHpeGLzzLfHkgMqva7KsGE3rMPYk+ioGPl3TuPWrqawjwSKlsUP/vf61f80Br42DugXL4RPAoE5b5P/8628TZVqYMzkC1hfKNOzxkAOsYCW+vLizurCPm8yeIqDYlZq/DcFVxHxPkAR9uOFZwlKNXZbMzaDEU+ebXX4g+WG6dpKK0GSFV4MZX5SvpZrvIZvTspyVYjpXHV&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Atr+wCzO0N5tg1kGJABoj+aZ4GWGFYv7kzTMBuk0hDeFXfDgp+Af7tMAkfmG67iqopLbNccfhlE6fXBwZail88u/6S9zhqAgZLclp3cPFDnZdGLF0pNqzsx6pk2j5tS+srUVHT+M5gGYOhC6iofm0ek0CQYsSwd6e8uUV627Cb00qLT1d0BGax0oQA2UE+dgCiR2jZaO0bnPsh6a6VC3P0&quot;</span> +</span><br><span class="line">                <span class="string">&quot;vGdiWeNZyjTEHXD3YaUb9y49+bniXV7SpHcLiZj+voezbBQqCETrDTc1pLjicAgBtCJ4kPYUzDJBtB/NUQR+PHMwH4QrhgqaDKFPnCjFAOv63ob7aepyfMI/fWenLJmEuTQU/hWv7zxhvC3KX7hfcIPTtUYDRJofRS4F0UNTGY7wHf0nD+uqJPaxEamlsFMNtPLa2ZAskmEXy1tegY8sH8&quot;</span> +</span><br><span class="line">                <span class="string">&quot;V8pFL7Gn0EbOAonzSLwQKZhlESxQ7MPTu3fgP7mnuEknJmhk3dwiCNNePtG6NftfjQSeJGHl+qtJNdWL22jONkATEgCZDQfYCAGkDPnI/svE9N80b83xT5K/+MQaLZGX/cyTWKLIlz21uaHGSRo0MaNBwYrRjNOZhoHbN2Cy0sgVLvlaMGTnkH4PJ/I09GQxsNAKLXz+vAKKNwbA36Kw4n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;21WRWDoSBJ5gPjFKWHR1S4BYUCxI90O51M9InW1G06saOk991lD9RH6A0ywH3Nw4Mkg7BGLvdIdqCoqAmrcvgYJ1h/RvJOt/h2ipzcDpz/qaZU2UZabYEn3V714z0d5LMvN690tCaaaO1PSGiNTPrlRJaajhMKjIj0sQ1U1K4To1wyvhN4rsSeR+QtEIKK1xOW8yj5nhlEvksrd3GULB+hL&quot;</span> +</span><br><span class="line">                <span class="string">&quot;1ymx/tZgdQxe4ysd3cL9U/7tMmlPc9YWVtO22UO7iVrTfhTHmT0Rs9ttFNBjkyh/bPRTloBts7VeIUpze3ppRP4ncOJCaxxLOwtd0fA6iTvV4eAFeAcia29951yCHn91FjaNljJcPnRNy+u0VK+SlDptv5AcagR0luMfzGuIHOHdn9wIvb8/UDxAvxhwnieHQ7s1GdDUSq1T2xR5iHstyUu&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Ma/Gax0oQA2UE+dgCiR2jZaO5/TnlbXb9IKvNeQ1fAvHxiIwfpxozEMIvOzOrPbLwJjs8xXbkCH8GvEYiqQfMw2B3w6YIawzwVlcx+4CypfZvtYTatE+XCzs2j8rjFUZWUBv2olwN3ZfL3a0AfpAo0+LTSRIivoQSNEEuk7sIg2xU1lonGUe8JRYJovoyczZNNC/OUI5wD5kWCEM0v3A/kO&quot;</span> +</span><br><span class="line">                <span class="string">&quot;Du50mX+Sl1LtmX8FQdy1q5nbS1BWFqfF6cibw4CL5yMH&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行样本后报错：<br>GetObjectClass 的 object 为 null</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/01.webp"
                      alt="01"
                ></p>
<p>当前报错位置已经断下来了，输入bt查看调用栈</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/02.webp"
                     
                ></p>
<p>用ida打开样本so，跳到 0x092b8 地址</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/03.webp"
                     
                ></p>
<p>先分析一下，查看GetObjectClass的文档</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">jclass GetObjectClass(JNIEnv *env, jobject obj);</span><br></pre></td></tr></table></figure>

<p>有两个参数，env和object，根据ARM函数调用约定采用，参数1<del>参数4 分别保存到 R0</del>R3 寄存器中</p>
<p>所以往上看R1出现的地址位置，0x92A8，进行断点查看调用的位置</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/04.webp"
                     
                ></p>
<p>ida跳到0x0a554，转为汇编代码后，可以看到object是v24，也就是入参a2，</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/05.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/06.webp"
                     
                ></p>
<p>查看该函数的地址为0xa2ac，这跟我们一开始调用的地址一样的，在看当时传递的第二个object，确实传的0</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20221127/07.webp"
                     
                ></p>
<p>可以通过jadx查看正确的对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">tfccDecrypt</span><span class="params">(<span class="type">int</span> param1, <span class="type">int</span> param2, String param3, String param4)</span> &#123;</span><br><span class="line">    <span class="comment">// com.bdcaijing.tfccsdk.Tfcc</span></span><br><span class="line">    <span class="comment">// private native String tfccDecrypt(int i, int i2, String str, String str2);</span></span><br><span class="line">    List&lt;Object&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(vm.getJNIEnv()); <span class="comment">//第一个参数默认env</span></span><br><span class="line"><span class="comment">//        list.add(0); //第二个参数一般填0，一般用不到</span></span><br><span class="line">    <span class="type">DvmClass</span> <span class="variable">Tfcc</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/bdcaijing/tfccsdk/Tfcc&quot;</span>);</span><br><span class="line">    DvmObject&lt;?&gt; TfccObject = Tfcc.newObject(<span class="literal">null</span>);</span><br><span class="line">    list.add(vm.addLocalObject(TfccObject));</span><br><span class="line">    list.add(param1);</span><br><span class="line">    list.add(param2);</span><br><span class="line">    <span class="type">StringObject</span> <span class="variable">stringObject1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, param3);</span><br><span class="line">    list.add(vm.addLocalObject(stringObject1));</span><br><span class="line">    <span class="type">StringObject</span> <span class="variable">stringObject2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm, param4);</span><br><span class="line">    list.add(vm.addLocalObject(stringObject2));</span><br><span class="line">    <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> <span class="keyword">module</span>.callFunction(emulator, <span class="number">0xa2ac</span>, list.toArray());</span><br><span class="line">    System.out.println(vm.getObject(number.intValue()).getValue().toString());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>再次运行就可以了</p>
]]></content>
      <tags>
        <tag>Unidbg</tag>
      </tags>
  </entry>
  <entry>
    <title>Unidbg操作说明</title>
    <url>/2022/10/19/Unidbg%E6%93%8D%E4%BD%9C%E8%AF%B4%E6%98%8E/</url>
    <content><![CDATA[<h2 id="补环境的三条准则"><a href="#补环境的三条准则" class="headerlink" title="补环境的三条准则"></a>补环境的三条准则</h2><ol>
<li>常规object，比如jstring，jarray使用Unidbg封装的API</li>
<li>除此之外的jobject使用vm.resolveClass(className).newObject(object)，jclass使用vm.resolveClass(className)</li>
<li>如果object不可得，传空&#x2F;方法签名&#x2F;标识</li>
</ol>
<h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ul>
<li><a href="#AndroidEmulator">AndroidEmulator</a><ul>
<li><a href="#AndroidEmulator%E4%BB%8B%E7%BB%8D">AndroidEmulator介绍</a></li>
<li><a href="#%E5%88%9B%E5%BB%BAAndroidEmulator%E5%AE%9E%E4%BE%8B">创建AndroidEmulator实例</a></li>
<li><a href="#AndroidEmulator%E6%93%8D%E4%BD%9C%E6%8E%A5%E5%8F%A3">AndroidEmulator操作接口</a><ul>
<li><a href="#getMemory">getMemory</a></li>
<li><a href="#createDalvikVM">createDalvikVM</a></li>
<li><a href="#loadLibrary">loadLibrary</a></li>
<li><a href="#getDalvikVM">getDalvikVM</a></li>
<li><a href="#showRegs">showRegs</a></li>
<li><a href="#getBackend">getBackend</a></li>
<li><a href="#getPid">getPid</a></li>
<li><a href="#getProcessName">getProcessName</a></li>
<li><a href="#getContext">getContext</a></li>
<li><a href="#isRunning">isRunning</a></li>
<li><a href="#Trace">Trace</a></li>
<li><a href="#et-x2F-Get">Set&#x2F;Get</a></li>
<li><a href="#SyscallHandler">SyscallHandler</a></li>
<li><a href="#Debugger">Debugger</a></li>
<li><a href="#emulateSignal">emulateSignal</a></li>
<li><a href="#disassemble">disassemble</a></li>
<li><a href="#close">close</a></li>
<li><a href="#getUnwinder">getUnwinder</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Memory">Memory</a><ul>
<li><a href="#Memory%E4%BB%8B%E7%BB%8D">Memory介绍</a></li>
<li><a href="#Memory%E6%93%8D%E4%BD%9C">Memory操作</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Memory%E5%AE%9E%E4%BE%8B">获取Memory实例</a></li>
<li><a href="#setLibraryResolver">setLibraryResolver</a></li>
<li><a href="#findModule">findModule</a></li>
<li><a href="#allocateStack">allocateStack</a></li>
<li><a href="#malloc">malloc</a></li>
<li><a href="#setErrno">setErrno</a></li>
<li><a href="#getStackPoint">getStackPoint</a></li>
<li><a href="#disableCallInitFunction">disableCallInitFunction</a></li>
<li><a href="#getMemoryMap">getMemoryMap</a></li>
<li><a href="#pointer">pointer</a></li>
<li><a href="#addModuleListener">addModuleListener</a></li>
<li><a href="#load">load</a></li>
</ul>
</li>
<li><a href="#Memory%E6%80%BB%E7%BB%93">Memory总结</a></li>
</ul>
</li>
<li><a href="#VM">VM</a><ul>
<li><a href="#VM%E4%BB%8B%E7%BB%8D">VM介绍</a></li>
<li><a href="#VM%E4%BB%8B%E7%BB%8D">VM介绍</a></li>
<li><a href="#VM%E6%8E%A5%E5%8F%A3">VM接口</a><ul>
<li><a href="#%E6%97%A5%E5%BF%97%E6%8E%A7%E5%88%B6">日志控制</a></li>
<li><a href="#%E8%AE%BE%E7%BD%AEJNI">设置JNI</a></li>
<li><a href="#%E8%B0%83%E7%94%A8JNI_OnLoad%E5%87%BD%E6%95%B0">调用JNI_OnLoad函数</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96%E6%A8%A1%E6%8B%9F%E5%99%A8%E5%AE%9E%E4%BE%8B">获取模拟器实例</a></li>
<li><a href="#%E8%8E%B7%E5%8F%96APK%E7%9B%B8%E5%85%B3%E4%BF%A1%E6%81%AF">获取APK相关信息</a></li>
<li><a href="#%E5%8A%A0%E8%BD%BD%E6%A8%A1%E5%9D%97">加载模块</a></li>
</ul>
</li>
<li><a href="#VM%E6%80%BB%E7%BB%93">VM总结</a></li>
</ul>
</li>
<li><a href="#CallMethod">CallMethod</a><ul>
<li><a href="#%E6%89%A7%E8%A1%8CJNI%E5%87%BD%E6%95%B0">执行JNI函数</a></li>
<li><a href="#%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F%E5%87%BD%E6%95%B0">执行任意函数</a></li>
<li><a href="#%E6%89%A7%E8%A1%8Cmain%E5%87%BD%E6%95%B0">执行main函数</a></li>
<li><a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNI方法封装</a><ul>
<li><a href="#void">void</a></li>
<li><a href="#boolean">boolean</a></li>
<li><a href="#int">int</a></li>
<li><a href="#long">long</a></li>
<li><a href="#float">float</a></li>
<li><a href="#double">double</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B">对象类型</a></li>
</ul>
</li>
<li><a href="#JNI%E6%96%B9%E6%B3%95%E7%AD%BE%E5%90%8D">JNI方法签名</a></li>
</ul>
</li>
<li><a href="#Hook">Hook</a><ul>
<li><a href="#Hook%E4%BB%8B%E7%BB%8D">Hook介绍</a></li>
<li><a href="#Hook%E6%A1%86%E6%9E%B6%E5%88%86%E7%B1%BB">Hook框架分类</a><ul>
<li><a href="#HookZz">HookZz</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96HookZz%E5%AE%9E%E4%BE%8B">获取HookZz实例</a></li>
<li><a href="#HookZz-API">HookZz API</a><ul>
<li><a href="#wrap">wrap</a></li>
<li><a href="#replace">replace</a></li>
<li><a href="#instrument">instrument</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Dobby">Dobby</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Dobby%E5%AE%9E%E4%BE%8B">获取Dobby实例</a></li>
<li><a href="#Dobby-API">Dobby API</a><ul>
<li><a href="#replace-1">replace</a></li>
<li><a href="#instrument">instrument</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#xHook">xHook</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96xHook%E5%AE%9E%E4%BE%8B">获取xHook实例</a></li>
<li><a href="#xHook-API">xHook API</a><ul>
<li><a href="#register">register</a></li>
<li><a href="#refresh">refresh</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Whale">Whale</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96Whale%E5%AE%9E%E4%BE%8B">获取Whale实例</a></li>
<li><a href="#Whale-API">Whale API</a></li>
</ul>
</li>
<li><a href="#patch">patch</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#JNI">JNI</a><ul>
<li><a href="#JNI%E4%BB%8B%E7%BB%8D">JNI介绍</a></li>
<li><a href="#%E7%B1%BB-x2F-%E7%B1%BB%E5%9E%8B">类&#x2F;类型</a></li>
<li><a href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B">对象&#x2F;实例</a></li>
<li><a href="#%E5%8C%85%E8%A3%85%E5%AF%B9%E8%B1%A1">包装对象</a><ul>
<li><a href="#String">String</a></li>
<li><a href="#Array">Array</a></li>
<li><a href="#List">List</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Module">Module</a><ul>
<li><a href="#Module%E4%BB%8B%E7%BB%8D">Module介绍</a></li>
<li><a href="#Module%E5%B8%B8%E7%94%A8%E7%9A%84%E5%B1%9E%E6%80%A7">Module常用的属性</a><ul>
<li><a href="#base">base</a></li>
<li><a href="#name">name</a></li>
<li><a href="#callEntry">callEntry</a></li>
<li><a href="#findSymbolByName">findSymbolByName</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#Backend">Backend</a><ul>
<li><a href="#Backend%E4%BB%8B%E7%BB%8D">Backend介绍</a></li>
<li><a href="#Backend%E5%88%97%E8%A1%A8">Backend列表</a><ul>
<li><a href="#Unicorn-x2F-Unicorn2">Unicorn&#x2F;Unicorn2</a><ul>
<li>使用Unicorn2后端:</li>
<li>Unicorn后端特点</li>
</ul>
</li>
<li><a href="#Dynarmic">Dynarmic</a><ul>
<li>使用Dynarmic后端</li>
<li>Dynarmic后端特点</li>
</ul>
</li>
<li><a href="#Hypervisor">Hypervisor</a><ul>
<li>使用Hypervisor后端</li>
<li>Hypervisor后端特点</li>
</ul>
</li>
<li><a href="#Kvm">Kvm</a><ul>
<li>使用Kvm后端</li>
<li>Kvm后端特点</li>
</ul>
</li>
</ul>
</li>
<li><a href="#Backend%E6%8E%A5%E5%8F%A3">Backend接口</a></li>
</ul>
</li>
<li><a href="#yxDebuggerRMm">Debugger</a><ul>
<li><a href="#Debugger%E4%BB%8B%E7%BB%8D">Debugger介绍</a></li>
<li><a href="#ConsoleDebugger">ConsoleDebugger</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8%E6%AD%A5%E9%AA%A4">使用步骤</a></li>
<li><a href="#%E8%B0%83%E8%AF%95%E6%8C%87%E4%BB%A4">调试指令</a></li>
</ul>
</li>
<li><a href="#GDB_SERVER">GDB_SERVER</a></li>
<li><a href="#ANDROID_SERVER_V7">ANDROID_SERVER_V7</a></li>
<li><a href="#Block">Block</a></li>
</ul>
</li>
<li><a href="#SyscallHandler">SyscallHandler</a><ul>
<li><a href="#SyscallHandler%E4%BB%8B%E7%BB%8D">SyscallHandler介绍</a></li>
<li><a href="#API">API</a><ul>
<li><a href="#%E8%8E%B7%E5%8F%96SyscallHandler%E5%AE%9E%E4%BE%8B">获取SyscallHandler实例</a></li>
<li><a href="#setVerbose">setVerbose</a></li>
<li><a href="#addIOResolver">addIOResolver</a></li>
<li><a href="#setEnableThreadDispatcher">setEnableThreadDispatcher</a></li>
<li><a href="#setFileListener">setFileListener</a></li>
<li><a href="#getFileIO">getFileIO</a></li>
</ul>
</li>
<li><a href="#%E8%87%AA%E5%A4%84%E7%90%86%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8">自处理系统调用</a></li>
<li><a href="#FileResult">FileResult</a><ul>
<li>success</li>
<li>failed</li>
<li>fallback</li>
</ul>
</li>
</ul>
</li>
<li><a href="#VirtualModule">VirtualModule</a><ul>
<li><a href="#VirtualModule%E4%BB%8B%E7%BB%8D">VirtualModule介绍</a></li>
<li><a href="#unidbg%E8%87%AA%E5%B8%A6%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97">unidbg自带虚拟模块</a></li>
<li><a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%99%9A%E6%8B%9F%E6%A8%A1%E5%9D%97">自定义虚拟模块</a><ul>
<li>模拟场景</li>
<li>首次尝试</li>
<li>处理问题</li>
<li>完整代码</li>
</ul>
</li>
</ul>
</li>
<li><a href="#Jnitrace">Jnitrace</a><ul>
<li><a href="#%E4%BD%BF%E7%94%A8">使用</a></li>
<li><a href="#jnitrace%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E8%BF%94%E5%9B%9E%E7%9A%84%E6%98%AF%E5%9C%B0%E5%9D%80%E7%9A%84%E6%97%B6%E5%80%99">jnitrace函数调用返回的是地址的时候</a></li>
<li><a href="#%E5%A0%86%E6%A0%88%E6%A3%80%E6%B5%8B">堆栈检测</a></li>
</ul>
</li>
<li><a href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">函数调用的两种方式</a><ul>
<li><a href="#%E7%AC%A6%E5%8F%B7%E8%B0%83%E7%94%A8">符号调用</a></li>
<li><a href="#%E5%9C%B0%E5%9D%80%E8%B0%83%E7%94%A8">地址调用</a></li>
</ul>
</li>
<li><a href="#%E6%9E%84%E5%BB%BA%E7%B1%BB%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F">构建类的两种方式</a></li>
<li><a href="#%E7%B1%BB%E7%BB%A7%E6%89%BF%E7%9A%84%E5%86%99%E6%B3%95">类继承的写法</a></li>
<li><a href="#unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7">unidbg补获取系统属性</a></li>
<li><a href="#%E6%96%87%E4%BB%B6%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%8C%E5%AE%9E%E7%8E%B0-IOResolver">文件重定向，实现-IOResolver</a></li>
<li><a href="#%E4%B8%80%E4%BA%9B%E5%B8%B8%E7%94%A8%E5%8A%9F%E8%83%BD">一些常用功能</a></li>
<li><a href="#%E5%8F%8D%E5%88%B6unidbg">反制unidbg</a></li>
<li><a href="#Unidbg%E6%8A%A5%E9%94%99">Unidbg报错</a></li>
</ul>
<h2 id="基本框架"><a href="#基本框架" class="headerlink" title="基本框架"></a>基本框架</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line"></span><br><span class="line">xxxx() &#123;</span><br><span class="line">    <span class="comment">// 创建模拟器实例,进程名建议依照实际进程名填写，可以规避针对进程名的校验</span></span><br><span class="line">    emulator = AndroidEmulatorBuilder.for32Bit().setProcessName(<span class="string">&quot;xxxxx&quot;</span>).build();</span><br><span class="line">    <span class="comment">// 获取模拟器的内存操作接口</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">    <span class="comment">// 设置系统类库解析</span></span><br><span class="line">    memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">    <span class="comment">// 创建Android虚拟机,传入APK，Unidbg可以替我们做部分签名校验的工作</span></span><br><span class="line">    vm = emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apk路径&quot;</span>));</span><br><span class="line">    <span class="comment">// 加载目标SO</span></span><br><span class="line">    <span class="type">DalvikModule</span> <span class="variable">dm</span> <span class="operator">=</span> vm.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;so路径&quot;</span>), <span class="literal">true</span>); <span class="comment">// 加载so到虚拟内存</span></span><br><span class="line">    <span class="comment">//获取本SO模块的句柄,后续需要用它</span></span><br><span class="line">    <span class="keyword">module</span> = dm.getModule();</span><br><span class="line">    vm.setJni(<span class="built_in">this</span>); <span class="comment">// 设置JNI</span></span><br><span class="line">    vm.setVerbose(<span class="literal">true</span>); <span class="comment">// 打印日志</span></span><br><span class="line"></span><br><span class="line">    dm.callJNI_OnLoad(emulator); <span class="comment">// 调用JNI OnLoad</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="AndroidEmulator"><a href="#AndroidEmulator" class="headerlink" title="AndroidEmulator"></a>AndroidEmulator</h2><h3 id="AndroidEmulator介绍"><a href="#AndroidEmulator介绍" class="headerlink" title="AndroidEmulator介绍"></a>AndroidEmulator介绍</h3><p>AndroidEmulator是一个抽象的Android模拟器接口。它作为一个枢纽，协调unidbg中大多数模块相互工作，至关重要。我们需要的大多数操作也都需要借助于它。</p>
<h3 id="创建AndroidEmulator实例"><a href="#创建AndroidEmulator实例" class="headerlink" title="创建AndroidEmulator实例"></a>创建AndroidEmulator实例</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">AndroidEmulator</span> <span class="variable">build</span> <span class="operator">=</span> AndroidEmulatorBuilder</span><br><span class="line">    <span class="comment">// 指定32位CPU</span></span><br><span class="line">    .for32Bit()</span><br><span class="line">    <span class="comment">// 添加后端，推荐使用Dynarmic，运行速度快，但并不支持某些新特性</span></span><br><span class="line">    .addBackendFactory(<span class="keyword">new</span> <span class="title class_">DynarmicFactory</span>(<span class="literal">true</span>))</span><br><span class="line">    <span class="comment">// 指定进程名，推荐以安卓包名做为进程名</span></span><br><span class="line">    .setProcessName(<span class="string">&quot;com.github.unidbg&quot;</span>)</span><br><span class="line">    <span class="comment">// 设置根路径</span></span><br><span class="line">    .setRootDir(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;target/rootfs/default&quot;</span>))</span><br><span class="line">    <span class="comment">// 生成AndroidEmulator实例</span></span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure>

<h3 id="AndroidEmulator操作接口"><a href="#AndroidEmulator操作接口" class="headerlink" title="AndroidEmulator操作接口"></a>AndroidEmulator操作接口</h3><h4 id="getMemory"><a href="#getMemory" class="headerlink" title="getMemory"></a>getMemory</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取内存操作接口</span></span><br><span class="line"><span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br></pre></td></tr></table></figure>
<p>获取内存操作接口，关于Memory接口介绍查看<a href="#Memory">Memory</a>。</p>
<h4 id="getPid"><a href="#getPid" class="headerlink" title="getPid"></a>getPid</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取进程pid</span></span><br><span class="line"><span class="type">int</span> <span class="variable">pid</span> <span class="operator">=</span> emulator.getPid();</span><br></pre></td></tr></table></figure>

<h4 id="createDalvikVM"><a href="#createDalvikVM" class="headerlink" title="createDalvikVM"></a>createDalvikVM</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 创建虚拟机</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.createDalvikVM();</span><br><span class="line"><span class="comment">// 创建虚拟机并指定APK文件</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apk file path&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>创建虚拟机，关于VM的接口查看<a href="#VM">VM介绍</a></p>
<h4 id="loadLibrary"><a href="#loadLibrary" class="headerlink" title="loadLibrary"></a>loadLibrary</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数一: So或可执行ELF文件</span></span><br><span class="line"><span class="comment">//参数二: 是否强制执行Init初始化系列函数</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Elf文件路径&quot;</span>), <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//省略参数二，默认为false</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;Elf文件路径&quot;</span>));</span><br></pre></td></tr></table></figure>

<h4 id="getDalvikVM"><a href="#getDalvikVM" class="headerlink" title="getDalvikVM"></a>getDalvikVM</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取已创建的虚拟机</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">vm</span> <span class="operator">=</span> emulator.getDalvikVM();</span><br></pre></td></tr></table></figure>
<p>获取已创建的虚拟机。</p>
<h4 id="showRegs"><a href="#showRegs" class="headerlink" title="showRegs"></a>showRegs</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//打印所有寄存器信息</span></span><br><span class="line">emulator.showRegs();</span><br><span class="line"><span class="comment">//打印指定寄存器信息</span></span><br><span class="line">emulator.showRegs(ArmConst.UC_ARM_REG_R0, ArmConst.UC_ARM_REG_R1);</span><br></pre></td></tr></table></figure>
<p>打印当前寄存器信息。</p>
<h4 id="getBackend"><a href="#getBackend" class="headerlink" title="getBackend"></a>getBackend</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取后端CPU</span></span><br><span class="line">Backend backend = emulator.getBackend();</span><br></pre></td></tr></table></figure>
<p>获取后端，关于后端请查看<a href="#Backend">Backend</a>介绍</p>
<h4 id="getProcessName"><a href="#getProcessName" class="headerlink" title="getProcessName"></a>getProcessName</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取进程名</span></span><br><span class="line"><span class="type">String</span> <span class="variable">processName</span> <span class="operator">=</span> emulator.getProcessName();</span><br></pre></td></tr></table></figure>
<p>获取进程名。</p>
<h4 id="getContext"><a href="#getContext" class="headerlink" title="getContext"></a>getContext</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取寄存器</span></span><br><span class="line">RegisterContext context = emulator.getContext();</span><br></pre></td></tr></table></figure>
<p>获取寄存器上下文，关于寄存器上下文介绍请查看<a href="#RegisterContext">RegisterContext介绍</a>。</p>
<h4 id="isRunning"><a href="#isRunning" class="headerlink" title="isRunning"></a>isRunning</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 是否正在运行</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> emulator.isRunning();</span><br></pre></td></tr></table></figure>
<p>是否正在运行。</p>
<h4 id="Trace"><a href="#Trace" class="headerlink" title="Trace"></a>Trace</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Trace汇编指令</span></span><br><span class="line">emulator.traceCode();</span><br><span class="line"><span class="comment">//指定起始结束范围Trace汇编指令。</span></span><br><span class="line">emulator.traceCode(<span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//带回调的Trace，每条指令都会回调onInstruction方法</span></span><br><span class="line">emulator.traceCode(<span class="number">1</span>, <span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">TraceCodeListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onInstruction</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address, Instruction insn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">mnemonic</span> <span class="operator">=</span> insn.getMnemonic();</span><br><span class="line">        <span class="keyword">if</span> (mnemonic.equals(<span class="string">&quot;svc&quot;</span>) || mnemonic.equals(<span class="string">&quot;swi&quot;</span>))&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;0x&quot;</span>+Long.toHexString(address)+<span class="string">&quot;执行了svc指令&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Trace读内存</span></span><br><span class="line">emulator.traceRead();</span><br><span class="line"><span class="comment">// emulator.traceRead(起始地址，结束地址);  // 哪里做了读取</span></span><br><span class="line"><span class="comment">//Trace写内存</span></span><br><span class="line">emulator.traceWrite(); </span><br><span class="line"><span class="comment">// emulator.traceWrite(起始地址，结束地址);  // 哪里做了赋值</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：Trace功能仅支持Unicorn后端引擎</strong><br />如使用带范围的Trace，起始位置大于结束位置将全部进行Trace。与无参方法作用相同。每种Trace都包含了三种重载，参照traceCode()即可。</p>
<h4 id="Set-x2F-Get"><a href="#Set-x2F-Get" class="headerlink" title="Set&#x2F;Get"></a>Set&#x2F;Get</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator.set(<span class="string">&quot;Test&quot;</span>,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> emulator.&lt;DocTest&gt;get(<span class="string">&quot;Test&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>emulator内部维护了一个Map，如有全局的对象需要存储，可借助这两个API来操作，无需额外维护Map对象</p>
<h4 id="SyscallHandler"><a href="#SyscallHandler" class="headerlink" title="SyscallHandler"></a>SyscallHandler</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SyscallHandler&lt;AndroidFileIO&gt; syscallHandler = emulator.getSyscallHandler();</span><br></pre></td></tr></table></figure>
<p>获取系统调用处理器，其API请查看<a href="#SyscallHandler-1">SyscallHandler介绍</a>。</p>
<h4 id="Debugger"><a href="#Debugger" class="headerlink" title="Debugger"></a>Debugger</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//无参默认CONSOLE调试器</span></span><br><span class="line"><span class="type">Debugger</span> <span class="variable">attach</span> <span class="operator">=</span> emulator.attach();</span><br><span class="line"><span class="comment">//指定调试器</span></span><br><span class="line"><span class="type">Debugger</span> <span class="variable">attach</span> <span class="operator">=</span> emulator.attach(DebuggerType.CONSOLE);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span>  <span class="title class_">DebuggerType</span> &#123;</span><br><span class="line">    <span class="comment">//console debugger</span></span><br><span class="line">    CONSOLE,</span><br><span class="line">    <span class="comment">//gdb server</span></span><br><span class="line">    GDB_SERVER,</span><br><span class="line">    <span class="comment">//ida android server v7.x</span></span><br><span class="line">    ANDROID_SERVER_V7</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>附加调试器。关于调试器请查看<a href="#Deggbuer">Debugger介绍</a>。</p>
<h4 id="emulateSignal"><a href="#emulateSignal" class="headerlink" title="emulateSignal"></a>emulateSignal</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数为SIG_NUM Linux执行 kill -l 查看信号列表</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> emulator.emulateSignal(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>模拟向进程发送一个信号。</p>
<h4 id="disassemble"><a href="#disassemble" class="headerlink" title="disassemble"></a>disassemble</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 参数一: 地址</span></span><br><span class="line"><span class="comment">// 参数二: 机器码</span></span><br><span class="line"><span class="comment">// 参数三: 是否为Thumb指令</span></span><br><span class="line"><span class="comment">// 参数四: 最多处理多少条指令</span></span><br><span class="line"><span class="type">byte</span>[] code = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x00</span>, <span class="number">0x20</span>&#125;;</span><br><span class="line">Instruction[] disassemble = emulator.disassemble(<span class="number">0</span>, code, <span class="literal">true</span>, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<p>如需灵活转换，请使用Capstone，此处只是Capstone的简单封装。disassemble方法的另一重载不推荐大家使用，为Trace而封装的，了解即可。</p>
<h4 id="close"><a href="#close" class="headerlink" title="close"></a>close</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator.close();</span><br></pre></td></tr></table></figure>
<p>调用此方法来释放Android虚拟机使用的资源。</p>
<h4 id="getUnwinder"><a href="#getUnwinder" class="headerlink" title="getUnwinder"></a>getUnwinder</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator.getUnwinder().unwind();</span><br></pre></td></tr></table></figure>
<p>此方法用来打印调用栈</p>
<h2 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h2><h3 id="Memory介绍"><a href="#Memory介绍" class="headerlink" title="Memory介绍"></a>Memory介绍</h3><p>Memory内存接口主要提供了两个功能</p>
<ul>
<li>内存管理</li>
<li>ELF文件的加载</li>
</ul>
<p>下面我们来介绍下Memory操作的主要接口。</p>
<h3 id="Memory操作"><a href="#Memory操作" class="headerlink" title="Memory操作"></a>Memory操作</h3><h4 id="获取Memory实例"><a href="#获取Memory实例" class="headerlink" title="获取Memory实例"></a>获取Memory实例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//emulator为模拟器实例</span></span><br><span class="line"><span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br></pre></td></tr></table></figure>

<h4 id="setLibraryResolver"><a href="#setLibraryResolver" class="headerlink" title="setLibraryResolver"></a>setLibraryResolver</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定Android SDK 版本，目前支持19和23两个版本</span></span><br><span class="line">memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br></pre></td></tr></table></figure>
<p><font color="red">此接口属于必调用接口。</font>设置SDK版本，管理了Android提供的常用基本so库。如不调用此方法，在处理Elf文件的依赖时，需要自行处理依赖问题。只有So中无任何依赖的情况下可以不调用此方法。</p>
<h4 id="findModule"><a href="#findModule" class="headerlink" title="findModule"></a>findModule</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据名称获取已加载模块</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.findModule(<span class="string">&quot;libc.so&quot;</span>);</span><br><span class="line"><span class="comment">//根据模块在内存中的地址查找已加载模块</span></span><br><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.findModuleByAddress(address);</span><br><span class="line"><span class="comment">//获取所有已经加载过的模块</span></span><br><span class="line">Collection&lt;Module&gt; loadedModules = memory.getLoadedModules();</span><br></pre></td></tr></table></figure>
<p>上面两个方法都为获取已加载的模块，需在自行加载模块之后调用。</p>
<h4 id="allocateStack"><a href="#allocateStack" class="headerlink" title="allocateStack"></a>allocateStack</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数为申请栈空间的大小</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.allocateStack(<span class="number">0x10</span>);</span><br><span class="line"><span class="comment">//在栈空间写入数据并返回指针</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.writeStackBytes(<span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">0x01</span>, <span class="number">0x02</span>&#125;);</span><br><span class="line"><span class="comment">//在栈空间写入字符串并返回指针</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.writeStackString(<span class="string">&quot;doc&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>不要在程序运行期间修改栈，如果你不清楚在做什么，最好不要自行开辟栈空间，unidbg会自行维护。</p>
<h4 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数一: 分配内存的大小</span></span><br><span class="line"><span class="comment">//参数二: runtime标志</span></span><br><span class="line"><span class="type">MemoryBlock</span> <span class="variable">malloc</span> <span class="operator">=</span> memory.malloc(<span class="number">0x10</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">//获取已分配内存的指针来操作该内存</span></span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> malloc.getPointer();</span><br><span class="line"><span class="comment">//释放已分配的内存</span></span><br><span class="line">malloc.free();</span><br></pre></td></tr></table></figure>
<p>参数二的runtime标志：true表示使用mmap按页大小分配，相应的调用MemoryBlock.free方法则使用munmap释放。false表示使用libc.malloc分配，相应的调用MemoryBlock.free方法则使用libc.free释放。</p>
<h4 id="setErrno"><a href="#setErrno" class="headerlink" title="setErrno"></a>setErrno</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">memory.setErrno(UnixEmulator.EPERM); </span><br></pre></td></tr></table></figure>
<p>如需在模拟执行某函数前需要指定errno，可使用此方法设置。</p>
<h4 id="getStackPoint"><a href="#getStackPoint" class="headerlink" title="getStackPoint"></a>getStackPoint</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">stackPoint</span> <span class="operator">=</span> memory.getStackPoint(); </span><br></pre></td></tr></table></figure>
<p>返回当前SP寄存器指向的地址。</p>
<h4 id="disableCallInitFunction"><a href="#disableCallInitFunction" class="headerlink" title="disableCallInitFunction"></a>disableCallInitFunction</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">memory.disableCallInitFunction();</span><br><span class="line"><span class="comment">//参数一: 指定是否调用初始化</span></span><br><span class="line">memory.setCallInitFunction(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<p>禁用Elf加载时调用初始化函数。需配合加载模块的forceCallInit参数使用。如不进行上述设置，默认为true。</p>
<h4 id="getMemoryMap"><a href="#getMemoryMap" class="headerlink" title="getMemoryMap"></a>getMemoryMap</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Collection&lt;MemoryMap&gt; memoryMap = memory.getMemoryMap();</span><br><span class="line"><span class="comment">//打印当前内存映射情况</span></span><br><span class="line"><span class="keyword">for</span> (MemoryMap map : memoryMap)&#123;</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取内存映射信息，所有正在使用的内存块都维护在此Map中。</p>
<h4 id="pointer"><a href="#pointer" class="headerlink" title="pointer"></a>pointer</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> memory.pointer(<span class="number">0x40000000</span>);</span><br><span class="line"><span class="type">UnidbgPointer</span> <span class="variable">pointer2</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator, <span class="number">0x40000000</span>);</span><br></pre></td></tr></table></figure>
<p>在unidbg中，可以借助unidbgPointer封装的API来读写内存，此API供已知地址的情况下，获得一个指针指向已知地址，继而进行操作。可以理解为指哪打哪。具体内存读写操作请查看<a href="#UnidbgPointer">UnidbgPointer</a>。</p>
<h4 id="addModuleListener"><a href="#addModuleListener" class="headerlink" title="addModuleListener"></a>addModuleListener</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">memory.addModuleListener(<span class="keyword">new</span> <span class="title class_">ModuleListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onLoaded</span><span class="params">(Emulator&lt;?&gt; emulator, Module <span class="keyword">module</span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="keyword">module</span>.name + <span class="string">&quot;已被加载&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>添加一个模块加载监听器，当一个新模块被加载后，会回调ModuleListener的onLoaded方法，用来感知某模块加载。一般用于想在某个模块加载后接着进行hook的操作。需在模块加载前设置，否则无效。</p>
<h4 id="load"><a href="#load" class="headerlink" title="load"></a>load</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> memory.load(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;文件地址&quot;</span>)); </span><br></pre></td></tr></table></figure>
<p>其余几个重载就不介绍了，emulator接口提供的模块加载API和VM提供的加载API底层都基于此，仅是对此API的一层封装。</p>
<h3 id="Memory总结"><a href="#Memory总结" class="headerlink" title="Memory总结"></a>Memory总结</h3><p>Memory模块封装了关于内存管理的各个接口，其余未介绍的方法不推荐大家使用，多为unidbg内部封装的功能。</p>
<h2 id="VM"><a href="#VM" class="headerlink" title="VM"></a>VM</h2><h3 id="VM介绍"><a href="#VM介绍" class="headerlink" title="VM介绍"></a>VM介绍</h3><p>如果要加载的模块中存在JNI交互的场景，需要创建VM。VM主要的作用就是代理了一套JNI，在模拟执行的过程中，如果需要借助JNI来操作Java层，就少不了VM的帮助。</p>
<h3 id="VM创建"><a href="#VM创建" class="headerlink" title="VM创建"></a>VM创建</h3><p>在<a href="#AndroidEmulator">AndroidEmulator</a>一节我们介绍过，主要有两种创建VM的方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建虚拟机</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">dalvikVM</span> <span class="operator">=</span> emulator.createDalvikVM();</span><br><span class="line"><span class="comment">//创建虚拟机并指定APK文件</span></span><br><span class="line"><span class="type">VM</span> <span class="variable">dalvikVM</span> <span class="operator">=</span> emulator.createDalvikVM(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;apk file path&quot;</span>));</span><br></pre></td></tr></table></figure>
<p>推荐使用指定APK文件进行创建，某些API需要指定APK文件才可使用。</p>
<h3 id="VM接口"><a href="#VM接口" class="headerlink" title="VM接口"></a>VM接口</h3><h4 id="日志控制"><a href="#日志控制" class="headerlink" title="日志控制"></a>日志控制</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置是否输出JNI运行日志 </span></span><br><span class="line">vm.setVerbose(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>此开关只控制VM的日志，主要表现为JNI交互的详细日志。</p>
<h4 id="设置JNI"><a href="#设置JNI" class="headerlink" title="设置JNI"></a>设置JNI</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置JNI接口 </span></span><br><span class="line">dalvikVM.setJni(<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>如程序中存在使用JNI的接口，必须设置JNI。推荐自实现的类继承AbstractJni类，此类封装了绝大部份常用的方法，免去部分繁杂的内容。如签名校验(需指定APK文件创建VM)、常用JDK操作等。 关于JNI部分请查看<a href="#JNI">JNI介绍</a></p>
<h4 id="调用JNI-OnLoad函数"><a href="#调用JNI-OnLoad函数" class="headerlink" title="调用JNI_OnLoad函数"></a>调用JNI_OnLoad函数</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 参数一: 模拟器实例 </span></span><br><span class="line"><span class="comment">// 参数二: 要执行JNI_OnLoad函数的模块 </span></span><br><span class="line">dalvikVM.callJNI_OnLoad(emulator,<span class="keyword">module</span>);</span><br></pre></td></tr></table></figure>
<p>对JNI_OnLoad函数进行模拟执行。如某些JNI方法在JNI_OnLoad函数进行动态绑定需调用此函数后才能够调用JNI方法，推荐加载模块后紧接执行此方法。</p>
<h4 id="获取模拟器实例"><a href="#获取模拟器实例" class="headerlink" title="获取模拟器实例"></a>获取模拟器实例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Emulator&lt;?&gt; emulator = dalvikVM.getEmulator(); </span><br></pre></td></tr></table></figure>

<h4 id="获取APK相关信息"><a href="#获取APK相关信息" class="headerlink" title="获取APK相关信息"></a>获取APK相关信息</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//指定APK文件以后，可调用该方法获取资源文件</span></span><br><span class="line"><span class="type">byte</span>[] bytes = dalvikVM.openAsset(<span class="string">&quot;fileName&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定APK文件以后，可调用该方法获取APK包名</span></span><br><span class="line"><span class="type">String</span> <span class="variable">packageName</span> <span class="operator">=</span> dalvikVM.getPackageName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定APK文件以后，可调用该方法获取APK版本名称</span></span><br><span class="line"><span class="type">String</span> <span class="variable">versionName</span> <span class="operator">=</span> dalvikVM.getVersionName();</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定APK文件以后，可调用该方法获取APK版本号</span></span><br><span class="line"><span class="type">long</span> <span class="variable">versionCode</span> <span class="operator">=</span> dalvikVM.getVersionCode();</span><br><span class="line"></span><br><span class="line"><span class="comment">//指定APK文件以后，可调用该方法获取Manifest清单信息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">manifestXml</span> <span class="operator">=</span> dalvikVM.getManifestXml();</span><br></pre></td></tr></table></figure>

<h4 id="加载模块"><a href="#加载模块" class="headerlink" title="加载模块"></a>加载模块</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数一: 模块名称</span></span><br><span class="line"><span class="comment">//参数二: 是否强制执行Init初始化</span></span><br><span class="line"><span class="type">DalvikModule</span> <span class="variable">docModule</span> <span class="operator">=</span> dalvikVM.loadLibrary(<span class="string">&quot;doc&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//参数一: 模块名称</span></span><br><span class="line"><span class="comment">//参数二: 要加载模块的字节数据</span></span><br><span class="line"><span class="comment">//参数三: 是否强制执行Init初始化</span></span><br><span class="line"><span class="type">DalvikModule</span> <span class="variable">docModule</span> <span class="operator">=</span> dalvikVM.loadLibrary(<span class="string">&quot;doc&quot;</span>, soFile.getBytes(), <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>VM同样能够加载Elf模块，具体的差异就是如果指定了APK文件，可以使用上述第一个重载方法指定模块名称，unidbg会自行从APK文件中提取该So文件进行加载。第二个重载方法使用较少，指定byte[]数据进行加载，名称由参数一指定。<br />返回一个DalvikModule实例，可调用JNI_OnLoad函数:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">docModule.callJNI_OnLoad(emulator); </span><br></pre></td></tr></table></figure>
<p>该实例还维护了一个Module实例，可使用下面方法获取。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> docModule.getModule(); </span><br></pre></td></tr></table></figure>
<p>有关Module实例请查看<a href="#Module">Module</a></p>
<h3 id="VM总结"><a href="#VM总结" class="headerlink" title="VM总结"></a>VM总结</h3><p>上述的几个接口主要来控制VM或获取APK文件信息，VM其中的方法不止于这些，我们留到JNI部分来介绍，因为其他的几个方法都是有关于JNI交互场景的，也就是unidbg中的环境问题。<br />unidbg补环境、JNI交互请查看<a href="#JNI">JNI介绍</a></p>
<h2 id="CallMethod"><a href="#CallMethod" class="headerlink" title="CallMethod"></a>CallMethod</h2><h3 id="执行JNI函数"><a href="#执行JNI函数" class="headerlink" title="执行JNI函数"></a>执行JNI函数</h3><ul>
<li>我们首先来写一段小案例来说明如何在unidbg中执行JNI函数</li>
</ul>
<p>Java层:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-doc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">jnitest</span><span class="params">(String arg)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So层:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include &lt;string&gt;</span><br><span class="line"></span><br><span class="line">using namespace std;</span><br><span class="line"></span><br><span class="line">extern <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT jstring JNICALL</span><br><span class="line"><span class="title function_">Java_com_github_unidbg_Test_jnitest</span><span class="params">(JNIEnv *env, jobject thiz, jstring arg)</span> &#123;</span><br><span class="line">    const <span class="type">char</span> *c_arg = env-&gt;GetStringUTFChars(arg, nullptr);</span><br><span class="line">    <span class="type">string</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="string">&quot;unidbg:&quot;</span>;</span><br><span class="line">    hello.append(c_arg);</span><br><span class="line">    <span class="keyword">return</span> env-&gt;NewStringUTF(hello.c_str());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>非常简单的一段小例子，我们就以该例子来说明如何调用libnative-doc.so中的jnitest函数。</p>
<ul>
<li><p>第一步: 创建一个DvmObject，此对象相当于在Java层去调用native函数的类的实例对象</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建一个类的实例对象</span></span><br><span class="line">DvmObject&lt;?&gt; obj = vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>).newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>关于实例对象的介绍请查看<a href="#%E5%AF%B9%E8%B1%A1-x2F-%E5%AE%9E%E4%BE%8B">JNI对象&#x2F;实例</a></p>
</li>
<li><p>第二步: 使用该对象调用JNI方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数一: Emulator实例</span></span><br><span class="line"><span class="comment">//参数二: 方法的签名</span></span><br><span class="line"><span class="comment">//参数三: 可变参数，传需要向该方法传递的参数</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> obj.callJniMethodObject(emulator, <span class="string">&quot;jnitest(Ljava/lang/String;)Ljava/lang/String;&quot;</span>, <span class="string">&quot;yyds!&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>我们拥有了一个实例对象，就可以像在Java中那样来调用native方法了，针对Java层中不同返回值调用的API不同，请查看<a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNI方法封装</a><br />参数二是方法的签名，此参数如何填写请查看<a href="#JNI%E6%96%B9%E6%B3%95%E5%B0%81%E8%A3%85">JNI方法签名</a></p>
</li>
</ul>
<h3 id="执行任意函数"><a href="#执行任意函数" class="headerlink" title="执行任意函数"></a>执行任意函数</h3><p>当我们想执行的函数并非导出函数，也可使用地址进行调用，请自行参考unidbg对JNI函数调用的封装，自行实现此部分。</p>
<h3 id="执行main函数"><a href="#执行main函数" class="headerlink" title="执行main函数"></a>执行main函数</h3><p>如果加载的文件是一个可执行文件，需要持有该文件被加载后返回的Module实例来调用callEntry方法，请查看<a href="#Module">Module</a></p>
<h3 id="JNI方法封装"><a href="#JNI方法封装" class="headerlink" title="JNI方法封装"></a>JNI方法封装</h3><h4 id="void"><a href="#void" class="headerlink" title="void"></a>void</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//调用void返回值的函数</span></span><br><span class="line">testClass.callStaticJniMethod(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line">obj.callJniMethod(emulator,<span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="boolean"><a href="#boolean" class="headerlink" title="boolean"></a>boolean</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//调用boolean返回值的函数</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodBoolean(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">boolean</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodBoolean(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="int"><a href="#int" class="headerlink" title="int"></a>int</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//调用int返回值的函数</span></span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="long"><a href="#long" class="headerlink" title="long"></a>long</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//调用long返回值的函数</span></span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>

<h4 id="float"><a href="#float" class="headerlink" title="float"></a>float</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>先拿到4字节的int数据，然后将其转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">allocate</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">4</span>);</span><br><span class="line">allocate.putInt(ret);</span><br><span class="line">allocate.flip();</span><br><span class="line"><span class="type">float</span> <span class="variable">f_ret</span> <span class="operator">=</span> allocate.getFloat();</span><br></pre></td></tr></table></figure>

<h4 id="double"><a href="#double" class="headerlink" title="double"></a>double</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> testClass.callStaticJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line"><span class="type">long</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodLong(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>先拿到8字节的long数据，然后将其转换</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">ByteBuffer</span> <span class="variable">allocate</span> <span class="operator">=</span> ByteBuffer.allocate(<span class="number">8</span>);</span><br><span class="line">allocate.putLong(ret);</span><br><span class="line">allocate.flip();</span><br><span class="line"><span class="type">double</span> <span class="variable">d_ret</span> <span class="operator">=</span> allocate.getDouble();</span><br></pre></td></tr></table></figure>

<h4 id="对象类型"><a href="#对象类型" class="headerlink" title="对象类型"></a>对象类型</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line"><span class="comment">//调用对象类型返回值的函数</span></span><br><span class="line">DvmObject&lt;?&gt; ret = testClass.callStaticJniMethodObject(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br><span class="line">DvmObject&lt;?&gt;  ret = obj.callJniMethodObject(emulator, <span class="string">&quot;signature&quot;</span>, args);</span><br></pre></td></tr></table></figure>
<p>基本类型外的所有类型都为对象类型，包括基本类型的数组类型</p>
<h3 id="JNI方法签名"><a href="#JNI方法签名" class="headerlink" title="JNI方法签名"></a>JNI方法签名</h3><p>通过类名与方法签名的配合，才能定位到唯一的函数。所以一定要将方法签名填写正确，unidbg才可以找到对应的函数，所有的类型都按JNI本身定义的签名一致。</p>
<table>
<thead>
<tr>
<th><strong>Java类型</strong></th>
<th><strong>类型签名</strong></th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>Z</td>
</tr>
<tr>
<td>byte</td>
<td>B</td>
</tr>
<tr>
<td>char</td>
<td>C</td>
</tr>
<tr>
<td>long</td>
<td>J</td>
</tr>
<tr>
<td>float</td>
<td>F</td>
</tr>
<tr>
<td>double</td>
<td>D</td>
</tr>
<tr>
<td>short</td>
<td>S</td>
</tr>
<tr>
<td>int</td>
<td>I</td>
</tr>
<tr>
<td>类</td>
<td>L全限定类名;</td>
</tr>
<tr>
<td>数组</td>
<td>[元素类型签名</td>
</tr>
</tbody></table>
<p>unidbg方法签名如下格式:<br />方法名(参数列表)返回值 <br />举个例子:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">native</span> String <span class="title function_">jnitest</span><span class="params">(String arg)</span>;</span><br></pre></td></tr></table></figure>
<p>对应的方法签名为:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">jnitest(Ljava/lang/String;)Ljava/lang/String;</span><br></pre></td></tr></table></figure>



<h2 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h2><h3 id="Hook介绍"><a href="#Hook介绍" class="headerlink" title="Hook介绍"></a>Hook介绍</h3><p>Hook模块为unidbg引入第三方Hook框架而封装的一个模块，使用它可以快速对目标So进行hook操作。而API基本与第三方Hook框架保持一致。如果是32位程序，要注意Hook目标地址是否为Thumb模式，手动处理+1操作。</p>
<h3 id="Hook框架分类"><a href="#Hook框架分类" class="headerlink" title="Hook框架分类"></a>Hook框架分类</h3><h4 id="HookZz"><a href="#HookZz" class="headerlink" title="HookZz"></a>HookZz</h4><p>HookZz为Dobby的前身，32位模式下推荐使用HookZz。支持inline hook。</p>
<h5 id="获取HookZz实例"><a href="#获取HookZz实例" class="headerlink" title="获取HookZz实例"></a>获取HookZz实例</h5><figure class="highlight c"><table><tr><td class="code"><pre><span class="line">HookZz hook = HookZz.getInstance(emulator);</span><br></pre></td></tr></table></figure>
<p>在使用任何Hook框架之前都需要拿到unidbg对该Hook框架的封装实例。</p>
<h5 id="HookZz-API"><a href="#HookZz-API" class="headerlink" title="HookZz API"></a>HookZz API</h5><h6 id="wrap"><a href="#wrap" class="headerlink" title="wrap"></a>wrap</h6><p>wrap的作用相当于在目标地址进行一层包装，回调到我们的代码，可以对其打印当前参数或寄存器的值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 1.获取HookZz实例</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">// 2.创建hook触发回调</span></span><br><span class="line">WrapCallback&lt;HookZzArm32RegisterContextImpl&gt; wrapCallback = <span class="keyword">new</span> <span class="title class_">WrapCallback</span>&lt;HookZzArm32RegisterContextImpl&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContextImpl ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        <span class="comment">//hook函数进入前回调</span></span><br><span class="line">        System.out.println(<span class="string">&quot;arg0:&quot;</span> + ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookZzArm32RegisterContextImpl ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        <span class="comment">//hook函数返回后回调</span></span><br><span class="line">        System.out.println(<span class="string">&quot;ret:&quot;</span> + ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// 3.wrap</span></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*偏移*/</span>;</span><br><span class="line">hookZz.wrap(functionAddress, wrapCallback);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.wrap重载, hook导出符号</span></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line">hookZz.wrap(symbol, wrapCallback);</span><br></pre></td></tr></table></figure>

<h6 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h6><p>replace可以进行替换目标函数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取HookZz实例</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">//创建replace触发回调</span></span><br><span class="line"><span class="type">ReplaceCallback</span> <span class="variable">replaceCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReplaceCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HookStatus <span class="title function_">onCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context, <span class="type">long</span> originFunction)</span> &#123;</span><br><span class="line">        <span class="comment">//函数调用前回调。上层会根据HookStatus来决定程序流程</span></span><br><span class="line">        <span class="comment">//先来介绍几个参数</span></span><br><span class="line">        <span class="comment">//emulator: 模拟器实例</span></span><br><span class="line">        <span class="comment">//context: Hook上下文，可根据此参数获取各种参数。也可存储临时数据。</span></span><br><span class="line">        <span class="comment">//originFunction: 原函数地址</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取参数一并打印</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;arg0:&quot;</span>+arg0);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//获取指针参数二并存入context</span></span><br><span class="line">        context.push(context.getPointerArg(<span class="number">1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//修改参数三的值为0</span></span><br><span class="line">        <span class="type">EditableArm32RegisterContext</span> <span class="variable">ctx</span> <span class="operator">=</span> (EditableArm32RegisterContext) context;</span><br><span class="line">        ctx.setR2(<span class="number">0</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//可以在此改变函数流程</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">newFuncAddr</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xDC0</span><span class="comment">/*偏移*/</span>;</span><br><span class="line">        <span class="keyword">return</span> HookStatus.RET(emulator, newFuncAddr);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        //也可以直接返回一个值而不调用函数</span></span><br><span class="line"><span class="comment">        long retValue = 0L;</span></span><br><span class="line"><span class="comment">        return HookStatus.LR(emulator, retValue);</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context)</span> &#123;</span><br><span class="line">        <span class="comment">//此回调会根据hookZz.replace方法的第三个参数enablePostCall决定</span></span><br><span class="line">        <span class="comment">//可以获取context存储的数据</span></span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg2</span> <span class="operator">=</span> context.pop();</span><br><span class="line">        <span class="comment">//可在此修改函数返回值</span></span><br><span class="line">        <span class="built_in">super</span>.postCall(emulator, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*偏移*/</span>;</span><br><span class="line"><span class="comment">//对目标地址进行inline hook, 并传入回调实例</span></span><br><span class="line">hookZz.replace(functionAddress, replaceCallback);</span><br><span class="line"><span class="comment">//replace重载，第三个参数控制是否可以修改返回值</span></span><br><span class="line">hookZz.replace(functionAddress, replaceCallback, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line"><span class="comment">//使用符号进行hook</span></span><br><span class="line">hookZz.replace(symbol, replaceCallback);</span><br><span class="line">hookZz.replace(symbol, replaceCallback, <span class="literal">true</span>);</span><br></pre></td></tr></table></figure>

<h6 id="instrument"><a href="#instrument" class="headerlink" title="instrument"></a>instrument</h6><p>instrument提供了一种对单行汇编进行Hook的能力，使用场景较少。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//获取HookZz实例</span></span><br><span class="line"><span class="type">HookZz</span> <span class="variable">hookZz</span> <span class="operator">=</span> HookZz.getInstance(emulator);</span><br><span class="line"><span class="comment">//创建InstrumentCallback实例</span></span><br><span class="line">InstrumentCallback&lt;RegisterContext&gt; instrumentCallback = <span class="keyword">new</span> <span class="title class_">InstrumentCallback</span>&lt;RegisterContext&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dbiCall</span><span class="params">(Emulator&lt;?&gt; emulator, RegisterContext ctx, HookEntryInfo info)</span> &#123;</span><br><span class="line">        System.out.println(ctx.getIntArg(<span class="number">0</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*偏移*/</span>;</span><br><span class="line"><span class="comment">//对单行地址进行hook</span></span><br><span class="line">hookZz.instrument(functionAddress, instrumentCallback);</span><br><span class="line"></span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br><span class="line">hookZz.instrument(symbol, instrumentCallback);</span><br></pre></td></tr></table></figure>

<h4 id="Dobby"><a href="#Dobby" class="headerlink" title="Dobby"></a>Dobby</h4><p>64位模式下推荐使用Dobby进行inline hook。</p>
<h5 id="获取Dobby实例"><a href="#获取Dobby实例" class="headerlink" title="获取Dobby实例"></a>获取Dobby实例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Dobby</span> <span class="variable">dobby</span> <span class="operator">=</span> Dobby.getInstance(emulator);</span><br></pre></td></tr></table></figure>

<h5 id="Dobby-API"><a href="#Dobby-API" class="headerlink" title="Dobby API"></a>Dobby API</h5><h6 id="replace-1"><a href="#replace-1" class="headerlink" title="replace"></a>replace</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Dobby</span> <span class="variable">dobby</span> <span class="operator">=</span> Dobby.getInstance(emulator);</span><br><span class="line"><span class="type">long</span> <span class="variable">functionAddress</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0xC09D</span><span class="comment">/*偏移*/</span>;</span><br><span class="line">dobby.replace(functionAddress, <span class="keyword">new</span> <span class="title class_">ReplaceCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> HookStatus <span class="title function_">onCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context, <span class="type">long</span> originFunction)</span> &#123;</span><br><span class="line">        <span class="type">Pointer</span> <span class="variable">result</span> <span class="operator">=</span> context.getPointerArg(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;input:&quot;</span> + result.getString(<span class="number">0</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.onCall(emulator, context, originFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postCall</span><span class="params">(Emulator&lt;?&gt; emulator, HookContext context)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.postCall(emulator, context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,<span class="literal">true</span>);</span><br></pre></td></tr></table></figure>
<p>Dobby.replace的用法同HookZz，详细使用请查看<a href="#replace">HookZz-replace</a></p>
<h6 id="instrument-1"><a href="#instrument-1" class="headerlink" title="instrument"></a>instrument</h6><p>同HookZz中的<a href="#instrument-1">instrument</a>。</p>
<h4 id="xHook"><a href="#xHook" class="headerlink" title="xHook"></a>xHook</h4><p>xHook框架实现原理本身就存在局限性，只能够hook符号表函数。有好有坏，它的优点就是稳定。</p>
<h5 id="获取xHook实例"><a href="#获取xHook实例" class="headerlink" title="获取xHook实例"></a>获取xHook实例</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">IxHook</span> <span class="variable">hook</span> <span class="operator">=</span> XHookImpl.getInstance(emulator);</span><br></pre></td></tr></table></figure>

<h5 id="xHook-API"><a href="#xHook-API" class="headerlink" title="xHook API"></a>xHook API</h5><h6 id="register"><a href="#register" class="headerlink" title="register"></a>register</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">IxHook</span> <span class="variable">hook</span> <span class="operator">=</span> XHookImpl.getInstance(emulator);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>xHook的register方法的第一个参数为pathname_regex_str, 其支持POSIX BRE (Basic Regular Expression) 定义的正则表达式语法。用来检索符合条件的So。第二个参数为符号名。详情请看<a class="link"   href="https://github.com/iqiyi/xHook/blob/master/README.zh-CN.md" >xhook介绍<i class="fas fa-external-link-alt"></i></a></p>
<h6 id="refresh"><a href="#refresh" class="headerlink" title="refresh"></a>refresh</h6><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">hook.refresh(); </span><br></pre></td></tr></table></figure>
<p>在使用xHook进行hook时，务必调用此方法进行刷新才能生效。</p>
<h4 id="Whale"><a href="#Whale" class="headerlink" title="Whale"></a>Whale</h4><p>Whale Hook框架为跨平台的Hook框架，在Android中的实现为inline hook。</p>
<h5 id="获取Whale实例"><a href="#获取Whale实例" class="headerlink" title="获取Whale实例"></a>获取Whale实例</h5><p>IWhale whale &#x3D; Whale.getInstance(emulator); </p>
<h5 id="Whale-API"><a href="#Whale-API" class="headerlink" title="Whale API"></a>Whale API</h5><p>TODO</p>
<h4 id="原生hook"><a href="#原生hook" class="headerlink" title="原生hook"></a>原生hook</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;memcmp&quot;</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;callMemcmp作比较&quot;</span>);</span><br><span class="line">        <span class="type">RegisterContext</span> <span class="variable">registerContext</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg1</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">0</span>);</span><br><span class="line">        <span class="type">UnidbgPointer</span> <span class="variable">arg2</span> <span class="operator">=</span> registerContext.getPointerArg(<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> registerContext.getIntArg(<span class="number">2</span>);</span><br><span class="line">        Inspector.inspect(arg1.getByteArray(<span class="number">0</span>, length), <span class="string">&quot;arg1&quot;</span>);</span><br><span class="line">        Inspector.inspect(arg2.getByteArray(<span class="number">0</span>, length), <span class="string">&quot;arg2&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (arg1.getString(<span class="number">0</span>).equals(<span class="string">&quot;Context&quot;</span>))&#123;</span><br><span class="line">            emulator.attach().debug();</span><br><span class="line">            <span class="comment">// mr1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="patch"><a href="#patch" class="headerlink" title="patch"></a>patch</h3><p>第一种，使用arm转机器码<br />转换网址 <a class="link"   href="https://armconverter.com/" >https://armconverter.com/<i class="fas fa-external-link-alt"></i></a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patch</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator,<span class="keyword">module</span>.base + <span class="number">0x3E8</span>);</span><br><span class="line">    <span class="type">byte</span>[] code = <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;(<span class="type">byte</span>) <span class="number">0xd0</span>, <span class="number">0x1a</span>&#125;;</span><br><span class="line">    pointer.write(code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二种，使用keystone</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patch2</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">UnidbgPointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator,<span class="keyword">module</span>.base + <span class="number">0x3E8</span>);</span><br><span class="line">    <span class="type">Keystone</span> <span class="variable">keystone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Keystone</span>(KeystoneArchitecture.Arm, KeystoneMode.ArmThumb);</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;subs r0, r2, r3&quot;</span>;</span><br><span class="line">    <span class="type">byte</span>[] machineCode = keystone.assemble(s).getMachineCode();</span><br><span class="line">    <span class="comment">//byte[] code = ;</span></span><br><span class="line">    pointer.write(machineCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JNI"><a href="#JNI" class="headerlink" title="JNI"></a>JNI</h2><h3 id="JNI介绍"><a href="#JNI介绍" class="headerlink" title="JNI介绍"></a>JNI介绍</h3><p>当一个So在模拟执行的过程中，它要与Java层进行交互，比如获取Java层某个字段的值、调用Java层的某个方法获取返回值等等，如果你不告诉unidbg如何做，那程序就无法执行下去。你告诉undibg碰到访问Java层的某些东西的时候该怎么做的这个过程，从而让程序正确的执行下去，就叫做补环境。<br />我们在JNI部分来介绍unidbg如何来补环境，首先我们要来看unidbg中的几个概念</p>
<h3 id="类-x2F-类型"><a href="#类-x2F-类型" class="headerlink" title="类&#x2F;类型"></a>类&#x2F;类型</h3><p>Java中可以抽象出一个类，一个类可以创建对象，可以调用该类上的静态方法。一个类的基本属性有很多，unidbg模拟了父类和接口。在unidbg中对应的为DvmClass。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//参数一: 类名</span></span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">Test</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line"><span class="comment">//重载方法，可以指定父类型。也就是表示了TestUnidbg继承了Test类。</span></span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">dvmClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/TestUnidbg&quot;</span>, Test);</span><br></pre></td></tr></table></figure>
<p>VM的resolveClass方法会创建出一个类型，可以理解为Java中的一个类，参数为全限定类名，将.换为&#x2F;。这样就创建出来一种类型了。我们可以基于此类型创建对象。</p>
<h3 id="对象-x2F-实例"><a href="#对象-x2F-实例" class="headerlink" title="对象&#x2F;实例"></a>对象&#x2F;实例</h3><p>Java层肯定会有对象的，或者叫做实例，unidbg中对应的叫做DvmObject。unidbg中所有的Java层的对象都直接或间接的继承自DvmObject。模拟创建对象:</p>
<ul>
<li><p>第一种方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">dvmClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line"><span class="comment">//参数一: 值</span></span><br><span class="line">DvmObject&lt;?&gt; obj = dvmClass.newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>在Java中，有了类，就可以new对象了对吧。unidbg的newObject操作就类似这样。它可以有了一种类型后进行创建对象，其中的参数你可以存储任意类型的数据，此数据就会与该DvmObject绑定。</p>
</li>
<li><p>第二种方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//根据数据来创建DvmObject</span></span><br><span class="line"><span class="comment">//参数一: VM实例</span></span><br><span class="line"><span class="comment">//参数二: value</span></span><br><span class="line">DvmObject&lt;?&gt; obj = ProxyDvmObject.createObject(vm, <span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>unidbg会根据此value值的类型来创建DvmObject。如果value为基本数据类型则会被封装为该基本类型的包装类型。如果value为一个对象，则会获取该对象所对应的Class，根据Class名称来自动创建该类型，然后创建一个对象，相当于对第一种方法的一个封装。如果为数组类型，则会被封装为由unidbg创建的包装对象。</p>
</li>
</ul>
<h3 id="包装对象"><a href="#包装对象" class="headerlink" title="包装对象"></a>包装对象</h3><p>理论上所有的Java层的对象在unidbg中都可以按照上面所述的方法进行创建。但unidbg内部有部分封装，所以在使用的时候我们要使用unidbg的包装对象</p>
<h4 id="String"><a href="#String" class="headerlink" title="String"></a>String</h4><p>String类型被封装为StringObject</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">StringObject</span>(vm,<span class="string">&quot;unidbg&quot;</span>); </span><br></pre></td></tr></table></figure>

<h4 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h4><p>数组类型在使用的时候按如下使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//byte[]</span></span><br><span class="line"><span class="type">ByteArray</span> <span class="variable">byteArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArray</span>(vm, <span class="keyword">new</span> <span class="title class_">byte</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//int[]</span></span><br><span class="line"><span class="type">IntArray</span> <span class="variable">intArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IntArray</span>(vm, <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//short[]</span></span><br><span class="line"><span class="type">ShortArray</span> <span class="variable">shortArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShortArray</span>(vm, <span class="keyword">new</span> <span class="title class_">short</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//float[]</span></span><br><span class="line"><span class="type">FloatArray</span> <span class="variable">floatArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FloatArray</span>(vm, <span class="keyword">new</span> <span class="title class_">float</span>[]&#123;<span class="number">1.0f</span>, <span class="number">2.0f</span>, <span class="number">3.0f</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//double[]</span></span><br><span class="line"><span class="type">DoubleArray</span> <span class="variable">doubleArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DoubleArray</span>(vm, <span class="keyword">new</span> <span class="title class_">double</span>[]&#123;<span class="number">1.0d</span>, <span class="number">2.0d</span>, <span class="number">3.0d</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Object[]</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayObject</span>(byteArray, intArray);</span><br></pre></td></tr></table></figure>

<h4 id="List"><a href="#List" class="headerlink" title="List"></a>List</h4><p>List类型的数据被封装为ArrayListObject</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">Test</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">List&lt;DvmObject&lt;?&gt;&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">list.add(Test.newObject(<span class="literal">null</span>));</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">ArrayListObject</span>(vm,list);</span><br></pre></td></tr></table></figure>

<!-- ### 补环境
TODO -->

<h2 id="Module"><a href="#Module" class="headerlink" title="Module"></a>Module</h2><h3 id="Module介绍"><a href="#Module介绍" class="headerlink" title="Module介绍"></a>Module介绍</h3><p>在undibg中，经过Memory加载到内存中的Elf文件，都被抽象为一个Module(LinuxModule)对象。无论是Emulator还是VM加载的，底层都是对Memory的load进行了封装，返回值就是一个Module实例。</p>
<h3 id="Module常用的属性"><a href="#Module常用的属性" class="headerlink" title="Module常用的属性"></a>Module常用的属性</h3><h4 id="base"><a href="#base" class="headerlink" title="base"></a>base</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;加载的基址: &quot;</span>+<span class="keyword">module</span>.base);</span><br></pre></td></tr></table></figure>
<p>base属性维护了该Elf文件被加载到内存中的基址。</p>
<h4 id="name"><a href="#name" class="headerlink" title="name"></a>name</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;模块的名称: &quot;</span>+<span class="keyword">module</span>.name);</span><br></pre></td></tr></table></figure>
<p>name属性维护了该模块的名称，通常为文件名。</p>
<h4 id="callEntry"><a href="#callEntry" class="headerlink" title="callEntry"></a>callEntry</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> <span class="keyword">module</span>.callEntry(emulator);</span><br></pre></td></tr></table></figure>
<p>当被加载的文件是可执行文件时，需要通过该方法来调用main函数。</p>
<h4 id="findSymbolByName"><a href="#findSymbolByName" class="headerlink" title="findSymbolByName"></a>findSymbolByName</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Module</span> <span class="variable">module</span> <span class="operator">=</span> emulator.loadLibrary(file, <span class="literal">true</span>);</span><br><span class="line"><span class="type">Symbol</span> <span class="variable">symbol</span> <span class="operator">=</span> <span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;symbolName&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>通过名字查找当前模块中的符号。</p>
<h2 id="Backend"><a href="#Backend" class="headerlink" title="Backend"></a>Backend</h2><h3 id="Backend介绍"><a href="#Backend介绍" class="headerlink" title="Backend介绍"></a>Backend介绍</h3><p>unidbg内置了五种Backend。Backend的作用是用来模拟执行机器指令。它作为一个模块被unidbg引入，提供了模拟CPU的能力，且被封装为统一的Backend接口。</p>
<h3 id="Backend列表"><a href="#Backend列表" class="headerlink" title="Backend列表"></a>Backend列表</h3><p>unidbg默认使用Unicorn后端。即在创建AndroidEmulator时无额外添加BackendFactory即为Unicorn后端。</p>
<h4 id="Unicorn-x2F-Unicorn2"><a href="#Unicorn-x2F-Unicorn2" class="headerlink" title="Unicorn&#x2F;Unicorn2"></a>Unicorn&#x2F;Unicorn2</h4><p><a class="link"   href="https://www.unicorn-engine.org/" >Unicorn官网<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="使用Unicorn2后端"><a href="#使用Unicorn2后端" class="headerlink" title="使用Unicorn2后端:"></a>使用Unicorn2后端:</h5><p>emulator &#x3D; AndroidEmulatorBuilder           .for32Bit()           .addBackendFactory(new Unicorn2Factory(true))           .build();<br />Unicorn2Factory构造方法的参数表示在Unicorn2创建失败时，是否退回使用Unicorn后端。如设置false，在Unicorn2后端创建失败后就退出，而不选择使用Unicorn后端。</p>
<h5 id="Unicorn后端特点"><a href="#Unicorn后端特点" class="headerlink" title="Unicorn后端特点"></a>Unicorn后端特点</h5><ul>
<li>执行较其他后端慢</li>
<li>支持原生Hook</li>
<li>支持Debugger功能</li>
<li>支持原生Trace</li>
</ul>
<p>对调试、Trace功能支持较好，缺点是执行较慢。推荐在实验环境中使用。</p>
<h4 id="Dynarmic"><a href="#Dynarmic" class="headerlink" title="Dynarmic"></a>Dynarmic</h4><p><a class="link"   href="https://github.com/MerryMage/dynarmic" >Dynarmic官网<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="使用Dynarmic后端"><a href="#使用Dynarmic后端" class="headerlink" title="使用Dynarmic后端"></a>使用Dynarmic后端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for32Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">DynarmicFactory</span>(<span class="literal">true</span>))</span><br><span class="line">          .build();</span><br></pre></td></tr></table></figure>

<h5 id="Dynarmic后端特点"><a href="#Dynarmic后端特点" class="headerlink" title="Dynarmic后端特点"></a>Dynarmic后端特点</h5><ul>
<li>执行速度快</li>
<li>无原生Hook功能</li>
</ul>
<p>生产环境推荐使用，速度比Unicorn快很多。</p>
<h4 id="Hypervisor"><a href="#Hypervisor" class="headerlink" title="Hypervisor"></a>Hypervisor</h4><p><a class="link"   href="https://github.com/Bareflank/hypervisor" >Hypervisor官网<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="使用Hypervisor后端"><a href="#使用Hypervisor后端" class="headerlink" title="使用Hypervisor后端"></a>使用Hypervisor后端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for32Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">HypervisorFactory</span>(<span class="literal">true</span>))</span><br><span class="line">          .build()</span><br></pre></td></tr></table></figure>

<h5 id="Hypervisor后端特点"><a href="#Hypervisor后端特点" class="headerlink" title="Hypervisor后端特点"></a>Hypervisor后端特点</h5><ul>
<li>支持Apple M1</li>
<li>最快的ARM64后端</li>
</ul>
<h4 id="Kvm"><a href="#Kvm" class="headerlink" title="Kvm"></a>Kvm</h4><p><a class="link"   href="https://github.com/kholia/OSX-KVM" >Kvm官网<i class="fas fa-external-link-alt"></i></a></p>
<h5 id="使用Kvm后端"><a href="#使用Kvm后端" class="headerlink" title="使用Kvm后端"></a>使用Kvm后端</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder</span><br><span class="line">          .for64Bit()</span><br><span class="line">          .addBackendFactory(<span class="keyword">new</span> <span class="title class_">KvmFactory</span>(<span class="literal">false</span>))</span><br><span class="line">          .build();</span><br></pre></td></tr></table></figure>

<h5 id="Kvm后端特点"><a href="#Kvm后端特点" class="headerlink" title="Kvm后端特点"></a>Kvm后端特点</h5><ul>
<li>支持Raspberry Pi B4</li>
</ul>
<h3 id="Backend接口"><a href="#Backend接口" class="headerlink" title="Backend接口"></a>Backend接口</h3><p>Backend为CPU的抽象接口，通过它可以直接读写CPU的寄存器的值、内存读写。unidbg对此类接口都有对应的封装，不建议直接使用此类接口。</p>
<h2 id="Deggbuer"><a href="#Deggbuer" class="headerlink" title="Deggbuer"></a>Deggbuer</h2><h3 id="Debugger介绍"><a href="#Debugger介绍" class="headerlink" title="Debugger介绍"></a>Debugger介绍</h3><p><strong>重要提醒: 只有unicorn后端支持调试功能！！！</strong> <strong>重要提醒: 只有unicorn后端支持调试功能！！！</strong> <strong>重要提醒: 只有unicorn后端支持调试功能！！！</strong><br />调试是在逆向工程中不可缺少的一个功能，可以帮助我们快速定位问题。在unidbg也是支持的，而且这部分功能基于原生Unicorn后端，支持非常好。<br />主要功能:</p>
<ul>
<li>断点调试</li>
<li>内存读写</li>
<li>寄存器读写</li>
<li>单步调试</li>
<li>堆栈搜索</li>
<li>调用栈打印</li>
<li>反汇编</li>
<li>patch</li>
</ul>
<h3 id="ConsoleDebugger"><a href="#ConsoleDebugger" class="headerlink" title="ConsoleDebugger"></a>ConsoleDebugger</h3><h4 id="使用步骤"><a href="#使用步骤" class="headerlink" title="使用步骤"></a>使用步骤</h4><h5 id="第零步"><a href="#第零步" class="headerlink" title="第零步"></a>第零步</h5><p>再提示一下，先将后端切换回Unicorn。如何切换请查看: <a href="#Backend">Backend</a></p>
<h5 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h5><p>得到控制台调试器实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Debugger</span> <span class="variable">debugger</span> <span class="operator">=</span> emulator.attach();</span><br></pre></td></tr></table></figure>

<h5 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h5><p>下断点。下断点有多种重载方便使用:</p>
<ul>
<li>模块 + 偏移</li>
<li>模块 + 符号名</li>
<li>绝对地址<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//模块 + 偏移</span></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="number">0x8607</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//模块 + 符号</span></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="string">&quot;Java_com_github_unidbg_Test_sign&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 绝对地址</span></span><br><span class="line"><span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0x8607</span>;</span><br><span class="line">debugger.addBreakPoint(address);</span><br></pre></td></tr></table></figure>
<strong><font color="red">下断点无需手动thumb指令+1操作，手动+1下断点也是一样的效果。但手动+1会有其他的作用，如查看断点等功能，推荐手动+1。</font></strong><br />还有其他三种断点重载，添加一个断点回调:<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">BreakPointCallback</span> <span class="variable">breakPointCallback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">      <span class="comment">//当断点命中会回调此方法</span></span><br><span class="line">      <span class="comment">//do something...</span></span><br><span class="line">      <span class="comment">//返回值决定是否进入手动调试。</span></span><br><span class="line">      <span class="comment">//返回true，则只回调此方法，不进入调试</span></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="number">0x8607</span>, breakPointCallback);</span><br><span class="line"></span><br><span class="line">debugger.addBreakPoint(<span class="keyword">module</span>, <span class="string">&quot;Java_com_github_unidbg_Test_sign&quot;</span>, breakPointCallback);</span><br><span class="line"></span><br><span class="line"><span class="type">long</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">module</span>.base + <span class="number">0x8607</span>;</span><br><span class="line">debugger.addBreakPoint(address, breakPointCallback);</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h5><p>执行。无论使用哪种方式对目标地址下断点，在执行起来后如果执行到断点位置，就会在控制台断下等待命令的输入。以我目前例子，命中断点后输出如下所示:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">debugger <span class="keyword">break</span> at: <span class="number">0x40008606</span> @ Function32 address=<span class="number">0x40008607</span>, arguments=[unidbg@<span class="number">0xfffe12a0</span>[libadd.so]<span class="number">0x2a0</span>, <span class="number">17037394</span>, <span class="number">1</span>]</span><br><span class="line">&gt;&gt;&gt; r0=<span class="number">0xfffe12a0</span>(-<span class="number">126304</span>) r1=<span class="number">0x103f852</span> r2=<span class="number">0x1</span> r3=<span class="number">0x2</span> r4=<span class="number">0x0</span> r5=<span class="number">0x0</span> r6=<span class="number">0x0</span> r7=<span class="number">0x0</span> r8=<span class="number">0x0</span> sb=<span class="number">0x0</span> sl=<span class="number">0x0</span> fp=<span class="number">0x0</span> ip=<span class="number">0x401315e0</span></span><br><span class="line">&gt;&gt;&gt; SP=<span class="number">0xbffff730</span> LR=unidbg@<span class="number">0xffff0000</span> PC=RX@<span class="number">0x40008606</span>[libnative-doc.so]<span class="number">0x8606</span> cpsr: N=<span class="number">0</span>, Z=<span class="number">1</span>, C=<span class="number">0</span>, V=<span class="number">0</span>, T=<span class="number">1</span>, mode=<span class="number">0b10000</span></span><br><span class="line">&gt;&gt;&gt; d0=<span class="number">0x0</span>(<span class="number">0.0</span>) d1=<span class="number">0x3220302034203720</span>(<span class="number">3.002229861217884E-67</span>) d2=<span class="number">0x3436333832203236</span>(<span class="number">3.5366761868402984E-57</span>) d3=<span class="number">0x3120323938343135</span>(<span class="number">4.583358096989596E-72</span>) d4=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d5=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d6=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>) d7=<span class="number">0x2030203020302030</span>(<span class="number">1.2027122125173386E-153</span>)</span><br><span class="line">&gt;&gt;&gt; d8=<span class="number">0x0</span>(<span class="number">0.0</span>) d9=<span class="number">0x0</span>(<span class="number">0.0</span>) d10=<span class="number">0x0</span>(<span class="number">0.0</span>) d11=<span class="number">0x0</span>(<span class="number">0.0</span>) d12=<span class="number">0x0</span>(<span class="number">0.0</span>) d13=<span class="number">0x0</span>(<span class="number">0.0</span>) d14=<span class="number">0x0</span>(<span class="number">0.0</span>) d15=<span class="number">0x0</span>(<span class="number">0.0</span>)</span><br><span class="line">Java_com_github_unidbg_Test_sign + <span class="number">0x0</span></span><br><span class="line">=&gt; *[libnative-doc.so*<span class="number">0x08607</span>]*[80b5    ]*<span class="number">0x40008606</span>:*<span class="string">&quot;push &#123;r7, lr&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08609</span>] [6f46    ] <span class="number">0x40008608</span>: <span class="string">&quot;mov r7, sp&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860b</span>] [84b0    ] <span class="number">0x4000860a</span>: <span class="string">&quot;sub sp, #0x10&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860d</span>] [0390    ] <span class="number">0x4000860c</span>: <span class="string">&quot;str r0, [sp, #0xc]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0860f</span>] [0291    ] <span class="number">0x4000860e</span>: <span class="string">&quot;str r1, [sp, #8]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08611</span>] [0192    ] <span class="number">0x40008610</span>: <span class="string">&quot;str r2, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08613</span>] [0198    ] <span class="number">0x40008612</span>: <span class="string">&quot;ldr r0, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08615</span>] [4ff48061] <span class="number">0x40008614</span>: <span class="string">&quot;mov.w r1, #0x400&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08619</span>] [fff75aec] <span class="number">0x40008618</span>: <span class="string">&quot;blx #0x40007ed0&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0861d</span>] [04b0    ] <span class="number">0x4000861c</span>: <span class="string">&quot;add sp, #0x10&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x0861f</span>] [80bd    ] <span class="number">0x4000861e</span>: <span class="string">&quot;pop &#123;r7, pc&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08621</span>] [80b5    ] <span class="number">0x40008620</span>: <span class="string">&quot;push &#123;r7, lr&#125;&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08623</span>] [6f46    ] <span class="number">0x40008622</span>: <span class="string">&quot;mov r7, sp&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08625</span>] [82b0    ] <span class="number">0x40008624</span>: <span class="string">&quot;sub sp, #8&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08627</span>] [0190    ] <span class="number">0x40008626</span>: <span class="string">&quot;str r0, [sp, #4]&quot;</span></span><br><span class="line">    [libnative-doc.so <span class="number">0x08629</span>] [0198    ] <span class="number">0x40008628</span>: <span class="string">&quot;ldr r0, [sp, #4]&quot;</span></span><br></pre></td></tr></table></figure>
<p>主要信息有: 断点和当前函数参数信息，当前所有寄存器信息，当前位置的反汇编信息。 看到如上调试信息后，unidbg就会等待命令的输入，命令才是ConsoleDebugger的核心。下面我们就来看如何使用命令来操作ConsoleDebugger。</p>
<h4 id="调试指令"><a href="#调试指令" class="headerlink" title="调试指令"></a>调试指令</h4><h5 id="help"><a href="#help" class="headerlink" title="help"></a>help</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">help </span><br></pre></td></tr></table></figure>
<p>会看到下面的输出，此为ConsoleDebugger的帮助文档。我们下面也是介绍此帮助文档的内容。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">help</span><br><span class="line">c: <span class="keyword">continue</span></span><br><span class="line">n: step over</span><br><span class="line">bt: back trace</span><br><span class="line"></span><br><span class="line">st hex: search stack</span><br><span class="line">shw hex: search writable heap</span><br><span class="line">shr hex: search readable heap</span><br><span class="line">shx hex: search executable heap</span><br><span class="line"></span><br><span class="line">nb: <span class="keyword">break</span> at next block</span><br><span class="line">s|si: step into</span><br><span class="line">s[decimal]: execute specified amount instruction</span><br><span class="line"><span class="title function_">s</span><span class="params">(blx)</span>: execute util BLX mnemonic, low performance</span><br><span class="line"></span><br><span class="line"><span class="title function_">m</span><span class="params">(op)</span> [size]: show memory, <span class="keyword">default</span> size is <span class="number">0x70</span>, size may hex or decimal</span><br><span class="line">mr0-mr7, mfp, mip, msp [size]: show memory of specified register</span><br><span class="line"><span class="title function_">m</span><span class="params">(address)</span> [size]: show memory of specified address, address must start with 0x</span><br><span class="line"></span><br><span class="line">wr0-wr7, wfp, wip, wsp &lt;value&gt;: write specified register</span><br><span class="line"><span class="title function_">wb</span><span class="params">(address)</span>, ws(address), wi(address) &lt;value&gt;: write (<span class="type">byte</span>, <span class="type">short</span>, integer) memory of specified address, address must start with 0x</span><br><span class="line"><span class="title function_">wx</span><span class="params">(address)</span> &lt;hex&gt;: write bytes to memory at specified address, address must start with 0x</span><br><span class="line"></span><br><span class="line"><span class="title function_">b</span><span class="params">(address)</span>: add temporarily breakpoint, address must start with 0x, can be <span class="keyword">module</span> offset</span><br><span class="line">b: add breakpoint of register PC</span><br><span class="line">r: remove breakpoint of register PC</span><br><span class="line">blr: add temporarily breakpoint of register LR</span><br><span class="line"></span><br><span class="line"><span class="title function_">p</span> <span class="params">(assembly)</span>: patch assembly at PC address</span><br><span class="line">where: show java stack trace</span><br><span class="line"></span><br><span class="line">trace [begin end]: Set trace instructions</span><br><span class="line">traceRead [begin end]: Set trace memory read</span><br><span class="line">traceWrite [begin end]: Set trace memory write</span><br><span class="line">vm: view loaded modules</span><br><span class="line">vbs: view breakpoints</span><br><span class="line">d|dis: show disassemble</span><br><span class="line"><span class="title function_">d</span><span class="params">(0x)</span>: show disassemble at specify address</span><br><span class="line">stop: stop emulation</span><br><span class="line">run [arg]: run test</span><br><span class="line">gc: Run System.gc()</span><br><span class="line">cc size: convert asm from <span class="number">0x40008608</span> - <span class="number">0x40008608</span> + size bytes to c function</span><br></pre></td></tr></table></figure>

<h5 id="show-disassemble"><a href="#show-disassemble" class="headerlink" title="show disassemble"></a>show disassemble</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">d | dis</span><br></pre></td></tr></table></figure>
<p>打印当前位置反编译信息。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">d(address)</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">d0x40008607</span><br></pre></td></tr></table></figure>
<p>打印指定地址处的反编译信息。</p>
<h5 id="continue"><a href="#continue" class="headerlink" title="continue"></a>continue</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">c</span><br></pre></td></tr></table></figure>
<p>继续执行。直至遇到下一个断点断下或运行结束。</p>
<h5 id="step-over"><a href="#step-over" class="headerlink" title="step over"></a>step over</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">n</span><br></pre></td></tr></table></figure>
<p>单步步过，不进入跳转指令。</p>
<h5 id="step-into"><a href="#step-into" class="headerlink" title="step into"></a>step into</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">s | si </span><br></pre></td></tr></table></figure>
<p>单步执行。执行一句指令。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">s10 </span><br></pre></td></tr></table></figure>
<p>执行10句指令。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">sblx </span><br></pre></td></tr></table></figure>
<p>执行到blx指令。性能较低。</p>
<h5 id="next-block"><a href="#next-block" class="headerlink" title="next block"></a>next block</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">nb </span><br></pre></td></tr></table></figure>
<p>执行到下一<a href="#Block">block</a>处。</p>
<h5 id="b"><a href="#b" class="headerlink" title="b"></a>b</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">b </span><br></pre></td></tr></table></figure>
<p>可在当前PC处下断点。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">b0x40008607 </span><br></pre></td></tr></table></figure>
<p>指定地址下断点。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">b0x8607 </span><br></pre></td></tr></table></figure>
<p>指定偏移下断点，会根据当前位置的模块来计算。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">blr </span><br></pre></td></tr></table></figure>
<p>在LR处下断点。</p>
<h5 id="r"><a href="#r" class="headerlink" title="r"></a>r</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">r </span><br></pre></td></tr></table></figure>
<p>删除当前位置的断点。</p>
<h5 id="blr"><a href="#blr" class="headerlink" title="blr"></a>blr</h5><p>在函数返回时候下断点</p>
<h5 id="vbs"><a href="#vbs" class="headerlink" title="vbs"></a>vbs</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">vbs </span><br></pre></td></tr></table></figure>
<p>查看当前下的所有断点。</p>
<h5 id="back-trace"><a href="#back-trace" class="headerlink" title="back trace"></a>back trace</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">bt </span><br></pre></td></tr></table></figure>
<p>打印当前位置调用栈。</p>
<h5 id="show-memory"><a href="#show-memory" class="headerlink" title="show memory"></a>show memory</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">mr0-mr7 | mfp | mip | msp [size]</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">mr1 <span class="number">0x10</span></span><br></pre></td></tr></table></figure>
<p>读取对应寄存器所指向的地址的内存。size指定大小，默认0x70大小。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">m(address) [size]</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">m0xbffff730 <span class="number">10</span></span><br></pre></td></tr></table></figure>
<p>读取指定地址的内存。地址必须为0x开头的十六进制数。</p>
<h5 id="write-memory"><a href="#write-memory" class="headerlink" title="write memory"></a>write memory</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">wr0-wr7, wfp, wip, wsp &lt;value&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">wr2 <span class="number">0x100</span></span><br></pre></td></tr></table></figure>
<p>向对应寄存器写入value指定的值。此值可为0x开头十六进制数，可为十进制数。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">wb(address), ws(address), wi(address) &lt;value&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">wb0x40008606 <span class="number">1</span></span><br><span class="line">ws0x40008606 <span class="number">0xb502</span></span><br></pre></td></tr></table></figure>
<p>向指定地址写入value指定的值。写入的宽度由不同指令所指定，wb能写入一个字节数据、ws能short数据、wi能写入int数据，且大小端序会被自动转换。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">wx(address) &lt;hex&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">wx0x40008606 b502</span><br></pre></td></tr></table></figure>
<p>向指定地址写入hex数据，此处hex不能加0x开头，直接写十六进制就可以了。</p>
<h5 id="search-stack"><a href="#search-stack" class="headerlink" title="search stack"></a>search stack</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">st &lt;hex&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">st <span class="number">313233</span></span><br></pre></td></tr></table></figure>
<p>在当前栈上搜索指定的hex数据。</p>
<h5 id="search-writable-heap"><a href="#search-writable-heap" class="headerlink" title="search writable heap"></a>search writable heap</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">shr &lt;hex&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">shr <span class="number">313233</span></span><br></pre></td></tr></table></figure>
<p>在可写的内存搜索指定的hex数据。</p>
<h5 id="search-readable-heap"><a href="#search-readable-heap" class="headerlink" title="search readable heap"></a>search readable heap</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">shx &lt;hex&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">shx 6f46</span><br></pre></td></tr></table></figure>
<p>在可读的内存搜索指定的hex数据。</p>
<h5 id="search-executable-heap"><a href="#search-executable-heap" class="headerlink" title="search executable heap"></a>search executable heap</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">shx &lt;hex&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">shx 6f46</span><br></pre></td></tr></table></figure>
<p>在可执行的内存搜索指定的hex数据。</p>
<h5 id="where"><a href="#where" class="headerlink" title="where"></a>where</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">where </span><br></pre></td></tr></table></figure>
<p>打印当前unidbg的调用栈。</p>
<h5 id="vm"><a href="#vm" class="headerlink" title="vm"></a>vm</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">vm </span><br></pre></td></tr></table></figure>
<p>查看当前所有加载的模块。</p>
<h5 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">stop </span><br></pre></td></tr></table></figure>
<p>停止运行。</p>
<h5 id="patch-1"><a href="#patch-1" class="headerlink" title="patch"></a>patch</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">p &lt;assembly&gt;</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">p movs r0, #<span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>将当前位置进行patch，无需关心thumb。</p>
<h5 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h5><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">trace [begin end]</span><br><span class="line"><span class="comment">//如</span></span><br><span class="line">trace <span class="number">0x40008606</span> <span class="number">0x40008612</span></span><br><span class="line"></span><br><span class="line">traceRead [begin end]</span><br><span class="line">traceWrite [begin end]</span><br></pre></td></tr></table></figure>
<p>指定起始结束位置进行trace。</p>
<h3 id="GDB-SERVER"><a href="#GDB-SERVER" class="headerlink" title="GDB_SERVER"></a>GDB_SERVER</h3><p>不推荐使用。请使用<a href="#ConsoleDebugger">ConsoleDebugger</a>。</p>
<h3 id="ANDROID-SERVER-V7"><a href="#ANDROID-SERVER-V7" class="headerlink" title="ANDROID_SERVER_V7"></a>ANDROID_SERVER_V7</h3><p>不推荐使用。请使用<a href="#ConsoleDebugger">ConsoleDebugger</a>。</p>
<h3 id="Block"><a href="#Block" class="headerlink" title="Block"></a>Block</h3><p>什么叫做block？简单来说就是未发生跳转的一整段汇编为一个block，如发生B系列指令跳转，就会进入下一block。<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/01.webp"
                     
                ></p>
<h2 id="RegisterContext"><a href="#RegisterContext" class="headerlink" title="RegisterContext"></a>RegisterContext</h2><p>TODO</p>
<h2 id="SyscallHandler-1"><a href="#SyscallHandler-1" class="headerlink" title="SyscallHandler"></a>SyscallHandler</h2><h3 id="SyscallHandler介绍"><a href="#SyscallHandler介绍" class="headerlink" title="SyscallHandler介绍"></a>SyscallHandler介绍</h3><p>SyscallHandler模块为处理系统调用处理器的核心模块，模拟了在执行过程中所产生的大大小小的系统调用。虽然该模块为核心模块，但提供的API并不多，我们来看。</p>
<h3 id="API"><a href="#API" class="headerlink" title="API"></a>API</h3><h4 id="获取SyscallHandler实例"><a href="#获取SyscallHandler实例" class="headerlink" title="获取SyscallHandler实例"></a>获取SyscallHandler实例</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">SyscallHandler&lt;AndroidFileIO&gt; syscallHandler = emulator.getSyscallHandler(); </span><br></pre></td></tr></table></figure>

<h4 id="setVerbose"><a href="#setVerbose" class="headerlink" title="setVerbose"></a>setVerbose</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">syscallHandler.setVerbose(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure>
<p>部分系统调用日志开关。</p>
<h4 id="addIOResolver"><a href="#addIOResolver" class="headerlink" title="addIOResolver"></a>addIOResolver</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">syscallHandler.addIOResolver(<span class="keyword">new</span> <span class="title class_">IOResolver</span>&lt;AndroidFileIO&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> FileResult&lt;AndroidFileIO&gt; <span class="title function_">resolve</span><span class="params">(Emulator&lt;AndroidFileIO&gt; emulator, String pathname, <span class="type">int</span> oflags)</span> &#123;</span><br><span class="line">        <span class="comment">//参数二: 文件路径</span></span><br><span class="line">        <span class="comment">//参数三: 操作文件标志</span></span><br><span class="line">        <span class="comment">//返回值: FileResult </span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>添加IO处理器。如果在模拟执行期间，有读写文件操作，可由自定义指定的IO处理器进行处理，且自定义IO处理器的优先级最高。关于返回值请查看<a href="#FileResult">FileResult</a>。</p>
<h4 id="setEnableThreadDispatcher"><a href="#setEnableThreadDispatcher" class="headerlink" title="setEnableThreadDispatcher"></a>setEnableThreadDispatcher</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">syscallHandler.setEnableThreadDispatcher(<span class="literal">true</span>); </span><br></pre></td></tr></table></figure>
<p>多线程自动调度开关。开启此开关，会以多线程模式运行，当有线程创建会自动进行处理调度。</p>
<h4 id="setFileListener"><a href="#setFileListener" class="headerlink" title="setFileListener"></a>setFileListener</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">syscallHandler.setFileListener(<span class="keyword">new</span> <span class="title class_">FileListener</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onOpenSuccess</span><span class="params">(Emulator&lt;?&gt; emulator, String pathname, FileIO io)</span> &#123;</span><br><span class="line">        System.out.println(pathname+<span class="string">&quot;文件打开成功！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClose</span><span class="params">(Emulator&lt;?&gt; emulator, FileIO io)</span> &#123;</span><br><span class="line">        System.err.println(io.getPath()+<span class="string">&quot;文件打开失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>设置文件监听器。此API在在运行期间，可以监听所有成功打开和关闭的文件，打开失败的文件不会进行回调。</p>
<h4 id="getFileIO"><a href="#getFileIO" class="headerlink" title="getFileIO"></a>getFileIO</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">FileIO</span> <span class="variable">fileIO</span> <span class="operator">=</span> syscallHandler.getFileIO(<span class="number">0</span>); </span><br></pre></td></tr></table></figure>
<p>根据fd查询对应的File。</p>
<h3 id="自处理系统调用"><a href="#自处理系统调用" class="headerlink" title="自处理系统调用"></a>自处理系统调用</h3><p>如果unidbg处理的系统调用不足以满足你的需求，可以自己参考unidbg的处理方式，定制SyscallHandler来处理。</p>
<h3 id="FileResult"><a href="#FileResult" class="headerlink" title="FileResult"></a>FileResult</h3><p>在自定义IO处理中，FileResult作为回调方法的返回值。其有3个静态方法，分别代表对文件的不同操作。</p>
<h4 id="success"><a href="#success" class="headerlink" title="success"></a>success</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileResult.&lt;AndroidFileIO&gt;success(<span class="keyword">new</span> <span class="title class_">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;filepath&quot;</span>),pathname));</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>success方法表示一个文件正常处理。参数是一个NewFileIO接口的实现，根据不同的场景返回不同。如上面例子，就是返回一个普通文件，就使用SimpleFileIO实现，如果是一个文件夹，就使用DirectoryFileIO实现，其他场景可自行查看接口的实现类。</p>
<h4 id="failed"><a href="#failed" class="headerlink" title="failed"></a>failed</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileResult.failed(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>表示文件打开失败。参数是一个errno，会由上层处理将errno设置为该参数。</p>
<h4 id="fallback"><a href="#fallback" class="headerlink" title="fallback"></a>fallback</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">FileResult.&lt;AndroidFileIO&gt;fallback(<span class="keyword">new</span> <span class="title class_">DirectoryFileIO</span>(oflags,pathname,<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;filepath&quot;</span>)));</span><br></pre></td></tr></table></figure>
<p>表示降低自己的优先级，在其他处理器无法找到该文件时，由fallback指定的文件IO来代替。</p>
<h2 id="VirtualModule"><a href="#VirtualModule" class="headerlink" title="VirtualModule"></a>VirtualModule</h2><h3 id="VirtualModulem介绍"><a href="#VirtualModulem介绍" class="headerlink" title="VirtualModulem介绍"></a>VirtualModulem介绍</h3><p>VirtualModule是unidbg提供的一种虚拟模块方案。它的用途是当一个So由于某种原因，无法完整加载进unidbg，或想自己实现该So的部分功能时，就可以使用虚拟模块来解决。</p>
<h3 id="unidbg自带虚拟模块"><a href="#unidbg自带虚拟模块" class="headerlink" title="unidbg自带虚拟模块"></a>unidbg自带虚拟模块</h3><p>unidbg中自带了两个虚拟模块:</p>
<ul>
<li>AndroidModule(libandroid.so)</li>
<li>JniGraphics(libjnigraphics.so)</li>
</ul>
<p>这两个模块中的部分常用符号已经在unidbg中有提供，当我们要模拟执行一个So时，而它又正好使用了libandroid.so，我们就可以这样做:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">AndroidModule</span>(emulator,vm).register(memory); </span><br></pre></td></tr></table></figure>
<p>然后再加载目标So。libjnigraphics.so同理。</p>
<h3 id="自定义虚拟模块"><a href="#自定义虚拟模块" class="headerlink" title="自定义虚拟模块"></a>自定义虚拟模块</h3><p>当然我们也可以自己实现一个虚拟模块。下面我们以一个例子来说明虚拟模块应该如何使用。</p>
<h4 id="模拟场景"><a href="#模拟场景" class="headerlink" title="模拟场景"></a>模拟场景</h4><p>我们先来模拟一个使用虚拟So的场景。先来看Java层的代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.loadLibrary(<span class="string">&quot;native-doc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">native</span> <span class="type">int</span> <span class="title function_">sign</span><span class="params">(<span class="type">int</span> a)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Java层加载了libnative-doc.so，有一个sign方法，参数跟返回值都为int类型。我们再来看So层的代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">#include &lt;jni.h&gt;</span><br><span class="line">#include <span class="string">&quot;myAdd.h&quot;</span></span><br><span class="line"></span><br><span class="line">extern <span class="string">&quot;C&quot;</span></span><br><span class="line">JNIEXPORT jint JNICALL</span><br><span class="line"><span class="title function_">Java_com_github_unidbg_Test_sign</span><span class="params">(JNIEnv *env, jobject thiz, jint a)</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> myAdd(a, <span class="number">1024</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>So的代码有sign方法的实现，而且实现非常简单，调用了myAdd函数。但是这个myAdd函数是来自其他的So的一个函数，而且这个So还由于某种原因不能被正常加载或没必要去加载，我们来看在unidbg中该如何去做。</p>
<h4 id="首次尝试"><a href="#首次尝试" class="headerlink" title="首次尝试"></a>首次尝试</h4><p>现在首先要做的是在unidbg中加载native-doc模块，看代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg.android;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocTest</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DocTest</span>();</span><br><span class="line">        test.sign();</span><br><span class="line">        test.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//清理资源</span></span><br><span class="line">        IOUtils.close(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DocTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建模拟器实例</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//获取Memory接口</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">//创建虚拟机</span></span><br><span class="line">        vm = emulator.createDalvikVM();</span><br><span class="line">        <span class="comment">//加载模块</span></span><br><span class="line">        <span class="keyword">module</span> = emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/java/com/github/unidbg/libnative-doc.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//执行JNI_OnLoad函数</span></span><br><span class="line">        vm.callJNI_OnLoad(emulator, <span class="keyword">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//调用com/github/unidbg/Test类下的sign方法</span></span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">        DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;sign(I)I&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;执行结果: &quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们写完上面的代码，执行时会发现如下错误:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">libnative-doc.so load dependency libadd.so failed</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>unidbg会提示你libnative-doc.so需要一个libadd.so，而unidbg又找不到这个So来加载，所以就无法执行出正常的结果。这个libadd.so提供了myAdd函数的实现，但是它无法被正常加载，我们知道的是myAdd函数的实现是什么样子的。它就是将两个参数进行相加，然后返回结果。我们知道实现就好办了，下面通过虚拟So来解决这个问题。</p>
<h4 id="处理问题"><a href="#处理问题" class="headerlink" title="处理问题"></a>处理问题</h4><p>处理这种问题就分两步。第一步创建虚拟模块，来处理未找到的符号:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//继承VirtualModule类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Add</span> <span class="keyword">extends</span> <span class="title class_">VirtualModule</span>&lt;VM&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Add</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra)</span>&#123;</span><br><span class="line">        <span class="comment">//参数三为我们无法加载的So模块名称全称</span></span><br><span class="line">        <span class="built_in">super</span>(emulator,extra,<span class="string">&quot;libadd.so&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInitialize</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra, Map&lt;String, UnidbgPointer&gt; symbols)</span> &#123;</span><br><span class="line">        <span class="type">SvcMemory</span> <span class="variable">svcMemory</span> <span class="operator">=</span> emulator.getSvcMemory();</span><br><span class="line">        <span class="comment">//添加一个myAdd符号</span></span><br><span class="line">        symbols.put(<span class="string">&quot;_Z5myAddii&quot;</span>,svcMemory.registerSvc(<span class="keyword">new</span> <span class="title class_">ArmSvc</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">handle</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">                <span class="type">RegisterContext</span> <span class="variable">context</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">arg1</span> <span class="operator">=</span> context.getIntArg(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> arg0 + arg1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>第二步，在加载我们目标So时，先来加载我们的虚拟So:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//加载虚拟模块</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Add</span>(emulator, vm).register(memory);</span><br></pre></td></tr></table></figure>
<p>这样就可以搞定啦。</p>
<h4 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.github.unidbg.android;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.util.IOUtils;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.Module;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.ArmSvc;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.arm.context.RegisterContext;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidEmulatorBuilder;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.AndroidResolver;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.linux.android.dvm.*;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.Memory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.memory.SvcMemory;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.pointer.UnidbgPointer;</span><br><span class="line"><span class="keyword">import</span> com.github.unidbg.virtualmodule.VirtualModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DocTest</span> <span class="keyword">extends</span> <span class="title class_">AbstractJni</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">DocTest</span> <span class="variable">test</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DocTest</span>();</span><br><span class="line">        test.sign();</span><br><span class="line">        test.destroy();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//清理资源</span></span><br><span class="line">        IOUtils.close(emulator);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> AndroidEmulator emulator;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Module <span class="keyword">module</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> VM vm;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">DocTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//创建模拟器实例</span></span><br><span class="line">        emulator = AndroidEmulatorBuilder</span><br><span class="line">                .for32Bit()</span><br><span class="line">                .build();</span><br><span class="line">        <span class="comment">//获取Memory接口</span></span><br><span class="line">        <span class="type">Memory</span> <span class="variable">memory</span> <span class="operator">=</span> emulator.getMemory();</span><br><span class="line">        memory.setLibraryResolver(<span class="keyword">new</span> <span class="title class_">AndroidResolver</span>(<span class="number">23</span>));</span><br><span class="line">        <span class="comment">//创建虚拟机</span></span><br><span class="line">        vm = emulator.createDalvikVM();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//加载虚拟模块</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Add</span>(emulator, vm).register(memory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//加载模块</span></span><br><span class="line">        <span class="keyword">module</span> = emulator.loadLibrary(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;unidbg-android/src/test/java/com/github/unidbg/libnative-doc.so&quot;</span>), <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//执行JNI_OnLoad函数</span></span><br><span class="line">        vm.callJNI_OnLoad(emulator, <span class="keyword">module</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">sign</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//调用com/github/unidbg/Test类下的sign方法</span></span><br><span class="line">        <span class="type">DvmClass</span> <span class="variable">testClass</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;com/github/unidbg/Test&quot;</span>);</span><br><span class="line">        DvmObject&lt;?&gt; obj = testClass.newObject(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ret</span> <span class="operator">=</span> obj.callJniMethodInt(emulator, <span class="string">&quot;sign(I)I&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;执行结果: &quot;</span> + ret);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Add</span> <span class="keyword">extends</span> <span class="title class_">VirtualModule</span>&lt;VM&gt; &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Add</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra)</span> &#123;</span><br><span class="line">            <span class="built_in">super</span>(emulator, extra, <span class="string">&quot;libadd.so&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onInitialize</span><span class="params">(Emulator&lt;?&gt; emulator, VM extra, Map&lt;String, UnidbgPointer&gt; symbols)</span> &#123;</span><br><span class="line">            <span class="type">SvcMemory</span> <span class="variable">svcMemory</span> <span class="operator">=</span> emulator.getSvcMemory();</span><br><span class="line">            <span class="comment">//添加一个myAdd符号</span></span><br><span class="line">            symbols.put(<span class="string">&quot;_Z5myAddii&quot;</span>, svcMemory.registerSvc(<span class="keyword">new</span> <span class="title class_">ArmSvc</span>() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">handle</span><span class="params">(Emulator&lt;?&gt; emulator)</span> &#123;</span><br><span class="line">                    <span class="type">RegisterContext</span> <span class="variable">context</span> <span class="operator">=</span> emulator.getContext();</span><br><span class="line">                    <span class="type">int</span> <span class="variable">arg0</span> <span class="operator">=</span> context.getIntArg(<span class="number">0</span>);</span><br><span class="line">                    <span class="type">int</span> <span class="variable">arg1</span> <span class="operator">=</span> context.getIntArg(<span class="number">1</span>);</span><br><span class="line">                    <span class="keyword">return</span> arg0 + arg1;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Jnitrace"><a href="#Jnitrace" class="headerlink" title="Jnitrace"></a>Jnitrace</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">jnitrace -l so文件 包名 &gt; xxx.txt</span><br></pre></td></tr></table></figure>

<h3 id="jnitrace函数调用返回的是地址的时候"><a href="#jnitrace函数调用返回的是地址的时候" class="headerlink" title="jnitrace函数调用返回的是地址的时候"></a>jnitrace函数调用返回的是地址的时候</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/02.webp"
                      alt="image.png"
                ><br /> SO运行存在多线程的问题，多线程会给Trace分析带来干扰，我们在文本中查找TID 11372，跟着这个线 程走下去  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/03.webp"
                      alt="image.png"
                ><br /> 此处在获取0x49即我们的字符串的长度，继续往下  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/04.webp"
                      alt="image.png"
                ><br /> 此处将jstring转成Native 字符串，在JNI开发中，大部分JObject都属于局部引用，局部引用在用完之后需要手动释放  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/05.webp"
                      alt="image.png"
                ><br /> 比如GetStringUTFChars获取的资源，最后一定要ReleaseStringUTFChars，JNItrace会在Releasexxx这 系列API中，打印内容  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/06.webp"
                      alt="image.png"
                ><br /> <font color="red">但是需要注意的是，引用的释放方式有两种，除了Releasexx系列，也可以用DeleteLocalRef释放局部引 用，如果通过DeleteLocalRef释放，JNItrace并不会打印出具体值</font>  </p>
<h3 id="堆栈检测"><a href="#堆栈检测" class="headerlink" title="堆栈检测"></a>堆栈检测</h3><p>“java&#x2F;lang&#x2F;Throwable-&gt;<init>()V”<br /> new一个异常之后<br />“java&#x2F;lang&#x2F;Throwable-&gt;getStackTrace()[Ljava&#x2F;lang&#x2F;StackTraceElement;”<br />查看堆栈，这不就是堆栈检测吗，如果被Xposed Hook了，堆栈里会有Xposed这一 层。  <br /> new 异常之后，getStackTrace即得到异常堆栈数组，写代码验证一下<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/07.webp"
                      alt="image.png"
                >继续看JNItrace <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/08.webp"
                      alt="image.png"
                ><br />首先获取数据长度，这很好理解嘛，后面肯定是想循环遍历取出完整的调用栈，得知道调用栈有多长 <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/09.webp"
                      alt="image.png"
                ><br />获取数组第0个元素<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/10.webp"
                      alt="image.png"
                ><br /> getClassName，即获取具体的类名 <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/11.webp"
                      alt="image.png"
                ><br />因为是在JNI中处理，所以后面还得getString <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/12.webp"
                      alt="image.png"
                ><br />用完之后Release释放这个字符串资源，防止内存泄漏<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/13.webp"
                      alt="image.png"
                ><br /> com.xunmeng.pinduoduo.secure.DeviceNative即调用栈的第一层 <br />然后它对数组的第二个元素做同样的操作，一套流程总结下来，就是构造异常后读取调用栈嘛</p>
<h4 id="推荐使用objection查看堆栈"><a href="#推荐使用objection查看堆栈" class="headerlink" title="推荐使用objection查看堆栈"></a>推荐使用objection查看堆栈</h4><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/14.webp"
                      alt="image.png"
                ></p>
<h2 id="函数调用两种方式"><a href="#函数调用两种方式" class="headerlink" title="函数调用两种方式"></a>函数调用两种方式</h2><p>Unidbg call 参数传递，到底是自己call 地址 还是用Unidbg封装的API？<br />各有优劣，用API的话代码量小一些，自己call的话更灵活，限制小。熟能生巧。</p>
<h3 id="符号调用"><a href="#符号调用" class="headerlink" title="符号调用"></a>符号调用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;dta&quot;</span>;</span><br><span class="line"><span class="type">DvmObject</span> <span class="variable">dvmObject</span> <span class="operator">=</span> obj.callJniMethodObject(emulator, <span class="string">&quot;md5(Ljava/lang/String;)Ljava/lang/String;&quot;</span>, data);</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> (String) dvmObject.getValue();</span><br><span class="line">System.out.println(<span class="string">&quot;[symble] Call the so md5 function result is ==&gt; &quot;</span>+ result);</span><br></pre></td></tr></table></figure>

<h3 id="地址调用"><a href="#地址调用" class="headerlink" title="地址调用"></a>地址调用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Pointer</span> <span class="variable">jniEnv</span> <span class="operator">=</span> vm.getJNIEnv();</span><br><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br><span class="line"><span class="type">StringObject</span> <span class="variable">data</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringObject</span>(vm,<span class="string">&quot;dta&quot;</span>);</span><br><span class="line"></span><br><span class="line">List&lt;Object&gt; args = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">args.add(jniEnv);</span><br><span class="line">args.add(vm.addLocalObject(obj));</span><br><span class="line">args.add(vm.addLocalObject(data));</span><br><span class="line"></span><br><span class="line">Number[] numbers = <span class="keyword">module</span>.callFunction(emulator, <span class="number">0x8E81</span>, args.toArray());</span><br><span class="line">DvmObject&lt;?&gt; object = vm.getObject(numbers[<span class="number">0</span>].intValue());</span><br><span class="line"><span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) object.getValue();</span><br><span class="line">System.out.println(<span class="string">&quot;[addr] Call the so md5 function result is ==&gt; &quot;</span>+ value);</span><br></pre></td></tr></table></figure>

<h2 id="构建类的两种方式"><a href="#构建类的两种方式" class="headerlink" title="构建类的两种方式"></a>构建类的两种方式</h2><p>以当前包类为类名</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmObject</span> <span class="variable">obj</span> <span class="operator">=</span> ProxyDvmObject.createObject(vm,<span class="built_in">this</span>);</span><br></pre></td></tr></table></figure>
<p>自定义包名类名</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">DvmObject&lt;?&gt; context = vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>).newObject(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>

<h2 id="类继承的写法"><a href="#类继承的写法" class="headerlink" title="类继承的写法"></a>类继承的写法</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/15.webp"
                      alt="image.png"
                ><br />链式继承<br />vm.resolveClass(“子类”, vm.resolveClass(“父类”, vm.resolveClass(“父类的父类”))).newObject(signature);</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="string">&quot;android/app/ActivityThread-&gt;getApplication()Landroid/app/Application;&quot;</span>: &#123;</span><br><span class="line">    <span class="keyword">return</span> vm.resolveClass(<span class="string">&quot;android/app/Application&quot;</span>, vm.resolveClass(<span class="string">&quot;android/content/ContextWrapper&quot;</span>, vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>))).newObject(signature);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多行的写法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">DvmClass</span> <span class="variable">context</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/content/Context&quot;</span>);</span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">ContextWrapper</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/content/ContextWrapper&quot;</span>,context);</span><br><span class="line"><span class="type">DvmClass</span> <span class="variable">Application</span> <span class="operator">=</span> vm.resolveClass(<span class="string">&quot;android/app/Application&quot;</span>,ContextWrapper);</span><br><span class="line"><span class="keyword">return</span> Application.newObject(signature);</span><br></pre></td></tr></table></figure>

<h2 id="unidbg补获取系统属性"><a href="#unidbg补获取系统属性" class="headerlink" title="unidbg补获取系统属性"></a>unidbg补获取系统属性</h2><p><a class="link"   href="https://www.zskkk.cn/2022/12/22/unidbg%E8%A1%A5%E8%8E%B7%E5%8F%96%E7%B3%BB%E7%BB%9F%E5%B1%9E%E6%80%A7/" >unidbg补获取系统属性<i class="fas fa-external-link-alt"></i></a><br />可以使用unidbg封装好的hook方法知道系统调用了哪些系统属性，__system_property_get</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">SystemPropertyHook</span> <span class="variable">systemPropertyHook</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SystemPropertyHook</span>(emulator);</span><br><span class="line">systemPropertyHook.setPropertyProvider(<span class="keyword">new</span> <span class="title class_">SystemPropertyProvider</span>() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getProperty</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;lilac Systemkey:&quot;</span>+key);</span><br><span class="line">        <span class="keyword">switch</span> (key)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;);</span><br><span class="line">memory.addHookListener(systemPropertyHook);</span><br></pre></td></tr></table></figure>

<h2 id="文件重定向，实现-IOResolver"><a href="#文件重定向，实现-IOResolver" class="headerlink" title="文件重定向，实现 IOResolver"></a>文件重定向，实现 IOResolver</h2><p>需要继承 IOResolver 重写 resolve方法<br />在定义emulator好后，在so加载前添加文件重定位器<br />emulator.getSyscallHandler().addIOResolver(this);<br />指定路径文件定向（单文件）</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/key.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/key.txt&quot;</span>), pathname));</span><br><span class="line"><span class="comment">//            return FileResult.success(new ByteArrayFileIO(oflags, pathname, String.valueOf(System.currentTimeMillis()).getBytes(StandardCharsets.UTF_8)));</span></span><br><span class="line"><span class="comment">//            return null;</span></span><br><span class="line"><span class="comment">//            return FileResult.failed(13);</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 返回对应的文件夹（目录文件）</span></span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">DirectoryFileIO</span>(oflags, pathname,</span><br><span class="line">            <span class="keyword">new</span> DirectoryFileIO.<span class="built_in">DirectoryEntry</span>(<span class="literal">true</span>, String.<span class="built_in">valueOf</span>(System.<span class="built_in">currentTimeMillis</span>())), <span class="keyword">new</span> DirectoryFileIO.<span class="built_in">DirectoryEntry</span>(<span class="literal">true</span>, <span class="string">&quot;1234&quot;</span>)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/1.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/1.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/2.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/2.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(pathname.<span class="built_in">equals</span>(<span class="string">&quot;/data/user/0/com.example.fileinunidbg/files/demo2/3.txt&quot;</span>))&#123;</span><br><span class="line">    <span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">SimpleFileIO</span>(oflags, <span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/demo2/3.txt&quot;</span>), pathname));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> ((<span class="string">&quot;proc/&quot;</span> + emulator.<span class="built_in">getPid</span>() + <span class="string">&quot;/status&quot;</span>).<span class="built_in">equals</span>(pathname)) &#123;</span><br><span class="line"><span class="keyword">return</span> FileResult.<span class="built_in">success</span>(<span class="keyword">new</span> <span class="built_in">ByteArrayFileIO</span>(oflags, pathname, (<span class="string">&quot;文本内容.....&quot;</span>).<span class="built_in">getBytes</span>())&#125;</span><br></pre></td></tr></table></figure>
<p>或者是虚拟目录（对比文件夹里的文件比较多的情况下比较好）<br />在创建emulator的时候直接指定目录</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">emulator = AndroidEmulatorBuilder.for32Bit().<span class="built_in">setRootDir</span>(<span class="keyword">new</span> <span class="built_in">File</span>(<span class="string">&quot;unidbg-android/src/test/resources/FileDemo/VFS&quot;</span>)).<span class="built_in">build</span>();</span><br></pre></td></tr></table></figure>

<p>补了虚拟目录和代码，哪边会生效？<br />代码执行会先看有没有重写文件重定位器，没有就默认重定位器，两个都没有找到就到虚拟目录系统找，</p>
<h2 id="一些常用功能"><a href="#一些常用功能" class="headerlink" title="一些常用功能"></a>一些常用功能</h2><h3 id="打印内存，hexdump"><a href="#打印内存，hexdump" class="headerlink" title="打印内存，hexdump"></a>打印内存，hexdump</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Inspector.inspect(ctx.getR0Pointer().getByteArray(<span class="number">0</span>, <span class="number">0x10</span>), <span class="string">&quot;Arg1&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="unidbg下断点"><a href="#unidbg下断点" class="headerlink" title="unidbg下断点"></a>unidbg下断点</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">普通断点</span><br><span class="line">emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0x3161E</span>);</span><br><span class="line"></span><br><span class="line">内存写入断点</span><br><span class="line">emulator.traceWrite(<span class="keyword">module</span>.base + <span class="number">0x3A0C0</span>,<span class="keyword">module</span>.base + <span class="number">0x3A0C0</span>);</span><br></pre></td></tr></table></figure>

<h3 id="开启所有的日志"><a href="#开启所有的日志" class="headerlink" title="开启所有的日志"></a>开启所有的日志</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.ARM32SyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.unix.UnixSyscallHandler&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.AbstractEmulator&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.DalvikVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm.BaseVM&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line">Logger.getLogger(<span class="string">&quot;com.github.unidbg.linux.android.dvm&quot;</span>).setLevel(Level.DEBUG);</span><br><span class="line"></span><br><span class="line">所需要的头文件</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Level;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</span><br></pre></td></tr></table></figure>

<h3 id="计算汇编的行数"><a href="#计算汇编的行数" class="headerlink" title="计算汇编的行数"></a>计算汇编的行数</h3><p>计算某个函数的汇编行数前使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">traceLength</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.getBackend().hook_add_new(<span class="keyword">new</span> <span class="title class_">CodeHook</span>() &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hook</span><span class="params">(Backend backend, <span class="type">long</span> address, <span class="type">int</span> size, Object user)</span> &#123;</span><br><span class="line">            count += <span class="number">1</span>;</span><br><span class="line">            System.out.println(count);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onAttach</span><span class="params">(UnHook unHook)</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">detach</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="keyword">module</span>.base, <span class="keyword">module</span>.base + <span class="keyword">module</span>.size, <span class="literal">null</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="打印函数返回值或修改返回值"><a href="#打印函数返回值或修改返回值" class="headerlink" title="打印函数返回值或修改返回值"></a>打印函数返回值或修改返回值</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">hookRandom</span><span class="params">()</span>&#123;</span><br><span class="line">       emulator.attach().addBreakPoint(<span class="keyword">module</span>.findSymbolByName(<span class="string">&quot;lrand48&quot;</span>, <span class="literal">true</span>).getAddress(), <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">               System.out.println(<span class="string">&quot;call lrand48&quot;</span>);</span><br><span class="line">               <span class="comment">// 打印调用栈</span></span><br><span class="line">               emulator.getUnwinder().unwind();</span><br><span class="line">               <span class="comment">// 打印返回值或修改返回值</span></span><br><span class="line">               emulator.attach().addBreakPoint(emulator.getContext().getLRPointer().peer, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">                   <span class="meta">@Override</span></span><br><span class="line">                   <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">                       <span class="comment">//emulator.getBackend().reg_write(ArmConst.UC_ARM_REG_R0, 0x12345678);</span></span><br><span class="line">                       <span class="type">Number</span> <span class="variable">number</span> <span class="operator">=</span> emulator.getBackend().reg_read(ArmConst.UC_ARM_REG_R0);</span><br><span class="line">                       System.out.println(<span class="string">&quot;number &quot;</span> + number.intValue());</span><br><span class="line">                       <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;);</span><br><span class="line">               <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<!-- ## 算法分析中的HOOK思路  

- 快速验证用Console Debugger 
- 持久化用HookZz 
- 稳定Hook 用Unicorn Hook   -->


<h2 id="反制unidng"><a href="#反制unidng" class="headerlink" title="反制unidng"></a>反制unidng</h2><p>如何增加跑通Unidbg模拟执行的成本  ？</p>
<h4 id="一、JNI交互"><a href="#一、JNI交互" class="headerlink" title="一、JNI交互"></a>一、JNI交互</h4><p>主要有两点 </p>
<ol>
<li>尽可能增加补JAVA环境所需的时间成本</li>
</ol>
<p>打个比方，在SO中编写1000个对JAVA层的访问和调用函数，每次计算时根据时间戳使用其中的50 个，这样做的话，运算的时间成本不高，但因为时间戳一直在变，所以得在Unidbg中补齐全量的 JAVA访问。 </p>
<ol start="2">
<li>使用Unidbg暂不支持的JNI调用</li>
</ol>
<p>src&#x2F;main&#x2F;java&#x2F;com&#x2F;github&#x2F;unidbg&#x2F;linux&#x2F;android&#x2F;dvm&#x2F;DalvikVM.java 是Unidbg中实现JNI方法 的类，可以发现，只实现了最常用的那部分JNI方法，所以可以在样本中使用这些Unidbg尚未实现 的JNI方法。 </p>
<h4 id="二、系统调用"><a href="#二、系统调用" class="headerlink" title="二、系统调用"></a>二、系统调用</h4><p>Unidbg实现了许多常见的系统调用，但还有一些偏冷门的系统调用未实现，以及不偏僻但较难完美实现 的系统调用，典型代表——fork相关系统调用。 </p>
<h4 id="三、文件访问"><a href="#三、文件访问" class="headerlink" title="三、文件访问"></a>三、文件访问</h4><p>尽可能多的文件访问和交互 </p>
<h4 id="四、检测Unidbg"><a href="#四、检测Unidbg" class="headerlink" title="四、检测Unidbg"></a>四、检测Unidbg</h4><p>样本可以感知并检测自己运行在Unidbg环境中，并走向错误的分支。这一块我的了解不多，但确实是可 以的，Unidbg的执行环境和真机是有很大差距的。打个比方，每个Android进程都有一些初始化环境变 量，Android系统启动时通过setEnv设置，Unidbg中则没有。 </p>
<h4 id="五、目标函数无法被单独执行"><a href="#五、目标函数无法被单独执行" class="headerlink" title="五、目标函数无法被单独执行"></a>五、目标函数无法被单独执行</h4><p>尽其所能的增加目标函数被执行的”前置条件“，或者说初始化函数。这里面可以玩的花招、阴招太多 了。这应该作为一个主要的反Unidbg的方向，它是有效且杀伤力巨大的  </p>
<h4 id="六、在真机上使用GetStaticMethodID寻找一个不存在的方法"><a href="#六、在真机上使用GetStaticMethodID寻找一个不存在的方法" class="headerlink" title="六、在真机上使用GetStaticMethodID寻找一个不存在的方法"></a>六、在真机上使用GetStaticMethodID寻找一个不存在的方法</h4><p>在真机上，使用GetStaticMethodID寻找一个不存在的方法，系统会返回一个错误。在unidbg中使用GetStaticMethodID，像是无论存不存在都会模拟一个jmethodID返回给so<br />关于这个反unidbg的思路和形成，如果java层不存在某个类或者方法，jni中使用findclass或者getmethodid就会报错（这很合理嘛，因为找不到），而Unidbg因为没办法了解Java环境具体咋样，所以不管你find啥class还是get什么method，它都当做这是存在的。<br />解决，如果你想让Unidbg findclass找不到一个类，可以使用BaseVM的addNotFoundClass方法，如果想让Unidbg找不到某个方法，可以修改AbstractJni中的acceptMethod方法。</p>
<h2 id="Unidbg报错"><a href="#Unidbg报错" class="headerlink" title="Unidbg报错"></a>Unidbg报错</h2><h3 id="Illegal-JNI-version"><a href="#Illegal-JNI-version" class="headerlink" title="Illegal JNI version"></a>Illegal JNI version</h3><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/16.webp"
                      alt="image.png"
                ><br /> JNI版本错误，而只意味 JNIOnLoad 运行过程中出了错。至于具体出错的原因有很多，一个常见的问题是SO的依赖库缺失。  <br /> 我们的目标SO依赖了 libc++_shared.so ，这个库是C++的支持库，但不在Unidbg默认支持的SO里。 我们要在apk的lib里把它拷贝出来。  <br /> 还有另一个更通用的办法 ，当报错时，就把 traceCode打开，记录执行流，看最后在哪儿停下来。  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/17.webp"
                      alt="image.png"
                ><br /> 比如此处，我在JNI_OnLoad前面打开traceCode，在IDA中跳转到最后一条运行地址 0x177C  <br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/18.webp"
                      alt="image.png"
                ><br /> 可以发现正是C++的标准库函数，符合上面的猜测。  <br />添加之后正常加载<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/19.webp"
                      alt="image.png"
                ></p>
<h3 id="app开发过程中的失误，释放变量后还调用"><a href="#app开发过程中的失误，释放变量后还调用" class="headerlink" title="app开发过程中的失误，释放变量后还调用"></a>app开发过程中的失误，释放变量后还调用</h3><p>运行样本后，发现内存错误<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/20.webp"
                      alt="image.png"
                ><br />第一种尝试，把Unidbg的日志全开，src&#x2F;test&#x2F;resources&#x2F;log4j.properties中的INFO全配置改为DEBUG<br />再次运行后会在报错的地方停下来。输入bt查看调用栈<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/21.webp"
                      alt="image.png"
                ><br />unidbg提供了大量详情的调用回溯信息，直接拉到底部，看目标样本是从哪里调用。用IDA跳到0xabf<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/22.webp"
                      alt="image.png"
                ><br />奇了怪了，打个日志还报错？把日志等级改为INFO，在此处下个断点分析。<br />emulator.attach().addBreakPoint(module.base+0x00abf);<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/23.webp"
                      alt="image.png"
                ><br />_android_log_print是常用函数，参数1是此日志的优先级，参数2是tag，参数3是格式化字符串，之后的都是内容。都可以在Console Debugger中验证<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/24.webp"
                      alt="image.png"
                ><br />参数1是6，可以直接看，通过mrx查看其余参数，参数23也都正常，那参数4呢<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/25.webp"
                      alt="image.png"
                ><br />内存异常了，返回IDA查看代码<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/26.webp"
                      alt="image.png"
                ><br />可以看到上面释放了变量，下面还在调用。<br />怎么解决？<br />直接patch，改为两条无效指令，需要修改4个字节<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20230401/27.webp"
                      alt="image.png"
                ><br />首先写入0046，debug发现不对，调整了一下大小端序，再DEBUG似乎OK了</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog</span><span class="params">()</span>&#123;</span><br><span class="line">	<span class="type">int</span> <span class="variable">patchCode</span> <span class="operator">=</span> <span class="number">0x46004600</span>;</span><br><span class="line">	emulator.getMemory().pointer(<span class="keyword">module</span>.base + <span class="number">0xABE</span>).setInt(<span class="number">0</span>,patchCode);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>另一种填入两个nop也可以</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog1</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">Pointer</span> <span class="variable">pointer</span> <span class="operator">=</span> UnidbgPointer.pointer(emulator, <span class="keyword">module</span>.base + <span class="number">0xABE</span>);</span><br><span class="line">    <span class="keyword">assert</span> pointer != <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">Keystone</span> <span class="variable">keystone</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Keystone</span>(KeystoneArchitecture.Arm,KeystoneMode.ArmThumb)) &#123;</span><br><span class="line">		<span class="type">KeystoneEncoded</span> <span class="variable">encoded</span> <span class="operator">=</span> keystone.assemble(<span class="string">&quot;nop&quot;</span>);</span><br><span class="line">		<span class="type">byte</span>[] patch = encoded.getMachineCode();</span><br><span class="line">        pointer.write(<span class="number">0</span>, patch, <span class="number">0</span>, patch.length);</span><br><span class="line">        pointer.write(<span class="number">2</span>, patch, <span class="number">0</span>, patch.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>第三种方法，前面两种都是静态打patch，和用IDA的KeyPatch直接打patch没啥区别</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">patchLog2</span><span class="params">()</span>&#123;</span><br><span class="line">    emulator.attach().addBreakPoint(<span class="keyword">module</span>.base + <span class="number">0xABE</span>, <span class="keyword">new</span> <span class="title class_">BreakPointCallback</span>() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">onHit</span><span class="params">(Emulator&lt;?&gt; emulator, <span class="type">long</span> address)</span> &#123;</span><br><span class="line">        	emulator.getBackend().reg_write(ArmConst.UC_ARM_REG_PC,(address)+<span class="number">5</span>);</span><br><span class="line">        	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>解释一下做了什么，我们在log的调用处下了一个断点，inline hook 都是在调用前断下来了，所以在执 行前断了下来，然后加了BreakPointCallback回调，在这个时机做处理，我们将PC指针直接往前加了 5，PC指向哪里，函数就执行哪里，本来PC指向“blx log”这个地址，程序即将去执行log函数。但我们直 接将PC加了5，为什么加5？<br />我们知道这里的log是个坑，它长四个字节，我们要越过这个坑，但加4不够，我们是thumb模式，再+1，所以就是+5。</p>
]]></content>
      <tags>
        <tag>Unidbg</tag>
      </tags>
  </entry>
  <entry>
    <title>对称加解密算法RC4原理过程及实现</title>
    <url>/2022/09/15/%E5%AF%B9%E7%A7%B0%E5%8A%A0%E8%A7%A3%E5%AF%86%E7%AE%97%E6%B3%95RC4%E5%8E%9F%E7%90%86%E8%BF%87%E7%A8%8B%E5%8F%8A%E5%AE%9E%E7%8E%B0/</url>
    <content><![CDATA[<h1 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h1><p>RC4是一种流密码，可实现短密钥到长密钥的转换，流密码的加密就是比特的异或，为了安全性，关键就是密钥的生成，RC4就是解决密钥生成问题的。<br></br></p>
<p><strong>流密码结构：</strong><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220915/01.webp"
                     
                ></p>
</br>

<p>流密码类似于”一次一密”，不同的是”一次一密”使用的是真正的随机数流，而流密码使用的是伪随机数流。</br><br>设计流密码的主要因素</br><br>1、加密序列的周期要长，若出现重复的周期过短，容易被破解</br><br>2、密钥流应该尽可能地接近真正随机数流的特征</br><br>3、密钥长度要长，以避免琼穷举攻击</br></br></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220915/02.webp"
                     
                ></p>
</br>


<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="1-密钥编排，向量S和Y初始化"><a href="#1-密钥编排，向量S和Y初始化" class="headerlink" title="1. 密钥编排，向量S和Y初始化"></a>1. 密钥编排，向量S和Y初始化</h2><p>RC4的实现需要三个向量，初始向量S，密钥K,临时向量T</p>
<p>初始化向量S和T，将向量S填充为0到255的数值，根据密钥K，填充向量T。如果密钥K</p>
<p>比向量S短，就依次重复填充密钥K，如果与向量S等长，那么向量T与密钥K相同。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">S = []  <span class="comment"># 状态数组</span></span><br><span class="line">T = []  <span class="comment"># 临时数组</span></span><br><span class="line"><span class="comment"># 初始化S和T</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    S.append(i)</span><br><span class="line">    T.append(key[i % <span class="built_in">len</span>(key)])</span><br></pre></td></tr></table></figure>

</br>

<h2 id="2-向量S的初始置换，将原来有序的向量S重新排列"><a href="#2-向量S的初始置换，将原来有序的向量S重新排列" class="headerlink" title="2. 向量S的初始置换，将原来有序的向量S重新排列"></a>2. 向量S的初始置换，将原来有序的向量S重新排列</h2><p>从0遍历到255，每次 j&#x3D;(j+S[i]+ord(T[i]))%256，然后交换S[i] 和 S[j]，这样S盒顺序就被打乱了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 用T产生S的初始置换</span></span><br><span class="line">j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    j = (j + S[i] + <span class="built_in">ord</span>(T[i])) % <span class="number">256</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]  <span class="comment"># 交换S[i] 和 S[j]</span></span><br><span class="line">    <span class="comment"># print(S)</span></span><br></pre></td></tr></table></figure>
</br>

<h2 id="3-密钥生成，每加密一个字符，就需要生成一个字节的密钥"><a href="#3-密钥生成，每加密一个字符，就需要生成一个字节的密钥" class="headerlink" title="3. 密钥生成，每加密一个字符，就需要生成一个字节的密钥"></a>3. 密钥生成，每加密一个字符，就需要生成一个字节的密钥</h2><p>根据明文长度生成密钥流</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Ks = []</span><br><span class="line">i = j = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(M)):</span><br><span class="line">    i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">    j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">    S[i], S[j] = S[j], S[i]</span><br><span class="line">    t = (S[i] + S[j]) % <span class="number">256</span></span><br><span class="line">    Ks.append(t)</span><br></pre></td></tr></table></figure>

</br>

<h2 id="4-循环明文长度，每一个字符跟向量S异或"><a href="#4-循环明文长度，每一个字符跟向量S异或" class="headerlink" title="4. 循环明文长度，每一个字符跟向量S异或"></a>4. 循环明文长度，每一个字符跟向量S异或</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">C = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(M)):</span><br><span class="line">    C += <span class="built_in">chr</span>(<span class="built_in">ord</span>(M[i]) ^ S[Ks[i]])</span><br><span class="line"><span class="keyword">return</span> C</span><br></pre></td></tr></table></figure>

<p>解密也就是把密文当成明文再把加密执行一次</br></br></p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 密钥编排函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">KSA</span>(<span class="params">key</span>):</span><br><span class="line">    S = []  <span class="comment"># 状态数组</span></span><br><span class="line">    T = []  <span class="comment"># 临时数组</span></span><br><span class="line">    <span class="comment"># 初始化S和T</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        S.append(i)</span><br><span class="line">        T.append(key[i % <span class="built_in">len</span>(key)])</span><br><span class="line">        <span class="comment"># print(S)</span></span><br><span class="line">        <span class="comment"># print(T)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 用T产生S的初始置换</span></span><br><span class="line">    j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">        j = (j + S[i] + <span class="built_in">ord</span>(T[i])) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]  <span class="comment"># 交换S[i] 和 S[j]</span></span><br><span class="line">        <span class="comment"># print(S)</span></span><br><span class="line">        <span class="comment"># print(T)</span></span><br><span class="line">    <span class="keyword">return</span> S</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密钥流生成函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generateKey</span>(<span class="params">S, M</span>):</span><br><span class="line">    Ks = []</span><br><span class="line">    i = j = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(M)):</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span></span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span></span><br><span class="line">        S[i], S[j] = S[j], S[i]</span><br><span class="line">        t = (S[i] + S[j]) % <span class="number">256</span></span><br><span class="line">        Ks.append(t)</span><br><span class="line">    <span class="keyword">return</span> Ks</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rc4_encode</span>(<span class="params">M, key</span>):</span><br><span class="line">    C = <span class="string">&quot;&quot;</span></span><br><span class="line">    S = KSA(key)  <span class="comment"># 密钥编排</span></span><br><span class="line">    Ks = generateKey(S, M)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(M)):</span><br><span class="line">        C += <span class="built_in">chr</span>(<span class="built_in">ord</span>(M[i]) ^ S[Ks[i]])</span><br><span class="line">    <span class="keyword">return</span> C</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Rc4_decode</span>(<span class="params">C, key</span>):</span><br><span class="line">    M = <span class="string">&quot;&quot;</span></span><br><span class="line">    S = KSA(key)  <span class="comment"># 密钥编排</span></span><br><span class="line">    Ks = generateKey(S, C)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(C)):</span><br><span class="line">        M += <span class="built_in">chr</span>(<span class="built_in">ord</span>(C[i]) ^ S[Ks[i]])</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line">key = <span class="string">&#x27;123456789&#x27;</span></span><br><span class="line">m = <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"></span><br><span class="line">C = Rc4_encode(m, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;加密后密文：&quot;</span>, C)</span><br><span class="line"></span><br><span class="line">M = Rc4_decode(C, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;解密后明文：&quot;</span>, M)</span><br></pre></td></tr></table></figure>

</br>

<h2 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rc4_init</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *S, <span class="type">char</span> *key, <span class="type">int</span> key_len)</span> </span>&#123;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> T[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        S[i] = i;</span><br><span class="line">        T[i] = key[i % key_len];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">        j = (j + S[i] + T[i]) % <span class="number">256</span>;</span><br><span class="line">        <span class="built_in">swap</span>(S[i], S[j]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">rc4_crypto</span><span class="params">(<span class="type">unsigned</span> <span class="type">char</span> *S, <span class="type">char</span> *text, <span class="type">int</span> text_len)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>, t = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; text_len; k++) &#123;</span><br><span class="line">        i = (i + <span class="number">1</span>) % <span class="number">256</span>;</span><br><span class="line">        j = (j + S[i]) % <span class="number">256</span>;</span><br><span class="line">        <span class="built_in">swap</span>(S[i], S[j]);</span><br><span class="line">        t = (S[i] + S[j]) % <span class="number">256</span>;</span><br><span class="line">        text[k] ^= S[t];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">rc4_main</span><span class="params">(<span class="type">char</span> *text, <span class="type">int</span> text_len, <span class="type">char</span> *key)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> key_len = <span class="keyword">sizeof</span> key - <span class="number">1</span>;</span><br><span class="line">    <span class="type">unsigned</span> <span class="type">char</span> S[<span class="number">256</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">rc4_init</span>(S, key, key_len);</span><br><span class="line">    <span class="built_in">rc4_crypto</span>(S, text, text_len);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;result =&gt; %s\n&quot;</span>, text);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    char out[100] = &#123;0&#125;;</span></span><br><span class="line">    <span class="comment">//    base64_encode(text,out);</span></span><br><span class="line">    <span class="comment">//    printf(&quot;result(base64) =&gt; %s&quot;, out);</span></span><br><span class="line">    <span class="keyword">return</span> text;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> key[] = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line">    <span class="type">char</span> text[] = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    <span class="type">int</span> text_len = <span class="built_in">sizeof</span>(text) - <span class="number">1</span>;</span><br><span class="line">    string aa = <span class="built_in">rc4_main</span>(text, text_len, key);</span><br><span class="line">    cout&lt;&lt;aa&lt;&lt;endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>HMAC-MD5,HMAC-SHA1算法流程</title>
    <url>/2022/07/06/HMAC-MD5-HMAC-SHA1%E7%AE%97%E6%B3%95%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h2 id="每种哈希函数的特征"><a href="#每种哈希函数的特征" class="headerlink" title="每种哈希函数的特征"></a>每种哈希函数的特征</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/01.webp"
                     
                ></p>
<h3 id="1-MD5"><a href="#1-MD5" class="headerlink" title="1.MD5"></a>1.MD5</h3><p>初始化魔数：<br />A &#x3D; 0x67452301;<br />B &#x3D; 0xEFCDAB89;<br />C &#x3D; 0x98BADCFE;<br />D &#x3D; 0x10325476;<br />K表<br />K1 &#x3D; 0xd76aa478<br />K2 &#x3D; 0xe8c7b756<br />K3 &#x3D; 0x242070db<br />K表来自sin函数<br />输出长度16个字节，或者说32个十六进制数，有时候输出16个十六进制数。</p>
<h3 id="2-SHA1"><a href="#2-SHA1" class="headerlink" title="2.SHA1"></a>2.SHA1</h3><p>A &#x3D; 0x67452301<br />B &#x3D; 0xEFCDAB89<br />C &#x3D; 0x98BADCFE<br />D &#x3D; 0x10325476<br />E &#x3D; 0xC3D2E1F0<br />和MD5相比，有五个初始化链接变量，而且前四个链接变量完全相同。<br />输出长度20个字节，或者说40个十六进制数。<br />只有四个K值，每20轮用同一个K作变换<br />K1 &#x3D; 0x5a827999<br />K2 &#x3D; 0x6ed9eba1<br />K3 &#x3D; 0x8f1bbcdc<br />K4 &#x3D; 0xca62c1d6</p>
<h3 id="3-SHA256"><a href="#3-SHA256" class="headerlink" title="3.SHA256"></a>3.SHA256</h3><p>A &#x3D; 0x6A09E667;<br />B &#x3D; 0xBB67AE85;<br />C &#x3D; 0x3C6EF372;<br />D &#x3D; 0xA54FF53A;<br />E &#x3D; 0x510E527F;<br />F &#x3D; 0x9B05688C;<br />G &#x3D; 0x1F83D9AB;<br />H &#x3D; 0x5BE0CD19;<br />八个初始化链接变量<br />输出长度为32个字节，或者说64个十六进制数<br />有64个K值，每轮1个K值<br />K1 &#x3D; 0x428a2f98<br />K2 &#x3D; 0x71374491<br />K3 &#x3D; 0xb5c0fbcf<br />K4 &#x3D; 0xe9b5dba5<br />K值来自素数</p>
<h3 id="4-SHA-512"><a href="#4-SHA-512" class="headerlink" title="4.SHA 512"></a>4.SHA 512</h3><p>A &#x3D; 0x6a09e667f3bcc908;<br />B &#x3D; 0xbb67ae8584caa73b;<br />C &#x3D; 0x3c6ef372fe94f82b;<br />D &#x3D; 0xa54ff53a5f1d36f1;<br />E &#x3D; 0x510e527fade682d1;<br />F &#x3D; 0x9b05688c2b3e6c1f;<br />G &#x3D; 0x1f83d9abfb41bd6b;<br />H &#x3D; 0x5be0cd19137e2179;<br />八个初始化链接变量，IDA反编译也时常显示为16个。<br />输出长度为64字节，或者说128个十六进制数<br />有80个K，每一轮一个K，K值来自素数。<br />K1 &#x3D; 0x428a2f98d728ae22<br />K2 &#x3D; 0x7137449123ef65cd<br />K3 &#x3D; 0xb5c0fbcfec4d3b2f<br />K4 &#x3D; 0xe9b5dba58189dbbc<br />和SHA256的K有关联。</p>
<h2 id="HMAC"><a href="#HMAC" class="headerlink" title="HMAC"></a>HMAC</h2><p>HMAC-MD5<br />HMAC-SHA1<br />HMAX-XXX 加盐+双重哈希方案</p>
<h3 id="HMAC-MD5"><a href="#HMAC-MD5" class="headerlink" title="HMAC MD5"></a>HMAC MD5</h3><p>Cyberchef<br />HMAC-MD5<br />明文：123456(utf-8)<br />密文：111111(utf-8)<br />结果：5542af910b1ff3f554dcdfb7ceccebc8</p>
<h4 id="公式："><a href="#公式：" class="headerlink" title="公式："></a>公式：</h4><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/02.webp"
                     
                ></p>
<h4 id="第一步（让密钥的长度达到分组长度）："><a href="#第一步（让密钥的长度达到分组长度）：" class="headerlink" title="第一步（让密钥的长度达到分组长度）："></a>第一步（让密钥的长度达到分组长度）：</h4><p>如果密钥长度超过512bit，先进行一次MD5后：16个字节+00000…<br />k &#x3D; 0x313131313131<br />密钥进行扩展<br />MD5: 512比特–64字节–128hex 分组长度<br />（十六进制，128长度）<br />k’&#x3D;0x31313131313100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</p>
<h4 id="第二步（k’⊕opad）："><a href="#第二步（k’⊕opad）：" class="headerlink" title="第二步（k’⊕opad）："></a>第二步（k’⊕opad）：</h4><p>先对opad填充到分组长度<br />0x5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c<br />进行异或<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/03.webp"
                     
                ><br><br />k’⊕opad&#x3D;0x6d6d6d6d6d6d5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c</p>
<h4 id="第三步（k’⊕ipad）："><a href="#第三步（k’⊕ipad）：" class="headerlink" title="第三步（k’⊕ipad）："></a>第三步（k’⊕ipad）：</h4><p>先对ipad填充到分组长度<br />0x36363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636<br />进行异或<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/04.webp"
                     
                ><br><br />k’⊕ipad&#x3D;0x07070707070736363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636</p>
<h4 id="第四步级联明文（-k’⊕ipad-m）"><a href="#第四步级联明文（-k’⊕ipad-m）" class="headerlink" title="第四步级联明文（(k’⊕ipad)||m）:"></a>第四步级联明文（(k’⊕ipad)||m）:</h4><p>(k’⊕ipad)||m&#x3D;0x07070707070736363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636313233343536</p>
<h4 id="第五步级联后进行md5（H-k’⊕ipad-m-）"><a href="#第五步级联后进行md5（H-k’⊕ipad-m-）" class="headerlink" title="第五步级联后进行md5（H((k’⊕ipad)||m)）:"></a>第五步级联后进行md5（H((k’⊕ipad)||m)）:</h4><p>级联后进行一次md5（不需要转hex）<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/05.webp"
                     
                ><br />H((k’⊕ipad)||m)&#x3D;873883125b81d8d9b483f29cffeeea37</p>
<h4 id="第六步（第二步级联第五步后进行md5，H-k’⊕opad-H-k’⊕ipad-m-）"><a href="#第六步（第二步级联第五步后进行md5，H-k’⊕opad-H-k’⊕ipad-m-）" class="headerlink" title="第六步（第二步级联第五步后进行md5，H((k’⊕opad)||H((k’⊕ipad)||m)）"></a>第六步（第二步级联第五步后进行md5，H((k’⊕opad)||H((k’⊕ipad)||m)）</h4><p>0x6d6d6d6d6d6d5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c873883125b81d8d9b483f29cffeeea37<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/06.webp"
                     
                ><br />结果：5542af910b1ff3f554dcdfb7ceccebc8<br />结果跟Cyberchef的HMAC-MD5一致</p>
<h3 id="HMAC-SHA1"><a href="#HMAC-SHA1" class="headerlink" title="HMAC SHA1"></a>HMAC SHA1</h3><p>Cyberchef<br />HMAC-SHA1<br />明文：helloword(utf-8)<br />密文：1111(hex)<br />结果：4ea30551db501b285a03a197c65fea249131b808</p>
<h4 id="第一步（让密钥的长度达到分组长度）：-1"><a href="#第一步（让密钥的长度达到分组长度）：-1" class="headerlink" title="第一步（让密钥的长度达到分组长度）："></a>第一步（让密钥的长度达到分组长度）：</h4><p>如果密钥长度超过512bit，先进行一次SHA1后：16个字节+00000…<br />k &#x3D; 0x1111<br />密钥进行扩展<br />SHA1: 512比特–64字节–128hex 分组长度<br />（十六进制，128长度）<br />k’&#x3D;0x11110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</p>
<h4 id="第二步（k’⊕opad）：-1"><a href="#第二步（k’⊕opad）：-1" class="headerlink" title="第二步（k’⊕opad）："></a>第二步（k’⊕opad）：</h4><p>异或0x5c<br />先对opad填充到分组长度<br />0x5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c<br />然后进行异或<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/07.webp"
                     
                ><br />k’⊕opad&#x3D;0x4d4d5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c</p>
<h4 id="第三步（k’⊕ipad）：-1"><a href="#第三步（k’⊕ipad）：-1" class="headerlink" title="第三步（k’⊕ipad）："></a>第三步（k’⊕ipad）：</h4><p>异或0x36<br />先对ipad填充到分组长度<br />0x3636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636<br />进行异或<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220706/08.webp"
                     
                ><br />k’⊕ipad&#x3D;0x27273636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636</p>
<h4 id="第四步级联明文（-k’⊕ipad-m）-1"><a href="#第四步级联明文（-k’⊕ipad-m）-1" class="headerlink" title="第四步级联明文（(k’⊕ipad)||m）:"></a>第四步级联明文（(k’⊕ipad)||m）:</h4><p>(k’⊕ipad)||m&#x3D;0x2727363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363636363668656c6c6f776f7264</p>
<h4 id="第五步级联后进行sha1（H-k’⊕ipad-m-）"><a href="#第五步级联后进行sha1（H-k’⊕ipad-m-）" class="headerlink" title="第五步级联后进行sha1（H((k’⊕ipad)||m)）:"></a>第五步级联后进行sha1（H((k’⊕ipad)||m)）:</h4><p>级联后进行一次sha1（不需要转hex）<br />H((k’⊕ipad)||m)&#x3D;aea39b30d6922fdbb1848fe3a49bd130ed337f77</p>
<h4 id="第六步（第二步级联第五步后进行sha1，H-k’⊕opad-H-k’⊕ipad-m-）"><a href="#第六步（第二步级联第五步后进行sha1，H-k’⊕opad-H-k’⊕ipad-m-）" class="headerlink" title="第六步（第二步级联第五步后进行sha1，H((k’⊕opad)||H((k’⊕ipad)||m)）"></a>第六步（第二步级联第五步后进行sha1，H((k’⊕opad)||H((k’⊕ipad)||m)）</h4><p>级联(k’⊕opad)||H((k’⊕ipad)||m)&#x3D;0x4d4d5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5c5caea39b30d6922fdbb1848fe3a49bd130ed337f77<br />4ea30551db501b285a03a197c65fea249131b808</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>第一步k值填充到块长度(md5和sha1是512bit，128hex)称为k’<br />第二步k’与0x36异或后拼接明文的hex，进行原函数哈希（如hmac md5就进行一次md5，hmac sha1就进行一次sha1）<br />第三步k’与0x5c异或后拼接第二步再进行一次原函数哈希</p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>SHA1原理分析及流程</title>
    <url>/2022/07/05/SHA1%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90%E5%8F%8A%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="SHA1介绍"><a href="#SHA1介绍" class="headerlink" title="SHA1介绍"></a>SHA1介绍</h1><p>SHA实际上是一系列算法的统称，分别包括：SHA-1、SHA-224、SHA-256、SHA-384以及SHA-512。后面4中统称为SHA-2，事实上SHA-224是SHA-256的缩减版，SHA-384是SHA-512的缩减版。各中SHA算法的数据比较如下表，其中的长度单位均为位：</p>
<table>
<thead>
<tr>
<th><strong>类别</strong></th>
<th><strong>MD5</strong></th>
<th><strong>SHA-1</strong></th>
<th><strong>SHA-224</strong></th>
<th><strong>SHA-256</strong></th>
<th><strong>SHA-384</strong></th>
<th><strong>SHA-512</strong></th>
</tr>
</thead>
<tbody><tr>
<td>消息摘要长度</td>
<td>128位(bit) 或 32字节</td>
<td>160位(bit)或40字节</td>
<td>224位(bit)或56字节</td>
<td>256位(bit)或64字节</td>
<td>384位(bit)或96字节</td>
<td>512位(bit)或128字节</td>
</tr>
<tr>
<td>消息长度</td>
<td>&#x2F;</td>
<td>小于264位</td>
<td>小于264位</td>
<td>小于264位</td>
<td>小于2128位</td>
<td>小于2128位</td>
</tr>
<tr>
<td>分组长度</td>
<td>512bit</td>
<td>512bit</td>
<td>512bit</td>
<td>512bit</td>
<td>1024bit</td>
<td>1024bit</td>
</tr>
<tr>
<td>计算字长度</td>
<td>32bit</td>
<td>32bit</td>
<td>32bit</td>
<td>32bit</td>
<td>64bit</td>
<td>64bit</td>
</tr>
<tr>
<td>计算步骤数</td>
<td>64</td>
<td>80</td>
<td>64</td>
<td>64</td>
<td>80</td>
<td>80</td>
</tr>
</tbody></table>
</br>

<h1 id="SHA1哈希算法流程"><a href="#SHA1哈希算法流程" class="headerlink" title="SHA1哈希算法流程"></a>SHA1哈希算法流程</h1><h2 id="消息填充"><a href="#消息填充" class="headerlink" title="消息填充"></a>消息填充</h2><p>对于任意长度的明文，SHA1的明文分组过程与MD5相类似，首先需要对明文添加位数，使明文总长度为448（mod512）位。在明文后添加位的方法是第一个添加位是l，其余都是0。然后将真正明文的长度（没有添加位以前的明文长度）以64位表示，附加于前面已添加过位的明文后，此时的明文长度正好是512位的倍数。<br />M的长度 mod 512 &#x3D; R，考虑R（R为输入消息长度按512bit进行分组后，最后一组的长度）<br /> </p>
<ol>
<li>R &lt; 448，在最后一组的末尾填充1个“1”及若干个“0”，使最后一组的位数达到448位；再在这448位的基础上填充64位，这64位是M的原始长度的[二进制]</li>
</ol>
</br>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/01.webp"
                     
                ></p>
</br>

<ol start="2">
<li>R &gt;&#x3D; 448，在最后一组的末尾填充1个“1”及若干个“0”，使最后一组位数达到512；再新增一组，添加448个“0”和64位M的原始长度的二进制表示。</li>
</ol>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/02.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/03.webp"
                     
                ></p>
</br>

<h2 id="初始化模值"><a href="#初始化模值" class="headerlink" title="初始化模值"></a>初始化模值</h2><p>A&#x3D;0x67452301</br><br>B&#x3D;0xEFCDAB89</br><br>C&#x3D;0x98BADCFE</br><br>D&#x3D;0x10325476</br><br>E&#x3D;0xC3D2E1F0</br></br></p>
<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p>第一个512位分组进来后，以32位为一组，分别存储在W0 ，……，W15 中</br><br>之后还要将这16份子明文分组扩充到80份子明文分组，我们记为W[k]（k&#x3D; 0, 1,……79），扩充的方法如下。</br></br></p>
<h2 id="分组扩展为80份"><a href="#分组扩展为80份" class="headerlink" title="分组扩展为80份"></a>分组扩展为80份</h2><p><em>Wt</em> &#x3D; Mt , 当0≤t≤15</br><br><em>Wt</em>&#x3D;(<em>Wt</em> −16 ⊕ <em>Wt</em> −14 ⊕ <em>Wt</em> −8 ⊕ <em>Wt</em> −3)&lt;&lt;&lt;1    (16≤t≤79)</br><br>“&lt;&lt;&lt;” 表示循环左移符号，上述中是循环左移1位。</p>
</br>

<h2 id="计算信息摘要"><a href="#计算信息摘要" class="headerlink" title="计算信息摘要"></a>计算信息摘要</h2><p>Kt (0≤t≤19) &#x3D; 0x5A827999</br><br>Kt (20≤t≤39) &#x3D; 0x6ED9EBA1</br><br>Kt (40≤t≤59) &#x3D; 0x0x8F188CDC</br><br>Kt (60≤t≤79) &#x3D; 0x0xCA62C1D6</br></br><br>4轮80步的计算中使用到的函数和固定常熟如下表所示：</br></p>
<table>
<thead>
<tr>
<th><strong>计算轮次</strong></th>
<th><strong>计算的步数</strong></th>
<th><strong>计算函数</strong></th>
<th><strong>计算常数</strong></th>
</tr>
</thead>
<tbody><tr>
<td>第一轮</td>
<td>0≤t≤19步</td>
<td>ft(B,C,D)&#x3D;(B&amp;C)&amp;#124;(~B&amp;D)</td>
<td>_K_t&#x3D;0x5A827999</td>
</tr>
<tr>
<td>第二轮</td>
<td>20≤t≤39步</td>
<td>ft(B,C,D)&#x3D;B⊕C⊕D</td>
<td>_K_t&#x3D;0x6ED9EBA1</td>
</tr>
<tr>
<td>第三轮</td>
<td>40≤t≤59步</td>
<td>ft(B,C,D)&#x3D;(B&amp;C)&amp;#124;(B&amp;D)&amp;#124;(C&amp;D)</td>
<td>_K_t&#x3D;0x8F188CDC</td>
</tr>
<tr>
<td>第四轮</td>
<td>60≤t≤79步</td>
<td>ft(B,C,D)&#x3D;B⊕C⊕D</td>
<td>_K_t&#x3D;0xCA62C1D6</td>
</tr>
</tbody></table>
<p>（&amp;是与（And），|是或（Or），~是非（Not），^是异或（Xor））</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>与</td>
<td>两个位都为1时，结果才为1</td>
</tr>
<tr>
<td>|</td>
<td>或</td>
<td>两个位都为0时，结果才为0</td>
</tr>
<tr>
<td>^</td>
<td>异或</td>
<td>两个位相同为0，相异为1</td>
</tr>
<tr>
<td>~</td>
<td>取反</td>
<td>0变1，1变0</td>
</tr>
<tr>
<td>&lt;&lt;&lt;</td>
<td>循环左移</td>
<td>将移出的低位放到该数的高位</td>
</tr>
</tbody></table>
</br>

<h2 id="链接变量与初始链接变量进行求和运算"><a href="#链接变量与初始链接变量进行求和运算" class="headerlink" title="链接变量与初始链接变量进行求和运算"></a>链接变量与初始链接变量进行求和运算</h2><p>SHA1有4轮运算，每一轮包括20个步骤，一共80步，最终产生160位的信息摘要，这160位的摘要存放在5个32位的链接变量中。</br><br>在SHA1的4论运算中，虽然进行的就具体操作函数不同，但逻辑过程却是一致的。首先，定义5个变量，假设为H0、H1、H2、H3、H4，对其分别进行如下操作：</br><br>（A）、将A左移5为与 函数的结果求和，再与对应的子明文分组、E以及计算常数求和后的结果赋予H0。</br><br>（B）、将A的值赋予H1。</br><br>（C）、将B左移30位，并赋予H2。</br><br>（D）、将C的值赋予H3。</br><br>（E）、将D的值赋予H4。</br><br>（F）、最后将H0、H1、H2、H3、H4的值分别赋予A、B、C、D</br></br><br>A &#x3D; H0 &#x3D; A&lt;&lt;&lt;5+ft(B,C,D)+E+Wt+Kt</br><br>B &#x3D; H1 &#x3D; A</br><br>C &#x3D; H2 &#x3D; B&lt;&lt;&lt;30</br><br>D &#x3D; H3 &#x3D; C</br><br>E &#x3D; H4 &#x3D; D</br><br>这一过程表示如下：</br><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/04.webp"
                     
                ></p>
</br>

<h2 id="加上初始化模值"><a href="#加上初始化模值" class="headerlink" title="加上初始化模值"></a>加上初始化模值</h2><p>a &#x3D; H0+A</br><br>b &#x3D; H1+B</br><br>c &#x3D; H2+C</br><br>d &#x3D; H3+D</br><br>e &#x3D; H4+E</br><br>result &#x3D; abcde</br><br>经过4论80步计算后得到的结果，再与各链接变量的初始值求和，就得到了我们最终的信息摘要。而对于有多个明文分组的，则将前面所得到的结果作为初始值进行下一明文分组的计算，最后一组的512位分组经过80轮的操作后，最终产生的</br><br>H0、H1、H2、H3、H4要加上一开始的A、B、C、D、E，及加完后最终的abcde即为消息M的hash值。</br><br></br></p>
<h1 id="整个sha1加密简要过程如下："><a href="#整个sha1加密简要过程如下：" class="headerlink" title="整个sha1加密简要过程如下："></a>整个sha1加密简要过程如下：</h1><p>（1） 将512位的明文分组划分为16个子明文分组，每个子明文分组为32位。</br><br>（2） 申请5个32位的链接变量，记为A、B、C、D、E。</br><br>（3） 16份子明文分组扩展为80份。</br><br>（4） 80份子明文分组进行4轮运算。</br><br>（5） 链接变量与初始链接变量进行求和运算。</br><br>（6） 链接变量作为下一个明文分组的输入重复进行以上操作。</br><br>（7） 最后，5个链接变量要加上一开始的模值，最终级联起来的数据就是SHA1摘要。</br></p>
</br>

<h1 id="例子：对409732112进行sha1"><a href="#例子：对409732112进行sha1" class="headerlink" title="例子：对409732112进行sha1"></a>例子：对409732112进行sha1</h1><p>409732112&#x3D;&#x3D;&gt;ASCII   34 30 39 37 33 32 31 31 32<br />转为二进制就是 4*18 &#x3D; 72bit<br />34 &#x3D;&#x3D;&gt; 0011 0100<br />30 &#x3D;&#x3D;&gt; 0011 0000<br />39 &#x3D;&#x3D;&gt; 0011 1001<br />37 &#x3D;&#x3D;&gt; 0011 0111<br />33 &#x3D;&#x3D;&gt; 0011 0011<br />32 &#x3D;&#x3D;&gt; 0011 0010<br />31 &#x3D;&#x3D;&gt; 0011 0001<br />31 &#x3D;&#x3D;&gt; 0011 0001<br />32 &#x3D;&#x3D;&gt; 0011 0010<br />72bit填充1000….到448bit， 填充1个1和375个0<br /><br>0011 0100 0011 0000 0011 1001 0011 0111 0011 0011 0011 0010 0011 0001 0011 0001 0011 0010 1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000<br /><br><br />对应16进制<br />34 30 39 37 33 32 31 31 32 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00<br />512bit - 448bit &#x3D; 64bit<br /><br />留的那64比特长度，用于填充长度信息，长度单位为比特<br />64bit附加长度信息 （就是明文对应16进制的长度）<br />00  …. 00 72（中间58个0, 明文72是十进制，需要转为十六进制）<br />明文72bit+填充（10…）376bit+长度信息（00 00 …48）64bit &#x3D; 512bit<br />34 30 39 37 33 32 31 31 32 80 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 48<br />512bit &#x2F; 4 &#x3D; 128位16进制<br />128分16组 &#x3D; 8位 （每组8位）<br />W0 &#x3D; 0x 34 30 39 37<br />W1 &#x3D; 0x 33 32 31 31 <br />W2 &#x3D; 0x 32 80 00 00 <br />W3 &#x3D; 0x 00 00 00 00<br />…<br />W14 &#x3D; 0x 00 00 00 00<br />W15 &#x3D; 0x 00 00 00 48 <br />扩展分组到80份<br /></p>
<p><em>Wt</em>&#x3D;( <em>Wt</em> − 16 ⊕ <em>Wt</em> −14 ⊕ <em>Wt</em> −8 ⊕ <em>Wt</em> −3)&lt;&lt;1    (16≤_t_≤79)<br />这里手算前3个，最终80份程序生成<br />W16 &#x3D; (W0⊕W2⊕W8⊕W13)&lt;&lt;1<br />W17 &#x3D; (W1⊕W3⊕W9⊕W14)&lt;&lt;1<br />W18 &#x3D; (W2⊕W4⊕W10⊕W15)&lt;&lt;1</p>
<p>W0 &#x3D; 0011 0100 0011 0000 0011 1001 0011 0111<br />W1 &#x3D; 0011 0011 0011 0010 0011 0001 0011 0001<br />W2 &#x3D; 0011 0010 1000 0000 0000 0000 0000 0000<br />W3&#x3D;0，W4&#x3D;0，W8&#x3D;0，W9&#x3D;0，W10&#x3D;0，W13&#x3D;0，W14 &#x3D; 0<br />W15&#x3D; 0000 0000 0000 0000 0000 0000 0100 1000<br />W16 &#x3D; (W0⊕W2)&lt;&lt;1&#x3D; 0000 1101 0110 0000 0111 0010 0110 1110 &#x3D; 0x 0D60726E<br />W17 &#x3D; W1&lt;&lt;1&#x3D; 0110 0110 0110 0100 0110 0010 0110 0010 &#x3D; 0x 66646262<br />W18 &#x3D; (W2⊕W15)&lt;&lt;1&#x3D; 0110 0101 0000 0000 0000 0000 1001 0000 &#x3D; 0x 65000090<br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/05.webp"
                     
                ></p>
<p>跟程序结果一致，下面直接输出结果<br />W0 &#x3D; 0x34303937<br />W1 &#x3D; 0x33323131<br />W2 &#x3D; 0x32800000<br />W3 &#x3D; 0x0<br />W4 &#x3D; 0x0<br />W5 &#x3D; 0x0<br />W6 &#x3D; 0x0<br />W7 &#x3D; 0x0<br />W8 &#x3D; 0x0<br />W9 &#x3D; 0x0<br />W10 &#x3D; 0x0<br />W11 &#x3D; 0x0<br />W12 &#x3D; 0x0<br />W13 &#x3D; 0x0<br />W14 &#x3D; 0x0<br />W15 &#x3D; 0x48<br />W16 &#x3D; 0xd60726e<br />W17 &#x3D; 0x66646262<br />W18 &#x3D; 0x65000090<br />W19 &#x3D; 0x1ac0e4dc<br />W20 &#x3D; 0xccc8c4c4<br />W21 &#x3D; 0xca000120<br />W22 &#x3D; 0x3581c9b8<br />W23 &#x3D; 0x99918919<br />W24 &#x3D; 0x8ec0e69d<br />W25 &#x3D; 0xa7cb57b4<br />W26 &#x3D; 0xf9231313<br />W27 &#x3D; 0x28000483<br />W28 &#x3D; 0xd60726e0<br />W29 &#x3D; 0x664624f6<br />W30 &#x3D; 0x21c37eaa<br />W31 &#x3D; 0x53e59ba6<br />W32 &#x3D; 0x1cd612b<br />W33 &#x3D; 0xf5595f41<br />W34 &#x3D; 0x61c99c2<br />W35 &#x3D; 0xf21b00a9<br />W36 &#x3D; 0xb42ee9bb<br />W37 &#x3D; 0x67966a1a<br />W38 &#x3D; 0xd132a24c<br />W39 &#x3D; 0xb3235961<br />W40 &#x3D; 0x2371fd7e<br />W41 &#x3D; 0x57415c75<br />W42 &#x3D; 0x3437eaa1<br />W43 &#x3D; 0x3e59bb45<br />W44 &#x3D; 0x2957db08<br />W45 &#x3D; 0xcc047fd6<br />W46 &#x3D; 0x9eca0d11<br />W47 &#x3D; 0x79908d1c<br />W48 &#x3D; 0xd148f483<br />W49 &#x3D; 0x9d921d19<br />W50 &#x3D; 0xff2a2f89<br />W51 &#x3D; 0xf5384aea<br />W52 &#x3D; 0xa3b31bcd<br />W53 &#x3D; 0xcf36c649<br />W54 &#x3D; 0x33623193<br />W55 &#x3D; 0x7c83278a<br />W56 &#x3D; 0x12704a2a<br />W57 &#x3D; 0x8fd19775<br />W58 &#x3D; 0x3d927355<br />W59 &#x3D; 0x2a2b88a6<br />W60 &#x3D; 0x37feb543<br />W61 &#x3D; 0x8e608fac<br />W62 &#x3D; 0xad96814e<br />W63 &#x3D; 0x5efe0599<br />W64 &#x3D; 0x64e43d19<br />W65 &#x3D; 0x95da8390<br />W66 &#x3D; 0x7fea8510<br />W67 &#x3D; 0xe9827238<br />W68 &#x3D; 0x65ea391a<br />W69 &#x3D; 0x847fd6fe<br />W70 &#x3D; 0xca0d119e<br />W71 &#x3D; 0x908d18f9<br />W72 &#x3D; 0x9ef3a531<br />W73 &#x3D; 0xf45b1bbb<br />W74 &#x3D; 0xca16b7ff<br />W75 &#x3D; 0xa675a007<br />W76 &#x3D; 0x17b22d58<br />W77 &#x3D; 0x3defd669<br />W78 &#x3D; 0x4a141b9d<br />W79 &#x3D; 0x98376750</p>
<p>80轮运算<br />A &#x3D; 0x67452301 &#x3D; 0110 0111 0100 0101 0010 0011 0000 0001<br />B &#x3D; 0xEFCDAB89 &#x3D; 1110 1111 1100 1101 1010 1011 1000 1001<br />C &#x3D; 0x98BADCFE &#x3D; 1001 1000 1011 1010 1101 1100 1111 1110<br />D &#x3D; 0x10325476 &#x3D; 0001 0000 0011 0010 0101 0100 0111 0110<br />E &#x3D; 0xC3D2E1F0 &#x3D; 1100 0011 1101 0010 1110 0001 1111 0000</p>
<table>
<thead>
<tr>
<th><strong>计算轮次</strong></th>
<th><strong>计算的步数</strong></th>
<th><strong>计算函数</strong></th>
<th><strong>计算常数</strong></th>
</tr>
</thead>
<tbody><tr>
<td>第一轮</td>
<td>0≤t≤19步</td>
<td>ft(B,C,D)&#x3D;(B&amp;C)&amp;#124;(~B&amp;D)</td>
<td>_K_t&#x3D;0x5A827999</td>
</tr>
<tr>
<td>第二轮</td>
<td>20≤t≤39步</td>
<td>ft(B,C,D)&#x3D;B⊕C⊕D</td>
<td>_K_t&#x3D;0x6ED9EBA1</td>
</tr>
<tr>
<td>第三轮</td>
<td>40≤t≤59步</td>
<td>ft(B,C,D)&#x3D;(B&amp;C)&amp;#124;(B&amp;D)&amp;#124;(C&amp;D)</td>
<td>_K_t&#x3D;0x8F188CDC</td>
</tr>
<tr>
<td>第四轮</td>
<td>60≤t≤79步</td>
<td>ft(B,C,D)&#x3D;B⊕C⊕D</td>
<td>_K_t&#x3D;0xCA62C1D6</td>
</tr>
</tbody></table>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220705/06.webp"
                     
                ><br><br />第一轮第一步<br />A&lt;&lt;&lt;5 &#x3D;&#x3D;&gt; 1110 1000 1010 0100 0110 0000 0010 1100<br />B&amp;C &#x3D; 1000 1000 1000 1000 1000 1000 1000 1000<br /><del>B&amp;D&#x3D; 0001 0000 0011 0010 0101 0100 0111 0110<br />ft(B,C,D) &#x3D; (B&amp;C)|(</del>B&amp;D) &#x3D; 1001 1000 1011 1010 1101 1100 1111 1110<br />H0 &#x3D; 0x2D3E4D1EA（保留末8位）&#x3D; 0x D3E4D1EA<br />H1 &#x3D; 0x67452301<br />H2 &#x3D; 0x7BF36AE2<br />H3 &#x3D; 0x98BADCFE<br />H4 &#x3D; 0x10325476<br />把H0-H4重新赋值给A,B,C,D,E<br />A &#x3D; H0<br />B &#x3D; H1<br />C &#x3D; H2<br />D &#x3D; H3<br />E &#x3D; H4<br />…<br />第80轮<br />A &#x3D; 0x135B4514 &#x3D; 0001 0011 0101 1011 0100 0101 0001 0100<br />B &#x3D; 0xCE03E912 &#x3D; 1100 1110 0000 0011 1110 1001 0001 0010<br />C &#x3D; 0xD50D5F9A &#x3D; 1101 0101 0000 1101 0101 1111 1001 1010<br />D &#x3D; 0xD940C253 &#x3D; 1101 1001 0100 0000 1100 0010 0101 0011<br />E &#x3D; 0x36F72811 &#x3D; 0011 0110 1111 0111 0010 1000 0001 0001</p>
<p>A&lt;&lt;&lt;5 &#x3D; 0110 1011 0110 1000 1010 0010 1000 0010<br />ft(B,C,D)&#x3D;B⊕C⊕D &#x3D; 1100 0010 0100 1110 0111 0100 1101 1011<br />W79 &#x3D; 0x98376750<br />K79 &#x3D; 0xCA62C1D6<br />H0 &#x3D; 0xC7486894<br />H1 &#x3D;  0x135B4514<br />H2 &#x3D; 1011 0011 1000 0000 1111 1010 0100 0100 &#x3D; 0xB380FA44<br />H3 &#x3D; 0xD50D5F9A<br />H4 &#x3D; 0xD940C253 </p>
<p>最后的H0-H4要加上一开始的模值<br />a &#x3D; H0+A &#x3D; 0x2E8D8B95<br />b &#x3D; H1+B &#x3D;0x0328F09D<br />c &#x3D; H2+C &#x3D; 0x4C3BD742<br />d &#x3D; H3+D &#x3D; 0xE53FB410<br />e &#x3D; H4+E &#x3D; 0x9D13A443<br />abcde &#x3D; 2E8D8B950328F09D4C3BD742E53FB4109D13A443<br />              2e8d8b950328f09d4c3bd742e53fb4109d13a443<br />结果一致</p>
<h3 id="python实现sha1"><a href="#python实现sha1" class="headerlink" title="python实现sha1"></a>python实现sha1</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 0xffffffff is used to make sure numbers dont go over 32</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chunks</span>(<span class="params">messageLength, chunkSize</span>):</span><br><span class="line">    chunkValues = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(messageLength), chunkSize):</span><br><span class="line">        chunkValues.append(messageLength[i:i + chunkSize])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> chunkValues</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leftRotate</span>(<span class="params">chunk, rotateLength</span>):</span><br><span class="line">    <span class="keyword">return</span> ((chunk &lt;&lt; rotateLength) | (chunk &gt;&gt; (<span class="number">32</span> - rotateLength))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sha1Function</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="comment"># initial hash values</span></span><br><span class="line">    h0 = <span class="number">0x67452301</span></span><br><span class="line">    h1 = <span class="number">0xEFCDAB89</span></span><br><span class="line">    h2 = <span class="number">0x98BADCFE</span></span><br><span class="line">    h3 = <span class="number">0x10325476</span></span><br><span class="line">    h4 = <span class="number">0xC3D2E1F0</span></span><br><span class="line"></span><br><span class="line">    messageLength = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># preprocessing</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message)):</span><br><span class="line">        messageLength += <span class="string">&#x27;&#123;0:08b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">ord</span>(message[char]))</span><br><span class="line"></span><br><span class="line">    temp = messageLength</span><br><span class="line">    messageLength += <span class="string">&#x27;1&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">len</span>(messageLength) % <span class="number">512</span> != <span class="number">448</span>):</span><br><span class="line">        messageLength += <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">    messageLength += <span class="string">&#x27;&#123;0:064b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">len</span>(temp))</span><br><span class="line">    chunk = chunks(messageLength, <span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> eachChunk <span class="keyword">in</span> chunk:</span><br><span class="line">        words = chunks(eachChunk, <span class="number">32</span>)</span><br><span class="line">        w = [<span class="number">0</span>] * <span class="number">80</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">            w[n] = <span class="built_in">int</span>(words[n], <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>, <span class="number">80</span>):</span><br><span class="line">            <span class="comment"># sha1</span></span><br><span class="line">            w[i] = leftRotate((w[i - <span class="number">3</span>] ^ w[i - <span class="number">8</span>] ^ w[i - <span class="number">14</span>] ^ w[i - <span class="number">16</span>]), <span class="number">1</span>)</span><br><span class="line">            <span class="comment"># sha0</span></span><br><span class="line">            <span class="comment"># w[i] = (w[i - 3] ^ w[i - 8] ^ w[i - 14] ^ w[i - 16])</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Initialize hash value for this chunk:</span></span><br><span class="line">        a = h0</span><br><span class="line">        b = h1</span><br><span class="line">        c = h2</span><br><span class="line">        d = h3</span><br><span class="line">        e = h4</span><br><span class="line"></span><br><span class="line">        <span class="comment"># main loop:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">80</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="number">0</span> &lt;= i &lt;= <span class="number">19</span>:</span><br><span class="line">                f = (b &amp; c) | ((~b) &amp; d)</span><br><span class="line">                k = <span class="number">0x5A827999</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="number">20</span> &lt;= i &lt;= <span class="number">39</span>:</span><br><span class="line">                f = b ^ c ^ d</span><br><span class="line">                k = <span class="number">0x6ED9EBA1</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="number">40</span> &lt;= i &lt;= <span class="number">59</span>:</span><br><span class="line">                f = (b &amp; c) | (b &amp; d) | (c &amp; d)</span><br><span class="line">                k = <span class="number">0x8F1BBCDC</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">elif</span> <span class="number">60</span> &lt;= i &lt;= <span class="number">79</span>:</span><br><span class="line">                f = b ^ c ^ d</span><br><span class="line">                k = <span class="number">0xCA62C1D6</span></span><br><span class="line"></span><br><span class="line">            a, b, c, d, e = ((leftRotate(a, <span class="number">5</span>) + f + e + k + w[i]) &amp; <span class="number">0xffffffff</span>, a, leftRotate(b, <span class="number">30</span>), c, d)</span><br><span class="line"></span><br><span class="line">        h0 = h0 + a &amp; <span class="number">0xffffffff</span></span><br><span class="line">        h1 = h1 + b &amp; <span class="number">0xffffffff</span></span><br><span class="line">        h2 = h2 + c &amp; <span class="number">0xffffffff</span></span><br><span class="line">        h3 = h3 + d &amp; <span class="number">0xffffffff</span></span><br><span class="line">        h4 = h4 + e &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;%08x%08x%08x%08x%08x&#x27;</span> % (h0, h1, h2, h3, h4)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    plainText = <span class="string">&quot;409732112&quot;</span></span><br><span class="line">    sha1Hash = sha1Function(plainText)</span><br><span class="line">    <span class="built_in">print</span>(sha1Hash)</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>MD5源码分析及流程</title>
    <url>/2022/06/20/MD5%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90%E5%8F%8A%E6%B5%81%E7%A8%8B/</url>
    <content><![CDATA[<h1 id="MD5算法实现："><a href="#MD5算法实现：" class="headerlink" title="MD5算法实现："></a>MD5算法实现：</h1><p>输入：不定长度信息（要加密的信息）</p>
<p>输出：固定长度128-bits。由四个32位分组组成，将这四个32位分组级联后将生成一个128位散列值。</p>
<p>基本方式为：求余、取余、调整长度、与链接变量进行循环运算。得出结果。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220620/01.webp"
                     
                ></p>
<br>

<h2 id="填充"><a href="#填充" class="headerlink" title="填充"></a>填充</h2><p>在MD5算法中，首先需要对输入信息进行填充，使其位长对512求余的结果等于448，并且填充必须进行，即使其位长对512求余的结果等于448。因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。</p>
<p>填充的方法如下：</p>
<ol>
<li>在信息的后面<font color="red">填充一个1和无数个0</font>，直到满足上面的条件时才停止用0对信息的填充。</li>
<li>在这个结果后面<font color="red">附加一个以64位二进制表示的填充前信息长度（明文的长度，单位为Bit）</font>，如果二进制表示的填充前信息长度超过64位，则取低64位</li>
</ol>
<p>经过这两步的处理，信息的位长&#x3D;N<em>512+448+64&#x3D;(N+1）</em>512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。</p>
<br>

<h2 id="初始化变量（变量值一般不变）"><a href="#初始化变量（变量值一般不变）" class="headerlink" title="初始化变量（变量值一般不变）"></a>初始化变量（变量值一般不变）</h2><p>初始的128位值为初试<font color="red">链接变量</font>，这些参数用于第一轮的运算，以<font color="red">大端字节序</font>来表示，他们分别为： </p>
<p>A&#x3D;0x01234567，</p>
<p>B&#x3D;0x89ABCDEF，</p>
<p>C&#x3D;0xFEDCBA98，</p>
<p>D&#x3D;0x76543210。</p>
<p>（每一个变量给出的数值是高字节存于内存低地址，低字节存于内存高地址，即大端字节序。在程序中变量A、B、C、D的值分别为0x67452301，0xEFCDAB89，0x98BADCFE，0x10325476）</p>
<br>

<h2 id="处理分组数据"><a href="#处理分组数据" class="headerlink" title="处理分组数据"></a>处理分组数据</h2><font color="red">

<p>消息分以512位为一分组进行处理，每一个分组进行上述4轮共64次计算后，将A，B，C，D分别加上计算得到的a，b，c，d。当做新的A，B，C，D，并将这4个变量赋值给a,b,c,d再进行下一分组的运算。由于填充后的消息长度为(N+1)*512，则共需计算N+1个分组。计算所有数据分组后，这4个变量为最后的结果，即MD5值。<br></font></p>
<br>

<p>每一分组的算法流程如下：</p>
<p>（1）第一分组需要将上面四个链接变量复制到另外四个变量中：A到a，B到b，C到c，D到d。</p>
<p>（2）从第二分组开始的变量为上一分组的运算结果，即A &#x3D; a， B &#x3D; b， C &#x3D; c， D &#x3D; d。</p>
<p>主循环有四轮（MD4只有三轮），每轮循环都很相似。第一轮进行16次操作。每次操作对a、b、c和d中的其中三个作一次非线性函数运算，然后将所得结果加上第四个变量，文本的一个子分组和一个常数。再将所得结果向左环移一个不定的数，并加上a、b、c或d中之一。最后用该结果取代a、b、c或d中之一。</p>
<br>

<p>一个MD5运算由类似的64次循环构成，分成4组16次。</p>
<p>F ：一个非线性函数，一个函数运算一次</p>
<p>Mi ：表示一个 32-bits 的输入数据</p>
<p>Ki：表示一个 32-bits 常数，用来完成每次不同的计算。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220620/02.webp"
                     
                ></p>
<p>说明：</p>
<font color="red">

<p>( (a + 线性函数(b,c,d) + Mj + Ki) &lt;&lt; s) + a &#x3D;&#x3D; B<br></font></p>
<br>

<p>以下是每次操作中用到的四个非线性函数（<font color="red">每轮一个</font>）。</p>
<p>F( X ,Y ,Z ) &#x3D; ( X &amp; Y ) | ( (~X) &amp; Z )  &#x3D;&#x3D;&gt; If X then Y else Z</p>
<p>G( X ,Y ,Z ) &#x3D; ( X &amp; Z ) | ( Y &amp; (~Z) )  &#x3D;&#x3D;&gt; If Z then X else Y</p>
<p>H( X ,Y ,Z ) &#x3D;X ^ Y ^ Z  &#x3D;&#x3D;&gt; If X&#x3D;Y then Z else ~Z</p>
<p>I( X ,Y ,Z ) &#x3D;Y ^ ( X | (~Z) )</p>
<p>（&amp;是与（And），|是或（Or），~是非（Not），^是异或（Xor））</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>与</td>
<td>两个位都为1时，结果才为1</td>
</tr>
<tr>
<td>|</td>
<td>或</td>
<td>两个位都为0时，结果才为0</td>
</tr>
<tr>
<td>^</td>
<td>异或</td>
<td>两个位相同为0，相异为1</td>
</tr>
<tr>
<td>~</td>
<td>取反</td>
<td>0变1，1变0</td>
</tr>
<tr>
<td>&lt;&lt;&lt;</td>
<td>循环左移</td>
<td>将移出的低位放到该数的高位</td>
</tr>
</tbody></table>
<p><br>循环左移:</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220620/03.webp"
                     
                ></p>
<p>这四个函数的说明：如果X、Y和Z的对应位是独立和均匀的，那么结果的每一位也应是独立和均匀的。</br><br>F是一个逐位运算的函数。即，如果X，那么Y，否则Z。函数H是逐位奇偶操作符。</br><br>假设Mj表示消息的第j个子分组（从0到15），常数ti是4294967296*abs( sin(i) ）的整数部分，i 取值从1到64，单位是弧度。（4294967296&#x3D;2^(32)）</p>
</br>
现定义：</br>
FF(a ,b ,c ,d ,Mj ,s ,ti ) 操作为 a = b + ( (a + F(b,c,d) + Mj + ti) << s)</br>
GG(a ,b ,c ,d ,Mj ,s ,ti ) 操作为 a = b + ( (a + G(b,c,d) + Mj + ti) << s)</br>
HH(a ,b ,c ,d ,Mj ,s ,ti) 操作为 a = b + ( (a + H(b,c,d) + Mj + ti) << s)</br>
II(a ,b ,c ,d ,Mj ,s ,ti) 操作为 a = b + ( (a + I(b,c,d) + Mj + ti) << s)</br>
<br>

<p><strong><font color="red">注意：“&lt;&lt;&lt;”表示循环左移位，不是左移位</font></strong></p>
</br>

<p><strong>K表</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>, <span class="number">0xf57c0faf</span>,</span><br><span class="line"> <span class="number">0x4787c62a</span>, <span class="number">0xa8304613</span>, <span class="number">0xfd469501</span>, <span class="number">0x698098d8</span>, <span class="number">0x8b44f7af</span>,</span><br><span class="line"> <span class="number">0xffff5bb1</span>, <span class="number">0x895cd7be</span>, <span class="number">0x6b901122</span>, <span class="number">0xfd987193</span>, <span class="number">0xa679438e</span>,</span><br><span class="line"> <span class="number">0x49b40821</span>, <span class="number">0xf61e2562</span>, <span class="number">0xc040b340</span>, <span class="number">0x265e5a51</span>, <span class="number">0xe9b6c7aa</span>,</span><br><span class="line"> <span class="number">0xd62f105d</span>, <span class="number">0x2441453</span>, <span class="number">0xd8a1e681</span>, <span class="number">0xe7d3fbc8</span>, <span class="number">0x21e1cde6</span>,</span><br><span class="line"> <span class="number">0xc33707d6</span>, <span class="number">0xf4d50d87</span>, <span class="number">0x455a14ed</span>, <span class="number">0xa9e3e905</span>, <span class="number">0xfcefa3f8</span>,</span><br><span class="line"> <span class="number">0x676f02d9</span>, <span class="number">0x8d2a4c8a</span>, <span class="number">0xfffa3942</span>, <span class="number">0x8771f681</span>, <span class="number">0x6d9d6122</span>,</span><br><span class="line"> <span class="number">0xfde5380c</span>, <span class="number">0xa4beea44</span>, <span class="number">0x4bdecfa9</span>, <span class="number">0xf6bb4b60</span>, <span class="number">0xbebfbc70</span>,</span><br><span class="line"> <span class="number">0x289b7ec6</span>, <span class="number">0xeaa127fa</span>, <span class="number">0xd4ef3085</span>, <span class="number">0x4881d05</span>, <span class="number">0xd9d4d039</span>,</span><br><span class="line"> <span class="number">0xe6db99e5</span>, <span class="number">0x1fa27cf8</span>, <span class="number">0xc4ac5665</span>, <span class="number">0xf4292244</span>, <span class="number">0x432aff97</span>,</span><br><span class="line"> <span class="number">0xab9423a7</span>, <span class="number">0xfc93a039</span>, <span class="number">0x655b59c3</span>, <span class="number">0x8f0ccc92</span>, <span class="number">0xffeff47d</span>,</span><br><span class="line"> <span class="number">0x85845dd1</span>, <span class="number">0x6fa87e4f</span>, <span class="number">0xfe2ce6e0</span>, <span class="number">0xa3014314</span>, <span class="number">0x4e0811a1</span>,</span><br><span class="line"> <span class="number">0xf7537e82</span>, <span class="number">0xbd3af235</span>, <span class="number">0x2ad7d2bb</span>, <span class="number">0xeb86d391</span>]</span><br></pre></td></tr></table></figure>
</br>
这四轮（共64步）是：</br>
第一轮</br>
FF(a ,b ,c ,d ,M0 ,7 ,0xd76aa478 )</br>
FF(d ,a ,b ,c ,M1 ,12 ,0xe8c7b756 )</br>
FF(c ,d ,a ,b ,M2 ,17 ,0x242070db )</br>
FF(b ,c ,d ,a ,M3 ,22 ,0xc1bdceee )</br>
FF(a ,b ,c ,d ,M4 ,7 ,0xf57c0faf )</br>
FF(d ,a ,b ,c ,M5 ,12 ,0x4787c62a )</br>
FF(c ,d ,a ,b ,M6 ,17 ,0xa8304613 )</br>
FF(b ,c ,d ,a ,M7 ,22 ,0xfd469501)</br>
FF(a ,b ,c ,d ,M8 ,7 ,0x698098d8 )</br>
FF(d ,a ,b ,c ,M9 ,12 ,0x8b44f7af )</br>
FF(c ,d ,a ,b ,M10 ,17 ,0xffff5bb1 )</br>
FF(b ,c ,d ,a ,M11 ,22 ,0x895cd7be )</br>
FF(a ,b ,c ,d ,M12 ,7 ,0x6b901122 )</br>
FF(d ,a ,b ,c ,M13 ,12 ,0xfd987193 )</br>
FF(c ,d ,a ,b ,M14 ,17 ,0xa679438e )</br>
FF(b ,c ,d ,a ,M15 ,22 ,0x49b40821 )</br>

</br>
第二轮</br>
GG(a ,b ,c ,d ,M1 ,5 ,0xf61e2562 )</br>
GG(d ,a ,b ,c ,M6 ,9 ,0xc040b340 )</br>
GG(c ,d ,a ,b ,M11 ,14 ,0x265e5a51 )</br>
GG(b ,c ,d ,a ,M0 ,20 ,0xe9b6c7aa )</br>
GG(a ,b ,c ,d ,M5 ,5 ,0xd62f105d )</br>
GG(d ,a ,b ,c ,M10 ,9 ,0x02441453 )</br>
GG(c ,d ,a ,b ,M15 ,14 ,0xd8a1e681 )</br>
GG(b ,c ,d ,a ,M4 ,20 ,0xe7d3fbc8 )</br>
GG(a ,b ,c ,d ,M9 ,5 ,0x21e1cde6 )</br>
GG(d ,a ,b ,c ,M14 ,9 ,0xc33707d6 )</br>
GG(c ,d ,a ,b ,M3 ,14 ,0xf4d50d87 )</br>
GG(b ,c ,d ,a ,M8 ,20 ,0x455a14ed )</br>
GG(a ,b ,c ,d ,M13 ,5 ,0xa9e3e905 )</br>
GG(d ,a ,b ,c ,M2 ,9 ,0xfcefa3f8 )</br>
GG(c ,d ,a ,b ,M7 ,14 ,0x676f02d9 )</br>
GG(b ,c ,d ,a ,M12 ,20 ,0x8d2a4c8a} </br>
</br>
第三轮</br>
HH(a ,b ,c ,d ,M5 ,4 ,0xfffa3942 )</br>
HH(d ,a ,b ,c ,M8 ,11 ,0x8771f681 )</br>
HH(c ,d ,a ,b ,M11 ,16 ,0x6d9d6122 )</br>
HH(b ,c ,d ,a ,M14 ,23 ,0xfde5380c )</br>
HH(a ,b ,c ,d ,M1 ,4 ,0xa4beea44 )</br>
HH(d ,a ,b ,c ,M4 ,11 ,0x4bdecfa9 )</br>
HH(c ,d ,a ,b ,M7 ,16 ,0xf6bb4b60 )</br>
HH(b ,c ,d ,a ,M10 ,23 ,0xbebfbc70 }</br>
HH(a ,b ,c ,d ,M13 ,4 ,0x289b7ec6 )</br>
HH(d ,a ,b ,c ,M0 ,11 ,0xeaa127fa )</br>
HH(c ,d ,a ,b ,M3 ,16 ,0xd4ef3085 )</br>
HH(b ,c ,d ,a ,M6 ,23 ,0x04881d05 )</br>
HH(a ,b ,c ,d ,M9 ,4 ,0xd9d4d039 )</br>
HH(d ,a ,b ,c ,M12 ,11 ,0xe6db99e5 )</br>
HH(c ,d ,a ,b ,M15 ,16 ,0x1fa27cf8 )</br>
HH(b ,c ,d ,a ,M2 ,23 ,0xc4ac5665 )</br></br>
第四轮</br>
II(a ,b ,c ,d ,M0 ,6 ,0xf4292244 )</br>
II(d ,a ,b ,c ,M7 ,10 ,0x432aff97 )</br>
II(c ,d ,a ,b ,M14 ,15 ,0xab9423a7 )</br>
II(b ,c ,d ,a ,M5 ,21 ,0xfc93a039 )</br>
II(a ,b ,c ,d ,M12 ,6 ,0x655b59c3 )</br>
II(d ,a ,b ,c ,M3 ,10 ,0x8f0ccc92 )</br>
II(c ,d ,a ,b ,M10 ,15 ,0xffeff47d )</br>
II(b ,c ,d ,a ,M1 ,21 ,0x85845dd1 )</br>
II(a ,b ,c ,d ,M8 ,6 ,0x6fa87e4f )</br>
II(d ,a ,b ,c ,M15 ,10 ,0xfe2ce6e0 )</br>
II(c ,d ,a ,b ,M6 ,15 ,0xa3014314 )</br>
II(b ,c ,d ,a ,M13 ,21 ,0x4e0811a1 )</br>
II(a ,b ,c ,d ,M4 ,6 ,0xf7537e82 )</br>
II(d ,a ,b ,c ,M11 ,10 ,0xbd3af235 )</br>
II(c ,d ,a ,b ,M2 ,15 ,0x2ad7d2bb )</br>
II(b ,c ,d ,a ,M9 ,21 ,0xeb86d391 )</br>

</br>

<p>所有这些完成之后，将a、b、c、d分别在原来基础上再加上A、B、C、D。</br><br>即a &#x3D; a + A，b &#x3D; b + B，c &#x3D; c + C，d &#x3D; d + D</br><br>然后用下一分组数据继续运行以上算法。</br></p>
<h2 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h2><p>最后的输出是a、b、c和d的<font color="red">大端法</font>级联。</p>
</br>

<h2 id="例子：123456-进行md5"><a href="#例子：123456-进行md5" class="headerlink" title="例子：123456 进行md5"></a>例子：123456 进行md5</h2><p>123456&#x3D;&#x3D;&gt;ASCII   31 32 33 34 35 36</br><br>转为二进制就是 4*12 &#x3D; 48bit</br><br>31 &#x3D;&#x3D;&gt; 0011 0001</br><br>32 &#x3D;&#x3D;&gt; 0011 0010</br><br>33 &#x3D;&#x3D;&gt; 0011 0011</br><br>34 &#x3D;&#x3D;&gt; 0011 0100</br><br>35 &#x3D;&#x3D;&gt; 0011 0101</br><br>36 &#x3D;&#x3D;&gt; 0011 0110</br></br><br>48bit填充1000….到448bit 填充1个1和399个0</br><br>0011 0001 0011 0010 0011 0011 0011 0100 0011 0101 0011 0110  1000000….</br><br>对应16进制</br><br>31 32 33 34 35 36 80 …..（98个0）</br><br>512bit - 448bit &#x3D; 64bit</br><br>留的那64比特长度，用于填充长度信息，长度单位为比特</br><br>64bit附加长度信息 （就是明文对应16进制的长度）</br><br>00  …. 48（60个0）以<font color="red">小端法</font>存放&#x3D;&#x3D;》 48 00 … 00</br><br>明文48bit+填充（10…）400bit+长度信息（48 00..）64bit &#x3D; 512bit</br><br>31 32 33 34 35 36 80 00 … 30 00 ..</br><br>512bit &#x2F; 4 &#x3D; 128位16进制</br><br>128分16组 &#x3D; 8位 （每组8位）</br><br>M1 &#x3D;&#x3D;&gt; 31 32 33 34 </br><br>M2 &#x3D;&#x3D;&gt; 35 36 80 00</br><br>M3 &#x3D;&#x3D;&gt; 00 00 00 00   </br><br>…</br></br><br>M15 &#x3D;&#x3D;&gt; 30 00 00 00</br><br>M16 &#x3D;&#x3D;&gt; 00 00 00 00</br></br><br>初始值变量</br><br>A&#x3D;0x 01 23 45 67，</br><br>B&#x3D;0x 89 AB CD EF，</br><br>C&#x3D;0x FE DC BA 98，</br><br>D&#x3D;0x 76 54 32 10。</br></br><br>以小端法存储</br><br>A &#x3D;&#x3D;&gt; 0x 67 45 23 01</br><br>B &#x3D;&#x3D;&gt; 0x EF CD AB 89</br><br>C &#x3D;&#x3D;&gt; 0x 98 BA DC FE</br><br>D &#x3D;&#x3D;&gt; 0x 10 32 54 76</br></br><br>二进制</br><br>A &#x3D;&gt; 0110 0111 0100 0101 0011 0010 0000 0001</br><br>B &#x3D;&gt; 1110 1111 1100 1101 1010 1011 1000 1001</br><br>C &#x3D;&gt; 1001 1000 1011 1010 1101 1100 1111 1110</br><br>D &#x3D;&gt; 0001 0000 0011 0010 0101 0100 0111 0110</br></br><br>第一轮第一步</br><br>FF(a ,b ,c ,d ,M0 ,7 ,0xd76aa478 )</br><br>b + ( (a + F(b,c,d) + Mj + Ki) &lt;&lt; s)</br><br>F(b,c,d)  &#x3D;&#x3D; &gt;  ( X &amp; Y ) | ( (~X) &amp; Z )  &#x3D;&#x3D;&gt; If X then Y else Z</br><br></br>F(b,c,d)  &#x3D;&#x3D;&gt; 1001 1000 1011 1010 1101 1100 1111 1110 &#x3D;&#x3D;&gt; 98 BA DC FE</br><br>+a &#x3D;&gt; 98 BA DC FE + 67 45 23 01 &#x3D;&gt; FF FF FF FF</br></p>
<p>M1 &#x3D; 31 32 33 34 小端法 &#x3D;&gt; 34 33 32 31</br><br>+M1 &#x3D;&gt; FF FF FF FF + 34 33 32 31  &#x3D;&gt; 34 33 32 30 (只保留低8位)</br><br></br><br>+Ki&#x3D;&#x3D;&gt; 34 33 32 30 + D7 6A A4 78 &#x3D;&gt; 0B 9D D6 A8 &#x3D;&#x3D;&gt; 0000 1011 1001 1101 1101 0110 1010 1000</br><br></br><br>&lt;&lt;&lt;s(7)</br><br>&#x3D;&#x3D;&gt; 0011 1011 1010 1101 0101 0000 0001 0111 &#x3D;&#x3D;&gt; CE EB 54 05</br></br></p>
<p>+b</br><br>&#x3D;&#x3D;&gt; CE EB 54 05 + EF CD AB 89 &#x3D;&#x3D;&gt; BE B8 FF 8E</br></br></p>
<p>第一轮后</br><br>a &#x3D;&#x3D;&gt; 0x 10 32 54 76</br><br>b &#x3D;&#x3D;&gt; 0x DE B8 FF 8E</br><br>c &#x3D;&#x3D;&gt; 0x EF CD AB 89</br><br>d &#x3D;&#x3D;&gt; 0x 98 BA DC FE</br><br>…</br></br><br>第64轮</br><br>a &#x3D;&#x3D;&gt; 0x  B7 E8 71 AF &#x3D;&#x3D;&gt; 1011 0111 1110 1000 0111 0001 1010 1111</br><br>b &#x3D;&#x3D;&gt; 0x  BF 25 79 C0 &#x3D;&#x3D;&gt; 1011 1111 0010 0101 0111 1001 1100 0000</br><br>c &#x3D;&#x3D;&gt; 0x  2E 55 BB 7C &#x3D;&#x3D;&gt; 0010 1110 0101 0101 1011 1011 0111 1100</br><br>d &#x3D;&#x3D;&gt; 0x  D2 96 E7 E0 &#x3D;&#x3D;&gt; 1101 0010 1001 0110 1110 0111 1110 0000</br><br>b + ( (a + I(b,c,d) + Mj + ti) &lt;&lt; s)</br><br> I(b,c,d)  &#x3D;&#x3D;&gt; I( b ,c ,d ) &#x3D;c ^ ( b | (<del>d) ) &#x3D;&#x3D;&gt; </br><br>(</del>d) &#x3D;&#x3D;&gt; 0010 1101 0110 1001 0001 1000 0001 1111</br></br></p>
<p>b | (~d) &#x3D;&#x3D;&gt; 1011 1111 0110 1101 0111 1001 1101 1111</br></br></p>
<p>c ^ ( b | (~d) ) &#x3D;&#x3D;&gt; 1001 0001 0011 1000 1100 0010 1010 0011 &#x3D;&#x3D;&gt; 91 38 C2 A3</br></br></p>
<p>+a &#x3D;&#x3D;&gt; 0x 49 21 34 52 </br><br>M64 &#x3D; 0</br><br>+M64 &#x3D;&#x3D;&gt; 0x 49 21 34 52 </br><br>K64 &#x3D; 0x EB 86 D3 91</br><br>+K64 &#x3D;&#x3D;&gt; 0x 34 A8 07 E3 &#x3D;&#x3D;&gt; 0011 0100 1010 1000 0000 0111 1110 0011</br><br>s64 &#x3D; 21</br><br>&lt;&lt; s &#x3D;&#x3D;&gt; 1111 1100 0110 0110 1001 0101 0000 0000 &#x3D;&#x3D;&gt; 0x FC 66 95 00</br><br>+b &#x3D;&#x3D;&gt; 0x BB 8C 0E C0</br></br></p>
<p>a &#x3D;&#x3D; d &#x3D;&#x3D;0x  D2 96 E7 E0</br><br>b &#x3D;&#x3D;0x BB 8C 0E C0</br><br>c &#x3D;&#x3D; b &#x3D;&#x3D;0x  BF 25 79 C0</br><br>d &#x3D;&#x3D; c &#x3D;&#x3D;0x  2E 55 BB 7C</br></br></p>
<p>将a、b、c、d分别在原来基础上再加上A、B、C、D。</br><br>即a &#x3D; a + A，b &#x3D; b + B，c &#x3D; c + C，d &#x3D; d + D</br><br>a &#x3D; a + A &#x3D;&#x3D;&gt; 0x 39 DC 0A E1 &#x3D;&#x3D;&gt; 0x E1 0A DC 39</br><br>b &#x3D; b + B &#x3D;&#x3D;&gt; 0x AB 59 BA 49 &#x3D;&#x3D;&gt; 0x 49 BA 59 AB</br><br>c &#x3D; c + C &#x3D;&#x3D;&gt; 0x 57 E0 56 BE &#x3D;&#x3D;&gt; 0x BE 56 E0 57</br><br>d &#x3D; d + D &#x3D;&#x3D;&gt;0x 3E 88 0F F2 &#x3D;&#x3D;&gt; 0x F2 0F 88 3E</br></p>
<p>abcd &#x3D;&#x3D; E1 0A DC 39 49 BA 59 AB BE 56 E0 57 F2 0F 88 3E &#x3D;&gt; e10adc3949ba59abbe56e057f20f883e</br></br></p>
<h2 id="MD5相对MD4所作的改进："><a href="#MD5相对MD4所作的改进：" class="headerlink" title="MD5相对MD4所作的改进："></a>MD5相对MD4所作的改进：</h2><p>1.增加了第四轮. </br><br>2.每一步均有唯一的加法常数. </br><br>3.为减弱第二轮中函数G的对称性从(X&amp;Y)|(X&amp;Z)|(Y&amp;Z)变为(X&amp;Z)|(Y&amp;(~Z)) </br><br>4.第一步加上了上一步的结果,这将引起更快的雪崩效应. </br><br>5.改变了第二轮和第三轮中访问消息子分组的次序,使其更不相似.</br><br>6.近似优化了每一轮中的循环左移位移量以实现更快的雪崩效应.各轮的位移量互不相同.</br><br></br></p>
<h2 id="对明文编码"><a href="#对明文编码" class="headerlink" title="对明文编码"></a>对明文编码</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220620/04.webp"
                     
                ><br></br></p>
<h2 id="为什么是这些非线性函数？"><a href="#为什么是这些非线性函数？" class="headerlink" title="为什么是这些非线性函数？"></a><font color="red">为什么是这些非线性函数？</font></h2><p>Ø这没什么最优解，你也可以使用别的非线性函数，或者自己实现时把顺序颠倒</br><br>Ø但这可能会造成算法安全性下降，而且是你无法把控的部分，因为这部分内容的专业性非常强，属于密码学的内容</br></p>
</br>

<h2 id="为什么K表是这样，sin函数，或者说三角函数，在这儿扮演了怎样的角色？"><a href="#为什么K表是这样，sin函数，或者说三角函数，在这儿扮演了怎样的角色？" class="headerlink" title="为什么K表是这样，sin函数，或者说三角函数，在这儿扮演了怎样的角色？"></a><font color="red">为什么K表是这样，sin函数，或者说三角函数，在这儿扮演了怎样的角色？</font></h2><p>k表的生成是： Ki &#x3D; 2^32 x |sin i|</br><br>截取整数转16进制</br><br>例如：K1 &#x3D; 2^32 x |sin 1| &#x3D; 3614090360.2828…..</br><br>3614090360 &#x3D;&#x3D;&gt; D76AA478</br></br></p>
<h2 id="循环左移为什么是这样移？这个规定是为什么呢？-随机"><a href="#循环左移为什么是这样移？这个规定是为什么呢？-随机" class="headerlink" title="循环左移为什么是这样移？这个规定是为什么呢？(随机)"></a><font color="red">循环左移为什么是这样移？这个规定是为什么呢？(随机)</font></h2><p>我们只知道，本质上，它是为了更好的扩散和混淆，让明文和密文之间没有明显的对应和关联，但为什么这样做，可能是安全性上的考量</br><br>比如胎死腹中的sha0和被广泛使用的sha1，竟然只通过循环左移1位就解决了安全性的问题</br></br></p>
<h2 id="为什么是填充1个1和其余都是0，不是都是0"><a href="#为什么是填充1个1和其余都是0，不是都是0" class="headerlink" title="为什么是填充1个1和其余都是0，不是都是0"></a><font color="red">为什么是填充1个1和其余都是0，不是都是0</font></h2><p>加入输入 1000</br><br>填充都是0后 1000 0000</br><br>不知道明文是哪个了</br><br>填充1后 1000 1000</br><br>就可以区分出来</br></br></p>
<h2 id="大端、小端基础知识"><a href="#大端、小端基础知识" class="headerlink" title="大端、小端基础知识"></a>大端、小端基础知识</h2><p><a class="link"   href="https://zhuanlan.zhihu.com/p/316347205" >https://zhuanlan.zhihu.com/p/316347205<i class="fas fa-external-link-alt"></i></a></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220620/05.webp"
                     
                ></p>
</br>

<h2 id="python-md5"><a href="#python-md5" class="headerlink" title="python md5"></a>python md5</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os.path</span><br><span class="line"></span><br><span class="line">SV = [<span class="number">0xd76aa478</span>, <span class="number">0xe8c7b756</span>, <span class="number">0x242070db</span>, <span class="number">0xc1bdceee</span>, <span class="number">0xf57c0faf</span>,</span><br><span class="line">      <span class="number">0x4787c62a</span>, <span class="number">0xa8304613</span>, <span class="number">0xfd469501</span>, <span class="number">0x698098d8</span>, <span class="number">0x8b44f7af</span>,</span><br><span class="line">      <span class="number">0xffff5bb1</span>, <span class="number">0x895cd7be</span>, <span class="number">0x6b901122</span>, <span class="number">0xfd987193</span>, <span class="number">0xa679438e</span>,</span><br><span class="line">      <span class="number">0x49b40821</span>, <span class="number">0xf61e2562</span>, <span class="number">0xc040b340</span>, <span class="number">0x265e5a51</span>, <span class="number">0xe9b6c7aa</span>,</span><br><span class="line">      <span class="number">0xd62f105d</span>, <span class="number">0x2441453</span>, <span class="number">0xd8a1e681</span>, <span class="number">0xe7d3fbc8</span>, <span class="number">0x21e1cde6</span>,</span><br><span class="line">      <span class="number">0xc33707d6</span>, <span class="number">0xf4d50d87</span>, <span class="number">0x455a14ed</span>, <span class="number">0xa9e3e905</span>, <span class="number">0xfcefa3f8</span>,</span><br><span class="line">      <span class="number">0x676f02d9</span>, <span class="number">0x8d2a4c8a</span>, <span class="number">0xfffa3942</span>, <span class="number">0x8771f681</span>, <span class="number">0x6d9d6122</span>,</span><br><span class="line">      <span class="number">0xfde5380c</span>, <span class="number">0xa4beea44</span>, <span class="number">0x4bdecfa9</span>, <span class="number">0xf6bb4b60</span>, <span class="number">0xbebfbc70</span>,</span><br><span class="line">      <span class="number">0x289b7ec6</span>, <span class="number">0xeaa127fa</span>, <span class="number">0xd4ef3085</span>, <span class="number">0x4881d05</span>, <span class="number">0xd9d4d039</span>,</span><br><span class="line">      <span class="number">0xe6db99e5</span>, <span class="number">0x1fa27cf8</span>, <span class="number">0xc4ac5665</span>, <span class="number">0xf4292244</span>, <span class="number">0x432aff97</span>,</span><br><span class="line">      <span class="number">0xab9423a7</span>, <span class="number">0xfc93a039</span>, <span class="number">0x655b59c3</span>, <span class="number">0x8f0ccc92</span>, <span class="number">0xffeff47d</span>,</span><br><span class="line">      <span class="number">0x85845dd1</span>, <span class="number">0x6fa87e4f</span>, <span class="number">0xfe2ce6e0</span>, <span class="number">0xa3014314</span>, <span class="number">0x4e0811a1</span>,</span><br><span class="line">      <span class="number">0xf7537e82</span>, <span class="number">0xbd3af235</span>, <span class="number">0x2ad7d2bb</span>, <span class="number">0xeb86d391</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据ascil编码把字符转成对应的二进制</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binvalue</span>(<span class="params">val, bitsize</span>):</span><br><span class="line">    binval = <span class="built_in">bin</span>(val)[<span class="number">2</span>:] <span class="keyword">if</span> <span class="built_in">isinstance</span>(val, <span class="built_in">int</span>) <span class="keyword">else</span> <span class="built_in">bin</span>(<span class="built_in">ord</span>(val))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(binval) &gt; bitsize:</span><br><span class="line">        <span class="keyword">raise</span> (<span class="string">&quot;binary value larger than the expected size&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(binval) &lt; bitsize:</span><br><span class="line">        binval = <span class="string">&quot;0&quot;</span> + binval</span><br><span class="line">    <span class="keyword">return</span> binval</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">string_to_bit_array</span>(<span class="params">text</span>):</span><br><span class="line">    array = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> text:</span><br><span class="line">        binval = binvalue(char, <span class="number">8</span>)</span><br><span class="line">        array.extend([<span class="built_in">int</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">list</span>(binval)])</span><br><span class="line">    <span class="keyword">return</span> array</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环左移</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leftCircularShift</span>(<span class="params">k, bits</span>):</span><br><span class="line">    bits = bits % <span class="number">32</span></span><br><span class="line">    k = k % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    upper = (k &lt;&lt; bits) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    result = upper | (k &gt;&gt; (<span class="number">32</span> - (bits)))</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 分块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">blockDivide</span>(<span class="params">block, chunks</span>):</span><br><span class="line">    result = []</span><br><span class="line">    size = <span class="built_in">len</span>(block) // chunks</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, chunks):</span><br><span class="line">        result.append(<span class="built_in">int</span>.from_bytes(block[i * size:(i + <span class="number">1</span>) * size], byteorder=<span class="string">&quot;little&quot;</span>))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># F函数作用于“比特位”上</span></span><br><span class="line"><span class="comment"># if x then y else z</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">return</span> ((X &amp; Y) | ((~X) &amp; Z))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if z then x else y</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">G</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">return</span> ((X &amp; Z) | (Y &amp; (~Z)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># if X = Y then Z else ~Z</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">H</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">return</span> (X ^ Y ^ Z)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">I</span>(<span class="params">X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">return</span> (Y ^ (X | (~Z)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 四个F函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FF</span>(<span class="params">a, b, c, d, M, s, t</span>):</span><br><span class="line">    result = b + leftCircularShift((a + F(b, c, d) + M + t), s)</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GG</span>(<span class="params">a, b, c, d, M, s, t</span>):</span><br><span class="line">    result = b + leftCircularShift((a + G(b, c, d) + M + t), s)</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HH</span>(<span class="params">a, b, c, d, M, s, t</span>):</span><br><span class="line">    result = b + leftCircularShift((a + H(b, c, d) + M + t), s)</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">II</span>(<span class="params">a, b, c, d, M, s, t</span>):</span><br><span class="line">    result = b + leftCircularShift((a + I(b, c, d) + M + t), s)</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据转换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fmt8</span>(<span class="params">num</span>):</span><br><span class="line">    bighex = <span class="string">&quot;&#123;0:08x&#125;&quot;</span>.<span class="built_in">format</span>(num)</span><br><span class="line">    binver = binascii.unhexlify(bighex)</span><br><span class="line">    result = <span class="string">&quot;&#123;0:08x&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>.from_bytes(binver, byteorder=<span class="string">&#x27;little&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> (result)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算比特长度</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bitlen</span>(<span class="params">bitstring</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(bitstring) * <span class="number">8</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5sum</span>(<span class="params">msg</span>):</span><br><span class="line">    <span class="comment"># 计算比特长度，如果内容过长，64个比特放不下。就取低64bit。</span></span><br><span class="line">    msgLen = bitlen(msg) % (<span class="number">2</span> ** <span class="number">64</span>)</span><br><span class="line">    <span class="comment"># 先填充一个0x80，其实是先填充一个1，后面跟对应个数的0，因为一个明文的编码至少需要8比特，所以直接填充 0b10000000即0x80</span></span><br><span class="line">    msg = msg + <span class="string">b&#x27;\x80&#x27;</span>  <span class="comment"># 0x80 = 1000 0000</span></span><br><span class="line">    <span class="comment"># 似乎各种编码，即使是一个字母，都至少得1个字节，即8bit才能表示，所以不会出现原文55bit，pad1就满足的情况？可是不对呀，要是二进制文件呢？</span></span><br><span class="line">    <span class="comment"># 填充0到满足要求为止。</span></span><br><span class="line">    zeroPad = (<span class="number">448</span> - (msgLen + <span class="number">8</span>) % <span class="number">512</span>) % <span class="number">512</span></span><br><span class="line">    zeroPad //= <span class="number">8</span></span><br><span class="line">    msg = msg + <span class="string">b&#x27;\x00&#x27;</span> * zeroPad + msgLen.to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">    <span class="comment"># 计算循环轮数，512个为一轮</span></span><br><span class="line">    msgLen = bitlen(msg)</span><br><span class="line">    iterations = msgLen // <span class="number">512</span></span><br><span class="line">    <span class="comment"># 初始化变量</span></span><br><span class="line">    <span class="comment"># 算法魔改的第一个点，也是最明显的点</span></span><br><span class="line">    A = <span class="number">0x67452301</span></span><br><span class="line">    B = <span class="number">0xefcdab89</span></span><br><span class="line">    C = <span class="number">0x98badcfe</span></span><br><span class="line">    D = <span class="number">0x10325476</span></span><br><span class="line">    <span class="comment"># MD5的主体就是对abcd进行n次的迭代，所以得有个初始值，可以随便选，也可以用默认的魔数，这个改起来毫无风险，所以大家爱魔改它，甚至改这个都不算魔改。</span></span><br><span class="line">    <span class="comment"># main loop</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, iterations):</span><br><span class="line">        a = A</span><br><span class="line">        b = B</span><br><span class="line">        c = C</span><br><span class="line">        d = D</span><br><span class="line">        block = msg[i * <span class="number">64</span>:(i + <span class="number">1</span>) * <span class="number">64</span>]</span><br><span class="line">        <span class="comment"># 明文的处理，顺便调整了一下端序</span></span><br><span class="line">        M = blockDivide(block, <span class="number">16</span>)</span><br><span class="line">        <span class="comment"># Rounds</span></span><br><span class="line">        a = FF(a, b, c, d, M[<span class="number">0</span>], <span class="number">7</span>, SV[<span class="number">0</span>])</span><br><span class="line">        d = FF(d, a, b, c, M[<span class="number">1</span>], <span class="number">12</span>, SV[<span class="number">1</span>])</span><br><span class="line">        c = FF(c, d, a, b, M[<span class="number">2</span>], <span class="number">17</span>, SV[<span class="number">2</span>])</span><br><span class="line">        b = FF(b, c, d, a, M[<span class="number">3</span>], <span class="number">22</span>, SV[<span class="number">3</span>])</span><br><span class="line">        a = FF(a, b, c, d, M[<span class="number">4</span>], <span class="number">7</span>, SV[<span class="number">4</span>])</span><br><span class="line">        d = FF(d, a, b, c, M[<span class="number">5</span>], <span class="number">12</span>, SV[<span class="number">5</span>])</span><br><span class="line">        c = FF(c, d, a, b, M[<span class="number">6</span>], <span class="number">17</span>, SV[<span class="number">6</span>])</span><br><span class="line">        b = FF(b, c, d, a, M[<span class="number">7</span>], <span class="number">22</span>, SV[<span class="number">7</span>])</span><br><span class="line">        a = FF(a, b, c, d, M[<span class="number">8</span>], <span class="number">7</span>, SV[<span class="number">8</span>])</span><br><span class="line">        d = FF(d, a, b, c, M[<span class="number">9</span>], <span class="number">12</span>, SV[<span class="number">9</span>])</span><br><span class="line">        c = FF(c, d, a, b, M[<span class="number">10</span>], <span class="number">17</span>, SV[<span class="number">10</span>])</span><br><span class="line">        b = FF(b, c, d, a, M[<span class="number">11</span>], <span class="number">22</span>, SV[<span class="number">11</span>])</span><br><span class="line">        a = FF(a, b, c, d, M[<span class="number">12</span>], <span class="number">7</span>, SV[<span class="number">12</span>])</span><br><span class="line">        d = FF(d, a, b, c, M[<span class="number">13</span>], <span class="number">12</span>, SV[<span class="number">13</span>])</span><br><span class="line">        c = FF(c, d, a, b, M[<span class="number">14</span>], <span class="number">17</span>, SV[<span class="number">14</span>])</span><br><span class="line">        b = FF(b, c, d, a, M[<span class="number">15</span>], <span class="number">22</span>, SV[<span class="number">15</span>])</span><br><span class="line"></span><br><span class="line">        a = GG(a, b, c, d, M[<span class="number">1</span>], <span class="number">5</span>, SV[<span class="number">16</span>])</span><br><span class="line">        d = GG(d, a, b, c, M[<span class="number">6</span>], <span class="number">9</span>, SV[<span class="number">17</span>])</span><br><span class="line">        c = GG(c, d, a, b, M[<span class="number">11</span>], <span class="number">14</span>, SV[<span class="number">18</span>])</span><br><span class="line">        b = GG(b, c, d, a, M[<span class="number">0</span>], <span class="number">20</span>, SV[<span class="number">19</span>])</span><br><span class="line">        a = GG(a, b, c, d, M[<span class="number">5</span>], <span class="number">5</span>, SV[<span class="number">20</span>])</span><br><span class="line">        d = GG(d, a, b, c, M[<span class="number">10</span>], <span class="number">9</span>, SV[<span class="number">21</span>])</span><br><span class="line">        c = GG(c, d, a, b, M[<span class="number">15</span>], <span class="number">14</span>, SV[<span class="number">22</span>])</span><br><span class="line">        b = GG(b, c, d, a, M[<span class="number">4</span>], <span class="number">20</span>, SV[<span class="number">23</span>])</span><br><span class="line">        a = GG(a, b, c, d, M[<span class="number">9</span>], <span class="number">5</span>, SV[<span class="number">24</span>])</span><br><span class="line">        d = GG(d, a, b, c, M[<span class="number">14</span>], <span class="number">9</span>, SV[<span class="number">25</span>])</span><br><span class="line">        c = GG(c, d, a, b, M[<span class="number">3</span>], <span class="number">14</span>, SV[<span class="number">26</span>])</span><br><span class="line">        b = GG(b, c, d, a, M[<span class="number">8</span>], <span class="number">20</span>, SV[<span class="number">27</span>])</span><br><span class="line">        a = GG(a, b, c, d, M[<span class="number">13</span>], <span class="number">5</span>, SV[<span class="number">28</span>])</span><br><span class="line">        d = GG(d, a, b, c, M[<span class="number">2</span>], <span class="number">9</span>, SV[<span class="number">29</span>])</span><br><span class="line">        c = GG(c, d, a, b, M[<span class="number">7</span>], <span class="number">14</span>, SV[<span class="number">30</span>])</span><br><span class="line">        b = GG(b, c, d, a, M[<span class="number">12</span>], <span class="number">20</span>, SV[<span class="number">31</span>])</span><br><span class="line"></span><br><span class="line">        a = HH(a, b, c, d, M[<span class="number">5</span>], <span class="number">4</span>, SV[<span class="number">32</span>])</span><br><span class="line">        d = HH(d, a, b, c, M[<span class="number">8</span>], <span class="number">11</span>, SV[<span class="number">33</span>])</span><br><span class="line">        c = HH(c, d, a, b, M[<span class="number">11</span>], <span class="number">16</span>, SV[<span class="number">34</span>])</span><br><span class="line">        b = HH(b, c, d, a, M[<span class="number">14</span>], <span class="number">23</span>, SV[<span class="number">35</span>])</span><br><span class="line">        a = HH(a, b, c, d, M[<span class="number">1</span>], <span class="number">4</span>, SV[<span class="number">36</span>])</span><br><span class="line">        d = HH(d, a, b, c, M[<span class="number">4</span>], <span class="number">11</span>, SV[<span class="number">37</span>])</span><br><span class="line">        c = HH(c, d, a, b, M[<span class="number">7</span>], <span class="number">16</span>, SV[<span class="number">38</span>])</span><br><span class="line">        b = HH(b, c, d, a, M[<span class="number">10</span>], <span class="number">23</span>, SV[<span class="number">39</span>])</span><br><span class="line">        a = HH(a, b, c, d, M[<span class="number">13</span>], <span class="number">4</span>, SV[<span class="number">40</span>])</span><br><span class="line">        d = HH(d, a, b, c, M[<span class="number">0</span>], <span class="number">11</span>, SV[<span class="number">41</span>])</span><br><span class="line">        c = HH(c, d, a, b, M[<span class="number">3</span>], <span class="number">16</span>, SV[<span class="number">42</span>])</span><br><span class="line">        b = HH(b, c, d, a, M[<span class="number">6</span>], <span class="number">23</span>, SV[<span class="number">43</span>])</span><br><span class="line">        a = HH(a, b, c, d, M[<span class="number">9</span>], <span class="number">4</span>, SV[<span class="number">44</span>])</span><br><span class="line">        d = HH(d, a, b, c, M[<span class="number">12</span>], <span class="number">11</span>, SV[<span class="number">45</span>])</span><br><span class="line">        c = HH(c, d, a, b, M[<span class="number">15</span>], <span class="number">16</span>, SV[<span class="number">46</span>])</span><br><span class="line">        b = HH(b, c, d, a, M[<span class="number">2</span>], <span class="number">23</span>, SV[<span class="number">47</span>])</span><br><span class="line"></span><br><span class="line">        a = II(a, b, c, d, M[<span class="number">0</span>], <span class="number">6</span>, SV[<span class="number">48</span>])</span><br><span class="line">        d = II(d, a, b, c, M[<span class="number">7</span>], <span class="number">10</span>, SV[<span class="number">49</span>])</span><br><span class="line">        c = II(c, d, a, b, M[<span class="number">14</span>], <span class="number">15</span>, SV[<span class="number">50</span>])</span><br><span class="line">        b = II(b, c, d, a, M[<span class="number">5</span>], <span class="number">21</span>, SV[<span class="number">51</span>])</span><br><span class="line">        a = II(a, b, c, d, M[<span class="number">12</span>], <span class="number">6</span>, SV[<span class="number">52</span>])</span><br><span class="line">        d = II(d, a, b, c, M[<span class="number">3</span>], <span class="number">10</span>, SV[<span class="number">53</span>])</span><br><span class="line">        c = II(c, d, a, b, M[<span class="number">10</span>], <span class="number">15</span>, SV[<span class="number">54</span>])</span><br><span class="line">        b = II(b, c, d, a, M[<span class="number">1</span>], <span class="number">21</span>, SV[<span class="number">55</span>])</span><br><span class="line">        a = II(a, b, c, d, M[<span class="number">8</span>], <span class="number">6</span>, SV[<span class="number">56</span>])</span><br><span class="line">        d = II(d, a, b, c, M[<span class="number">15</span>], <span class="number">10</span>, SV[<span class="number">57</span>])</span><br><span class="line">        c = II(c, d, a, b, M[<span class="number">6</span>], <span class="number">15</span>, SV[<span class="number">58</span>])</span><br><span class="line">        b = II(b, c, d, a, M[<span class="number">13</span>], <span class="number">21</span>, SV[<span class="number">59</span>])</span><br><span class="line">        a = II(a, b, c, d, M[<span class="number">4</span>], <span class="number">6</span>, SV[<span class="number">60</span>])</span><br><span class="line">        d = II(d, a, b, c, M[<span class="number">11</span>], <span class="number">10</span>, SV[<span class="number">61</span>])</span><br><span class="line">        c = II(c, d, a, b, M[<span class="number">2</span>], <span class="number">15</span>, SV[<span class="number">62</span>])</span><br><span class="line">        b = II(b, c, d, a, M[<span class="number">9</span>], <span class="number">21</span>, SV[<span class="number">63</span>])</span><br><span class="line">        A = (A + a) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        B = (B + b) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        C = (C + c) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        D = (D + d) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    result = fmt8(A) + fmt8(B) + fmt8(C) + fmt8(D)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    data = <span class="built_in">str</span>(<span class="string">&quot;123456&quot;</span>).encode(<span class="string">&quot;UTF-8&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;plainText: &quot;</span>, data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;result: &quot;</span>, md5sum(data))</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>Base64编码与解码源码分析</title>
    <url>/2022/06/14/Base64%E7%BC%96%E7%A0%81%E4%B8%8E%E8%A7%A3%E7%A0%81%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>Base64是一种基于64个可打印字符来表示二进制数据的表示方法，是一种编码方式，提及编码方式，必然有其对应的字符集合。在Base64编码中，相互映射的两个集合是：</p>
<ul>
<li><p>二进制数据{0, 1}</p>
</li>
<li><p>{A, B, C, D, E, F, G, H, I, J, K, L, M, N, O, P, Q, R, S, T, U, V, W, X, Y, Z, a, b, c, d, e, f, g, h, i, j, k, l, m, n, o, p, q, r, s, t, u, v, w, x, y, z, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, +, &#x2F;}</p>
</li>
</ul>
<p>Base64编码方式可使得信息在这两种字符集表示法之间相互等价转换。</p>
<br>

<h2 id="Base64编码过程"><a href="#Base64编码过程" class="headerlink" title="Base64编码过程"></a>Base64编码过程</h2><p>由于base64的字符集大小为64，那么，需要6个比特的二进制数作为一个基本单元表示一个base64字符集中的字符。因为6个比特有2^6&#x3D;64种排列组合。</p>
<p>具体来说，编码过程如下：</p>
<ol>
<li>将每三个字节作为一组，共24bit，若不足24bit在其后补充0；</li>
<li>将这24个bit分为4组，每一组6个bit；</li>
<li>在每组前加00扩展为8个bit，形成4个字节，每个字节表示base64字符集索引；</li>
<li>扩展后的8bit表示的整数作为索引，对应base64字符集的一个字符，这就是base64编码值；在处理最后的不足3字节时，缺一个字节索引字节取3个，最后填充一个&#x3D;，；缺两个字节取2个索引字节，最后填充&#x3D;&#x3D;。</li>
</ol>
<p>解码时将过程逆向即可。</p>
<p>Base64索引表：</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/01.webp"
                     
                ></p>
<br>

<h2 id="ASCII码表"><a href="#ASCII码表" class="headerlink" title="ASCII码表"></a>ASCII码表</h2><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/02.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/03.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/04.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/09.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/05.webp"
                     
                ></p>
<br>

<h2 id="编码示例"><a href="#编码示例" class="headerlink" title="编码示例"></a>编码示例</h2><h3 id="示例一"><a href="#示例一" class="headerlink" title="示例一"></a>示例一</h3><p>Man的base64编码</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/06.webp"
                     
                ></p>
<ol>
<li>第一步，’M’, ‘a’, ‘n’的ASCII值分别为77, 97, 110，对应的二进制值分别为：01001101, 01100001, 01101110；取三个字节共24bit：010011010110000101101110</li>
<li>第二步，将这24bit分为4组，每组6个bit：010011, 010110, 000101, 101110</li>
<li>每组前面加00，形成4个字节的，00010011, 00010110, 00000101, 00101110, 即19, 22, 5, 46</li>
<li>根据索引表，对应的base64字符分别是T, W, F, u<br>最后的base64字符串是: TWFu。</li>
</ol>
<p>解码时将过程逆向即可。</p>
<br>

<h3 id="示例二"><a href="#示例二" class="headerlink" title="示例二"></a>示例二</h3><p>剩余两个字节，BC的base64编码 </p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/07.webp"
                     
                ></p>
<ol>
<li>第一步，’B’, ‘C’的ASCII值分别为66, 64, 对应二进制值分别为：01000010, 01000011；取三个字节，不足不0，共24bit：01000010, 01000011, 00000000</li>
<li>第二步，将这24bit分为4组，每组6个bit：010000, 100100, 001100, 000000</li>
<li>每组前面加00，形成4个字节的，00010000, 00100100, 00001100, 00000000，即16, 36, 12, 0</li>
<li>由于’B’, ‘C’只有两个字节，缺一个字节，因此取3个索引；根据索引表，对应的base64字符分别是Q, k, M，最后填充一个&#x3D;</li>
</ol>
<p>最后的base64字符串是：QkM&#x3D;</p>
<br>

<h3 id="示例三"><a href="#示例三" class="headerlink" title="示例三"></a>示例三</h3><p>剩余一个字节，A的base64编码 </p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220614/08.webp"
                     
                ></p>
<ol>
<li>第一步，’A’的ASCII值65, 对应二进制值为：01000001; 取三个字节，不足不0，共24bit：01000001, 00000000, 00000000</li>
<li>第二步，将这24bit分为4组，每组6个bit：010000, 010000, 000000, 000000</li>
<li>每组前面加00，形成4个字节的，00010000, 00010000, 00000000, 00000000，即16, 16, 0, 0</li>
<li>由于’A’只有一个字节，缺两个字节，因此取2个索引；根据索引表，对应的base64字符分别是Q, Q，最后填充&#x3D;&#x3D;</li>
</ol>
<p> 最后的base64字符串是：QQ&#x3D;&#x3D;</p>
<br>

<h2 id="Python实现"><a href="#Python实现" class="headerlink" title="Python实现"></a>Python实现</h2><h3 id="base64编码方式一："><a href="#base64编码方式一：" class="headerlink" title="base64编码方式一："></a>base64编码方式一：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">base64实现</span></span><br><span class="line"><span class="string">encode: 先编码，十进制化(汉字在utf-8编码下占三个字节，在gbk编码下占两个字节)，再转二进制进行+0填充后合并，不足6的倍数继续填充，切片，十进制化查表，拼接,不足4的倍数填充=</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fillIt</span>(<span class="params">string, factor, item</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    指定倍数填充指定字符</span></span><br><span class="line"><span class="string">    string：原字符串</span></span><br><span class="line"><span class="string">    factor：倍数</span></span><br><span class="line"><span class="string">    item：填充字符</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    length = <span class="built_in">len</span>(string)</span><br><span class="line">    remainder = length % factor</span><br><span class="line">    <span class="keyword">if</span> remainder:</span><br><span class="line">        times = factor - remainder</span><br><span class="line">        string = string + times * item</span><br><span class="line">    <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">splitIt</span>(<span class="params">string, bits</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    指定位数切片</span></span><br><span class="line"><span class="string">    string：原字符串</span></span><br><span class="line"><span class="string">    bits：每次切片数量</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    length = <span class="built_in">len</span>(string)</span><br><span class="line">    new_list = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits, length + <span class="number">1</span>, bits):</span><br><span class="line">        new_list.append(string[i - bits:i])</span><br><span class="line">        remain = length % bits</span><br><span class="line">        <span class="keyword">if</span> remain != <span class="number">0</span>:</span><br><span class="line">            new_list.append(string[-remain:])</span><br><span class="line">    <span class="keyword">return</span> new_list</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">string</span>):</span><br><span class="line">    string_temp = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line">    <span class="comment"># 索引编码表</span></span><br><span class="line">    base64_dict = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span> ** <span class="number">6</span>):</span><br><span class="line">        base64_dict[i] = string_temp[i]</span><br><span class="line">        <span class="comment"># 编码</span></span><br><span class="line">    string_encode_byte = string.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="comment"># 十进制化</span></span><br><span class="line">    string_digit_list = <span class="built_in">list</span>(string_encode_byte)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 二进制化 + 0填充到8位</span></span><br><span class="line">    string_bin_list = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> string_digit_list:</span><br><span class="line">        string_bin_list.append(<span class="built_in">str</span>(<span class="built_in">bin</span>(item))[<span class="number">2</span>:].zfill(<span class="number">8</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 字符串合并</span></span><br><span class="line">    string_sum = <span class="string">&#x27;&#x27;</span>.join(string_bin_list)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 6 的倍数，不足 0 填充</span></span><br><span class="line">    string_fill = fillIt(string_sum, factor=<span class="number">6</span>, item=<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 切片，6位一个单位</span></span><br><span class="line">    string_bin_list2 = splitIt(string_fill, bits=<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 十进制化</span></span><br><span class="line">    string_digit_list2 = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> string_bin_list2:</span><br><span class="line">        string_digit_list2.append(<span class="built_in">int</span>(item, <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 查表</span></span><br><span class="line">    string_base64_list = []</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> string_digit_list2:</span><br><span class="line">        string_base64_list.append(base64_dict[item])</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 拼接</span></span><br><span class="line">    string_sum2 = <span class="string">&#x27;&#x27;</span>.join(string_base64_list)</span><br><span class="line">    <span class="comment"># 4 的倍数，不足填充 =</span></span><br><span class="line">    string_convert = fillIt(string_sum2, factor=<span class="number">4</span>, item=<span class="string">&#x27;=&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> string_convert</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="built_in">print</span>(encode(<span class="string">&quot;123啊a&quot;</span>))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="base64编码方式二："><a href="#base64编码方式二：" class="headerlink" title="base64编码方式二："></a>base64编码方式二：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">base64_charset = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encode</span>(<span class="params">string</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    将bytes类型编码为base64</span></span><br><span class="line"><span class="string">    :param string:需要编码的字符串</span></span><br><span class="line"><span class="string">    :return:base64字符串</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 对字符串转字节</span></span><br><span class="line">    origin_bytes = string.encode()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将每一位bytes转换为二进制字符串, &#x27;&#123;:0&gt;8&#125;&#x27;.format(str) 填充到8位</span></span><br><span class="line">    base64_bytes = [<span class="string">&#x27;&#123;:0&gt;8&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(<span class="built_in">bin</span>(b)).replace(<span class="string">&#x27;0b&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="keyword">for</span> b <span class="keyword">in</span> origin_bytes]</span><br><span class="line"></span><br><span class="line">    resp = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    nums = <span class="built_in">len</span>(base64_bytes) // <span class="number">3</span></span><br><span class="line">    remain = <span class="built_in">len</span>(base64_bytes) % <span class="number">3</span>  <span class="comment"># 余数</span></span><br><span class="line"></span><br><span class="line">    integral_part = base64_bytes[<span class="number">0</span>:<span class="number">3</span> * nums]  <span class="comment"># 取3的倍数分组</span></span><br><span class="line">    <span class="keyword">while</span> integral_part:</span><br><span class="line">        <span class="comment"># 取三个字节，以每6比特，转换为4个整数（直接转换位十进制，不填充到8位在转十进制）, 对码表进行查找</span></span><br><span class="line">        tmp_unit = <span class="string">&#x27;&#x27;</span>.join(integral_part[<span class="number">0</span>:<span class="number">3</span>])</span><br><span class="line">        tmp_unit = [<span class="built_in">int</span>(tmp_unit[x: x + <span class="number">6</span>], <span class="number">2</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">18</span>]]</span><br><span class="line">        <span class="comment"># 取对应base64字符</span></span><br><span class="line">        resp += <span class="string">&#x27;&#x27;</span>.join([base64_charset[i] <span class="keyword">for</span> i <span class="keyword">in</span> tmp_unit])</span><br><span class="line">        integral_part = integral_part[<span class="number">3</span>:]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> remain:</span><br><span class="line">        <span class="comment"># 补齐三个字节，每个字节补充 0000 0000</span></span><br><span class="line">        remain_part = <span class="string">&#x27;&#x27;</span>.join(base64_bytes[<span class="number">3</span> * nums:]) + (<span class="number">3</span> - remain) * <span class="string">&#x27;0&#x27;</span> * <span class="number">8</span></span><br><span class="line">        <span class="comment"># 取三个字节，以每6比特，转换为4个整数</span></span><br><span class="line">        <span class="comment"># 剩余1字节可构造2个base64字符，补充==；剩余2字节可构造3个base64字符，补充=</span></span><br><span class="line">        tmp_unit = [<span class="built_in">int</span>(remain_part[x: x + <span class="number">6</span>], <span class="number">2</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">18</span>]][:remain + <span class="number">1</span>]</span><br><span class="line">        resp += <span class="string">&#x27;&#x27;</span>.join([base64_charset[i] <span class="keyword">for</span> i <span class="keyword">in</span> tmp_unit]) + (<span class="number">3</span> - remain) * <span class="string">&#x27;=&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    s = <span class="string">&quot;123啊a&quot;</span></span><br><span class="line"><span class="built_in">print</span>(encode(s))</span><br></pre></td></tr></table></figure>

<br>

<h3 id="base64解码方式三："><a href="#base64解码方式三：" class="headerlink" title="base64解码方式三："></a>base64解码方式三：</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">decode</span>(<span class="params">base64_str</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解码base64字符串</span></span><br><span class="line"><span class="string">    :param base64_str:base64字符串</span></span><br><span class="line"><span class="string">    :return:解码后的bytearray；若入参不是合法base64字符串，返回空bytearray</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 判断是否符合base64的格式</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(base64_str) % <span class="number">4</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 去除末尾=</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> base64_str[<span class="built_in">len</span>(base64_str)-<span class="number">1</span>:] == <span class="string">&quot;=&quot;</span>:</span><br><span class="line">            base64_str = base64_str[:<span class="built_in">len</span>(base64_str)-<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 遍历判断字符串元素是否在编码表里</span></span><br><span class="line">    <span class="keyword">for</span> m <span class="keyword">in</span> base64_str:</span><br><span class="line">        <span class="keyword">if</span> m <span class="keyword">not</span> <span class="keyword">in</span> base64_str:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 对每一个base64字符取下标索引，并转换为6为二进制字符串</span></span><br><span class="line">    base64_bytes = [<span class="string">&#x27;&#123;:0&gt;6&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(<span class="built_in">bin</span>(base64_charset.index(s))).replace(<span class="string">&#x27;0b&#x27;</span>, <span class="string">&#x27;&#x27;</span>)) <span class="keyword">for</span> s <span class="keyword">in</span> base64_str <span class="keyword">if</span> s != <span class="string">&#x27;=&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    resp = <span class="built_in">bytearray</span>()</span><br><span class="line">    nums = <span class="built_in">len</span>(base64_bytes) // <span class="number">4</span></span><br><span class="line">    remain = <span class="built_in">len</span>(base64_bytes) % <span class="number">4</span></span><br><span class="line">    <span class="comment"># 截取4的整数倍</span></span><br><span class="line">    integral_part = base64_bytes[<span class="number">0</span>:<span class="number">4</span> * nums]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> integral_part:</span><br><span class="line">        <span class="comment"># 取4个6位base64字符，作为3个字节</span></span><br><span class="line">        tmp_unit = <span class="string">&#x27;&#x27;</span>.join(integral_part[<span class="number">0</span>:<span class="number">4</span>])</span><br><span class="line">        tmp_unit = [<span class="built_in">int</span>(tmp_unit[x: x+<span class="number">8</span>], <span class="number">2</span>) <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">8</span>, <span class="number">16</span>]]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tmp_unit:</span><br><span class="line">            resp.append(i)</span><br><span class="line">        integral_part = integral_part[<span class="number">4</span>:]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 取剩余的</span></span><br><span class="line">    <span class="keyword">if</span> remain:</span><br><span class="line">        remain_part = <span class="string">&#x27;&#x27;</span>.join(base64_bytes[nums*<span class="number">4</span>:])</span><br><span class="line">        tmp_unit = [<span class="built_in">int</span>(remain_part[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>], <span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(remain-<span class="number">1</span>)]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> tmp_unit:</span><br><span class="line">            resp.append(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> resp.decode()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<br>

<h2 id="c-实现"><a href="#c-实现" class="headerlink" title="c++实现"></a>c++实现</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by zsk on 2022/9/13.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base64</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//base64 加密</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">encode</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *data, <span class="type">char</span> *out)</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> Base64Code[] = &#123;</span><br><span class="line">    <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;D&#x27;</span>, <span class="string">&#x27;E&#x27;</span>, <span class="string">&#x27;F&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;H&#x27;</span>, <span class="string">&#x27;I&#x27;</span>, <span class="string">&#x27;J&#x27;</span>, <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;L&#x27;</span>, <span class="string">&#x27;M&#x27;</span>, <span class="string">&#x27;N&#x27;</span>, <span class="string">&#x27;O&#x27;</span>, <span class="string">&#x27;P&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Q&#x27;</span>, <span class="string">&#x27;R&#x27;</span>, <span class="string">&#x27;S&#x27;</span>, <span class="string">&#x27;T&#x27;</span>, <span class="string">&#x27;U&#x27;</span>, <span class="string">&#x27;V&#x27;</span>, <span class="string">&#x27;W&#x27;</span>, <span class="string">&#x27;X&#x27;</span>, <span class="string">&#x27;Y&#x27;</span>, <span class="string">&#x27;Z&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;f&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;g&#x27;</span>, <span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;i&#x27;</span>, <span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;k&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;o&#x27;</span>, <span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;q&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;t&#x27;</span>, <span class="string">&#x27;u&#x27;</span>, <span class="string">&#x27;v&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;w&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;y&#x27;</span>, <span class="string">&#x27;z&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>, <span class="string">&#x27;4&#x27;</span>, <span class="string">&#x27;5&#x27;</span>, <span class="string">&#x27;6&#x27;</span>, <span class="string">&#x27;7&#x27;</span>, <span class="string">&#x27;8&#x27;</span>, <span class="string">&#x27;9&#x27;</span>, <span class="string">&#x27;+&#x27;</span>, <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="comment">// 计算长度</span></span><br><span class="line">    <span class="type">int</span> data_len = <span class="built_in">strlen</span>(data);</span><br><span class="line">    <span class="keyword">if</span> (data_len == <span class="number">0</span>) &#123;</span><br><span class="line">        out[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="comment">//主编码循环, &amp; 同为 1 的位，结果为 1，否则结果为 0。 | 只要有1个是1的位，结果为1，否则为0</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; data_len / <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        out[i * <span class="number">4</span>] = Base64Code[data[i * <span class="number">3</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">1</span>] = Base64Code[((data[i * <span class="number">3</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) | (data[i * <span class="number">3</span> + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>)];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">2</span>] = Base64Code[((data[i * <span class="number">3</span> + <span class="number">1</span>] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>) | (data[i * <span class="number">3</span> + <span class="number">2</span>]) &gt;&gt; <span class="number">6</span>];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">3</span>] = Base64Code[data[i * <span class="number">3</span> + <span class="number">2</span>] &amp; <span class="number">0x3F</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//长度不为3的倍数</span></span><br><span class="line">    <span class="keyword">if</span> (data_len % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">        out[i * <span class="number">4</span>] = Base64Code[data[i * <span class="number">3</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">1</span>] = Base64Code[((data[i * <span class="number">3</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>)];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">2</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">3</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (data_len % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">        out[i * <span class="number">4</span>] = Base64Code[data[i * <span class="number">3</span>] &gt;&gt; <span class="number">2</span>];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">1</span>] = Base64Code[((data[i * <span class="number">3</span>] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">4</span>) | (data[i * <span class="number">3</span> + <span class="number">1</span>] &gt;&gt; <span class="number">4</span>)];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">2</span>] = Base64Code[((data[i * <span class="number">3</span> + <span class="number">1</span>] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">2</span>)];</span><br><span class="line">        out[i * <span class="number">4</span> + <span class="number">3</span>] = <span class="string">&#x27;=&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//base64 解密</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">decode</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *data, <span class="type">char</span> *out)</span> </span>&#123;</span><br><span class="line">    <span class="type">static</span> <span class="type">char</span> _ucode[] = &#123;</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">62</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">63</span>,</span><br><span class="line">    <span class="number">52</span>, <span class="number">53</span>, <span class="number">54</span>, <span class="number">55</span>, <span class="number">56</span>, <span class="number">57</span>, <span class="number">58</span>, <span class="number">59</span>, <span class="number">60</span>, <span class="number">61</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">64</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>,</span><br><span class="line">    <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">    <span class="number">0</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">33</span>, <span class="number">34</span>, <span class="number">35</span>, <span class="number">36</span>, <span class="number">37</span>, <span class="number">38</span>, <span class="number">39</span>, <span class="number">40</span>,</span><br><span class="line">    <span class="number">41</span>, <span class="number">42</span>, <span class="number">43</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">48</span>, <span class="number">49</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">&#125;;</span><br><span class="line">    <span class="type">int</span> i;</span><br><span class="line">    <span class="type">int</span> len = <span class="built_in">strlen</span>(data);</span><br><span class="line">    <span class="type">ptrdiff_t</span> len2 = len / <span class="number">4</span> * <span class="number">3</span>;</span><br><span class="line">    <span class="comment">//判断末位是否有等号、有几个等号</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="string">&#x27;=&#x27;</span> == data[len - <span class="number">2</span>])</span><br><span class="line">        len2 -= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&#x27;=&#x27;</span> == data[len - <span class="number">1</span>])</span><br><span class="line">        len2--;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (len % <span class="number">4</span>)</span><br><span class="line">        len2 += (len % <span class="number">4</span> - <span class="number">1</span>);</span><br><span class="line">    <span class="comment">//主解密循环</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; len2 / <span class="number">3</span>; ++i) &#123;</span><br><span class="line">        out[i * <span class="number">3</span>] = (_ucode[data[i * <span class="number">4</span>]] &lt;&lt; <span class="number">2</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">1</span>]] &gt;&gt; <span class="number">4</span>);</span><br><span class="line">        out[i * <span class="number">3</span> + <span class="number">1</span>] = ((_ucode[data[i * <span class="number">4</span> + <span class="number">1</span>]] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">2</span>]] &gt;&gt; <span class="number">2</span>);</span><br><span class="line">        out[i * <span class="number">3</span> + <span class="number">2</span>] = ((_ucode[data[i * <span class="number">4</span> + <span class="number">2</span>]] &amp; <span class="number">0x03</span>) &lt;&lt; <span class="number">6</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">3</span>]]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//末位为一个或两个等号的情况，这时候不能通过主解密循环进行解密</span></span><br><span class="line">            <span class="keyword">if</span> (len2 % <span class="number">3</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            out[i * <span class="number">3</span>] = (_ucode[data[i * <span class="number">4</span>]] &lt;&lt; <span class="number">2</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">1</span>]] &gt;&gt; <span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (len2 % <span class="number">3</span> == <span class="number">2</span>) &#123;</span><br><span class="line">            out[i * <span class="number">3</span>] = (_ucode[data[i * <span class="number">4</span>]] &lt;&lt; <span class="number">2</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">1</span>]] &gt;&gt; <span class="number">4</span>);</span><br><span class="line">            out[i * <span class="number">3</span> + <span class="number">1</span>] = ((_ucode[data[i * <span class="number">4</span> + <span class="number">1</span>]] &amp; <span class="number">0x0F</span>) &lt;&lt; <span class="number">4</span>) | (_ucode[data[i * <span class="number">4</span> + <span class="number">2</span>]] &gt;&gt; <span class="number">2</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *text = <span class="string">&quot;12345&quot;</span>;</span><br><span class="line">            <span class="type">char</span> out[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            <span class="type">char</span> out2[<span class="number">100</span>] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">            Base64::<span class="built_in">encode</span>(text, out);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;encode==&gt;%s\n&quot;</span>, out);</span><br><span class="line">            Base64::<span class="built_in">decode</span>(out, out2);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;decode==&gt;%s&quot;</span>, out2);</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<br>

<h2 id="中文的base64编码"><a href="#中文的base64编码" class="headerlink" title="中文的base64编码"></a>中文的base64编码</h2><br>

<p>其实base64编码只是在二进制与base64字符集之间映射的编码，与其他字符集毫无关系。其他字符集想要转换为base64编码，只需先将其转换为二进制，再做base64编码即可。</p>
<br>

<p>那么对于Unicode字符集而言，有多种编码方式将其装换为二进制，所以在编码过程中就需要统一编码，以免造成乱码。上述Python示例就将中文转换为base64，首先使用默认编码utf-8将字符串转换为二进制（使用Python的str.encode()），再做base64编码；解码时候同样如此，先将base64字符串解码为二进制，再将二进制转换为字符串（使用Python的str.decode()）</p>
]]></content>
      <tags>
        <tag>算法</tag>
      </tags>
  </entry>
  <entry>
    <title>jni接口比较(Jnitrace/Frida/ExAndroidNativeEmu/Unidbg)</title>
    <url>/2022/06/07/jni%E6%8E%A5%E5%8F%A3%E6%AF%94%E8%BE%83-Jnitrace-Frida-ExAndroidNativeEmu-Unidbg/</url>
    <content><![CDATA[<ul>
<li><p>它们是如何处理&#x2F;实现jni几百个接口函数的？</p>
</li>
<li><p>它们能hook&#x2F;主动调用JNI接口函数么？</p>
</li>
<li><p>它们是如何找到jni(动)静态注册的Native函数的？</p>
</li>
<li><p>它们能hook动(静)态注册的Native函数么？</p>
</li>
<li><p>它们能主动调用动(静)态注册的Native函数么？</p>
</li>
<li><p>首先定义：</p>
<ul>
<li>Java层的Native函数</li>
<li>env、vm → jni接口函数</li>
<li>jni静态函数、jni动态函数</li>
<li>纯native函数<table>
<thead>
<tr>
<th></th>
<th><strong>Frida</strong></th>
<th><strong>jnitrace</strong></th>
<th><strong>ExAndroidNativeEmu</strong></th>
<th><strong>Unidbg</strong></th>
</tr>
</thead>
<tbody><tr>
<td>可以跑完整的apk么？</td>
<td>⚪</td>
<td>⚪</td>
<td>×</td>
<td>×</td>
</tr>
<tr>
<td>可以hook Java么？查看参调返</td>
<td>⚪</td>
<td>x</td>
<td>x</td>
<td>×</td>
</tr>
<tr>
<td>可以hook JNI接口函数么？查看参调返</td>
<td>⚪</td>
<td>⚪</td>
<td>⚪</td>
<td>⚪</td>
</tr>
<tr>
<td>可以主动调用JNI接口函数么？获取返回值</td>
<td>⚪</td>
<td>x</td>
<td>⚪</td>
<td>⚪</td>
</tr>
<tr>
<td>如何找到静态绑定的Native函数？</td>
<td>dlopen&#x2F;dlsym</td>
<td>dlsym</td>
<td>Module</td>
<td>Module</td>
</tr>
<tr>
<td>如何找到动态绑定的Native函数？</td>
<td>hook RegisterNatives</td>
<td>hook RegisterNatives</td>
<td>hook RegisterNatives</td>
<td>hook RegisterNatives</td>
</tr>
<tr>
<td>如何hook(动)静态注册的Native函数？</td>
<td>⚪</td>
<td>⚪</td>
<td>x</td>
<td>⚪</td>
</tr>
<tr>
<td>如何主动调用(动)静态注册的Native函数？</td>
<td>⚪</td>
<td>x</td>
<td>⚪</td>
<td>⚪</td>
</tr>
</tbody></table>
</li>
</ul>
</li>
<li><p>Frida中JNI接口的实现细节</p>
</li>
</ul>
<p><a class="link"   href="https://github.com/frida/frida-java-bridge/blob/master/lib/env.js#L362" >https://github.com/frida/frida-java-bridge/blob/master/lib/env.js#L362<i class="fas fa-external-link-alt"></i></a><br />linux动态库函数dlopen与dlsym使用<br /><a class="link"   href="https://blog.csdn.net/lanhuazui10/article/details/117849995" >https://blog.csdn.net/lanhuazui10/article/details/117849995<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="frida-hook-java"><a href="#frida-hook-java" class="headerlink" title="frida hook java"></a>frida hook java</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hookJava</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.roysue.easyso1.MainActivity&quot;</span>).<span class="property">method01</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">str</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;str:&quot;</span>, str)</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">method01</span>(str);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result:&quot;</span>, result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="frida-invoke-java"><a href="#frida-invoke-java" class="headerlink" title="frida invoke java"></a>frida invoke java</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">invokeJava</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> result = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.roysue.easyso1.MainActivity&quot;</span>).<span class="title function_">decrypt</span>(<span class="string">&quot;82e8edd5b05654bf0fedcdfc1c9b4b0f&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result:&quot;</span>, result)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="frida-hook-jni"><a href="#frida-hook-jni" class="headerlink" title="frida hook jni"></a>frida hook jni</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">find_RegisterNatives</span>(<span class="params">params</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> symbols = <span class="title class_">Module</span>.<span class="title function_">enumerateSymbolsSync</span>(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> addrRegisterNatives = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i];</span><br><span class="line">        <span class="comment">//_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi</span></span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;RegisterNatives&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            addrRegisterNatives = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RegisterNatives is at &quot;</span>, symbol.<span class="property">address</span>, symbol.<span class="property">name</span>);</span><br><span class="line">            <span class="title function_">hook_RegisterNatives</span>(addrRegisterNatives)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_RegisterNatives</span>(<span class="params">addrRegisterNatives</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (addrRegisterNatives != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(addrRegisterNatives, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] method_count:&quot;</span>, args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">var</span> env = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">var</span> java_class = args[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> class_name = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">tryGetEnv</span>().<span class="title function_">getClassName</span>(java_class);</span><br><span class="line">                <span class="comment">//console.log(class_name);</span></span><br><span class="line">                <span class="keyword">var</span> methods_ptr = <span class="title function_">ptr</span>(args[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">var</span> method_count = <span class="built_in">parseInt</span>(args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; method_count; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> name_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span>));</span><br><span class="line">                    <span class="keyword">var</span> sig_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span>));</span><br><span class="line">                    <span class="keyword">var</span> fnPtr_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">2</span>));</span><br><span class="line">                    <span class="keyword">var</span> name = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(name_ptr);</span><br><span class="line">                    <span class="keyword">var</span> sig = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(sig_ptr);</span><br><span class="line">                    <span class="keyword">var</span> find_module = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(fnPtr_ptr);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] java_class:&quot;</span>, class_name, <span class="string">&quot;name:&quot;</span>, name, <span class="string">&quot;sig:&quot;</span>, sig, <span class="string">&quot;fnPtr:&quot;</span>, fnPtr_ptr,  <span class="string">&quot; fnOffset:&quot;</span>, <span class="title function_">ptr</span>(fnPtr_ptr).<span class="title function_">sub</span>(find_module.<span class="property">base</span>), <span class="string">&quot; callee:&quot;</span>, <span class="title class_">DebugSymbol</span>.<span class="title function_">fromAddress</span>(<span class="variable language_">this</span>.<span class="property">returnAddress</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(find_RegisterNatives);</span><br></pre></td></tr></table></figure>

<h3 id="frida-hook-纯native静态，动态函数（dlopen）"><a href="#frida-hook-纯native静态，动态函数（dlopen）" class="headerlink" title="frida hook  纯native静态，动态函数（dlopen）"></a>frida hook  纯native静态，动态函数（dlopen）</h3><p>动态函数初始化只执行一次，需要hook dlopen（来判断so是否加载）</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_Native_JNi</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> method01 = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> method02 = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;_Z8method02P7_JNIEnvP7_jclassP8_jstring&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 address:&quot;</span>, method01)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 address:&quot;</span>, method02)</span><br><span class="line">        <span class="keyword">if</span>(method01)&#123;</span><br><span class="line">            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(method01, &#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                    <span class="comment">// env-&gt;GetStringUTFChars(str_, JNI_FALSE)</span></span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 args[2] ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>], <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 retval ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(retval, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(method02)&#123;</span><br><span class="line">            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(method02, &#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 args[2] ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>], <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 retval ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(retval, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlopen</span>(<span class="params">module_name, fun</span>) &#123;</span><br><span class="line">    <span class="comment">//安卓高版本需要同时hook android_dlopen_ext</span></span><br><span class="line">    <span class="keyword">var</span> android_dlopen_ext = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (android_dlopen_ext) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(android_dlopen_ext, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (pathptr) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">path</span> = (pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">path</span>.<span class="title function_">indexOf</span>(module_name) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">canhook</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>, <span class="variable language_">this</span>.<span class="property">path</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canhook</span>) &#123;</span><br><span class="line">                    <span class="title function_">fun</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> dlopen = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (dlopen) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(dlopen, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (pathptr) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">path</span> = (pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dlopen:&quot;</span>, <span class="variable language_">this</span>.<span class="property">path</span>)</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">path</span>.<span class="title function_">indexOf</span>(module_name) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">canhook</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dlopen:&quot;</span>, <span class="variable language_">this</span>.<span class="property">path</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canhook</span>) &#123;</span><br><span class="line">                    <span class="title function_">fun</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>, android_dlopen_ext, <span class="string">&quot;dlopen:&quot;</span>, dlopen);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// hookJava()</span></span><br><span class="line">    <span class="title function_">hook_dlopen</span>(<span class="string">&quot;libroysue.so&quot;</span>, hook_Native_JNi)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="frida-hook-纯native静态，动态函数（libart，RegisterNatives）"><a href="#frida-hook-纯native静态，动态函数（libart，RegisterNatives）" class="headerlink" title="frida hook 纯native静态，动态函数（libart，RegisterNatives）"></a>frida hook 纯native静态，动态函数（libart，RegisterNatives）</h3><p>通过hook libart下的RegisterNatives来hook动态函数，动态函数加载后，静态函数已经加载了<br />.init .init_array, so feature - dlopen dlsym<br />jni JNI_Onload &#x3D; RegisterNatives</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">find_RegisterNatives</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> symbols = <span class="title class_">Module</span>.<span class="title function_">enumerateSymbolsSync</span>(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> addrRegisterNatives = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi</span></span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;RegisterNatives&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            addrRegisterNatives = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RegisterNatives is at &quot;</span>, symbol.<span class="property">address</span>, symbol.<span class="property">name</span>);</span><br><span class="line">            <span class="title function_">hook_RegisterNatives</span>(addrRegisterNatives)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_RegisterNatives</span>(<span class="params">addrRegisterNatives</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (addrRegisterNatives != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(addrRegisterNatives, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] method_count:&quot;</span>, args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">var</span> env = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">var</span> java_class = args[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> class_name = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">tryGetEnv</span>().<span class="title function_">getClassName</span>(java_class);</span><br><span class="line">                <span class="comment">//console.log(class_name);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> methods_ptr = <span class="title function_">ptr</span>(args[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> method_count = <span class="built_in">parseInt</span>(args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; method_count; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> name_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span>));</span><br><span class="line">                    <span class="keyword">var</span> sig_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span>));</span><br><span class="line">                    <span class="keyword">var</span> fnPtr_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> name = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(name_ptr);</span><br><span class="line">                    <span class="keyword">var</span> sig = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(sig_ptr);</span><br><span class="line">                    <span class="keyword">var</span> find_module = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(fnPtr_ptr);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] java_class:&quot;</span>, class_name, <span class="string">&quot;name:&quot;</span>, name, <span class="string">&quot;sig:&quot;</span>, sig, <span class="string">&quot;fnPtr:&quot;</span>, fnPtr_ptr,  <span class="string">&quot; fnOffset:&quot;</span>, <span class="title function_">ptr</span>(fnPtr_ptr).<span class="title function_">sub</span>(find_module.<span class="property">base</span>), <span class="string">&quot; callee:&quot;</span>, <span class="title class_">DebugSymbol</span>.<span class="title function_">fromAddress</span>(<span class="variable language_">this</span>.<span class="property">returnAddress</span>));</span><br><span class="line">                    <span class="keyword">if</span> (name.<span class="title function_">indexOf</span>(<span class="string">&quot;decrypt&quot;</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                        <span class="keyword">var</span> method02addr = fnPtr_ptr;</span><br><span class="line">                        <span class="keyword">var</span> method01addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 address:&quot;</span>, method02addr)</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 address:&quot;</span>, method01addr)</span><br><span class="line">                        <span class="keyword">if</span>(method01addr)&#123;</span><br><span class="line">                            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(method01addr, &#123;</span><br><span class="line">                                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                                    <span class="comment">// env-&gt;GetStringUTFChars(str_, JNI_FALSE)</span></span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 args[2] ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>], <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 retval ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(retval, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(method02addr)&#123;</span><br><span class="line">                            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(method02addr, &#123;</span><br><span class="line">                                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 args[2] ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>], <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 retval ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(retval, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="frida-invoke-纯native-动态，静态-（基于dlopen）"><a href="#frida-invoke-纯native-动态，静态-（基于dlopen）" class="headerlink" title="frida invoke  纯native(动态，静态)（基于dlopen）"></a>frida invoke  纯native(动态，静态)（基于dlopen）</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> method01_addr = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> method02_addr = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> addrNewStringUTF = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_dlopen</span>(<span class="params">module_name, fun</span>) &#123;</span><br><span class="line">    <span class="comment">//安卓高版本需要同时hook android_dlopen_ext</span></span><br><span class="line">    <span class="keyword">var</span> android_dlopen_ext = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;android_dlopen_ext&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (android_dlopen_ext) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(android_dlopen_ext, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (pathptr) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">path</span> = (pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">path</span>.<span class="title function_">indexOf</span>(module_name) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">canhook</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>, <span class="variable language_">this</span>.<span class="property">path</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canhook</span>) &#123;</span><br><span class="line">                    <span class="title function_">fun</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> dlopen = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="literal">null</span>, <span class="string">&quot;dlopen&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (dlopen) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(dlopen, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="keyword">var</span> pathptr = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">if</span> (pathptr) &#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">path</span> = (pathptr).<span class="title function_">readCString</span>();</span><br><span class="line">                    <span class="comment">// console.log(&quot;dlopen:&quot;, this.path)</span></span><br><span class="line">                    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">path</span>.<span class="title function_">indexOf</span>(module_name) &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="variable language_">this</span>.<span class="property">canhook</span> = <span class="literal">true</span>;</span><br><span class="line">                        <span class="comment">// console.log(&quot;dlopen:&quot;, this.path);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">canhook</span>) &#123;</span><br><span class="line">                    <span class="title function_">fun</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;android_dlopen_ext:&quot;</span>, android_dlopen_ext, <span class="string">&quot;dlopen:&quot;</span>, dlopen);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_Native_JNi</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        method01_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>);</span><br><span class="line">        method02_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;_Z8method02P7_JNIEnvP7_jclassP8_jstring&quot;</span>);</span><br><span class="line">        addrNewStringUTF = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;_ZN7_JNIEnv12NewStringUTFEPKc&quot;</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 address:&quot;</span>, method01_addr)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 address:&quot;</span>, method02_addr)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;addrNewStringUTF address:&quot;</span>, addrNewStringUTF)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invoke_method01</span>(<span class="params">contents</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> method01_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(method01_addr &amp;&amp; addrNewStringUTF)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01_addr is =&gt;&quot;</span>,method01_addr)</span><br><span class="line">        <span class="keyword">var</span> method01 = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(method01_addr, <span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">NewStringUTF</span> = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addrNewStringUTF, <span class="string">&quot;pointer&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Jstring</span> = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">newStringUtf</span>(contents)</span><br><span class="line">            <span class="comment">// var Jstring = NewStringUTF(Java.vm.getEnv(), Memory.allocUtf8String(contents));</span></span><br><span class="line">            result = <span class="title function_">method01</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Jstring</span>, <span class="title class_">Jstring</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is =&gt;&quot;</span>,result)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">            result = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invoke_method02</span>(<span class="params">contents</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(method02_addr &amp;&amp; addrNewStringUTF)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02_addr is =&gt;&quot;</span>, method02_addr)</span><br><span class="line">        <span class="keyword">var</span> method02 = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(method02_addr, <span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">NewStringUTF</span> = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addrNewStringUTF,<span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Jstring</span> = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">newStringUtf</span>(contents)</span><br><span class="line">            <span class="comment">// var Jstring = NewStringUTF(Java.vm.getEnv(), Memory.allocUtf8String(contents));</span></span><br><span class="line">            result = <span class="title function_">method02</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Jstring</span>, <span class="title class_">Jstring</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is =&gt;&quot;</span>,result)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">            result = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">invoke1</span>:invoke_method01,</span><br><span class="line">    <span class="attr">invoke2</span>:invoke_method02</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">hook_dlopen</span>(<span class="string">&quot;libroysue.so&quot;</span>, hook_Native_JNi)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>

<h3 id="frida-invoke-纯native-动态，静态-（基于RegisterNatives）"><a href="#frida-invoke-纯native-动态，静态-（基于RegisterNatives）" class="headerlink" title="frida invoke  纯native(动态，静态)（基于RegisterNatives）"></a>frida invoke  纯native(动态，静态)（基于RegisterNatives）</h3><p>通过RegisterNatives获取到jni函数地址，进行调用</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> addrNewStringUTF = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">var</span> method02addr = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">find_RegisterNatives</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> symbols = <span class="title class_">Module</span>.<span class="title function_">enumerateSymbolsSync</span>(<span class="string">&quot;libart.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> addrRegisterNatives = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; symbols.<span class="property">length</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">var</span> symbol = symbols[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;NewStringUTF&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            addrNewStringUTF = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;NewStringUTF is at &quot;</span>, symbol.<span class="property">address</span>, symbol.<span class="property">name</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//_ZN3art3JNI15RegisterNativesEP7_JNIEnvP7_jclassPK15JNINativeMethodi</span></span><br><span class="line">        <span class="keyword">if</span> (symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;art&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp;</span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;JNI&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;RegisterNatives&quot;</span>) &gt;= <span class="number">0</span> &amp;&amp; </span><br><span class="line">                symbol.<span class="property">name</span>.<span class="title function_">indexOf</span>(<span class="string">&quot;CheckJNI&quot;</span>) &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            addrRegisterNatives = symbol.<span class="property">address</span>;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;RegisterNatives is at &quot;</span>, symbol.<span class="property">address</span>, symbol.<span class="property">name</span>);</span><br><span class="line">            <span class="title function_">hook_RegisterNatives</span>(addrRegisterNatives)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook_RegisterNatives</span>(<span class="params">addrRegisterNatives</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (addrRegisterNatives != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(addrRegisterNatives, &#123;</span><br><span class="line">            <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] method_count:&quot;</span>, args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">var</span> env = args[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">var</span> java_class = args[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">var</span> class_name = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">tryGetEnv</span>().<span class="title function_">getClassName</span>(java_class);</span><br><span class="line">                <span class="comment">//console.log(class_name);</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> methods_ptr = <span class="title function_">ptr</span>(args[<span class="number">2</span>]);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> method_count = <span class="built_in">parseInt</span>(args[<span class="number">3</span>]);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; method_count; i++) &#123;</span><br><span class="line">                    <span class="keyword">var</span> name_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span>));</span><br><span class="line">                    <span class="keyword">var</span> sig_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span>));</span><br><span class="line">                    <span class="keyword">var</span> fnPtr_ptr = <span class="title class_">Memory</span>.<span class="title function_">readPointer</span>(methods_ptr.<span class="title function_">add</span>(i * <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">3</span> + <span class="title class_">Process</span>.<span class="property">pointerSize</span> * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">var</span> name = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(name_ptr);</span><br><span class="line">                    <span class="keyword">var</span> sig = <span class="title class_">Memory</span>.<span class="title function_">readCString</span>(sig_ptr);</span><br><span class="line">                    <span class="keyword">var</span> find_module = <span class="title class_">Process</span>.<span class="title function_">findModuleByAddress</span>(fnPtr_ptr);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;[RegisterNatives] java_class:&quot;</span>, class_name, <span class="string">&quot;name:&quot;</span>, name, <span class="string">&quot;sig:&quot;</span>, sig, <span class="string">&quot;fnPtr:&quot;</span>, fnPtr_ptr,  <span class="string">&quot; fnOffset:&quot;</span>, <span class="title function_">ptr</span>(fnPtr_ptr).<span class="title function_">sub</span>(find_module.<span class="property">base</span>), <span class="string">&quot; callee:&quot;</span>, <span class="title class_">DebugSymbol</span>.<span class="title function_">fromAddress</span>(<span class="variable language_">this</span>.<span class="property">returnAddress</span>));</span><br><span class="line">                    <span class="keyword">if</span> (name.<span class="title function_">indexOf</span>(<span class="string">&quot;decrypt&quot;</span>) &gt;= <span class="number">0</span>)&#123;</span><br><span class="line">                        method02addr = fnPtr_ptr;</span><br><span class="line">                        <span class="keyword">var</span> method01addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>);</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01 address:&quot;</span>, method02addr)</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 address:&quot;</span>, method01addr)</span><br><span class="line">                        <span class="comment">// if(method01addr)&#123;</span></span><br><span class="line">                        <span class="comment">//     Interceptor.attach(method01addr, &#123;</span></span><br><span class="line">                        <span class="comment">//         onEnter: function(args)&#123;</span></span><br><span class="line">                        <span class="comment">//             // env-&gt;GetStringUTFChars(str_, JNI_FALSE)</span></span><br><span class="line">                        <span class="comment">//             console.log(&quot;method01 args[2] ==&gt; &quot;, Java.vm.getEnv().getStringUtfChars(args[2], null).readCString())</span></span><br><span class="line">                        <span class="comment">//         &#125;,</span></span><br><span class="line">                        <span class="comment">//         onLeave: function(retval)&#123;</span></span><br><span class="line">                        <span class="comment">//             console.log(&quot;method01 retval ==&gt; &quot;, Java.vm.getEnv().getStringUtfChars(retval, null).readCString())</span></span><br><span class="line">                        <span class="comment">//         &#125;</span></span><br><span class="line">                        <span class="comment">//     &#125;)</span></span><br><span class="line">                        <span class="comment">// &#125;</span></span><br><span class="line">                        <span class="keyword">if</span>(method02addr)&#123;</span><br><span class="line">                            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(method02addr, &#123;</span><br><span class="line">                                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 args[2] ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(args[<span class="number">2</span>], <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;,</span><br><span class="line">                                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02 retval ==&gt; &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(retval, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invoke_method01</span>(<span class="params">contents</span>)&#123;</span><br><span class="line">    <span class="keyword">var</span> method01_addr = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(<span class="string">&quot;libroysue.so&quot;</span>, <span class="string">&quot;Java_com_roysue_easyso1_MainActivity_method01&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(method01_addr &amp;&amp; addrNewStringUTF)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method01_addr is =&gt;&quot;</span>,method01_addr)</span><br><span class="line">        <span class="keyword">var</span> method01 = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(method01_addr, <span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">NewStringUTF</span> = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addrNewStringUTF, <span class="string">&quot;pointer&quot;</span>, [<span class="string">&quot;pointer&quot;</span>, <span class="string">&quot;pointer&quot;</span>]);</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Jstring</span> = <span class="title class_">NewStringUTF</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(contents));</span><br><span class="line">            result = <span class="title function_">method01</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Jstring</span>, <span class="title class_">Jstring</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is =&gt;&quot;</span>,result)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">            result = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">invoke_method02</span>(<span class="params">contents</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(method02addr &amp;&amp; addrNewStringUTF)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;method02_addr is =&gt;&quot;</span>, method02addr)</span><br><span class="line">        <span class="keyword">var</span> method02 = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(method02addr, <span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">NewStringUTF</span> = <span class="keyword">new</span> <span class="title class_">NativeFunction</span>(addrNewStringUTF,<span class="string">&#x27;pointer&#x27;</span>,[<span class="string">&#x27;pointer&#x27;</span>,<span class="string">&#x27;pointer&#x27;</span>])</span><br><span class="line">        <span class="keyword">var</span> result = <span class="literal">null</span>;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">Jstring</span> = <span class="title class_">NewStringUTF</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Memory</span>.<span class="title function_">allocUtf8String</span>(contents));</span><br><span class="line">            result = <span class="title function_">method02</span>(<span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>(), <span class="title class_">Jstring</span>, <span class="title class_">Jstring</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is =&gt;&quot;</span>,result)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result is &quot;</span>, <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>())</span><br><span class="line">            result = <span class="title class_">Java</span>.<span class="property">vm</span>.<span class="title function_">getEnv</span>().<span class="title function_">getStringUtfChars</span>(result, <span class="literal">null</span>).<span class="title function_">readCString</span>();</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">rpc.<span class="property">exports</span> = &#123;</span><br><span class="line">    <span class="attr">invoke1</span>:invoke_method01,</span><br><span class="line">    <span class="attr">invoke2</span>:invoke_method02</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="comment">// hookJava()</span></span><br><span class="line">    <span class="comment">// hook_dlopen(&quot;libroysue.so&quot;, hook_Native_JNi)</span></span><br><span class="line">    <span class="title function_">find_RegisterNatives</span>(<span class="string">&quot;libroysue.so&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>

</br>


<h3 id="注："><a href="#注：" class="headerlink" title="注："></a>注：</h3><p>可以获取jni的NewStringUTF的地址，然后创建函数自动调用。或者直接使用Java.vm.getEnv().newStringUtf(contents)<br />作用：将java的string转jni的Jsting</p>
]]></content>
      <tags>
        <tag>frida</tag>
      </tags>
  </entry>
  <entry>
    <title>frida备忘录</title>
    <url>/2022/05/20/frida%E5%A4%87%E5%BF%98%E5%BD%95/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="e2f7489b6b3df8cc640954cecf68a34b4213ddd1c7d8db231cb5b63202fcef69">48341a95da23a3300a7f9cab827f52f859bd1d7d4cfdfa5ebea6118d927f9fa453605fb7134ff7f12f2e4d8cccfece0a2d63667c8c14d12c227edbd9df18867ede48db74bedc0201c59c5e021572d34820f643b1c9c637a23941a64116b09483d88286fa42e6580bb95ac0d42915808830d12ba3de64d3abc63717b5a382367998fd1b1aa37501c0da4955ab0460442bec42d48450b44ca28e93b3ceddab77d26430448e9ebd38652713ad21ff91a066c8ad3e5e48ae0392125261e89d222fb1fbeda1b84048fd06193f100840fcfaef3e7452aadc58cef848165672339ba6277432bc04fe4cd7eaf81887f0884e88ef4c0bd27b01344a4e0b13969cacbb4705eaa435336fcb9acfe3186f780a645d97408650046f1070fbac96b67ff465dbf83293d86247a70e77f8de86544cf29bbdb0f95548b616199a0132f5be896c9898c6adda09a0959b08fd6f2241a99b065d423dd6e476aecb0e65663df4c51be5fac11b52992c7951604bc2f8191c6de822470e4821e4c7d2dc32be9287cd1f9c944304ed8c6e97441a0c049ae4dbdba16ce79705a8009177175302b2b36a45855fe4f5832b4d43533fe5257bf22c94a7612c280a347d430ed3a48dec41018790133e0cd35f25666961b1491a16da9ef3e1764c61acbd732e71c6036c9a9f90ab459f16335f7af38104c59fe60846f9b5da03b028b922654ae492bdb95c4bc903b51203bef1e1910b089282e2605c5ed06658aee77e33e3d7c976e86435bc1407889f879feb4fa3902137b32291e571131f639049eb7a60ffbaafb896c07c4bddda724c9f3c9050f7dd21f31430a3a3b67b677c80a273142e98ca762b45bf220adb02e5df2cb61c437b1a4e20c94815bf9ef1d03d0bdd0780c5834b756064b7aec131e28a6ba0f820969a88e7fdb8eb0b82c47da5f8e5e8a7b3a137282a2bb4663a80997793f4197c25a2e04a547a1c01421a8d589292f3fc4932f5c5054414b64998d95c7d71c93e1a8283f558a9a75fedca9144f9fcab3ad93356c44776a84780d697cf1ebfd209608716a1f3286177cdaaf3256a7dd6c180b54e7f9faa98548dd6dcb98f4073925a7c4177f9bf10294c962248e704681e7c866eafb1a231247c4e85427e600b007b8ce33f5b9827e324d8f3c4631a90a3fc59a0d8f4be7e6d13738f07c9009977d54b447ed1548533aa489b1105a451205cec65ee7a55297b14e5c7376d8821ef8fb81b3d94bfa9e2b64605d4bed8e145ea6c0cb6dab6b7dd8eec804facd80de335bedf238d115e026c5892eaac744ea176e7893041c7e498df2d1c4ca9a577c74a87d4ef29ea3715998c89f2c7ee3e3a788c2f449e77392c957840d86800f182d1c142ee9114a311e7b2910f8b95f71805f06990a557ebc0632981d811fa2f60cd7abe4f4457c7f6d00e7d358ce4d828ef8c2c437de9cff80f9b7f893682664dd7c83754fe5f3d48d7086f5e141c91c962e4a160316864460311892a0f070884dbff79b3411e96b7f28db708d93834c0aa45015cd608cc804dfa1b4b2e6cce9ab3fd66931a8b1d5271dc7c149957e88dff7a65de2f37dbf8784ccc861967fe1a50672aaa8912d4920537820dc3b83ed6ffffff9baf12d8ef4a7c421d65e7f7a277f10bc8a92a93cfd71a9b231739bb9f49af171fa36d78cd64d973ecb9c099fc6fc66893b05052191dfff541dd452ee57ff993b4664e4534b59e04e867c1384ccc7cf36a0bdb7dfe1c3d354c4c19f773f2bb5ca21f48480124e65123456ee66a2715953041ad565b1fd65852a473031ffc6abfe85304a6b49e5a8c211c3aea6a20985cf59a290abda7bd295fce78c0adfc31fe0bf218ccd0eaf71d25a21a0a880e47e0cdb55a7e8fb8e3adbe78df6e8cb8b18912070b4eda7dfdb353a136ea36c756236c71ad595c5684cab482a36e704c5173c589ab610748b6e0a95bc1c7ccd16bc3de5ad91381c0b063000820fef1e344526a717be82b42f9646534bc41f3959326b82dca2febd44d0e2d3b95196c9ec8a2e075df574054993de2eb057c960baaa175b01753aaf6016fb176f19049d8047f769db431b7720eee5389c5c716ca781dbbc0f37b554dff691a04a861a6a956585eac3aa588939a4f981881d5aed75a94d232dcb418113d9934f8f754f31cb506f9b4776abc919e7c30125f19bcf405e159ee2f73d85839d72a1ab2a33c0306f0d94659b25daf58c77445bc9b02898b80de74ae0f708d263cab9bb1b3cd8aade542a805589277e66568c927bf1e7f66d8f49b8ca62e1abd7918f53b4860f0371955c488044bf90f88143547dccc68d5105c424ec906542cbcadebb1fd7478864d92af44698dd050ccae5d137e75c7775ab4a6faefdef920d6a62fafd2300ca51ee7d17744add09d44f0591c2d4bf86c323f7e526833105361e34f1932dd17d102616d105618e8d58c24d732a5fdca662187d0075553eb797e2f436224920ab7ca344b035aa3f77a9c37dadc0dabf5245de87e7909c48b9f6a8b594baefc13a5f6c8a2c1228e5010a68210643da25eb33f1f4718b809029a6f415f39470976b28454d6894db4eeb1c3b3804962dec1c48ca7ca9fbf43d57b035754ae1bf13931721d24472ff367ed6078c2be6dfff6ede3337dc0d02982dd2b695f129ffd73f9a9cf041bce4a2bce391ceb8131db28df0c255a0cca34c87a0df1e84f04f9dd0aa397575cfad47963a8d1241348bf2eca0e096f86cca9150109ea4929096d41e7c0ee94bd8e44bb3a2df5cd07f8efb2fd07eda9a9e510a642606d99bf082f02d20a551b5df7e08d3b5bf818ce61f7a748d3bc19e57d4ec56514ad32d86417845e25c03c95ef1b83002768003f4073cbe209156b7b5dfe84fd0b9576e7c19caebaa673372546badc50656076aea76918a40c46c23225b55101a52d9cd3a16853436f07cae71e82636ce870b84ddef292671e27cc1625a6e70196f1281151da828ec817e808aa1f21e4a20fc6176c5312e8d3b3fe7ee3b1fdf381bb5496c4104f9bf5aca07b8ae9d939e751137b82c4a851205e48bfebb09317bfb957e668b564f51d5fec2f88bab655584f00a6189a819de83f9b7ebab6588f98625c267fcf0a266da637cb1dd5be892b522b7b25cf882f61aa2faf33b2b12a96ef9172a8372ff0eff2659469a62bfe9f6591e50233aa160b3c998e89c5edbfc254d64b498d66571c637639f69be62cc8edfccf91b87bed30d2f7b12430a22566ae87ff6f796b2f0ad02cbc978637d5739c67e4d1ea2ea7f2a972ac8a4d122720166a220cbd15a3743e39a8e25bf275447a3792153ec9757b206cc6e7d1c3401305163e14f9ea4fe6213db1bf42ce839f69f213e2a95b7608df444be4edbea0272507c5562bf8f9c08d306337077248d34d38b3c43406b4d4395556fa2fa35212d696d300c1a380a7ebb0c5fe6f3dc9303fc3d75f12e8cfe69d9168b4582255c8ee15509d0e3be89d16dd142d258cf87dd33059aaf86881e0fcfae49ba0675b2b94557918ae4d68e592efdc58ad635408df1702c65c249131a68bad7a5afddec03f04e82ea1e9135b6c1ddf670307cba78ba2c49a364111a4a6ee8ec98176dc6d664cf5bac063449ad8982d0cae79fbeb5978bdb5f26b0d19b8516bf3268ef444e803a3a796ce5df4cefc39832c0e46242de8168892fa7c239f5de31f13ec1b36d4c525713590913192f1ec726d6b8d5e826c4ce77b5245782319c65b152057aa9b684ac01e969ca6eab9442c52cd9a09e5a2aa30593527dadbbe20a1dfef448bdf4172d3fc4380628ee6a180377428de14f0c851f610c5d0b14433f1a54c4ca82283aa34de463e28d35170ccd48ee88ee7f5d542cff3b7941dc55973caa3c13166396d7ee3b0e696c81210971b4e7ce2a33534d0dc25950c54198732ab0652c98388c7559e16072dec44b39041898069e811af4d36459c8bd98fc10ee5364b5b424e4e0acca54d48916abf40ca407bd16972fe35d77d1ebd411585538f57f75db1151b3f3ab3bdf2070c504740bf64ed68ab8dca672bf7842a99046939c01984bcedea00490846d98e9254bef9879fe7db61e2327f538634c0c12fc1bd501dbc2dad729ec285a8668711e232465365a225afdf88b72fe499fe84cb9a6c000e58c132b4a860875d0675d89fdc22cf8f3ea259a2f36af0f2f2f03a7f62c060a787912b07d4a0138ca10c042501859c49cd5b5a9728b82ea6a6a464f0bf334c220c3ffee0d981ce045f345aabd0a5805b89d845fdb2a0d44f5c9c7cb8d51d802131e15057daed7ff8e0635b093d6add43947815cff7676cd00f3dfaa20b7425c40f296b0f758b1caf7d27bed6e1f57aa676338e7e88064296bd91f9945b347aa997916b8733e6ac97a348d98dd78481ae1ca8949341f90417b6eec6c695e07ee65b32527a0bf091134b56166608f24dda05d93b7fd3a5ba15121ae6e413bf72050a70f58324aed86992de461af3cdc6f4386dc9d620308e0db6aae141aa84ce246e11022064315684b87f396663b65e334ea4969ad7ab82fb69bfc92276b2c91f28b8775446b7be7d22c7577f3c8582fd424f74d10de433a29eba519d48f64217d8854349636ef9bbf94720df0b3a092fcb8d639a5408c61dcc56997bff8b011ec144fe5f80e4e1e7de73392ed3bcd3b451da951d2cdec778d8c574be39b9c9912eea2abf6d45564ffbca78239645436b669b80f208e879da09b174800e7f072e802c3864722ed5b5b60c6bc3233d973671ef0df2d45f1ad7fafce57bef6daf92f661787f2c2d9d627bafc47019bac44de3e907d5a420014a856616ebeb97c8744e312015cbc2d5e659c81ec12314bc753ecfe0cbaf3dcb4ca242ae006cfc36a81b4e34554dc84924b0169d5fff2da952a02def8d2813f9a7dfc6fe8aebdf3f4850a86768c5a66624aeb991f52764d8d8779c05853bfd92ffbbb802f9abba4832c0bb0cb3604455a43ac3068181e3364327233d2b42b437baf4b92896880513418d24f0ffad1b1daa9b9dc01d246dd0f5840e1ff4f30368451336c306e40f40b98ae5e5d0955b57e8eb0d0d6818b347de261140b34aacaa9950de6a16cbced4b30739fb76d2352ef7aabc626f60e4a6cd8376eaa8f19ad710c9a14ce51f40573f3736edad67b85b42f7de877b42637f8484a1552aaaa96249cce3f270939ecd18d3bccf6c46e1982611167ddf915b024750ceeff09e622c1b1f66ca7903e9a324762b0f83949faecb6248331f0e22c33cc75db70efca4865910f9bb64a986e9f3ce88ad74280475fa6fc4862274763e84e20a03b3e9445511dfb965a9dd84b6f1f63736531ccb19048fe4c0f5ac530050da052d8c65075bfaddb23977d10a3d703887790a247b8a8ef36794ccb4ed1fcaf57988cc49c130d51cfdcd85eb2833376b27441133a522d429e3c47aa857044aa8be9b96e6a2deac901e6cc87efd4de62dd93cb5eb0c4a71f5aa456e1f1dab1a8958c7db3a20976d1a0d3e769416e7e1217155bd6a281fb900928651ca980228a8e65d70bc0791c9f49a3cc23c4ef6a93841a2156236e5d593c44c16357e15e13f1742f6b52ad7d9af44d2e8cb514abb0bf729bbb0f329cf233b973e89f2a50a34134a65cc08199e519f79624982a7abaf35ef4bf00d63b3b2e70c1fd815a52b3f52f906cfd45ee1366949dbae82badc1418a505f9039448a20d9bbcddd4304992de7bc678940c58825417cbf2615a13ca75cf3a13d2f6c46947b4a433cee4fe38a4766af78f73eb85210c3178d0966f3dfbdfafd3f5e13f0dbb3d031a0c80cf1a171fc6ddbf2f8e940098bd20e4df1c81f8f48602180ec21ed516f4474d09072d69d0573ccda35e3369df25707a28895b22bec2f8985acfe5788e6835a59d07337f95a75253b3eb67b3d1e6627e4c21df99f081542ae952b2b111c674f0ae434e726923b50210fd7d8950dd87e46b6756fea457e266819884916266f14f8146eac0747d19314dedcff56e14a0015c7f34f5c29a0f65fa443592673c1415093530c427135e386115c698ec7192b839315b0a0e21cc0a05067b9d44196b1b7557a9ad56c64ba6dbbe59062d6eaeccfc3d08fe488badc1000906684807dfbd61cdd601adfeb6e4a38256840769b12c00c7f38bbbda437c827c61cdc780ba768aee3d5e08b45bb9496c990ab293729714714c8ce89a51eb637ffdf931ebb008180e8908a5f8b0bbccba526a9a7ff1e6553db6303f9535020536129cc138ff444cb55eb8eedba57a041dc3b4161ae2d730a0bd40c729c557e2bd65b50a822975a4daa59d0035f7cd38e4163b21257f397e1355a1d954ce8dc19d650abbb70ef2df81becdf2fae5d3a3559ff56227ab8975921b1469f4e1cfda17d18c414fad002339f28580b213f926c2061c4ca56695ae76763e006197ee518abb206c7e9ab222b748df4f1267fc88ee94561a20630f4f4b193864568f2d6f9b3c678dbb409da37f7f7aa418304f732cdb4b4b75745dfec3277f1004ec1621955599acd649db39a0f04b2749cfdebe8f99dfd3507821cb7e04cf2a65e74af6a643c79cb3240eddf304119c6c764eb9e22197c5c1a052bf8ce890244422ac30de224dacbeb52f13ea6a82bb85339445d9761750bcf93c09faeee56c6c667705f38cd31340f061f00e4e42fa56175126daead62e4187d4797e8cf8d1e24e059dd60cf2cc21b0d82acff2bfda770a4c3cc89e309e719adafa1e3a4bff45895bfcd15e07917a8570b3e0666b4cfde0fe4408c89048b042497ea0ecd694ce01c0ed047738e983d153a622d74f66bfd4832bc28fa445ebc90864d46d73835e4113629ce554765c8216a25a7e23b22c425a5b516807ea0a7bb4351b1f8b4d14583faf73916e7649567ad1605bec090ab468382df036ce7785e8054d25b4d0e90cca361018040e4239455bc874ef436ebdefd9762b54547af6c9c0f11fcb3d866d1d859303db8fcd715897b92ddac75629202f85daa1aa56941dee6553bff06b49084987324c8f1af5ba533c1b8a80d832d3db046f675deaf3f48cd9911f2747e75fd6f966b51f99d3a9345b85d3acd3cd1bc390f8f71eec9432894cfe32f9e384da9155a967c6ef01c7b1d215eca38a254cf85bf777b42b2c17bdb32bf10f44fa2c038b51b48ee46d6d006603f1eb3b33d770ab8d6820ad7c46f2102876734916724e9b9d5087d1bb8499bd0763e9a129fe40cb162409abc631144b0615738171fc470c2d52df1bebd4856a4d032f5aeb30d85b990291f46edf1e95483457d60aacf07aee78858b86446dfa547491d0114bfe0397bcf8c56787fe8e83a5638ea49d8e430afedbc91f0ba4b15c3c0aba80ac13ca97c6a05bafeea3bdd366e550cc4d3327bd4992e0264454c3db54b46cf060b51e9f9f451ea37a31d29b9766886eab20145d756e59317833fc1f1dece8bfef7cd2af093d20913dac9c6e0ef7054dc19e44470413fbc1134f12f48a99398983adb08f00eba6dcb887536317863ad16b11ede378ac42b82ce240b69f62fd3f57a37e90b03c2ea12170aa0efaf84d41e5b987c3330768e2a59d5d1483eb6bd29cb3e6a62b5e674982ea84aab709a0d3d04f2d2765f69fcd14078f91e9115ffe0b6a2f34e834fbc748c73ce4c22815d7b2b2dfee9aaf49bd6aa55cbf810557c88cabe3f9ec271bc2436447a591342639eee69e7e9f001167718ea3e45aeaa9efc3f760a26a00bb8391f26180c4b34a1b190f0137ba53599ac23bc2c19995c7cd333f4553d3190bb4b3c90a573124e81ab23e2a1e9879f747d80be4684435e0c9a30f1e14780b12842dc402536d193017210b1658d03594fd4a50d9c77035251a176482bf15dd06aa11361e773a3f55e85452db7a7899274eaf38fbc6df7cf665229d2fd2f61400294b83da603440171161fdf663d36fb103ee09e0c5b98e7aee5a6ba6c84d69119518fc9bb962fad91dd19fcf834ca8abd5a68ea4fcb8a4d2bed16abfee52775e51ea29005cd5ce747c22fe84188d5d64225d8535106f2c6c88a8e002bbd29346e70c635409c98dca162ac0f000e3b44eb32ded0ece8e5b92c3b47b551ef19459717bf7db2639be0ee81e4f51e85a2ba9941a079204d34b3535bac8d23ded32822a1402c08fc4be2f06fd3fc61c4c68f42c175f620109e61a6dd5786eac59d4d0929144ed30c08a16b9f7f2a7eecf5eff1097d9694730521007b3a9f1eb3b07ac6b5fe924f6613697ee36ff1ae88af17e3eed812a0c591500c5d32aeea06b3e84acbd3a123c132e71343d7f8aa8d5f914c9022d37fbdb6231f58a04b6b66aaee549acde67bd5b8e9f688da592c759b80619bfe7173940619ded1d445d8bbd710247a4288f460614b347d111b755b5b99dbf1f137f055e8007f4c646919995522adf1de1ae54d21f1b00f375066759914069d68689315fba3692b3a979b8c141dfefe649620f57ec0ee18f3bac7e04540d8db4aa1f667c95bf4d6925ca826a5586c10aec551c27937248dd3d4cdc9610da91905c0391f6f2b96d1be022ce28b393ae1e6e43d1502e4868f6a78affa96a7412ed6e5c0d8295a635c32c1a72db7e5fe7748cf6cfaa03a1cac0fe95365cde85fcbee8942cb52cab07887814f7849155377066d0c2ca63bce5fadf27455143a34819e7f2fd14eb7e9696f860371a7fbd4173effc8886c32a097b8cba3b73f6a8bcf8daecc18d24e2f002c8a97aa4d7a81e0274b5c6cf95634b3955086b0a686c7d4d88abe806f604ba28a45785e060d224e2ca8769139881f262c57d2158b645f86da2ce292430ecab6190addcaf6342f86734fa7e4333d8c7ffa5965516369c04d10a2f0cefcfd1fd3a45e8ca6c22d2551af366aa82c0aa65ddf7cd99b12f418f893d794bbfc1bb68e8fd4dc88a42a4674708c2cb204828ababa33771bb6d8f02fd9bd9dbd00e48ac11fdf6838fd8561d43d01bb5ea04f3b50ad2f5b0ebf0a35c05762bf8d33ddce3e08f8b242435263f31b8080cffbec0e6d8e97af17af5b0604f618a314e2534517d8861d4547196dc80bb1a4a82045112433a695d131005171d4b3707d0d19a2f61b2c7146442739ec2c555af4d99bab483acad0fa5ce8ce4d19d7a72d704b1563c76232392fb3d5ed17874440f99c377fbb73565877b3e29dae560fb5addf9ebc4465625e82fa580afd4b3fae935dcddfb96664e7ea3d2727d320fa81aef60cc1f9f4963e373eb053d456b51cbfee5aabc159ee880b087a4f194f091279cc10c35a256107531d7b36ac32d356c3716e32526ea8ac5da54009d4fd51e7120adeeb6429fbee8459a3dd90526c2d136250bc7255993679b9fc741718a353672f83b6ac097f8a7eb46b805c29a85a610b8a7aa019985b1aa2be4ddbae31f2b0f0801765783de1fabac34d6f19e2b53e5a3d37a7c84740a5599d02f19ed3c5e54410778bc6b481e63819bc8ba3857525f855ff11b66f490537dbc6f9bfbc83f9ae241fb7c6bd63f7f9db1f8cc088c0f1865c66f129e4c52b30fbe21f973b80d5703a915a2803a136a443d78dac44fcc309e1358463cae0e96ee676464af0393477d98ea9ab36c5e5071dd43698651111070f4386731bd8aa23607eba5c0910d24691dfa92c87e2bddb1856f8b28e1a6ddeb36fb9042e7192b602569a456b139ba587e1c27cc32112b32a3ca5d9f7639fb9e8d6577eeede6f3c0916668cb57bd41a815f70d21073bc6f3a66649303946d4cf3469574f53b812bc79a5c28fed7d0073a84bd06637b1339460254b9d798443926d65f3ceb536aa56bae901b68aeb345bf2690f407916f1b0c2f9952fd44de9cd2afb6e3250c5e97bf03424ff13196a00d9a144f7cb1e1fd99f3c7ae2db11a8b94ce0d47a6c27e6387a6d150617efe73672a5bdb27cf2ce72c690dc81e438814ad533b52965db99f85e6c1af1fad5e277ea89ba025557237873f1a8487103a802e5e0d5c2946abf3d1d624824f6b409d072b6f60fd17c73c96524e38cc8e1e8b8c7c8c7e81e0e9fba4949f0a37758fd7b69809f45c6bedcefdbf791951f31b92b0963c6b43830d8b292ec23fc6c293a97b199e95991ad11046eb44d55d44c3690e8ef92b8d891107cc99d1e862364d418f9bf04edcfa9d2c471ca55300bdb0ed78f0024523e07a5cc3ee02a4d680a7b4909d059a5aa2cb898731114bcc81aa5a87a5d132296379dec2ef0c34518ccb70c23daf3f98f31982f39cb9a4be38add34ba01cfc545a32b47ed2067021cab4416de0507baae162cca518758bd3eae0296cb08c0fbf8487ad0ad3eea0496dada317702b0d7c09af7dc3769f0ba88022d57c69deacf6fd59247f632489e668b8b8992463f718db88814c032787263ddef8c2366d632c982ffd937168e4c5b579a12cbcb101e9f55764d8be8df8f0132d3136d8ddbda9dd85cc3f81621794d3fb2026902aecc265ae04a379738dd51ddb19854409cce4c2298d16179c988dcac9aa813c6144a6e5708d0781991fd5bb92a9c402e9fd7e93f997f24417263e500f170ddedffab9b69215a1c7dea82afa8fa5f6f5abe38ebfd4275c9e508aac1f45fb061dbfef46350729e2d679c9b81e82374b40860197923b3a4cfc28a7a7778d3ba53d6de962586fcdc2c1758a4e2e309e98721232136d18256a38327b3ca69f27cdf9802228be4ef884def0c48bd5756ae754d20199ac90fa28c22208c3364398babc6a72ec160b36877f2000d294cb208e1f1f740cf39f4806029d4d467ca85dbe0ba3819bad71ebd21c28b28183d44b708e0750460fb6a7e736c7f9afde91f211ae8c939254898b06b5d5a6117d09b06952cc3dde833a25be01d440f7963da9e395dc916cb0f84b2d2e41e58588326221aeae2de7f1a1bea5c6b64d73e85e140d734dcf2895bb1e4263ca8f2e1bc463b174d433c896c94593812531bd9d19e910ea71aed8c52af67dde27571ff326d74282dbcf94e96d1d6172ac66687c94ccd9f3b9f6793b7220d892a264ff0e14c6844847c16292676bed6370c57fe5370f915af514f6f8ca724c06631786243fc84a444474866d71b8e5beaff84a2ed31bb85041773f7559097a45010816506578ef65ff232b73f59b1e4c8c2377a000b371643de088a46e1ee00bb69a9b5a0a0c4c3a492873842138bea9533cbc345f487d8dd8bae4a23e701def843ed89fa9d1c41efb275eb855b60da86d5b5178151add2a440973a4af1ce3dffe1054983ce2a5b14400290c5b4d67cb874f35b5ee9cbdab181bc13a9a91bd5e7a7744c141a445c174f82f42a25664818477bada5dd30a124c624efcb92e1e8a100cd8a41d7a66bd071ce6818e0a7f96200c44452548e52c99b440e2af03b9dcf5e6278467c94b54b784048849e8535e73043791dd7d8afe3369d767ce607e8f81586325b1972bcb0d1e4e9d1fd74041320c013ea6bbad38aea977998ff7409d3f69ef21923ad00936fe00f3175f337a16c9f3a6a28c93b1d94fff102e4f2fa4dc82fda2fad3912a3f87bde0c22b78fe0ffa28e0c494227974d40971ccb67fb373bf29335327f3e8afd98e977fe6d12edd319a82a749781279179f59013a06c943126ca93fd2d123f1dc313915433cf03cc4b4c0d7bff01f50c382524307bec35da172e2a78cde4014001d16b902f61c96921a4ed6ddce9088f95d63e206b910b855584b7801758632bd36b19f215e987eaf2e1e0a243b7d03331293d27f48867ff1ad4c28898c596d4f4b9ba2944ac89a4cbaa56558b3534340600b8afb065a3fec17b723035e55ef45a9e2c5b51a2d679319c7bfb01b42637998675952892080d23542766ebd945d694c80eaa3503b8b3c0019385c614f00feddf989bc4280b164e39be08b7a4908c252066ea9d7b8c93a1b0664f000721ccba9d02100eba34dfff9a339695ec78696fd0025cefe3449609833867141b9274e8ba5db41d45aa913a4c92228bc58ec9fc015e41607c102a4a3da57d5b27f6433d5c6bbe9f0396c0203fffb3ad0da9ba8731538687ff19d94ac7ff03155bb7ff053d93192aa8dc84fbbed959aaa32adf736d747a33a63529de60834b90211c8c4541af0e43dfcb01ca78808ecf70ddc8005063c44c9a58ff8d81020eaedac53fb3caf572ae85b2b54f3821d938ad7ca102c6b6500dbab2a1986814487c438187223cf1783b5cf465fa674ae1c1ee04d30e5eecdb4e311ddeb3e065039061e8f7260c122c71be3ee0a4a4d8aae98c705916cca501bb789daab2633349d3ce6d25322f24dc8a74750ae0f39d72bc80cb0ac5a54d98a864522849de551b36bf760d8769de0e0eb67727ab449de0225bf442debef5076761dc4a3ad39c1fbf0ca91385bd8fdd40460bf0d1b1f5b86b9eea411804795954b88e9e4cb51c3723bfae97ea36c9513efbab34d205b343a14bf84a9187270a8a78f7b63cd5efb1f59a6901516bf63d86d08b2e6981717b25c09ee31a34383265060f22537a33cbeceba4bed3a7c1ae9953472db2b09934582bc5ba68194f96a2e217f43f2e0a427986cb700b4c6b62d4bee9ff315c27db46cd7e8c544c7bce977ed398e94b888273ed6c1ccad3b462879df3b27fd2b78da0c74d82b7c9e44d8865b08eacbf5f9105a69466827fdb166f98bff3c19e1e6fafca408a2273d25689d60a7bf2070d93acbb6b5d8f4e676c044bf7849b71f1db6b85647e9d8b60ca86cf058b55236f4b636802d04f3c7b83283d95022d420b6b5a5fa59733b1f09227440fbed4f215971df5de595fe077a69b84c77fd889bf390c54a046839cdf4e7194813c965ea1a391606aac54137f1ac719cc56640a62101dedafaff8371638f78b83c8b6c1073f5f6bb13208e35e5cafa0daa21fc06c3b36d50ada3a051c854c06d2877db717c72bda2e9a4a56d67f717fda2a541509ca0e33488e87bd74dd88b6d2a56df13bef16368453ae6f7859d3ed43e2aeab450c4a8c437b69d56e605ebdc57093aa5d49ec977a5d2466379736a0f4d806fd4f2a820712b2680457b502dd6be24b150a1275aeac20ba15f13103312d2eead6aacb1febabf2bc05113516a52aaddd20719f9daaaf91b366c137eee398303d9e838c51a7b265723b9aaf681bfa5d140d567ba51c55d14abcdb389e45e73ccb68ac65b8ddbe0f649ba23635f8aab6642e4dd073450bf7966aae3080467bac8f588d927f93478f138e1d975b00978a3ddf98162489449772321f70e34d914acc796752634681499e53ff9221570dd96e41e271bc9fd104ade6c454f64ad93d15be5e9524a71a3b3aca1d116573f06c95e5c6860369141411759cfe20866b79caba859b013a4b2c43384793243936e32862dd2722ef05381c56edd483616b234366ddada06041674fa3aa2ace2c51ab1733d4685c28a12c364830debcacb14288e68d69979bde5a7d700197a3b7e2327a8987087ef6a732b7630aca53d7569ad2ee01385e7f1125c473b5905c727ef2e99fe460c408ee4b79094f92e8d4d9c711b25c8a9a15e008b7e6d119d17e59924cb331a1a6255ae3347a4b4607ef0e9b27b57ceb44c54140f384186be28881a45dd88db80337d62561b9d4efe0b575ae943eed4fa36ce14fd53c1862a9e4a3839bf740739171f36770885b7baaf714e8a0b7b5ef40166f048798ad8b1d071c832af7658835575d9ac3ce3a9b7b77941f327b48359e3683f768a601a6c88ccdcbeb16904b8ba4cbb6e827e56a80e6ffd0b213cd5b643533befdd4c572051d2910f4989735949bcd58f255d428b63e84956696f826f4d9c8a60517cce4b47ae1a979b2732a48fe6fa4bbe49d234f76a0a5c53ba335a2a38366db5f5543c1595101d04882ed54b921bbc7fb1ee8f0b1fe011c2f917859620133a08a07876c59e7024c72fe461ec2e7d6ceef173f6a5edebccf91009f20a6903533dcc5d33552a4b4318c1152803e58f556fc6aa00170ff3d62aaed667c43c4c08069f9a3053d2dd7c62ddeece7bdf97c5d1d82339b7b14551608438023f29fd04433e2423a03d9ee073fbc796481e69b6660c7aa19f9d2b614d219d9a1ecbc3257dd8638326bb3c90ab6832ca917de7c16e0401a751e6afa83c8450da8aacdcdb05a52c705c3b079a5a4433987994bc9c58ebde8882e781c39d7d3d7c0aae30f7edbcf9ffe5fb03593fb9f602720d28a8ee18d722cbecde0219c9d879baa5c786b6b41da444931142f2194faeb3fc445d6647006b00bbe19b887f2e3adaa9f20a247fff462c7c54f10325243c99aa69582734f7535f806c70e9e5b5fc28342a6d105c67895aa131f6ddc12f4eaced2d39e942cf59823d2742728a1d9eaf3150d7c8099fbc739d3f6a13e004348232952fdebc27b42fb88b3133330cc73d4ce5025354f986cc9c4f5df166b197cab8e8fedbf2579362120f63ba0b893e1022fdf6472a15519d1b959545f83604fb2ae2d9d4482c96a4d0ca42b44dbf7c7d3e16a6bb9386e7f213bac5cbd88ca2916ca3fa6d06602564cd27108cf63ed8ec28070034d7ca9d670a3fb85a2d5c7832ed949e75f7bdb81977bd2b01e35a0aa6509512d4bcdca3682d1ff1abf85704e57d54d15386316ddabd360597453f0ab581023a4488e2ee16c578827f86d6d9da2d9a15e5b3d761ac18bb2fd98feb828744442f7a4e11d43bec294f96444b9a154d9b679a32f60781badea69ba0b94f28233a0d44df1327a184780b4f81380e7ab4dc5562c0d74cfbdbd97562f4fcfab90aa3b6ba9737a3f9ba00b8d4145ca299cb8447dd380ef7a8b28ceaf234c7f56d8b63963c6f12b85d8f96aad8d53efa12f28420885b8189b9c5ae712ed172c95ae0c9a704c15f43c5c76e2c6bbc4a819f3b14249ad81d5349808d9b3be07ce0efc17a2e667cb29955620b05ab4c36d5d4068bb671c7b99c1ac9aa28beec6619d3abec1d1412d0a3c97688d0e905d4bb5ee0f4256aec2f4b07ed8a569c2995b0ebc56f8da5c184d87dc5c388455a8a0aba79674aa9c0ad7ccee554fe5f561fdcd7b4008820c192dbe149bf3b4dc694b670fcfda4c565b3443be9d9f7feeefefc6b5431927e6096a5a71efc479702eced8cc792ea971587ada4a335a07111803ca1e4c67e2b33db9fee5e24ebfab38e2092fb12cf155504e5f8ae87f8ead0de37fa4b243c2eeac03bd2699d931f324f679c1b7b62c0f91c4b2211fb34a97475278ce9625cb2c38afd0e9a04e2686bea8de4b0c8f637072599dabd36a3514abe5140bcaaf83a0b4a941ac831723f53f9278917a694f40a156c1b96d4d0285f5022cfb670cce098ea21e9cb042bb060e392dd238f81ee83fa7e0e38f4e76ce4bec2cd951d76a10c6a1d9d3921a0afdbf42e1eefcfb8a6f56c94d2cfa9faad2f848eb2cba84172acadf70de4de0ad787e7fb358942d2ce3467ce60cae6d124bddc1d8bf36b3bbc09eba189dcc895ed28cc18ee9ade4890349e0c19e2b4a0ce770cd69d37497c31813fc1df3b157819be38dcea829f4f151dbae00a819692dd6dd923c23f0fe5869b7531dfc555a964195b12b1cc670e23e9c76384bfd04b0e09ae1881ed845b472a5c9d08430bd9618013f94a0372e0e1f1c6f994e0eb1211041ff07adaeec3790b5521ccc5bfe73afe48de3b06d0884c9fcf11069a0042db363e9a7dd14efa42f338d49a3227e91d8a5f979d84f3bfe962b32836416af1a3c8db9dd1dd955ba84ea924e6e366ba8097aaa17982b99a79df04b148ff24a5f79fbf36e9d9d9a8473f525c7e3aae61f1068bdd356d8e7fa408f2f8a3001db6af0e8e5b6dc1d0c4a97d93ade6150c805226396ac20f227c92b12196992ff559d933aeebc7f50a698efc2eabd680f89ec080999f9af9cd08cdff5c317d1a04486035193592e1611e9a8d73abfc4b882a1e0af64659c0bf2b11b489852e963e53c755108d308c9ec61fa518609b4fa3350ad430d9c5a97b3621ce5f968269985a84457bb05dbf29b03e36332984f4c47164f8bd57f42d751228f741510268e6db1d79318ef381e7c59d82f10f7d1b4dd9491cea40677bc71f92e357a8b20fb76c2df2f697ba46ee3afdf2c16b07d430105fc4bc43f2197cf74834edaa87ce95c8a19ee05dcda69f2a1f6a3212045ac19da1e4492b05e9ae2ceacb3ecf0cf9a8659f180ffd5af677133b158013ae26befb79b4891ffc8b3ad60813be0d54faba069898e1ecfa539ebe0cef12dc521884801836dd431f897ac77f7ff5997b7022f11c008d198d854c16ce21b594de733bbe9557b0393a01b1999d616627c6dc23add06f39acf59634af74cccf77b30cfd2cfd9a5a80b8f87b68c1c1c4586ef1de65ada8e49afc9079347200f28fad898398b9e873e9c100c92b417391449bf8fe99c95df90bf1469159d4721e9597ba40dd07495ce67cb7622704501e883f1516b9110d4f5eb1de1bbfcdffbf31c3a70ffdfdf6acaa3ada404e0121434c2f214d5bf6d96e803b11f354c76249241aac2659776a2a9ae5820fd64f0fc09c789912f907c9050eaf406f4b9322b62c98159cc0464727793be47b6bdb8b874516e633c824b70edf1ea34f661cd96e00b8eb72e1445cd93c801f30eb7f09c4dda4de44698b19c7931d707f16b44d709d267bd16a5d066405d3ad6dfb12312f5e828da594b3aadbaf8e164c258071a9ddf941867527a55c57281c5634980286a4ecc054696da3fa867884a9f57f9cba0352f5cb18988bda30d9d0a9a060a56bb501b8fba62459e1b11919a9c76bbed6b96f8162cd54eddb8683c835c93f26acec53704b5be2c3250a5d60bf49893dcfff1de9e2ff1ec57ab61d60341b3595d2eab170ebcbf0de1564e74fda4c397a29f9b6d3f995a8bde6c6a1e2480fca8964c49f28bd53a6df2a2a109c6aef687e76e33623fcb9300b6ad91dfdcb3f2ad90d8bfb166a9657d38db8456f22d5ff969fce73eae1e711e2d5cb670978a521c90226b10cd53d8622e18b42e958893a2559cd567d6628f5a0f418483f4c3b47b2e14098da10bda61ae5974d864d4042d4725ebd96114470a53e3fa8017be8c143e83bb6b6554c2b8a7971ff431b90f74ced72ac4ada80618fa53363e29d795e5086036a3c25408e64983e2226c6768d4cc3bcd7175804f6d345a33079c0b2fbfda4366f87e8d4c4d0816d3e67e3ca25091f74da56864536a0af45f1482d51f9cbb9d206e7a083f85f1ba8f75a2ea022b547810c0f4ab6289e2567ce6ee988ec37391ea0f7f1a8a2e50c8bbf44696e5e68f1054ffab5a56e8bfde6816f51c321245330a5ba7440e40c2d9af04d82502050db381f48cccaa56117ea2d77b3fa006b33b4ba0bf40e02f27b9eb585d4ae691da7c57a95805a6f5f03999ad082af6908f5a1428422396db474a1d18361edae09f7e69c22fdea9214b0b99c72cadc05c6fdbf49fa0edd3c54973d40161217d17cf5f1b2415db10f6e228dbc89259baeeb79f641a2da8a0866724c729e332cb9fb0613e7186df55b777800fd26b889fd965264903b531579907b059c58ccdc643f91cd9ee35c717da72dbfa55ae29c86c387dca07b42278370dd77402da9e675df9781e87ace59498482cfc8328501e5205a422dc74cc566bc0984a0907c6ba5c462691280476e88ee660d2352588d9cb9411a3012c22a6408e76ee6296a5de4309c5c6ca336f73136db2b6fbe92cda379615e95a4b64ce85e7b46354bf8f5524fdfcf1f85631f7df1eafa33ca46930f0b3b79eea07eceddbfaf3be40423a5e0d92055bf473934f06e342b467fea58c483819e06fc18b0eeb572d176aa2038fc78cbf7a213209dd9cffd42dc932cbbfb8123116ac93d61d78b3214a7e1a67cc2bfab33f08c371930d6d611f0041fddc1d4fdd9fe1b9b3c33178c02c598136dc4f107ed82b74a0268e12cdd8d13a20b59eed78c26cd22d4ee24e430c6e355e3f17e4990e1c9d5993d54631f13f096153c5c15ee61b23ab5ee9781c080c443e70b8dd1d63e8b6596a8d6dcd3e892f425126eca206e67bd8887c4411e0df950c1508dd9cdca1793fe5ebede27dcd26d3c509bc84963330571c83e2fcf65e881508216066e5d5775bf08ce54778f5d5a21b95f752dbb1bab87f68c02bc5ab0ccb503e83bd9fb68921f22dff8d3635211f22053058c3aed7c50cf4a67eeb0dc01638235463720de0f17f2dd01baf6115d17d6b89c4f699a144a3f0df3ce16799c54a33d4c141d83538681bfb4edb28b69e454424e154a32a24dfe8ce9500946d8d5ba7797453aa54a6d120a9f6989b6e0c1f39d03ed31e3f9d3db4d3a80e597ffc0ba08f87635d751ab77d19950e9929c52599b2c75c71883076410a80eaa1b4729db22fb0c737cfbabb9319d76e7610db023d538fa9272e4ec44567136d5bcaa328c24d1a97614e0d4e33a423f2c8f41872492903686dc101210e7a7334bab26035310860e1d5af306a8f1a847c8c00e983bf4a2be8dad303d03f2d21572152a3e96241f215997357c1e669bcc13eb150090f079750ec86e907d888183a586179d63c839620f1ad5079bd1b68970f54534d713e2a40604d59413c0b0a2393db07baa72c50fc530a1ab5f72c41c3089f62f13082b17260b80f67a29b15a959122104dd0c4c6abb6f061df4d2dd33a3de975b859679dda012b540355754811580578286bfc745e05fb500c843c3f9aad3227d4c3096122ad26f754bb6fc7e26e17f27621e2730c2e95d66a0124c065672eb437bec58905ba40d6afda0d6b268158bdd03be815ae4c1245c053247a5da9dd70ec41bf83e2d7a50c0cd647559ffc49b7dacde6fb4be222da07e64ac84fa30892ebe08c4c2133d65d54355dc761de3ec5058e7b39771a2f7d8771b6d35bb85e16edf6d3524cc73d67377ffd650ad47370cbd08f3b92b8738ec33b6352d866d0fa3f4a6062db8cbff842f0834f7b84773d96de025e8ba83c4ea1b64d0c66488fba28a22108a2468e9884bda1d0ebf684aace5d517b1ded31b77c7860734bc921e8d43fc342988200fe4f29f7617d6832999bc0a459ea7f64e789e6050a70cefd1d44ba40045bb579b9491a8c70dde3da70a6e80f670c632a19db77dbf9a4d220d39ada03f54920589a8a1bd64ab61695c445b7865a4194f690dc8625e895bdf17cf66323dd695b6f239f17c33caa68d577f97609b1711ee0da83fffb9c30f90c9d44eb0a99118b99d5d59e03119fe131e69fc9b6b92fede3a9756fd5a35455dfc1e9ba4c79e035734972c1c656c113b7b394d3e38f640ca6cc5313001d3e55a1aeeefc4b6b6d8128d33f82ee5ad80a9233d697d10923e8a8c49ea1db60ac50cd6829812011ab7ecc2a3a078884e361eb56e655240802729ebcd5a9a7360ce51975aa7f39e451e108a5a69520c6fcceb67448b5e73a781898d1d60ca5c4867354079149f78cbf8379f53992cc17d08a601c88b99d33690bb2aebe1b0d881d4e18f3e4f6c947fe908c5cd20eb805bde693c6019ecf330110593ce39c5a8f7fc08b8c2f955cfa7fbde32796c833ca4ef1e9ca144d20fe0dd1ccca12bada40165185cc36931221b4a6d438178c2ac79da4df446b3d26c387ef73bb1922ddfb6d9c88d1313255154dfdb943c1e4fd42d7047bbdfcf32f4b3d96f6f20a7665d7af0083f6446043a08fd560320536c509733ab3e3356db4a9a771f3a677ca5de1ecf84e9237a72f8caad02704895426138b7d7cb81ac45654b08a001539786de912d8a229dac028884fc6ab7a9f6881cd92775792852668fc9cdaf81d950dde3675e7f04f684eea48ebb4a0ff6785ae00fa8e4f4a2ba00e1ce73cf0e9e47333ada5efe67a2e7fc57fea9d0b9d966bbd8622656c2972b624d7485765fb02b2aafe7733075271ba07c3ec6ce0d480c86f1d1bff4e51a6973dd82acbfba58227ac2f1c9c0ffc5b00dce23092f252748ddd80fee1d16868f933928aa02c7517f2d1f476821340ccb9cc1f42c9141f8e20a5aa9afdd0a9ca04b46c42c4be2c8d134044cd2dbfb6f47d3039be61c21c0fd016d4d1f866658508c8e109fde13342fe34c43d860d081c86b261aa3d4ee10f2769b2fb6d454bf5ae4833502e574147de9fe402287bfc23680e765bb7d1b87822d667cfeebee837ef7d40e55cf4df14ab1f0c97b4d6aa6a73c564fc836046153b27d24f292d33f49606f4733dad726306aad6cee61e58679128c093079b2f21ce73741ca187747fba0c649bb47d3786528d9acd2705c1138d3297b8d86331a68bda0501f932a85b64494c598dea581d483fc4c9059b19c8a5e580e6c452f6cae6935830d522be891ee32be57470b0190ed80d4421420d85b1c8882bb4692656501c1852caff1694a3c9b9f07875fdb357f1c2401ac3afe1cdc45315725eabbcbb149efdcbab551e2d21c680937aeb60c8392a7ddf5da3e6538e47ae94afdd8941647277e6e542d9c92a3123a9162e01b2bb1efe06a9599957f25316a5327968a8c0150c73e32a3507e3299f39dd88dc2b6a600808bc07a5060d3adc2a1eab407598253e644426faf4b17e0c67673a777ed9a56398400c470afcfde6c88e4eea7589628ee5023eb823607127031b62443f68c0be85ba71748e4cc75ee99bf853f4a31c6522a4d53027f4d3d927c1bfce77e34d75e4863f25d30cd62ca632d00e900f7d2f08489ea2e2cc353b68252b28fc95a5bdf9e8700af227e7c9f130d6d35500f44882f15448418199c5676e84449546a515eba138fdfdc0214efaa936229649a326aed33cf596b401c3f918ba97692156a39ee0080494a8bb56412f1d483259e1cfcae4800e1a6e2a1f9946e2cfa5a02648a517d85c95a5f6bbd4a2d212e0129223cb4c3e62b4a0ed0ec35cbb6083ef96343dacc9d2489f3b8c524221ebe06419abed4d8f70ddad3f4cc657be6cfeb351f2d95c08ae86c0bfa7cf443b3556928e55609acaa5fa3ca209b0334e344f8a7a99bd59c55d75910cabd86cc7cb2e4950ad0b9283e90d1f415ebd490fa1c30563d4b2ae3acb815f654622101e97c3805c8b554aea38f81c3ad486f5284d7a01df77a2c06bd2ff87d45eded92c606e9b8162e62b4b28963d8dfed9d0db5e088e73bb0c050466e8a4dc4b7f772831f8d4a1bcaf930935100bff90bdf7de7590ce78af7d484c97fca2bbbf20dded34f2c66e167568d8c199baec24cafdd16b24935b6c2a27667672cf6f3d5f07cd036f88fc4985c9bdf78f8114e942585d9cff423bbcae75e561fbaee915778b25d3f636e46b362e95ff8edc2fc474d2a03f0436e07f44f6297d02303b6c4d23e39c656441a1059e74b4c484eceb2b8f7aef672216199a0a8f163863b32d42cc28e85bffbacd5bbbaa424c84ac3090bc9759733eb07ca413cd3d9e44505792b935a66c21955c0c74fadb98059e895f16c563dbece703962d28e466423bd03de2c5ca122e8908a109239cb9925dbf8d6bf78798e4e3974cc5ce828fcfceb838ba47fbf3394a69dfd092b8b745dd4e300ed4830fac994030def95bfe3f2addb3c4b6223ef15e54446a2012e724450c7391e950a125e0d900032cb58168b24a43e409bd4ec206a3f612c87c8a9bd32c045f48f7827ed5698f6f5e69ceacbf1b32d44693372ed1b209f1527e076cfa984e50f9c792c096a1a918c16fc28965f4e556e9d8d6e3b5284b27c41441c69d50db25329d38643cd6157ecba8f590ebe57b58523712623f72e719ccd14b8cac51b3e38e328d67c899e589f8fb1b219b025e759689f8aa261e6412a04f3732cd7b6e3959485d2531c9f98f5c2a8364dcd04acaeb3d8b894ef1a395b48a4d0b4b507fe0956928b9f8bea70bfe1ea04104aaf6ac2cf3a80dcef89b9d415a2173f91b9b17cd2523f3d80baaecf5f1592ceec3a0ca529a0d9d7b952a1c9a240a311c56e7df0b9e7f972c2294e891cf855473a7b8d0a46c0493481a99fe3be166218d57e8a7e9a28599bcabba3a15e83172498538d3054c8007b2c9d20ef14789a9f801c8caf3dff1ff1773fc4d73531b012419667aca144b65712419930d183c1678da4a49b756b5f2a30fda9193c6f2c3b0535c3d7e596c800004c61acbdeb2a8f47d8e7d017bd81eb022cbedf0aca25322f774ae80cf0b9ec7107de3a0b02513caef680fa1914ef298b21902e63404d8b28ca7a8f52c73888ed7af9a6cc8de690171df8b00b5fa7c68f88c1b2599a4ac9db4938a4ca3641991f66b70bf3753506e73e78b54bd9fe09f128e84452a19e3799c99ea73b8433851342b49f9ef94a198dda6d882bdd5915837d2c28d48210abd2683bf472128c43ceda26d9622fc412f0fdce8c573db4e2cc5c877c616c159506086df737c6b7ca4dcb497e8013e5778a8d6516753513ba90746038d2649af00b9f8151d9251c7edb80e97aef67a056785ce7c7333a985b0b0b3178d3faf52952a9fb86f9d8d19d9182036f38c2a9960013f51340a9a99aafdbfbac92f027006c5a10c26e3cb481f4c6be362c3f32c37e6100aa106fb636f9116cd20be1f0a7649816392ac9fdc6a6d91c38be591d28cad3534ff0211aefdb0f25e1694d8b606e321406158ffeaf85d4b79c096dd81ca91ec9910a5de3b4de7c9027e7efba1791cfc1607772ae1e495ec97b6efee697ef918796ff40bc7e0442aa2b67afd38c53aa7771a64230d2db111f2928dee271f4f7d8f1d861f58b2ba64617cb43e495a31f38062ff58a65cd3327aa1139ed107e5016e8c4561a8b56ff38b692f5d2d574b2c48cb209db98946891ed253afc4cd7e6df8a0884e469b1725776e0900725c190034a36d7a0303a3f7fca8eb908b8cf047166e78712b38303eb953cd14f018980a3b6820c745f7764bf4f4204b92e1cc417575d9b427865c0de204edb2eb74ca70461e951af80fb7618832fefe15d6d09b73388dd2496564e6056d289ac99dba83c0f2f2eadfd42e68e95acec67c63f467364c045457bc1a2c96b763ef7a1ee79a83579f70976ef0817f4decd3be02ebd04d796fd5c0c46bdd9f42259a8c4028492df1c43371afa35182c290b35f647f7bcaa5242f5c1749cfb0389c9af24e681fe64d9fde341aaf56f3aa79e8b05660afe14e699a19e113210837bcf979d935e7dba3d2b590010a341f1942bb7878412fd83ca9fb9eec85ec75811645f0113a3fe355bdd56b534741b7f584ff48231817b0114d745c83ac200e98ef8982c7f7af529f87ad70052dcb45800982bbe79b6728acde2927ed9a943f7b4dc079d12cb235ef5eea6c6e94d9cff1e57d11f76d39d55cac65e1b95db15d44512b2ac33a7817b079e67c83b30544a846fb4834a7c9ea33b3eb9d06f4757d9959e72a9dceaf7d38ae22f097bac50ecbf713892fe4ce8bf5d652fc0c5ec9a7cc18fc2b65890458b07899a1624ff88ffdeceff72efd411711a0a3793e860b41d5fd38495f9d326d2c3d70a436ff259012dee7f8b9dd37e14b62a7029428d69257c0fb7cfa32d0aee724099e9296905813feae49d81f056a51317768b6197f9bbd29a022ac7d306ee0403a9d433e42f4d6005b388e4384f01e29f69984fdea9ed6391ad5c09cc0959424e5b2d22ec0be65b80f60ca8bf02b7367250b1d1270e25023c55a2287e24cb7e326df2549a93228bb6d61f693be37692bc8270f343c6500467ebbc252c6cfa9eb7004fe60e53fabf0c6f791a7a379e45bb034d593d7f83b4004aec36a29d4d4940cc176e6f3e9c5e9b5ffaa74ac12e5076fb4b3f10caa6d3a821f954b8aa48d2d06d8b3327892347a3a8f32f6d172f59e4b1891597e2d586ec17527c9882e39683699ff50b25d1db9ea0ce23cbee007741d2cd445542a6cb0ebb9ae58a27c6df9c26b4b5e2aabfdaf6ccdd57b8c8ed573152caf21b89201abdff537ad31ee5cb407bcb44d7ee322162aadc5128828001afa57213f824b470938325df2f398fba64939d396dae4326913f8ef75560937fb827ac9155feed5945d662e3dc2b9a466867daca091f52aea5e33801d257d7af9013d51112fd325d31f11db1301e69a478c636921dfd2425fd37c05ce1e454805f6eb7d8611dbf50f031d595c91470070d823b1a22b733e3c6c628d0dde107c88b691166a165029f9bb8013fade613d6db1117f5176cc8e27f7e28467ca0a5dfee170655705d3ffbdeb9999eaca7d9de442a2faeb5881a29bab57fb08dc341d2fc7b66dc6048141c8322715b12878f04cf759bfa43d0a0c5cea2525470b9f5eb57db486c1cdd099aa86f0c766260c1454c6d52b98f0c5e506432d50b13e8c9773903a7c75e62b560b5782ff22c3713056f09a9c97d04322935bf978603fee38aa6d898e0105379813678c9baf5b97e4086a0778b95dc89dfa07ef1c7fdaee733f243862082bf140cbbc24acb6395628c3d6bc3c9f2b06f2d100e79b496a55d69cc68e8aa497b3502ce626e4031b09b0d9f16407f129f9df322b70b2cb998607bc51a6d75aaa1923efc5fc64c644598c499be1e7947a563f43ebc7aeb69fe84c71648bf95ac4526ba257b39c1fa89bd3ee57d7a9c09c265a2d788cfc2843212e0249d1fb51d5f4ba79ead35ad891df73a56cabd72a968a342123f1a089a7591a8fc378fae30504ebb6fad575133c9b8f0c7146e5ff247c237479a1eda0883c1ab866cf633add54d5c06820a99ab7ea12927c5f7d36fca9a4fb8840eacc1126d351af429beb751d10bc4de19e91bea537136b0b50a723e2e782749a5f79d389d1ce440cd178064d1f0dbf81c3d81792c78e0566789e4d8babf502e31486ae6ff6862f4bf068f3c619340bb22601cf61804be76d7519b56386af5df7bd159dd8c9fadbee1cb48e21b06e1655ba7ebe1f40285f025cec085ab577555484fa745e73325b7594fdb91d1e58e75c39858694395e76ac75442e46670a523849e5d5cb0f18d7418b12cbffe70257860c68d999fd4c61b519abd6770debfc9dfc2b5cf1a328d90caa88f7e2779925ea56e170a13cd554d440acfb032dd002fc795c530c872ad01b272ff2e113f8ab76f6da66d3cbbbbbefa3e574736dd5d5527fe788c64f1504b162edb4aba34de9590c190a83ed4a043f5c4935841ea3371ad1a678aea73c5930a93403a123167742206d866a37c9c7ce375465721fbf9884aa07760cf31d4b3b71ba271018c8e3c4d2cee1c7ce6881b006b9743300e42441632558ce9ad2bbcd4cfed4b694e3a27c2c585ab8230ff32bfe64ac2f9e3962b971df814a73cdc36c44d55d54ba0cb39dd7c2bfb385ca90614ae7eabebc52d13b9bb0474e18e1ca938b72f8e6463d066b4ab838bcc11166a0d50b867ea69b68e69001205d2176b6d8f182dd16d5b88971cae474c2bc5d4732331092a63d751cae0b5cec986a4b2612c651d03d04d514810213490337a3772c63ab677daafd94f24d07e6c2a4bd602ca61e54dba49ec034ce0caf7f0ee6b241ac5c31f8fc205ecfe329a291a7bad175e8ec83a4c4cd9643dbece0a64ed1c94f092b4abc2ea2d7a48ebb48ec835f4512b8cc265c48080d1743745dc5ce6dac5a78e589c2246df6495a0efcf2c5aae951474f325c8f200270c71f008be005602a479c06a90394faa1657a99070f458fabe25e16f00774df3a4ae1d3a0c9f133036bac8defb5045674ebaa885df6ac8a7d1412f8271047234d80130725cd481edfef0d6db0045f5d597f7bfa8b6c1676c2c5aaf47f6e85b16aa648cd5406bac592645fb7e4b34641b5908ffc662bc3959cfcaebd0a9aa505a7fc5ae69e88a58af395c3267b4e5fdbe802c18dff7f3a63dd0b6f8866793895b3450eb8aa6f1ae88e9278e792ad97307928a1a7b0b029b9764740d66ff831daabe8ead4552a5e62c4a34f214a7fb3e0ec172b32d748a61067667e9457f8a3953e5dc4d6d6d6e16969a45e530a51ff6ac1a976675ac00a385148dee6fb89c22b459352e8992ab83e4f41fc956c9a6da19a0b8811d75c43e14928b9f3f5ee7be4e480ae9e69465cd5b8895b86a9e2496bc661ada46cb0e7729e84f919685c3c5f99c8647e13b0ae40fc8d6c866d0c97d5aa8b9d6ee13faa1feb6c5eb8d2b2233461309b1c03838d17f1e0d7da228ad83ca82de19863203515c022461dfe0e5a88756453a23b4ce8bc2ec7057923a5c673aba003d7310300252033bfb76017f81f7f66776bf3eac64c155fb62550a0e0756a2ca0e9488e5abb9cb70151374a0f5ef09c1b65262b1b6624393ef6531ef3dc7d9e35c154df37b14393ea81493c6322eed2527670b452a868c00bbbe001eb32782abfaae27e8b444cd32124d6ffbd613534392a889aa571c83d1561e080836cdf38a9b799aaf8962ca0daba2882b9432ef73934a6decce250e3460c8bcdebacd4793e292d6d589c3a4a1c3aea513e8575166bbf141ab8e50343f58220d7668c9484ee148a9ba903af44d5044b99cf6013a0ead6d7b815db40e43a3217bbf54fe52b224cbc90293c4acafa0c430e573f4ba2b98811194a7013c4950755e2420b6b905c7a5a1373838643e630d256711bab271fefd9ffb5400f57679b71b546bc6a5107c74f219a6897010d0e5816035aa5222c143b961df599dc68ba5e613ceb1a41117a6d648fcb354499d9f5db2616e83ca6660d4233d242f674cd6fe5cf7d000023496ffcaa02b551922f7192c73735264a7836a1fa3e66c214fe3dca58eb9c97b582564500c82769ea60f5530d4d3427a66f5f69269c48970015a0c29ca5402a2ba124aba15aa12e0a5cbd6b956e10d0ecd80421a1ecc416244b5eabad4c4b69e0a7ea237a042e666de9c8a70c64a8260028ac96e06b95f353a336706e5411a3fc5bb88ee64f23ed3d1cb99255fb7cc80cfd5aa6b99f51e1481b821cb5d2d8511516c7f23fa865dcd24520eeb3ea3e023985d3055a5df3eab2e97f2e7a001e3eb52f1b4999e7e03ed274ee99a2c38c923b70b962ee6159903658da3fde3bdfa8c334c0d97ba2fd77c9d094aab7740ec0a77881255511adb4975d0dd464fc018575b09417812df45e7bb27675a8f9278817ec97aa6197598b40396f140b8267335d2da48a2ac13028c5a30d515bba3bf3b53638645974880f011cf70bc098416179e68f26ac194dc0cf93cebd56741264fdcca53d99f8fb1d85d533c7b6d53167c867ab12d054b2199c0bc71c8f8e60a5e0d834c13c499fed94ee4b6e7d5f3af18f0eea0846084a23f4da57f977677c4ebfdb7652389fb65839d4c6bde328a1fbbb4246f3dbe96f962448708993412b05907f0838a6751644529839de915e3072feab224d52c498b282fbae6a6c0a1e4bd0acaf3f14fe760873b8486a4f678dcf54817368efeb35cb5d17605c47fa20306f07438604edb50912c349c4694b0de3227dde9fc12feeb925bd9cc7729fb67157950866254f94ef41020b13d1c9accf7436b9d0589c38dc6a5f768cdfe9b7a96954dda1981cf15ed89460b4c823610c06dd4735cb7f7fb1859b3341bd6c56547ee8a321fff01dd4974673811d639c63d8d18defe3f3bf8d930c1683d03b6e013a2c1a1c39ddf1c88d08269d5e0ec9310734c0478f41a1e5d6b33bd55968b8e98e0b3e569d5647d98e27f506b172ffda6a9767e6077826cc7ea818c0244c34343661c5eca03601d416a3bb5b2f59d3ce17c5e48888cbfda699135d61df4fae6618e6a44a87aa4787956fa3ac8721fec4e91b58e7a971c6d24780fec97966f41c6b1148bf1a693ba9fe23fa243aa22dfffb183748b071dab2a30ae417af8e8d700e111177a056dd769646271b64fc52dd3786a2dbda32ad3b83a3329dd73c87a7f62eae4cfda834d30f95a4a8435de55ae2e3886c9bd3dbc3af5d0456fa13467622c22e0ad95ab796d6d41b4a62a2a2db65e2acc8b8ddc9b3a5d668040b40a65efb771cfada6bb487e1faaff7ffcfd8f8c51b7d61095a55094de7f88fe76497dc621446f9f17f4a7174b53d3171d7011e8441505bd17556ff8eb7243c81f1f610578099686dfc5126ee5765b9016128a8f139358dc24d89487c4f1d8f9366347b3cb2b68df3733b2a4494701fbf27c45f8f9969f3bee56905ace16c820f07a09de6b7f2c214d1881d3f84e0e8277cdf63ec225e8cd7b1bb537d71a201f1a1ab862304f97f372acc3312be7c372db0a426f590cc34088d321f63b777e953292dfa43af41680f6baf2d671d582e5cf1afccfaf1e028aeb5daf91974264c96abbff2dffdd1144419731742d22536aa396d5ea0ad11295104d1665d1181d5e690fd2d21c0ba5f94c689c9d218bbd5a96d4685dd4eb75458a8fcaeb14422d5acd9fae820450eda15625ca7f0d64ba3458e5edcae655423ca95826ed533142184acb47e3f594abaca40c6c3395fd5451f571b3104666bbc9097af9809af61754b615382e3ab18c8c0556fb8e402ab7bbb89c48477166dbfc4c7044beb2024d6318ae0a7b39d2e26efc40565fd57ce34fb622f3b2e6c2946af52ea63dfe7816bd3b65bfe87e7fc88b70a9e2804de6745a3995c380666bb94d63137ff6db0df6cb2662475fbf17f3ece1f71d8d99055cef114bb667c0d48c13e5693c9d6003e25e70148a5203e5a31532252003dc8a8672633c6db2cd4d0822c4e85087e36925a83dda2d1407eb32d748c1a6e49175106e646df84efb7e5568706dda58cc997f85094ae4703fbfb4b7208165e8b73f44dd0f4e12647cd427dbc1b2360bbd836ee52d938501487a8c5f8f4d776e46da8085f8914a3f324b1be2a9740be3fb2975981150836ca89d9de8657fa5b926acdd6612d7bb5645de432cdfb5a89cc8bc16fa91fc276acdfec6358d1bf50de007e2d5dbb6354974dec847fa762e05164c98a2ada4cab0f2eb9e338d77b810fd6dbee0659232208058e205af7f383cae4ca4162381c7251aef20bca0dff358f407edd6558576cf800fe34ca1713d833a1da5143b1d194d60ca8d0d753723a2638bda698737757f8366e01262a745709b2b673995664a45d17ddf6b965e5e4a6d4e30f29c7d79839aada6d409c278a2cb224329ce840e261f196b17cc56767e8e2aef99c90e3673bd45b8fa9ff19736a318fd4c9d62b9a700c84a0afaba8ece53166db08942216d6c85c3db04b29f7deb0d2486ab0add90ab7e37340ac356084ca44b7da764ae17ccfe9e0c78a23e31f914daa5adcef08ca44fd9ef433b9a70d293d1bd369473e180a5c80d8caae2351145d36d17b7d7a084cea107a6babba40033be30bf0fd5f9dd632d7cc829f1bff399efb88a3e788f9a3de0ad75f4283afcb25742ccb8c69ffbf75d0ff9be91b38b313917e9935d500b79e911b2fc41121007cae19c866be213320f0616b33a602a8ec69cfd1ec4b16c0b68f72411643f745fcf170d72b40cf0859ce281ffb828d73f36eadb569dad57f239ff25a351bd88ee50c1aed6c8d6fafe9d75f0c10748e311b74b264b133af0fee975b6134ede22387459d363f706ce39a254333e22d2464402280a37bf9600345efedfa790d0ebee36c757d6bf6f5c6591f923826d5e0a0aee014317b062471dfca8f03c085e846f6419ff6ecd1314f0e76f5c00826da1775c06f4faf6e0ca06fb51ba7e64348042fecc008991f19df87f02afdc127aaeb2ae0220b6d0d0163e769fa928d49ed8ae2eb961e1fd7669837067e2659cc99e81b80aae74620c3172e45532945d744efb8f4958d75aae825d145432601375576d2fb13abdd189a60d1b2790cdf3cec43a1cad7346f9eaaab8744e761572f682def764a1a0f26a1d411205a714a94e23e70e56199b1ff538fbf4507896fdb6920b2ab6fb6e2a5c4f449d4e767723ead521176683ffc2f3352bede4a2132d74da9d7cea6bfc1fbe809a2a7d1a3a34dcb4ed667651e350d848292de9091244a171f7b73e733db46e81470cc3c9eb2919af46f167e0cf32ccbaa594cf5bc871ae17b94bc6b4a00237aeb2f6130728cf733b1d6af7349b5482e58fff917ba71586e5262a1ca0403f191e4b7fdca3adc432e27c13a979c771a093fe1f5a98177b9748058c6c8463759f2672fbd82ed560524d19b5055f5104cd83cf6e7287f6934d263862a48a5c0cf23ef9b4839b784a0e584de68e493b6948a6d30d224d11aa9d98a2438724137ba35230ffefeb25d559235815e64ff300fdb2fa5664c17e91bbdd5acfa115f4790e5f931fdb14bfaddb53623b118ad464136c3000cebb8f4e129dbbe3239764f03964706ee06ffb4cb3d2a21e7e43cc0c780eb03b7363d70e3c2588bcc01a3333636e48916319ba99335c586e925b702b9ea5f4d0c2a06dd1c5c8f067773ddb938ce9ca652fbd52361f0f019e4d12dbf0bd65d176e524befc05e28e7967e16a0ecf20cf9ddf6073a1d4765283ba461af8bf3b7cbb60ab2223543a126d46820738b1cd41f2a60440351b14ac64540717d8270d867980ffc3eda7a9b119cdb9877d86211c8a05334c0803680cb424219998979af2d0d490da783fc18fdf4fe8e8de7059bc43d459152371cbd5596487bb8edc66fbc005fe935b8cf3e915932df014e24e87696a88fc01634d131f2e9867fd29a67f2e836736f343186763c15c128d7b070bbe75eb1c1e372cc1475c33dc7a3ea95e0325fdefea1a5b097a7cf0ef9836f2fd231f75d20b8e8fee3978db46941127ed89a7155492d03640ced4f7d8e80fc4925b07fd1f3721bcf2715cc93eef8476958a9d100df2931b83cdc5d5354911a3757ca2a0f09eb1d882a521e1aec3e20fac178c6cc93bfcbbfc08b9e43a841f500992352537430b4af5839a2c8b707874396954a4b6d246306ac5e4708ec6ee122fb4276faa3c62d96d5330bffac0821e1351ddeff311eda87898d7dacc276c9bb2b26693be8f764eab17b9a968e247de2546108746d0b4f1c5abd7f22181bf5771522881fb5a3e6f4d467d876a97ff7d5545a118b99d4f3b4f991c4393db6ba46606d55c939b7015cb364f3cdba9fce7a75736bac0979be7059d313037ed5af3081c2ebd5c195862cda6be091aa3e383be951cfc81268bb60e671d2201f130cf096899b15a4dd495c53dd7ac6aa219b0c0a8981f7bc0a7aa8363e9b351ae0960fc4c5e2ff8633349fb5cab5bffd164d0e04fba05c558b08622125b66815188654672463b3092306a1c189b586aafd871020b021eba32ed32fd0ad6d242d9227db745cf85149fb537ba0fa5c59de4e2fc6532e872e25ef74743ad7fcd031540c523e72d42073b8eb1b81c2b04a76b7a3564e70dc421633336bb5227ed969dda3558a8110c0f7a4f63a06b128563ed0ef10f75b134fe1c3596560075a2119ee186ad763b86b7fa2f8b2ba7c5230eafd1619550577118a6a2672137456c73e8c58b10eb5f09b57180a894661b31422c93456741a03cb77bd9861e815d80c45034a3d104ba09edbf3e25a98da5155e27d8c8dffd37600c73bd5bccf44fb0d243a194e7066a061efe197621ab26d9069bbee92d04d7705926d7892d87f46e8b440dc1e5e27dd716346cf12c661ad2cfc0b2def5cc6c7f8a8a394be693f6e08d4f82f0635b23090e2aa4c760c934321b102b5cf6efdb0531bfe9df3fb8b1bf103fec5d4d9a642406be3ee5454cdae90987be586fd4ba6ffb0d4816188bb707251a43fbce8572c0ec28ccb57389086093f13295573677293aeedf9ee2e897ed4c14f76f64160ed3d69de4a09e179fef09c5881c4393194d1f42eaf72509af605962b17f9c852afa07804b0822b3747963da0ffca761053dcc3b7794c7044e471b2a89dc7080d8540265a1cb7f3e2f84b7e104d66b116558d5715a1a16b72719350d94cbe8c1d809006f2d82e7b26b6a6c55245608e0f503c62f5c648fff1a7488e9c5d49c0526f405b8bfd83bfc1f9d0e5a3b387ed742ccf2c22d48ed9958b6a8b2c5be4a93850b5b602fccdbc25c91c94c419784a608092fa5e02d5016c55b1e0d32a0b37f0ca357fcfe438d92c10ea013a54ac3242dd6f2325ca844bda067ff317ecc78a0bd4027084b3ffa3ac047c9e35bc8ad0eb2e1d9c0d8e820d44b7cb3c6f0fad11d5fc8d7311705120f30b2c96d47dc7d0c29373692c101564766a803954ed43450a84ce483cfe37a68fb37324051c6515bec8401b855fcf5b07723c0d4a31b5fb17c907d3ba61f998c500a8cf7f371b3cd6a2dfb9c548d409c47bad18485c3cebf8ab9c54566723c5c40edf234b919670b82db2ea4af1e73dd217b2f94d1de5e48e63d92e256c6a36b874bdff4ae6f523d854fedbeeb41501e0d71efe883bc3f15464e629de337a79e3b21cfe035ffaed18c79a627a0846d4331b2f2fcfa97aa66da8f3b42a01683bee3b48a5948620496d926517595e09221d616e66568b69e83357e8f8319a76fde9f4e193625256ff6bb9d3f63cbd0d28bc8df352b0951beba1a21e2d056253cd0f73674d013e396943d1d1401baef6e8a3932f3c8393b187320ede7fcda7206369ea197fdf019e5535d39e7c2a40872d342f7f304d99c3672e47ef7e2d438d8a33ffb4e932f0fbc2b75a9ed5c812c66c3fbfd4e1752ec2a94c391a82fecdfffe1b6a7da38b68fd72c4df54c023de15dbf551e0e3f6c1ea2d6164a2176ecf246bbbcbfe5c209cc382a6aa51c45bfdc98f35cad15a42527320d668089cdb6f1c0e30be3ac95555d9af545d4a0a63cdbbaebbe71c52c7973e50c822495f883bfe9c0fcd5d642846d526cb75bc87f5121c8100f751577cd6140a53a302e90122061922c3e6bd3f9463c39514605a07bcf36206200f3bd6a5df92ad521202dba5acccefa499f92f6ae844a215a7b56ed8cdbe812f30b295a163b1e43b9005270a3d7de1355066529f778117dd3464a21763dd1e9c5b66cb3c1c59a6d45e9ce2210041923450c8d7aa95df8c52f4c5a3079d8820eb5978cf1fcb7ac40a708c443d5d2df2ba01f3df2643e9c03e582d6614d278b80e6f11e5f55c90f29389d0236fe1fd619400037dd1a4705f8de6bcd9e6648ce4113bce5079fccbfee2a0c71b91f8dc76314f0083573c7d806ff6862c7ebfe82af1ce1008ce943fb75af9a37c55d939d134195dce9fe2278b032d8a639ef2c87d649956822841f7f5bc3d9a34d359f4bc0cd388ae0bd3e05b8c9ff7ba462f99fa9d5d77706de67e11293a9c03d58d9f4d33e1bb61b14983580cb65dcc5c91b6954cc1d77b896c51ee7747f274cf211ade5bc8bd0fcc5e74b363b121ed050783390f0284168ddb7f8f52654aa8c7520a8d50705aa04bb88e31d74c75a875577124532d4bc44779b850b95128e3d4e98cef61653b3f8e216ea68efbc117adf19cb170d0d18531e08fd26a927aad07cb1e9945ef6e1a448b22504d5356870fc5716c3c699840cab43e9c3b4d1ba9641ac84beaf89ffe76aa6c439e73748ec4d2b86474902b3a5eaef8296ea6030339112af371f0a38739f29247449575f05c71dcf247fb9c556f4c7a8e9e9a1ec7c9d41624a0075dc47dcac2a756b15ccf48b5f540fcb8404020650524df9de9cbb95ef9341e955516698fd783b45c2ba4da29730db5218f24a5ab89e6a4d276a668b22b91242b20143e87e3ec33e52a2a1e36bb068173e882a28154b69ab3b1709363fe82a5aef4cfc9451a1b670e54ea312fda993e5bdfe46439d7620e993ee60411ae23bc46e31374d7f6ea6db5e61c80963712221fe8593ab31ed8e830115e7744a7069325561ed7f7f83c7362a087003caff973c2d01771885207871ffbeda36828f0174fb86593a557d6f53ecb16ee8c6bea85555b55d183cfa6239c1f6cd64274879d15b91887c33647b442dc5b6d87851a06301a3e5713fd03e9cf24f843d34cbd7d477b4b1abe62a87832b91e9d4cff074387bf3ea9d7c3fa29ce6a8ab396f1d963b66f3d541deb6b826275e9797517b11cc3a5cb2d0350782430ab051cee48be0cc0bea4b53acd8ec35d2531bd41cd713fedb8763f0e174b3621953796b463a3a141ff90865cf99c6fb1dd1f8af7ad0d9f667466d42f78ed07cafb815be29406551b6e9275390fdeba2bef9c5ed3542198a40fac49c7c8ef361e69ec6ed70a887818ad874559d0582efb7f2fc020786127d10ae1bb1db79c6b16d70b137c0aaccad4e59323c8cf1d8557bde731fd9c555a22808fcfef058c60fcf0d6c8cd67df7f831a32b8ae67ee7a59c4630c5d840accbc6643fad554baca77553d4354c2ee8ddce7ab50532dd9e88dca0aeadf43f0c3e5e4e2615dbf4e2cd1b191a9435bc3acddbd0c9a26429bceb3ebd5601b45ab7df1583a1146677eaf339c0056f7dc03211d5676ae7f2eb68eff49c64947627cdc2053e1cd2c47dfbb35d616954b098a0ba8cdf7a04aadf8f5ce724367a168779b9d4de4b94905c9dc80e9ddb8351583b0b07b8f0b6e4e02c5cd036f1d1024bf4647038ef532fc1aba92769327137da3650280edd4857ac3652c50ba5814526ed1faec701971e00afc107f612677a59802624969a4e6de5c7a137acaa2b80b51994d7633361e1f1cc2b5b0e22bfe309096c36310b39b96452f2012e6ae0b019ee624461dfb9633c73f2990699ae15a462cc121f3968f6a7052d8f22967c092018a7058985d55b88235df955807dfeb325304fe8c9c946a8e67ed95046f42bc2efeca0fcad10fade60b867c51922f75d4f5d64fe9016e217a2e88fa1f14d9f817df5d93f8d9c14118063094f5ce6ef74253e11cf3483d92b6050d86b1159df221e6f3882a70797399d07f075458d30698ae6e02367cba95e022de1cfd08e92eda1c3d54ab8001b422fc20444d1962833828901eb54489f9bc39abf14d98f36eceab6c51390bd0beeec786a6de6435db7f615e3098224f1946b1e7e8e6ea15f6b93112399fccf25a1c0e602ad3cf1832ff4bccf45f8e3136ac72837e4f2201a878b3972c347703fad110bd5d27d593ceefa1d41b0e7950fbb2a7a26f64ae0b345b96b8f6731c15f09c453ec6666a0aaa06de74fd94e4d2f91ba8490d38cd8a48f83609637e7b2668f6e40188f91269f56d118f70964604ba6458dc4d455f44cff9db835b7d29249939edcef5c15e1258a102ebfdd4794b00d4507daf0de298f17ca012ba8cc9f007e25144bb4cfe265a1ca1b1388ae341f1a631b7b06bed873d1fd2706bce5c649d76f9d4e2b43b2409b19943ea22e3df4ef5465473df9cf88dbb4082083eec84f9af28fcfd8d8a6326f627933d178ff0bd5181747c0fb2867d411a05479f6a25cad3b043cc668d8026a164370526abebddb3bc6083fcfaa1ae4c7af85f9e072f3813c748f670a9ffb9fd97ee7bc07773dc00fb70477fbeb7142b55c06fc1c0f97479890bb28b7eedf347d24880f6de58d5f4b638e5a8825c282469db6cd04c7c9d810070d09374b3c6a84467eee9adedfa53e3031bbdf47388a29bc9bc82875fe1d752ce75f312e96416b641de92518536452791cb7aaa8f01ee66948641ec1bc3eae0f788e42d9476b380069c178e8470c00eb72f469bbc2c1c9a3a0bc7a381acbd4484807302ab6150adbb78f02261edfa68a94702f591511f432ff4d30e6f99a170583133f80b12d33ea0d01779e89a1bc411843b55697a058aa27b10daa5d28b5c06aef1c9f740d69c095938a2be41bf8fdd188d3975f268320293ed0402e3d1a995c65a0ce1b84273fc63cb14bed91aa72f50a773b5685a576a3ac04ed9a9db4427c39cc06344f060e2f2f2280ae2bf001b3263ea2301064daa0ba3a0e11215227571751162de5fc0beca78ddb7095e7b0bd8bcfdf856a623b25c195cdf35ea58e32ba0cee7554c54954577f0aefa415666a31cf56f0a73916038c87004f5fb8da20e826b8040229ad06c5d88eca7fd956b01040e7f220a2a10842c2ef5a3e1532e9edd58e638ea6e4bfd0536732c8b19810c89c41c965181b343784830b8eee3828d7a4174f32e755d466d1dc3343516f92da1886268ed0b8c52b3c4a41c34a8e9eb10fd74f92f7fd59464b1a2031195825aa8999d0b60d6d4c2cbb35ae48debca1d20bac0146d45fa2ad6ecd2d028d1a561750482641536339f00238bec0bd5741080ab314af22b2f08679282e60e9973fca0a3fa65d48e13a499cfb1b670c8461ed4c8fec9fda11859a98528e2727f4248967996b903098a414419d1a39e07f5b1ba7ff781c600d5bb94dd0bd8b80151e9f488c32da1729bb7bc18adee7dc6e0db4ed6a2ede44060405c45cbedf0692dd30c2df13d42f167467a3c2219219e572dedcdc762e46346aa09cb1905887285f0216d51a5912ab101fd924f1f7ec9e63fde896c8b74f16cc51e1bf7dabfe4545cd5f806ab98d0bffa8df1081570d716c5b79e34e1dfc1776f6a51aeffd63d641cef7ba094cdd36059d1173000adc1c0bad56828418662452431e99af280f20e6a407a0d2c6e362cc9181a637947070504df06456791da2e49036a9f28ed37eb864cbdbcec831c47703104e14942f7fc7d4de98ca58d3c8f5d9fb316a3ecbd9f3b12aec76b6e75c86f1f693393ec5ff39d12b7a4b01e6c4543474af5023319b253d235e36a188c6e220310b240c0bfef8c1a19bda5fafc284d7085c33b132cd36f8c9e0f6c30c35bfea3e1c44f8bb543767b305c1c873da9dd97df7ac0d8c78f0e53e24a8c0e629e42adc65928c3c879b47295f39d8afaeffe150260aa13442042a68f0323a2044d69a1647e05e2959b713ed33095180c894d2803b11d616ada880834cad9079dd93a2c00c1421395b1d040b68296d2b6e7df035fe532191bb5b197f76158482076cd3460337f701cd601ffdcede3a27a58f2005c8fbdf8d04cbb39b59b7164bc8606d9e2607143ee1a5c962edf608f7bb00eeb7c44f51bc290e6c23880130a2960750bef119464b73454d7d1fc503b0fcbb618853ea153f414312c32bedd10b7b44dbbac8e85f02edcc8ad6c444d2d9f0b8e92b8e7a11aa9a20af0d51cc5828eea0797831e1a552e8a1d6ad4c79b5b86edb1f08b842ce1bc8267ce8be1dc485c2f499b28e3579f1c71a8cf9fe0c0aa0ef63695784399e8acb14447e697473fc87e7ba14dbbdd04a2e8ce961f42756a22e85519a97d6a5f8df6d2f595bca974dd9dcd433afa0a8436bc848f519f96014bdae9df975faf689beeefd8c4b37757f646d6a0b257da976d2c21de77c57b5568897ed78843a614cd6d4935fa432db6f149f532658730bb10b3f59cb321f9bc97d3aeaff3eccc3a2b071411b9573a22c68e46fa0c840c220f7c44f4e6a1b0e6b7184de5f0aa022ba3c62b8bcce83f98d132c3caa4204eef0c5dc4eedfb6dcdff6266bf1f4e5f0c438207fb0e0d137ffc13516c59fa88e8c14aa8515a8920f5bf2977ab3d8947a40e93d32fd0dd21f3e76ddafe3a393c3b05ae4e25c1f1f0fd5654c39b28c603dda6ada267457e12ac96b0dd0c70d51ab7e6d3334522abcaa411452e6394aa686fb9253dad002ff4c6e265395ee200b212c4e968aea277ec9318d1eaef93ec0ebc82e81e439a21ad0d1282947b430981f667e4854985b612bf57632b15b657ed01dceb5f1e6c145ab8e24d8060a457258beb80079b9b9ef2591b653aad9834a942aaeeeb344ea623fbfbddf73118cf322cf4928b0b2462038f29a9ad3c2a5a7bcf67def0d1cb52ac29dc606503e83994ccf5440fc7f669dd4d9ba6600753346923facfbae090fad3a4a0f0df23a7fb5bd4b18d95a48c496c5585c7c6899ce4667787b2e74f3e9379f6eeadc46b43aa414acf0685d2ea6fcfae7fb5a0e75edc2283f42c066fab39215f56a51c2dd8b4fb5a38a5cf07f396dc38c5c2b927a6f9cae09ae076c6feebacaf312d2cd270a93c05425d1f5238b933e5b6b5bbc0e6b456504f217216e3c95f6912be1017acbde219fb488a78254a1dc3a0d246fa809ce4b73fd53f8567c0adc12cea04ce54e03da0f993e71f801573a5731f8d274c892dadeaedc3252f2a3207aee0373ce3f2735936b233e96b54381e2a1d517aa772acaae533b232d64df28213da662f4899923641ea92fd7d79469cfec36f8a95ac07938619a429268e924982505ae372c5a9825654a2a230a439fc3f17aff69e1b0bab3130a8f796273fbecfd1c58e3cf34770f89e92d37febeb22979e039c4a00f5a1f6e127400db306c8ceaed22345b1792daeee9dcad69e1a10c5869e76d435e3ff1a2e155c554730501642444d7a043340c170512145f5df6fbc190aa59dc09820851623a1b7a5918fecf1075903dd945a4690b650b0c90139838722ed5bfb56381497fbf12373d1f4a2424d919fbeba83b0460e3ff37418e06934b9ada31ca50d9e9a8aa7f9f178de4b55b624225f0cb6a6f6554cc6d0df4f73eea2f22383451e12f209ca95cd988ab371ed2da1bfc29a67116175aa1c9c24b4242afe81e0c3fb1cbdc653442df14b64ef4c393de4afac23a759ab5d5209e3e5f57c0f74185c8daa72205ef78988418feb7e9b64d1e18c37ce04e81b4692289dbf8f1038cbb617c21e29ec072d359c750f7e5785e052267b135d7c2ba66237ddaf576173c8f9284a02d0cc7eeb3645ad3e00a8af0b4eaabd8d8592c1db5884a64bf5fe46614e001f063871de3d4c9c8e0782e8f591100187db46d8e9d7a635d923ddcb69c3e45352a7d7ae48cc92b39af151c536b3b7e042dae274bf5a3046007a200729c7be3e6aef47f96544458b43cd50cd934c4954a9b990aec00a3febf60ac95a9203d398f62eb1b2cd59b6a381b77276523a8869b1d1dfb880d4e96a9f2e943c0ac07ab490119bffd12a1bcec0b3c45ffc29b6a41cac1eddb75560bd41f4ea3f2d05bedbb0b96062fbc555ab94afbcdf243fe4e6ce4b0643d2d534f46390835dc2fef9ceb00105b04029dd1990ae1164f16d00fde22b1c2a7ac4194de672a03d43b20eb5939730547317f260708c89990a5e477a5980ef1a0f6f732e635f93f316d5b1e3f8baebfc765200fe3f107556f740861b45512f250724db265fb34b60dc925c80a4bbc1732c3a5fa29c55231950f093daa77e033338fe54990c60a86f91870bb39241b44c2e3174bad7de05ae0ba4b80315a1e77a3ac56ce416f98d63ae52ef042c0b9a5d871501c58dbeeb3430dd8edbbd190e8d405a7da85982740b04bf771c3f607b8e23fc8e03e05a8d0024f6537b9f7ca337811034d27f9998752e98268d63ef5fa2708989017983b4962e295f38c58d299e50d8f54beab49bdc3c31688f8b77962f42bdee985f8a46452d8f4b50c57d2304881261ca8eb0e520047d5d5d7b84428891955214157995216e09ed649c2f6dff115ed5fa0612c42f8bb1ee4fcc26318c2bb27af116cea7656edb90aa8149adc01602aab357018a9adb51172387b5418a5d604a41f1e267aae2f89461503d696fd113e34c94e57488b5ed8fdd51ccdea961488fded87ac6fe056cfb9b0c784064b1684c2fc85d851ecf9feb0929b7fc4dd0215d1f28f5881da3eae76d1d8aed5447764c8995d7389c66fc91831ea6a2c195ded7b3c63a7ea591a045ee895afaf9fe6991120253d0b02623afe6b65b68eb9084609167d722c76ed47bf01e0d1f9b32d0378a23df565b33b2609ad60aa59a21c06be483537c8b5e3a0f09b19a68c2b30249edbeb1a46c2368288689aa928cb200ea4538a49373552ace41519e06c4cb62592132e43157ae360d66a90be604eaad28c517d3a02c6c8e2bfb35f9db4a5389f5cc44d244cbc48042bf7a111ed18aace9b15d3c97c2648171e5e13d3910073d4bb61ece03e6215c1cf5b5c3cd082fba636a7bf7b42b448a5796f304a5e98a1e0e90ee4b58ffcb360d62a61355cbdd5dd17059169e722e612f5bc3e5d269a3b71dd2858cff87fac7088096f1c1fdac4c5617e2819abdec704c584140a66f8d4aa3b57dda98d03b6dc342d6c10af1a84b290869de358a59d42d7c2d8293cf6daab230cfc823d37d5e62c067a4cb865a8927499d0c3b1924837c94d09f6a50ae374a4fae228fba254ddc322b93576904c7d0b3204c7074fb5497c1fe9f9c6246b6d2f56b01bc453cd80b1a426a9849ba1db493b21a73c743eb473a5d74817ddabbe87d6b39163cf46bb2fe5f2e552bc1d7304f2b4061e5c4bbe60061c5bf556e4d103edff54ac64da3d8a6ae96e644f77ecb8fdafeb5695bdc0bc8a1e4791962ed2348ce07684f691668d6f0d924e7e200af6f37d41c7aaedce590fa440aa0da2395cdda5b1e687e4adf2bc740766512f131325ac10d2ad01216fa8343a483aa4e75ae13c7f90c70502efdcce9578d662a3b16621b171aa1ac3c593432c399ece72121e4582bd87ea8d78ea629f5cf537a1db97f19ee1d126601ce5b696b3341e395986601769ade8c107a2078cfa75533f37e45ea4f9e9fd7f9cd8e2d1461ab69bd12dcbdc3f3eff62e36c9dd235fcefb704aed269b47640cec9adc2d1bb7cfa82654f4f3f92fdf34aba455e1fde0468d65d36b2b60c59377c89c263f7b0c2b67a450149abb80f2d5ebba48880869d62ca7f5b326c52f4a6ed293b4aea75bed4b94cf690d241ae5f3a4b1efe48ca6144682af81b51109fffbdb30a777e4319b25e87fcf39c1de954c6c5882530624f84ef61791e150fc34dbf2fe6be67d7212b3d7957712af39ab2a2f40ff578a23793300ca3cdc9528554d0da0a27a7dbaa0fd231841736732fb95531e6efbf2aced3c106a6963ee58fc2ae09580db282d8f90f7495f2abb69001f70f9a674db7e8771095a9dabd966dc03793eef2bf758de0c2bc6e78b32c69f69447b248f8e1992a5d65625a1468cb159b31f3c01834c2b17c5cf64bc96ddc8b3becd1de394e86ce17f6bae7c448d3610b35999be7577cb63f3df40fd34a8f5a46c9ffa73987398c847ffa2822cfe99b80a0a85d33bb824e127a6764adaab4fd44e74fca73004ac296b07ba5ce184654c50aaa4c837ed81f53ff72ab863c5a007693c7c9535a603b355bfb28dabedde5dd97a63cb8098a1ef9c244e5d350603ebebbb2eb5c87ea87d4506ffe3a14a78b45504126e3b3a7c77f6c3fd8ebd26e1ffc90f34cbafe266272eef2931c5371762934cc3627bca925ce33d3bf8effa55ef0539e4aa0ec2017d1d51ce56432fdf7b457e9dc002c5cf4a8bb8b636ff06ef9c8c66c50fb40f5d55356b34f18c5478ede7482f169923ed3be51f772505154a4b4aa535d90b498dfdaa9cedecdee1b7156743468e1258dcf149943f2b9235a6c7b5c86b57b97433d32375d4b64e8f36e3244539570156cfda41ab9df0c2604c5f270569f150b81526d0e516032307fded4867a6c5840dafae3d010cc0674627d5b3d37ab0e81fc586bfdefe3e675fef564048f35a1e0159ab5c9d1ec7f180517534ba665db239e92c0a9c0b976ed95ad84389218077acb137cf5497bdd7fb68b926ff65baf7b167f29e5c68fcefa988853644a21917d4316781819865ce276bd7948c013a892acf52297c3243908e454df07736f840c11336adb4a8d8b806f6f21879138da7d3c7b66c9d5c5968ae76ae103e0a8bd9e4bdb018ee6bafcea250dc39728176f91dc41a19ce9a86474e6c004273441aa8d59a5626caaf469b617ab02b1cc97f4c658507c00b14cdea191fca580d3c89f55a767939fa1b65c48b69272525af4ff47e803d5930aba50880d91e04ba8b5ff5eaaf602a4b17634a1bbf9e6f4e40a644b443da4aa37ba1f55489d0e7436f471599a7d63e226939acb0f413f9ff39512c118a78fbf44b6b21dc1d0a4865e27adb024552807a56e1830ae3df52a8290ca481bb81db827d8318daa2ece93d432362614205b47f1304778c540b8129af1df36f3f0c4204700cf75de6bf732941eddfbc33e81424b639941f75004dd88a65a19ab2ce4c84226700dfe2b381c9a743f15c3dfd6de9faac48b40258e3b27484d4fa8b0121300e8b1440ee36c1c121cec6b303560bc810d19389b2713d6d15eb61d9da6fcba04b135c810d87d48acc846e76b587951ddec64a42d8bb42fbf3e015c79cab5d60cb178f20c74b4faec6079132b1dfad35c90e6f0f60e4a3777548f469e1c81074fc48f90ffa9e6ecd0501d633b345be519d539b9bbc887b709f1bc174349fc9d2c2bc32f9605687beeadbf9a368912196426048b409d10d349cc11691d3bec094e147e025d8eb8a6acab6f737dfc4a5111b3edac3a13c141b4b36d7464dbfe97c0854d568e6f71995aa2bdbcbf5bf0d0b08f84228b669a9c348565e866d6fea0e626e85241f9d4e2c2a5037d707c571d301de82523413ffe9aa9352fa2b72b224794deb1772514ba9c4c0c0ade1895f085275c0739622744992279020264f70e3f02ac49c7b95ff464f61b98333681340ec03b4843d9ef369c6fc4b9489989e006aff75b901c2b7889aca4af83b2c98fb752dcf3d13ab8c5d8d7af70048c59df5848ecadbfa8fe08a6c50f183bfe956cb53c7742020cb7d70aaf708f68271fc2a46966f744111f6788e7513bdeea6b5725f654036c1ad5df94895c088d9fbd3bb3b5a0a9007fc68ce615a8bc9de978993c1ad77ec506f16356b8e35d69d161f0393f014fe87417417fb507385adfe3897ad964ee03948e6cf9f4748919de272fac8cb05d3cfdd4a6eb1b2b09336a1ab903e6125b0f2fc2f5b6cb93f8e39b2eec991051d7d41d433c36998cc65fb47e854439e3a3d31069e73fd2ba3e1eff26ca84db669d57bc0eb99bc0053733f7bffc67edd9388fa4a8c5d233612c4a8eb46847429c2ccb3214d72f0dca298823addc7f394d993aaa227f0be0f664559a06eefe97271023b5801a7e4bf2735fb3068399537c4699241b3e71842047f012d9a6e05c1cd7dc132b3997b3a2a091c238bc803b5e4693218ddd0157d722bfb015eee392370f4930c637feb6caac7ba7d4d693e90ddbc100a5361b48bcb5168bac3dcce57e13d7e02bf1c6d28f1201b2ce1b543c690fea6296a4fc67100fa67f7cb485d3be7111ee04dbfa2125c389e6db2d44133c51772df88457b90edd85ce891bd9e1ea195fc4c149fdf117cb528cb776788a7d76c2741fe1bbd47b8a6b08fcce164f9827baf948252f06cdd391bc92d792fb8884b2b013bfd5f2e696323699680eb7ac7e92d55ccecc8a639435740ba3911b7ff9ec4114a5e73bfddffa24ddf1fb7040613454ffe7861ab0b791962ccd6eccb6d17ad61a9704250871726e5615803269a0d22724c212e2d95722fe1bd25a701b042d6955f65b44442e35c536715fb779038dc6f1473b9adc430f0ae3ce93db5e6416524b2f28125aefdaf150c86eaff700622e707d392988557c235670174e5b9b591cd5f271a4496a0a10ceb6ee1815467771ebbebd037fb539744c350f1a00aea6ec69a9cfd57695376971acc944f6e688b07b183080978465d310a4dbdff9ad1b9ddc55a8db8066c3cd106f63989db4274e84d3fbcb0bbb7dd68df8fed624edc91e04ce3bc565243e2a60ad08a879e3df75799f15bdc674be9056d3b58f92b47f7bc11cc7272b4448917e7b62af85d27c935cbf31e617054b9f27d5a980b91ab610c9b29cd22c0a08d2fae8fd4b5811f21ca6dcff828e804e87c3b9b1f54155a749e8de18fa406ba2d3cae6f09833bc74d542098ed36f75f3182a3cab57d9a318e5f754c2af6906b278b49ba94d4fe240f591a63c387d77181f24e7323b396ae28d88551b3948cef80e188b8945b10b0ea1df5647a48809c2a32dd67e16825b32f974372c5fb51398a71f77b8f7db4897b4a9840349eef5eed1b4fedbdb59e778cfb2c922ed24986af5123cfd4f4cfecbfd9c9c7cb2a72e61ecd2fedf2cc8673cbff4146df27ea48eea356fb86a51b894d6e09d23e2b054f2b7f17cc2459f7b7344f61f3895b85be71fb9071eb8968ea7ad3c57e220fab54fb9639ed3ce04a1ce5317d7ee120362196b508c81551258efe6cd2d2059169cd5f6a570d097b0667ac65a602c97fabc9edfe70d4da792fa37fccf58bea5c277df7a8c746e2c8d5389ce13e9e9459f29014f3edc9ce628e1b5482871fd0d40abf7cc9ef68dd5ab1500ab40db298ce7e9d694412e2eb073d0d46037497d4573e0188fdc16bcd39bd4cb5205e17022097bcc046a2588ca4153992c80ebcc9869a4d9e64b9d2299ab08acc5c44445293068b578a18ce9cd77573d888a920090e37f1284c0999c4ef4951e616938ba5842b1825de4343aee2eb66027e81eb4b21ce250669132d20efb38a9108c40bffa817e4791a3c0e7b8d9bfc2c4ba9c54e22b24a09e82def22edb5734298cd1a048c716a4b5e65051f97ebf35851670db65a3d002738a23de08ed0451ef1611e82f1e702f0a46cf4b443f815d74dd1773da6d2673786063f7d8a22ac6febbb9d0b567c4e01f84a6038a9a247a2dd001da28e4e5b3bd080624947966cad746b3359873b4da7c61ab2587a1110c2f35beedb009d7935ce18763a1d24c232fa285ebb71a6ff02d1b8647c5959b7fac43c5e1350a539ab97d8c4c3139ac2300300b8e638c704a5a079e4c654b9f4bf2f2313a92f61aa1d0791db15a7a1e449ad4f9354291396f0955672752f5ccd9d4acf60773f44eff6fded6582fe23f9b1f6e86d2ad41be4b696e7bfc3100be2a67def104badaf27c38b55f16a2a796e15625e18a76368a5d586913611c5a9d6d0703ff82130792bec7ddb88fdfb2863df578943d2019d9c962c97ba7d440bcdbcea324419e36baf05ff28705eb368ebde341844f136e642273709f3964d7831d105e9db681db3c7facde58c13f29c4aec08f665640753dc36ab155d54112de2e970c4d3d72d557bcf28defcb8f77289df1cd51773ca081d5285328e57d15cea0937948f3bf1ce3eb66d41a67d6621be49a9461b87ee636e7963cbff7eee9c729c4a768874031e2166d99b44bd51cea48bcd6bf783875dd829914a0a0ae044ee566f4e735d81e16c200a1032d38a50d5e8c1a3da2f0b2e1fc6869cf5d61b13aaf1f4436320e81a406271e7fe262ef75d0dc259723e5d5b73d2f133017e074a02107a3ac215b684b3431485fea0e122eb435d924b59411bb009616e5ddb859e5d35d7d206b727d246d91e2202884f201e9e7069b7dfc9cdec39e31f77251f053500e809b32909e60781d0cb6b781d7a513e554e0acd74675fea36e18cbb08856ff4dec10c7aed7b3df87fbdd72c58b2494202d4c12b63f378c840acbb1eb495e252c99c0321ee42455544df5dab5e5ac7c961a56ba42b39a7b2369e287957290df57cb1e0a373b589fed073643e6443dae8151258dda16c9b17a761fd2f6f464e014b7f4947cd99aa92e6de2905fd5940cbcec9d48e92d3c8d8a3984a01f49e1d69ee22500cfb07cb207c8f0c5afd55411a1a3687b7635119966515a529946b2075cb047b37541a66bb2e925ac617e2aeb388d9eb06ff05c306df94b4e80ed960ec8530ab4f07d243774e5f6606c728ba6c01a2240dd3a2fe95cc2616d9d1a44d5cdb9bc3442f03bb30764a4e7f179331bfd30a4c5daf76748fb92c8726198848e8f81c008b127f7cc6b950d4d7a4f86ef57803e6054b10748a0a559dd7f585568662ef8979f6cd597958f3e986bf92ab3c165b17975a48b00850e7eba8e8b8c0df319ff38756b3b4fe24976549bd487fb204eabfb5bccd85ad39dcd2be89dbc46697ab113c1468069a39d941cc7c6a65dcb928780b14fc2a4a56bbd45fb249a54c37fd08cb3efeb4e0829fae854fbd535032df6a1ac0a016c01e482b2e19a2fa20bf7f82eb3b27828ab031bfe7c74ca7b67efb5e06b4de11c17b2c0fccbc5b0e8dc9758f89a6fa686638a8c51b0b886d7f45ed4db43f73bf89257998841567a34908a706a841b962bcca817593a2101001d9b4c9ce0043ca7437380db6feda6b8244ceaecbf657ca96039ad76f6a9505b9d1f58bab38e0be55e96638dbdb87ece2fddc43f2995f19bdc55ae26c2d4cf7bbf4b46b1638cab0325ba453cf71a378af0a161e3c87ac14ac78fce14a67ddc1c1d442a688d0e7b9bf47e39e0b3eaa7e98bb9a694444450b58520ec11d64006b1ada3287b68bb47667b015f8a77a23cf652baf3bbb17934a504803779feeccc57b33bd90f4a3024da845d84ce308c1d28f8fea9e3e67d81f4fa81ee604583b6796b63a54c7963ab021f7f97205bbb6e9c864cb1d26f759e36071be0caab1a6007674961c70f4a61c130dce15834e4f6d173f36e7513b18bd88913feeb8681609a8efedc1ca34766d5b9a891218cae418bf5e4b2db287de7afbfd166f522129b651dea9930eb2ba11211a08c3f260c984a51da6fdd6e9013ced64884a5ad76da47be306e9189180953f8940a35dd1cc35875a0f9afa98852b3f52dac1925e469379f589c874e8a7dde3d4cd567273aa137a96ed1e7333623cc720819ee00e6d354a167012b10ec94bce340a1d446628b780ce9c199d3e97145a00a537c07522b750161ab2601ab2e35fba24fb4bff29b60cc5d7a126b1b6463639b74790efefda1db23a0d2f7478320608a9a1ee06cf4b7d3784b229ee7373d5748657d4848f589d75e2907175b7ca0ed50523328f089fd6f124a80fa711be61f9a467a883cf4cef0267fa728e12c6b328223b619a18295b6c698e7a883a211720962411f183895655842311d7b4e6dde6d8cb018c816f9464504886fa7adaff5d7bbb783952654e7628dcc2e1f5e82e912903757f60db9136b30355383ebe333463bd70b9d895bfbb08c0abe6881b810ce1a125aed3351c921915661bb314b5ec31213e6c0b73467ad78f0a4fdd2302feb57e7dbc8d2010968a40ad0bb8c930e7c4d7738d9f67b415b6ce6ff751587be0c1e1b65cd88930d2d95889fd8ec38373a02822b3c28093851f3f0bfb8589dd8b65dc6ad0dee1fe75b026c7e001e8fc43246477e702d02cab9a135fc3ace9ac3dbd8a41cfc11446c9fb3f1baa42e6347d26cfcbcb1a3ca284dc91d21202ca933eba909e09e9302638ae5b649347181f9a52c55fe745b9a1f4c276c8a61bc3dbcaa796ead0ac8fd3c6b323575147e88ccfe165b5df6c445e36be2b0705da6138829991722535c2b7a1ec38dad92e6ebf6babf9d708242de320fe922a1fd90ec4455cf136ebccb49f5b5f77583590645e7522e2f5c011c59a37dbca2688a15b4458b182eae906d89001f14aadde0c97ae34355d611e234e8ce3f76b5cadb018271741538d161d929f4802c2487512245015bc3d364ef7fd1c001bfce44ac181c84cada780b69bece531c6bfae9c4102da7d7cdbe342000f4190c5efd15ff0178eb3994541d9fc1f11deaaee6f3d71bb132173d858ba87b3bec53d90c008e2177df1ea77dad7a52e75cae5b27a83d2a39afe37f4f1e3354cd0fbe29dcace0b6c0807da435fb326bc54a0573c7e007bfbd703272ef779d587c3d48155fb59e9464d355103f14a914a7753445a9ae7560cf0be75c1dac058c6a17d6ef92388690775c15c6f5fe197ebf214e3c4ba337f249bc705f35d2337c63181736857263e526741647d6972dead0812f7cba40067abecafd9b7eec51fe2d9beea3b2366fc14766913721f60fd9e44d52d93c518d405d6ef65f5e37d782bf66314ec07299423c38e4a854b525a3d5ddea02ec381f67ea88bdc2d27ea895bd3d1246461d914a507b305786667d4ce20803e47ae9daa02f92608391e7e1a6764df161546d2ffd57868158fd3513d88caf71f5a439ab1f2e470273794b5ae7613e64d0015cda68abc8524d9c4850528e54c2b0674c585d7c927bf49ba0777a6e9695025daa34465314db6a00dfa3ad4ee76afbc9a13d4b3e4f7f8f2449bcd9269bc94475c682c330c815fa4f273c197421c8d2e9665af08f845178e2593b16ee875b2e09626dd622515d731df728a60cb4221b7150120baff3521727ffeb42741cc65225a0e8930207155c4851815ec4dc8646da3c3193fe69a353b39a152ec958d7b055c749708f3066cfe63f86c6acb38e02df06036be40da39d55c0eef75ae7e918d34c2370b6892c8f6dad0b57ec2f16cae48fa6d2730f822b6cbc5bc8de70013bef22085e655b088fa065fac0effc7a9a82bb8351bbc84cc5a35a1e12a837462db2e4cc2ad0a265cd4a74464f0a5d60f76f6dfbe37a9344c4308bd44cda6280996c9a9f2aff9f665c9675c15fe306e15370b65ea98ff2f75330607c87404f5a0060342145e81be4968939d64b7058ac2fcde9e75f238fed8cf25724c0f8949239d6fbb146dbf29067f620dd57133fb3335e12d964ce2be0f1474418a61fb29960673f75b99e4beee7c16093b7d04f9f785fd429f6872eb6fb907184c0a3c1f8c7d46bd45c170c0e79b4e2c2ff3273eb361d1f26b2176c3dcf219b3b188d9533b5b7a4d18889dc668004672524bab48940a66d8558e42683261c05d40707a3717a1c1c17c924ae01cbb6a7e357da32177cee274b4a9217ed5c933ce7c91d42f5c59cd712423f2a1fdb56c74c70344edeee0fc9f1156de3c73b2684f0f7a04e355338a5b768f6c703f699976ab8a19df68f95bb040be30702de40e90e380211c3be00b694b35ea57facb70bb6b31978fae19406968068e1780771452c5d0a886a8c6f098f894d7efb5068ca1f29add6e437f4018e76e04017454b3ff5e6c19237896f0ef0a8b368338b1d4d29a83c028830d1d42132ec31306ae3fb99e51f650b6c9c89da6461ab0375933ad97941e28550a54da0bb54500bb46e205e4a581672fd1d3eabd158f15dfba4bfc6748f711022589c768785d82d5a624ff502ec4a01fdff1a8ff1fa452d88212ea67427060aeb61a4a6c62fa9a5b828e814f51caabb478f28d3cebace1114cdfbb17a003a09b24f75a5ca4716cbee1b76bf0c308e0e0cb9d611664cc562e6a775bd873be8e9f08521f9cbf34ad4f3cc47432baa47aa885b17c3c3ddd2d7877e155c0351b86427f33e866894cd99aae62c90e9278790c6d8bac01768feafe9f92218d742519064e481d63c752b5d0d15d13d0687ea8b37ec7db26d5aadd21e095d9e4809a1ecf1305cd0098edb7b9e257087b3ac3d01325df3e4ddbb90c58af78e50a81e131487538daf5af9447ad62156a23f21f891857ecd2b0e0d6bbd360ddc12b16c69a0ce39ed42b01c6c641109808e419d5b93c90422af5ae3aff89a990951a61da2ee851345713d3363ed52d2a9f7d34a87034b1d427387a36ff6f16be2721d51d87066f699ab29b88213e9c6d15533b4b2852fdabcd4b60eaeb5966e48e72c493d32efd200a8a432d08e9d5aa7dece0a4037d91995ac9904f27490507c9cc934f6f7325dbf66ad4a3906a843a0099e90816eb726dc60a3c0782956c079f463ed803a54d5f970223c6c89043ef26a3ea18f2c08e5692b09e391ae1dc2c330b22441ffaab7006183e135a43d48f17c819c72fc3030974f594c010982e097999414786950b5b49a21de00cc31021ce33e7af18d3c4851766d575bb46c3df79c15d7eac92b44b0b1f3d326ae73caccb23723a7b835a8b20dd2dc871d61594fad241edb767e6b393b2fc7c78a47aa31ae338476fb177f1812dae966fede08640feecb5990991120f0f161536c63d438c1ff8110e53762fa7b0c76da9895a72db1c90425dcdab07f0a06781a1bcb56f735ff5c204de86410c53e79dee8e6d4476a9d88a40493dadf31f62d31270b6023cbd27be2f82dc58046e3e74bd28db7118d61a680839bfcef2bc96704d2f52aeeab70c7cb6613b9ec54cfbd87bf44053599f4729a378c75e91002d01ad26fe50d8d14a199fb6631d47d66cb91913c829ac46e4ab594a5bc9df6fdcc87a5d4a7cf5e44956e3c82d864dcbaa2ed7fcaa758f2a868079f2ae81488c5fcc83eba6ff72971612ccd2a1b91add471d4defa28aaf9f637ac81802ce6c85f3520377f564a434711f46ebe2fab7ccd5183059aeded29278c314c1c70668194f78518a23daecbc2b33454060c4e7161f23b26076d5bd145f6a3a499115b4ac1cd87f750143119cff9d097f8dfb39ae5e52f1f1d8bed9bdd8e20ab8fb59e0271bc2b1370f1b14016206db1d6d0a4d3af843ecdf36fa3dc19937e727aeaf3a9d814cfc7b29be89711fed26b587e17e749d13a5e0484607afab249d072218e4eeef708706668a3f67a94c5602ff7ea53aebc072a5154c8fb2778f2df25d431e1c233434e79fdee87401c4b8d1d7cb8f844ca885c8362f74a04ebbf3348a2682a831c2fc8b93998208c4bd319f401d80f5e3fb9a6e64d4a8ffeacd22eb4e5ad862c1c20457df8060ceb90fced90c2613293c676c6c9643c1932c94e3eabaf6a4297b8e9bc8543b0302594f2051c5501bb537ec21b93959b4f426788d4eacb68c071164d0f483c165a4e43f09aadcf30c3dc16529f591c19d635d7b82d7bf10b23368fdb25655b565a085bee582d7f742a892e59960b6a7027ed3bbdfa248dd49857606172210d45698ba9256e4d16b9c4f57b16ca801f873620c394437ec8c645b19992dd1ef0881fbfeb868f2a493c4f188bc30ed4fde4f88fd1929d7c8cd961e93ccd8fb928fbaa8afa62f13b86c2e1ed9b526ef875fac10ec39b0112c0c4e763052203b60a09ebbe6d6520a61e0905bd97a171b33d6a7be1475bd2af016b8000208f1e43f3ca1eed5d3e7c238c05176f12518a733418ba33748f4036ba8d66b38a6baf38d34800be393ad8940995ff52a42ca0fa4890f276baa9b23976d90b621be37c7d55cad94e1edc892a62a7434a055ff6d29c08dd5ceeacf066e37ece2f69c4a605a5056ea8247240476cf9f2616cffca7979f9464136442bed310f39c2a04a58c12e11dd6dbe117466ea6ec44b83ec21f88388fc921eeae2b9f57c6d71778caff0ede856cc1bc0d346e2a5be94fd5db011a863d968759307b7e32e69a49db99a5400a140c86a87b11764b54c7b185597cc95fa073a1874cb667e1216ea3af2a68c4fb7e22bbde9115645059339d5ed15d7d4d1f7deeae8d8e44accbf3b0976816b8f761c9bff50ed51093103aa129d057cdc4a517f036d8435e64a85c91ad3a549a876533149d6c52228426482821a95fa0ab62e924a1afbd23a514f413e1ffbe07b0472c97cd25af620efc902207cc4003ac666efe4497f8f3ea7b0149745dc0468994eaa19c91effe36cc3f36ece82d95e4f7e68fdbf55d22aebdab9b4056f61bd6d890cfb696c115d862b3216305a1c23ffa0e89750d4df1224b0f0c9690870ab21fdeaf576f458fd10eec93dc0e3edab1196b1634b40f08caede46ab2c628887c795d45e1dfe1dcea7e87d1395ff4f1e0408eca89017fe3dc666ecc1520f4898cf69667ab02c0e82b8e520eab0852081e5cdf73748bedbee9efff10b512c8580a7cd4570adfe23528f8d17f7817e2249ae2dcb9380a05fd2047bbb34657bfab932e01a255da5dcd066b48b620511ab69358f6fe3fe3144eef80466ea8605de85322a1fe9b6d5be804b1df80d193856e58563a65571744f54da752747ab2fe0002edb3c485411a51283e2ec3ac7a934e11af4ac9912279f3a253cf348a7aa89418242b5d9297c4c4eca9c7f62739b3587ba015407075490cff01a70b3c5bcf3fdd449eafce678a681cc9f5d24b2a9fd62c1ac391ace9aa59f38cd97855ce7fcd07309836089167049c88c29a4eb2b5040552a89646d4f0043367e990c20e88505b4bb160f3f805effb67a73b669b1f22da75009578851410096f54fbd748fe17f72031f8fb5d8a01f6b1a4fe393ea8bc92081bd13e8e4818f68b0e14b456edfb6031fec98e7178fc47a8716223ae7a48f327e9de84d2bb36f487c94332fc7f92da13eca1c87cef1bed77a8c2f549ebdfe3e0e652a476149680fc3431fb15c173961ae9d17f214769f3d07a33ddc2247aa3d94c854261e3990196acddff6d57cbe03b5879ab0abd638ba811d175a89589ead9c60cbc2f84253a88d33d537e43c96a658a547152ff3ccc93df462726aa903c239d2c8a7f78ffa062678fc0b6c76a3c40c7341397ab9d8019241c8ba5e5e8a70499c32bc28b8c3c3509a66422c8a87891e34be2b40206b54fc19a00302ae462b3da573bbe4bd083ed9cc7343e48e040679ebdab386de403e0a4c35dbdc9469d52e1cf10a27ea33c9a55d23cb1fdec6eeacfe0a734c2e2af04dfd73385f3e44c4c6202f7e44b206e97ada63ab5340033d3d9a5a413355e2640ab179453d2ccb44e855f3ca59e0e64669d6da98371e9d7f14116d422daa7fde5469b4a0e2f00493037f2c9c51af96d14289d2736709e05ab65ff33d739aa5e328643ad41e0eea22ef6917dd7ba64bb0de98d8458b1a0d6d9a876fffc9b81b064987608d8d9e0884741259b454bcc2a8e0d3a4edf4a3dba5333138250c827e7c6378007fe324d0785dba2fc7f872a14f6bd9a88c09b7149525aac8e0359b7de2163f2b018351c591220188b487d828f10b7cf607ccffc69e8de87d4744878770b846e2462e55852660b800c8482b0220fad66437652c781c741ba8080acdd85333794b306f0bdf87055ce9c5022d011c8fc58501f2b52ef9e48fc240a4eb487fc0c4112b639fd66e24e04d3311e51e7a6c1e6e8d944128ae603f4f04ff45f90da8c36d7d205854842db39102d1b0c7cd6bb078d1e152b0fe214d29ec9d9e038f716788a5d8b80704419c03a0a1c42644b4cd1620fa1d17c07ab9cb47e8635a5a9ada5615f06043d28e730a65887f1ab6cda926fb27c9ac4bb1b0ac2162554712547e31957b107a2ee0b7e07e1778110ae3098a8991336bedba54b9a39219afc1be86b2718968ff52659efa694f5ceebc40db8aebd2f0441ed7c3171879769dd4b573e7b9e1faec64a62a171f2628f4f7a6269b6a374d8e8da84306ebb1e739c9a39013141c2698e91543de6df4bc07965e7bd66e1a1a6a65d66cd0cad9621dd7bec2411eec1ab7851812ead6159f32c2c7b0982b40025f4ed80601c5680121ad0c7a888dd52b743b51087e57e1ddc167ad6ae35407cb74168382636302a413395c5b5563ae3e4209fc7b44cc2d3e7708820163985c0691a25981a226a28d802792532a6237fb11d20ddc3bf1234714e8a597e52f7c01ba5a6edc392f4bd707dab7628d81fbe3adce0e974976694c208e0998b47f28c26e5fc159ad4d1df85207d72919780c9aa520af034250a5845bee4ea0953b611ecf0457a8406a02b4b8697b620b28766ed27a6614be6aa141fa7dc98bdbc979849e1db736b35832efd41f4a17ac88425301a4768c0965774a53b6b74c849ddad0f3001ca6df47451bf5d190200dfe082b8caf832aaab316d9d25adc3e65217e04ee28b8f0627c51d5b605e6a7f507a243bbca5d712dd427c700f9a68e0e65b2e588e67f8f320fc543c26396cfe66704f8e4a7f641aac72e906076ce39800cd6c6bb60d07d6c4fc67e15cb8d34b97435fafac237e4a136c80ee0c7e11b9f27cec8fe477b89379456a0a8fda0565d64d78b7b33c0ddbdd9bc926d72fceb67febb9f79640680a71ffc7c96df40f7a2fdc5cb6ac4dc7aef248ffe058e9bfa6af4f12f56f6ab0d77da454b4bd4f215d4e7730d697f035e7fab8a3bd53b80daef3bc71022f182789a5526ca383b01f0600dffa66876d14c511e4925c177079e5238af188348c36aaa05480a4b498b51e677e6534fc99366bef5ed91da80dc7b87a95fefdb7963fb749fbcc40c349bd57f73bb08b8ce402b22bfdee8304ed12b570abaf8caef58897380e56df4ccfa885591e87a4302a26878ad112506939f5906f2a7664a61b0d1689e873cb4bfcb9681e395fd482efc4c29b75398b72487fb343aa9e1463b92554bbf0d2dc0040d1f218a960dfa4aa2f648af82007eda2ad06a1e258a77fc0b6a89e80b2c58195b3d7fbbbbf06fbdaad70cd02bd1730ef73bcd04899a7eb52881abdb645f3f9efbae00ec4d3c7ff902643b547724f05c1f087865bdb6f02d3bf4c0a5ab8adaffa6a8310373509cf87aa0f8d2a973eff1d7577170eeb84185a4ad9ed37db6d0ba75a1283410e9b001485676fa8bbba6a100a6e4e07fbf72994dab75b0a6e058c8160abbccfd6a66e2d4ab687ff69cb269cdf005354261dd9ccba11e82736784eb4bccef2e6eedd4e12c26b031c7f3ef13f2085d552fe65ffedc23c821339d2ed739a1f71ff0033311e0f6fde95489b6e1e98f083c7e71aa0277e04e6f121f58282fbe6eab86f963df7f882ceef660e2fa1777f4e4f9e70dd43dd9b4800baceec9ea0967251b210139591c800714b1492c3eb359c5d0a027be5faea460d7d49c107f1e520dd59a6fd91da754523de084f9dcfb1a878802a035619ecd198b5a18809bd7427c481868e92b01fa3e271a7c09de8068f3905b527b35d0d46e428d8b46b97602b345be638632ce6081853021167cf01f9882b924695673d9e5f92b0f2ae27e7cf18536fcf5498cfbaa583865af95a5b54a5c38f814b51e6f6a3b97a3c5f280bcbac5f0d01a1b41dc9cb225ae53292647231d5c417f0ccd2a4fa3879e39d957e87cacd054271e08059a7aa2712ba53a2f50b2e35feaae8ce81561e25bfabf3970c083058af9cccc570dd631e1bba2853914d2981fc4f15c6b0660c5a09ef150df80537ea4f26765ea8f1c3539309aff3794035f0ecbe09710ebce1e8d4d9e7d0f1df125c124ee4a8cecee42f714d608d75cd262e7f752e86e001103d05e7fb670876cba9185cfbec5bb30df680a074792bbdb751268e9380acf3659234873ed077a0d7fc8249e16958482b2ac038b0dc1514650d81fefa9b9544a073655d54537073025b165a64699c1fa98bc72bac50fd912cdd0afbdbf3ff9e8fc430d5fa86317b0d964d465c1c45787a8b622d6591f1c69150bbad524ff2fbc50a14093feeba53930aa9c03c16cb946a3a7dec119cb50e0612e4b7e0ef08ebff90aafda3b6fed19f139e9dce845ffae96010be2cc27b2e339f4f6b3fe2207a71a1a78899e2f28676181d1d056e91f0cff492250847fbee33c7e455b9efdfa53e8a780c310ff70c66216f28ed65f58aa47c6c90a624391104287b4cf1d5124a9f9cf3429ad60db56a64fa5d58ae985b696d02f8d902c9ee0ce6fa858a166ccfeb41f05d967ac2bb75b064d8b1aeed3282cb3b40fc334ff58629c8e49f04b985d1e66010c1f5b633c8f8bdcc1a179b616e0622c61d56e32617d804b427968024a8c44ea22b828a253758cb4a9023a4fa92ac83a62fb26bc43be22d74c0e55d101c44944c9e352e78891fe6a3df62fd6fe9e03b835054880b4f9748f9fd01b4993688f5ea015232434b8c5025d632fa634468af8527a82badac31f2a71588f0bf784ce7147ff4515198b4980e1a86b0ec7fed4289b479ab25509446664b0ac75708fd260ea3794d1453c1b6a9c3d8abcf14859b8c711c87413d2810374fdbf02f158a509425559b70bd8ed8b90a73acd335ad7454b811279d7a4260773c9901c2ee621e79529f195ee72098bf2e07faad8b6d616550a72f75d992d21914ce2fb48001c4bd390e9159e40131c6303dd0a364ce6dc2fe906caacdeb57086e2bc99306828c216c2a6b273a5425c9fbccb91d25da8e07a9bca705e969d35d49502211b81e27ac0122751071bb4eb70477cf20aa20d47b5f48de904f1151a73b6f922ef6f9bae051cbdb4a0c5b860abda1ebac7a1bef600dcd6295ccd6abfbf707e35150e0b973228b1d148037d0fd38c5648d80afe609ae64e285a166fd77c5b6298cb1724830a23f3cd2a694f8f11a248beddbe6babbb182648182e8e347c81a6b9cd546f8211e8a06926a2462cdd34dd26cf8cbed827f0c7de72dffdfafadc562e752189f63e9bc586439719380165b1684c1dcc47089e8714313d4e248f2da13c67a5a473d8974a431114a9e108273ad7959736dfa93ab636c5636a27fd5433340d3cfa57380606b20c6f0ceec2aeff35deb034c75cb2a499e05e131f923a4271b5a2f3fffa3fe20ec32181608dcbd2adcf566b71543be5bae1b2ce15cfbb180617c8bdd2eaa0885dadcfa844a0a307fd2d8f38a979a487e93fa6456aa441c6ec31ed103fab5e1639fe0dd9401813704839cb5ba800a0dd7d13bcb95522b1f585ea5ad581d47cff74d2a30905c6c87cf86217283755219df4b4f141f52279c2b0194b58ad9a42bc9e23f9c7262492d25a709ae2199f6d7801f25e9e55d14e0984b57e84b7b228185d84fd4b84d66afbdacc549911716a618a7583b59f991bd0ee46d1fb17307d0fd76c9117d667913704579e4f8ddbf562b864933e0dcb5d6acbadea0e3ba65d3f9143760d83b2f6df3c901902340c9c2f2314714d7700abd45e5b0cd831ed86ce2f462ee98c473e1a51602a987c1faef3935c79a723df0ee5426f600137d63abeacd67af6968787b086258aa9234b4050021901fabba2d500b7c288b57233c4bc3fbc95ff64aad402b88daa8df48003b646a7bfc994f28836e5d1c48bf4fdd145093ade4d3cdc3531f86e3ba2168cebd76ec3badbb2a2bb946084cc70b2a520c2ff90862fbe936ba23be876fd040b6bd063e9eaa07b6b8a97fca74f105771d695792570524cf103bcc0efd42e6dfbed0160bd2298ab7ad5de2d9ae1d1ed00f94b81926bf89cf70b74d207811bee299727bcd7dd729aac6cb75025d2550abfdd7dc2b3396e13e2f2b8d85c8f2de09670dcbe5d08566d73150effc3ebb0456f4ee73080238be0b338159953de9efd09ccbd701f266be2f8f55159c50eaf37fd4db9c813b427bb0fe8018969a1694f2753a8aab92db42e19b0f8b771fc2be40dbc9e356ef350876019b0c22562c81e1f36724183e103d0bf391134347b95b54cb81e6b3c578974b9fabec33f365c755e01f1b5ca68ea1f9c14ce325021a2b31905a16238bd92881291dd0f4970f0d34b9d399ad7d5faf41a001579d54b70e9ff4cd470fb2f6431e379fac1b22ee7d3284349770216eb5925cd107431742d7ebd87dcff6bc481921fdaaf0f1d4307b75d6d18b47d9387c40fa29a2c3cdc182f0f670e1a44d3eee4f6c2986e06df249224d1e63a19eb2dd7b89a417b626c62c77a1d6aab898369eccd31d1381da005e9b3db95ea7efd553b35ed92580bc5f724bee8bad9330cdf0908f92f9209bb2008714bbad5b435fc755023aa1f6a4ff7fb0ed659505eab014e846f8c30298874053e41a17b2ddb26aa19249f12146e6dd76e66f862ff5693fdccc1b0bb7fcf504f341ffde82ad7c4e875372e5421d6c65e3a845c52b790e8b6db58c12cce2b15b87682b9f2d530beff652e6f0df0f9154019cd3ca65ea788dedc95a2d49e8aa4abe28d5d395a54481262491d4f913826251ffdbc661704a9916003a0c5d5ddb973a7f983f07f15d4e49c515ef1d70cacf5186c8fcb3e15310275d0820eb54a10fb18da1333431f89f7e53a22a644a9b1f13aa9def3b903d4e27d2602ac32bbfe06b4ad3ccc799e01a030f4e84973724d60ede6d7799d0ec22d0badb3b5c9860091a7ba378ca97fd280d1900ce8ba67be92c99c82f44ff90fbce14c7ff80b977e0343bcdd0deab5251f6c5ebc80ed427b0f283b6b8ab2a46046fbb15e9a4dc34cff6b0e72e746f772aeada4e37a0d753426fec474984341dc9e12a9de0a28a4e9fbc0735d124a1a4fc35b6f53b752fd5009b60b7118c8357881e362d8d7b62dbd1f98007bf829188296a38fa27d8e0874e0d88eee9ba401bd428c45cdf25cb6ad96d444b6f42867f797b65f90ea789961912a800c1f276a6f28451f06db059cbf42ae90806615ddc4d52175214e633994f798d05749b5ac0306ca2c0d9c0ededf2ae4db53390f2056cd2bdd059881ee5ab166048764c317f4c8ec4a51884f8cd89ebdd6bd3c04a1a86ee0667296964eafa289ea0c1edb2282c44e04303234668b5fa508b4910fb3ac567d36f6f9802118351105c20c999dfd71f0f38451ac97baf4d755155c328fda4dc2e8fb40a58593cdc6883ca4a06b38219afbd7285f2ce0cb17f183649f57c58bb07e5ee3d1dabe3085b009e2b77685a78c26f0d1ca4818398401b5752a815bedcc920855fecf09b1b6e64e18c23c1a9dc22e6a68173e31d4919d04d89812cc73a171f5be682e821d9c68d4e832abd3d9e57b092e7f1ce165637170c5dc5e6a1188cca237944ae7410ac08bd77e4a75fe57b22e7bf31951d047e2ce65f72886df5ccdcee9eac86b391829069299b696b218b1a12a3313005ddb349710d720925116abade571900b289478f882426ae10c2882530fdc44fc591873a77a39fa7ee007f559853b48aa8213bdd4944667e8c8a2244ccecce7fa3a83380a6c09d420e1af15665a174a4f0f2a45ea2b504daa3c372158c060a7bcb98371a637b7f3d35dd2e8d06a2a841419043c6c6104c7d421e1be036d582bc3fad56cfd54a6e746071943ad96623d2ef783f614b52b27e4203830bd98b1f325242a4428f7cda031928ed3d03eaabc3f44fb6e631c5d9dfec27c9ff5c786f59134e2c214cdfe8ecc95cd990e406ccf5b756fbba97bdcff64999aede51de1eb995bdbd40f00db240d95e761c021537f0738884aab1dbae1d2a462c280289b2bba3c20f628cf845ca75b301268e4534b17caa6bce74d497e7b7ba63db1264bbbb197fee2a611f3840cf99b6a1a32690c8b271fd9e58fb80821c24afa6111e81bb722794299ec15f18df6dd93023e8dbbb71ba9c591b6ce8dddeb3d833c45f59a015e5fae5c79cbad4c40a112e0567747f1359a27a6e795b15af9ccf59c9304c41d943a2c0014ed385d2361bd71e38f9bc1729ab1111c4cc00680196593a475fb36dc1025a8a6ea5d4f234cbe8aea43429d442cf657fb727e8659c38fb529024d8c7a22664f4b56379a713c6d6d1e654b718b434b9e995526b21dd2e0403af186edd54746461a2603e5e1f66eea580cff8407113efa4efe1bc6f692da8f189d926c5d7e6745e3a6110cd4b1f4729652a2d0c9c7581fc0e047da0d7ef2dd4d9acc8ac26688aaa5f9b6ae4bef01f99fa9bb2c6be46f504ba73f8e459041c1f7ce278756180437d1b70e156fa5744cc94e2adaab8eb5d05b2414af3b2f368c3188cc5943d888e5ee6a1e6cedd97c06fbf74605e1510fbd15607a178a58279b46ae4a15c8c1ec669e485bb56550bcba6a7af9886f44ee84c936e3f27316796dab074c9227342108d1ebe40e05b1f7a158417a8e228ee145669b10c0e2744aaa41bc0b36d6e072868d9156fb83c22bad7d896d07b523e4e80ff419d3e2298cf360a015fa8288376a133f65be00f8586b5e832133fd185cb441d1172a68187f8874b65dbbe7017110680d5e0354a6d4c9047bda239ab1e6ed00a12524a32b5c463facbe7584f527349ca3de90ca80d40d7ac2ef59ba2c58a7898bada9465e2294640731376656020947f4e7a65d939077427d7fdd5f40c01c7d0d45ff37ac29808896d5262f873b88e5f9e20dc45c01157aaf621a2481da34ce7ec0d000b5244a494d1f4d12a04585c011e52aff46b315f22d7720ea2a0182832c548d8639f4efb5601c51f6d1226e483d6f094ad1d881e3ca9cb9b75e979edb13a85ec5cb8c5fe0ef59b154c3cedec7a3197af4d979e4a355215e65d15c12c82e477dae08bab4b9a0a3ceb41d4a4765402b2488cc83c12a62b2819dd688870c4777c76db2e8f96d607ca98be1ff6ea6eb661dec36f00cf190d6bd2419c839d1b9b9fb4ad592421deb5ca6a2e4ab6a6ea224551880273fe85f831b00fd2aacabaec9560c9a1992572c0fb7152e47687b8b6785fbde2ee2087091f86a087574610e7e6fe7e0abfbb8c561caf80919fbc00a6e569da4f1b08941703b74394f312516d2c783407db5a0ad79de11a2fb27d61ac0a78aad3e91bba185152d591c672a48ce96cb5252cd32869dc9ccf4e15a804eda7501f13ac4c4e733478ae0ede82fcfdb4ea408f129ec02417d6155e017580e09aaf03fd2bc32671c64518d113f11367f7446bf7c9d7cbc487d40269219c96f5913bee4413d6dd49a0a6afd421aceb8dc358effb48822e8d2c182fadbe65298a06622f1ba3ebbc4a743d96b1a493b2e766de2375e3d249fcaf93f4ae9dded939977102166c297197b57bbf927f6e100b37e15248fa8b33bbf49827a498adf7d6663f406802e520d17aea2296841bc26394aae4f7007ac6cd22179d76078338fb2651c5391c51932599facbecf17f8e29ca15cf4d5a65e9ecf24eea5c87717a70379d4f7180d62760beab7953f857cb077361ed28600f5a1c588aeb0d07d69d932dc64fbb38575ecf5e487296ff35df3a3d01f72dcaf64b4863c4297715e1682806e4e8a224692c28e8f468c523e4a3a47d391255414c191319792b2d0009a06695d4dbd792ebf6a8010e58541faf78a3028d64ac7408e5781e97c6111c9d93846cc085060714be138e9940fd98911c3afb28b5e4e9dfebb9a05ac06967286556f7a5ffa168392c7bdf1ec28d6e9ffa55e984b9250ff821c27ba377ed6e5948448ce03a3cd221a4a558c824b27564fd55f1eb552cda34a6a432a8dede511c3a19135308e0af3ab9130d09d4232009128075ca0b22a5867dbaa8f4ca032689aafd59013175ab7dfbf03761a26c9a1306c76789dd9f7268b53e37c1db1750b60453997569f60cfad34bf89f5afcdeb09130b139d2da9cfd347a68b8188a69aa73b04c1dd20993e2fe02fca5a6dd2ad0bd164a8e076ae5baa45f9069bcb06c48de174093108ed1040884f6124fa78a3052df1cf87a7cd75934fe0299f98c80f7600c400961973fe7eef7645a29b6809b7a5e10766a821dce536ce5238fd5a3b2372aba8e45923db50c61c5b314dfffd2a4562b1411eddcc7037d289238bd6ebc9aab87c05d30d2ade8458a52ded5a428229976f8349bbc3afed01f7e50b0cc2c6b132a5b0d2a029862b7b1a0fa45fbf243db04112b086764df9e702047d63efdd2dd35643b723f880d8161cbefd5ec2b4c7a0e8c50e0978a16062e4ff8c6b02702c79e9b44f196da5888089e83da74cdd3bdcbca8cccc491a6aa3e1c86656a86b6a8317be9a96f767cf5d5acda4d53632f63fb8aebce8bd61ea519ca838d317e5670bf54e2fe1cdeccc26285f0c90fc3bdea2acfad5ff2bd89cabe45bf879be38c22bf4cef7fedda6760fef67448b921ceaf406c734fd530510f4ada2e783a015952089e5d2ebb016ec67e19bea8758557d222bfb832dd36d2e7400b1b91fc39212b463840bb50cf5beeae4fafe188b778f9dba8b0078f5ccab8189640b435dc0447fa6df91620af2815810b35609379f9ed5167c484e7c42ad825e77f931eef15b91638c813b3da31525dc5a46a8121f11b418fe4289fa70b850b775202b281027a7185b62ec784bca326f94b4f60e89b75b7562522c0aa9e8e8f42eb7d204f820e2db96276310de81f7a85c53878789d0d405c70cbd68d9405e6d85ab142b5ee3176453b45d27d34f3627e7135b6dd6c7117e0fbb7e99169b186e37aab471908f0d91fc9ce08c9b93f2b75d9bce2314fb7401bf430b071d8a766ca8dad853d763156dbb7cf6d18c5faa5c295bf296915cf5526b2b9cb8763f37de5240871968c095f6fd7278b9395ce39125e9dd37ed67ac2039e211efe796288efb9d63b8aa8400f17c55887b0583019b2cb66111c4891db63b35ade7f1e372c9450d3b42bbf44085ca01ee465468e60353124aeed239a2354aefad2d8080ad3b5cf4ee141553e4aab3a0bdbe3004562bfb9a092fdde967405239768916eb93421d237302181028ef89eea67f880941e62c0669c1dbfce81ae69fb558e55340394bad521fd08d2494021f9a73feaff1243608a30e47170d12f9d876760cbb8ae7e53f6b29eabc97a499e058f24c54471ad7d59ac7394c837f681d00b1dec9a69be49e37f11b15b563b1fe967ec4fa412e53f70efdc515c44bf0a8580b58e1317af2fcaec5489ab1ab0f3669fd3b551cc308822af39edff5a8300c876eca21029ddc222584dd98a8c7a71cc254b2ee8be74f42b04e47a7e26e9a7610fd9c20532389f59e3fbf4d56a06c29b95b513e3936450f440b661597f4ab85a85d97bb20416fdcf87ae25fe93efba03e54b061beb8cef32dbcddda8d5da7035d9fdf68cad5541411d67fdf8cdb381aa18397b6f81cceace550d6227c8a9ae797ac9fc8c60ab902375ad62a753cf6dbe7927efb01f47d236450b26a4deed79a32288e4a1d0839623cae2d70edfb0c17d24d3fbfe98f2c3b76adcd0062673b93d11920b2626c954bd2df3ce86e62d31d47af1e999666327f3d1b881841a90c17aa63fa7a5d4ddbd46e93eada561c2bcf876b9de3af02a929a47329b00859e83f77e9212fdf2753f13aa42a8bfd58137a33d855ce293d69566c77065511a9418ff38ee8505a2d1b0ebb591c86254385627390b510d515c134d11e14e561caf670b0b1fc020a3bb7e32495fe2ca485e1e3de844195331a79d242595b58123da0a2deb7f5e1c270c64a99cd56960b3a128846a19a56f32bad39f72064af6d8e9ea383217812ffc09158e90b4577be31b5df557f23eb0fcd678c5870910f2db8261ce7a7740c7585f2d379cb78c2af1bb5efd59905d6e93f2efe1f0c1f406f7e8c82bec480fe8f9c30bcd6e800264f2f65a8264bf9964e69d8d294c5694a0d49a70e29de63f668288b055f2d382194b844090c7528ed7b10bc6bbe16110ac95a6542fbe2dba0bec9f547e4cdbb4751743e0ef0598b56951b3f77c9a8448428204f8dc65773c7c506bbfda601b598d7450c2c06abceba87174a5b5b71c39832be7dfec0f0dfd65f663567c87c992baa5f11072ad66852fb495bc3c490a90b3e5ad6f0e288858ba8fbeda081aaadd35039993007f3ff600dccaa531d07208bb059b682f20860c423ec042cac967b8f8f3f69544c8b542ca7737341701c6582ba246e19b8b1c41caa34a429056b6b5a7a21b2ce98b652c6334e39a590ebc2629fd36a71e30b8fead90e8a28dad6700747570bdd66554bcd12f2e4d4ecd3dafd993b11a42cb1f1af4992842be415cc4d8819a032ac56fd8463c4866720695bde19c19c7bd6f11c8289a432a2936179d8a1a54f4be01fecb9face82cf69a9759119b242d7d0d36ac20ae0cf4f03355b5d1419f8ea98f9ed07b815daa3b295bec6a65820dc841cda5d709d75688e2a5ef26c295f6a7f7b655a5791365174c29a20f64d3316f31e1e72d8b715473c6d28e4a710c5d06b94602167f4264834f0ffc9d3d9554943eff37a18a4e06799147419688cceb87875398d022cd8bae3634a70f9ed8cf4df35931599c5b3bf5451e319e16fce0d0aa840207a077061f21694c34351ffbad1b50b805197edb5a3eae882e2f92e1bdb19ce94e11aaf700eae5f7cb8f771eae7616a97e4dcb7b6a2990d2072fbdfd73bc6b178da3c405533cbe0bb0bc16066efe6e1bb0e49590900fefb85dc567d319b7ca08b590b8eacbec4bde61e71101b122da01d00a51b714e251c26d75a34ebd7ca3f9b8186571af2880601ca44fbf4991a0084682daef80c4af202a5b5377ccc026a05b016ca9a788fdcc57880e18e281f6ce144370119b5d82b11dc6a50d19a5b74e12750e8825f84b744d27560f919281b42ec02d99e82ab12feda5a69f3ccc6f6e5658bb079e2163d232c438fba777a2a09c38e5e5b0bf21392641318d47d9540ad2dfa75025d3ede98906b9b1c7033735381ea1e7b6bc679440c8d9a1e3b4a0c46395164dcfe64988924ec7a191a73f5b2110e754c60bd966c6b2e27edef4b4af51e9ba7b5090e48515dbd48a640847b4df4b794e9d58eb6824780896e41e33c470191dedf2ad115ae76913ff1a06100533d173e35498f1d02e0fd3bba3a25de7122cbb9e531e2f1552ea5d4d7e5a79701545669583430ebd669656af747fad183eb43a0e1b1eb2739104fdb0ee32108192f6a1eed9801be4645a15df396959c5664d661554ee6067d21a5fe5eadd487da64458cc0701c2740b2e095dd80abdd09fdc5d069ef51b4d3f34a27604908e4bb94536dc10a8d876b0772186400fbb734d091a884343f4fff47f900cb7c3bda7cd9ea4d70b4febbf647152103e0dd6f339284754938bf1a863a464467c489024a8a315e50858c5a852dceae793c4abbc7403ab29962543ffef6c5478e1e82baf3f1bf8791226b6d20975689a88822c479ae4bbf4fd45b5cb2f74664596fd05036ac1d96f583fbaebc6db208203042f77fa9061c88e41f5d7ed83c3c059752a2c10a58a074d51c335206e3cc6b3563b9741ba1aac33b5fc1e64ccd8c5bd86e56173ffe09b02faef227118a338386f95735f318896b484af1545010ec1724a862ff0a737ac34ed11d938b4b2980842a2704effb22e868801ad82754e3e19d93c5c085b5471c67ad9a949eea79340430c91d1d21c9718586e5bf903234e0810fec5ea80d9ba3340ea60fd2311721f1fb67e2db065a419f366311e24f025484c669107c35dfa3db5fdbe13f82039c59fb930b3ef43e530e129c784dc5b4ececd93e7d24c58feb49f0c9bdd1ab380e6614793fe023ed479c833c07572f6937cdd62dbc41c2079a4c7943bedf40819cf280a045a4f5978efb39fd2bff188346078ac5328c70fa023906a13eaaefcb3e445434b6b9a0f8e449e2592122336de09fd508a27b0fb4c49a9d92dfba8d03256ed9ac909ad1f0a6aa98344e81e464d718e34b9ad3a56523a5d5dc631b0b6d4965172b9e5bbfda0c982e0ebeed461f8060271486348ac9ab01665ed31d4f26ef76289b37f8117172bc3239f74212ddb8feb945751ee53777ec37ec1d920b9b6cff077dec2e37c63009858951be78157166ec7d840cc1c950bdbaf8911b608a68610f78cb54480fa629916a11882b99f4bab0a773d2fa80b657b797fd0ae36434ee7e7750422eb9bb14521432b6c84003d81278caa9fad2bc4f42334f73d48d7a43f2b997cced78962ad81ce3bb589bab3dfe5bfde046650b862e51f40134d993a2486bb65d1f1e19adb5c4f4490193094f7cfe3a7ac80a78d4a3341ae2f9ef8d84808bf48443564d1629464cec52d63ecbc8ed8443f2c8d5fe292fad00cb40f830216e263fe50b8fb597d3eca013d1a7dfef6a08376c307f94367e9e8e0ff540e53f6f80577859830a12972535a89ba4d2a23464fde171aff97bde87434d7a12645c2a74ab2c73f9c11ccf89c534d6a40b96212cc6646007db2433c043aa79515a1d90d2319ea62ac33289df66ed0d99f865f8c4ccc8b0801de0475b7b18a39d7e3fc29f9dc9bed8812497384fea42d6dc839d5400a2f547f90a7b5267c6199360608d585bc44425e403cae7f53f12ee4f04ea0d1b6231438e9d8cfa63b8d741d44781d421042430c4789458d01593c416fd326f2a1f47aba540b2df8761f1532f198ad9a5bfd653a53842278df9d5b2efe87c711184e3876cf675d61bedbedb9ef58d7fee05775a727632e3c4e467ace0d8424a0434186387ad43ac80b6b704dd04c8e9c3746e07f8a353071598b9017d506c0b904b0e4454239df11091c7e2699d6e7f0706dcb7935cf15fd0d52b1a7e98b2f9e23b06ad4a12a45f821681bdad16d72577232ef67928f0262d794958f4a2711f2b3666775895a17a1e9e022a8d84ac760542ac44aca4927aad50af60836ad7e8daad5a765ea867a78bd2adfb4ade4f3df4743a35fbef7fa64d603ac4f1d3facdb2ff882e4ca78dbf31c8aa772166445fc8801a7b195f7cc6b191fbbadd39538e372401732cd64515f16bfa497496f1d706e1656d331b6c75cbd2760118510b5b8f07f6d10608c632ead818a9159face6927959121ace1e0aba42976c9afb2061ac32303624c92158138beb9f2e80276469f7ad1d97a7744472decbf722b65e5e234626329ba6c81b58945a9314e98d9ebc385a18b6e4aa1ff731d5143db99bbfe8a82ddecb11a7c0cc935f08c5ca2ef70e2c0cd19472c936a8957684622b42be6632531a652c3c1255e28ad343a8c760989a82b0ab6f924a696f1566817fffadc278b3bd2a692985f04b4e97f112dd35e58fda2e74ae2666a48835872b7499e8f2932e8258ec80d0d43c5c11e17699c548b5cb769cbffd4a8f1e2def09ad1d5159bec613c76c0f4eb94f631f055a2271bb3a63e0303c1f35d659b02aaecd1e450c450b8c9570a599f18f06638c517984d1fdb140f68b5624946ac646a0a37100e027d23dad8c17ebeb3958fed3e4a3953788d8ba7c64ac8b0d793707415d74bbafae6fa7b086cea1e1cc39e2afcba38266705bbcadbd6507634faa2c7d38f80b128e8e448092bebbd5156d821207b2a4730a11f50fa58131e3dc049f14060772b5e72703af220ab0f46e82d82d5c6a72f471c6326cbc7d303babcdd1ada78d369bb93fa91981f5c937593fa76304436f3f0bef70122d2c7b4dad08c68b324567f07025023d67f30f0a5243fb07511bddd280d00d3639f5542260574758c792f4dbd1244aabc176afcebae9f9f1ce3473e37b308553e705ca34a9c4f388e67cc5b9914e8953b0ffcb61a18227067c4a157a9b43c6b4fb7a09e0211f783adb08c8c5bc9ba7f8bcd81618209e234af62645608d9b7b38dce6b2c136627608f4820be611788bee11f3323496f7058f7d41371f35a2b4f0cec503c37173325424934030e0a41b23acf89a48dfa9709c3abcaf6fcb1fd6f25a185f68f2abdd3044e475aaa4d0ab61ba1a0fa319bd45fa377032128442b7b2a3704c4dfc42fbf8d06b81f4c6572456072bb68185fff95dba64cfd8df486ad02c04945fd47637be206c0f36c9242f48ddff40e3aab6f7c516e8f9cc9964f3cbbfad48373fdd6ff1d8adc49a1be0db6013f3bc47cd8221501555abedce68d662240a8b2974669a09bfd5499a6f7a76ed70f6c9cee97aa6051dd5c99a883d86b0c8fbe1196ed247fe76697614f16ad1798cee2e64024888de12a8e915b4f534faae682539a8b52e17b994b4d0b1571856a9a38393ff4dff58a053e367e79b33dc7392dd0a993ff984425989d062014d0687213da099e03b208c3bb00983e56280f70020d07e255961a5144d34e74feb896d694ceab76a548affda16240d2d1b02a10e4edcc5c36beee27467c6cc4e41c6d6c578e30fcccb5f8c5507267292133716db46a7df0da3936394111b6c43d05a454a701c24ca373345ad6eab93a880706c34853a46ad0a2c6bbe2d2f3c732eb8284f25df7ad8dfca7eea91b8313fd21297afdb54b75b8a8f02746d52ec2c5221ad93d10ffbb6e477c41f20bdd8b414a931747bd64fb4a532891b1aa313b40b8882656f1f776bc0457dece131753fe57a437030ae4fc014b03f0e93f08d6e64301ea84c19f62a5cfee1d5177284d929bf39e5d0214aab3aa4541fd8194a17d9098ddeb199f17d47107983fe11c0f6a9dbf30294ce0cadc250ef6143e4a61c04bc6453ca1a9c420f852d51dd65a155df0463a1c5ec4736982fd7df49fd1da3f94cdce3f83d05519aebea1d63784f7e28b4db3b2b3805c8f2110bd3193afee13e1e247e089e857b4236bb47084d6e7e38c0d41badec5466094e6e4749b73115ceb2ed246f17953d0889ceba4301ef82826be47451dde61834d7bf7dcc15eed7aab0f66f53d619c63ed7af4ed5ff8840adc7f415b5686f6503f35ca1b3d0ee8b5cafba3f793b0b2982f752e79eac194307a02aa5104c8e985ed58e7237b28df7e03e7517d7b49a9290fffa98c14ed758a063ca2d961a388f3ddd1aaf6722c2516040bf64bbba8fde06af923a9bd9ab03fe41d9b9d5e0bd1bcc331915de679d991ff90814b5b88d0532e4d8e38c54e75927c8694ba43ff003d28433b616ba21070eecdb1b863bb5b281f3637e6bb44998f2235f370fb570f08c658684b9c32bf2f5279aaab7db107bae2d22be346a16621e36d35e1feff510ace0bb198cd3aa0f16eb06af411c6fbd937fcb3d248b007fbf51b5f04467ed66dfe993e485e6cb059df77c427097b8f8d0847b4196257346653f3d62fc8abe536943f7a9e2cbabd00cabad0fd627a76ac944988439081a88fce0449b8efe5dc77695efa68634201dc97ceb04dcd3bbbf75765d7222c6475fa7c2e991e6ff73d8f8dc0bc607b70e9ec9296e364021bbfb058d97b7f1f6793a56f794867834aedc860d7615b280a27ac7bf7c99c053459c2cdfbcd7a68dc9b5925d8bcf01913666b98564f80a8cd7bc57a5adbb91c3163c72c35a468ddf62c3989b6655b48141cb0bbfc68e1f50fdaef4be07c48a503cc02169e2dbb8bbc4d7f47f49d68507e149efbd061cb27f39b327c1855f2f039f56b00fa754f4888ada73a43dc7e8fe1ddab6bd5e96bc7ade0d514dd0ce31067a27d86e7aa1c1b689326a54b3ac5f4080644d9a72c5deb9617525cb569ec9544432c00adf55f81cb8c287b4f14e2fb79c5119a2083a53ade9ccfec24cd7ed3e31d40dfb9950a5f4387ba2135e437a6a2d875f5f31f38ea37b95a90f52b6d7ec6bd78aa1872606ba4dc9aa094a480a3a020374933c028fd21b4b274534b60c9a6a67bb6ccb880aa03cd00cda0e2b167539581da1485fafd4cefbb0584615a81c62217a082c5be6a92ca50b646e34c038410be0de59d1778ed6dcac2b6d09d36bb7bd34bfefe405d01a3627ac1432d8130bee04524d17a9d5d123a2b5fed6a468b2674d515c8362680c9a4fba6edd17c0bac0587f8d07edff5f6ebaed6e2b1890070ad79c441cf2337207dc152e5491077d07d8169eb174446559144cb0525f241099f8a7a10e510505543c76735910714a738d7b6930d151ca5c5b8c465fa75bd17e78c656740b9cf5e4c0286a3ad685b3d735c14ef3c053adcc451796698ffc6acffaa3e1984ca08b21eafa06d0645695037ce119a118fae85dffd4be3b763ad0049ffee16522a9e4e62837f07879967b278522dc30384938b916cc8cdaca25ca97f64973c967b7fe3ee995d1cc9f2faa2357709d5788f896989d6d1eaa82f9157cf3ec82067dc2ab66acf27d20adf3020e6c7f8cbf8496ae151329193157069b82ed92780e872e525fcffc575714ae5080ca9ada6ac0ecac7669d8760d0b7c00067b77f48691f27172a2c3aa9c416ddce90f5d2288ba0dcee662b96d59dfc2b35a8056f3751f513c8674e9dd3366f95e52d84b5493559bf6f1580246d965f0eb504514f108333a57ec919e01ba212635e38a57bdad5d3d85dc534fb7d0c337782064e5926a872fd8da9eba701df7e58786fc942a1df96473e8d5d260e45f0658b00c8098199232cc6193ebad30f5586b9e193262d5b7b4c6736201ac1a5c93d2aaf2fedbe876404b92b7078726c77fcb5be8ef83a2604144a9510e7ca01a1d79c82f845f7e41bc74ec6a835a81035ad7b7675d534a97f17ef136ee67b7ea6dda7e32872406859e30542cc31b5006c7012bc2b1cc8ae9d321f858aed8b6dee673131cc82e5d59fc2da13730cb8c303dc50fa7d110da843bc7ef4ddbee9447db76e3fe10ce1666edef3d555fafd361e697cd6fb3f7e36df455596507fa729a033c057639ded0a2860c8e62dd36d642497317977522bc316ad52b104d9e73f1b9e92879d6f12eb6dfc2bd64bd8bed3de7abb9577c1589b28043d7e95118c8e5e63647750a0d3ca812849483055b163e6a5603b383438ae6bff0032e28d96d233496cd77391eff64eecb03ec861561ddba29330bc8781e13a3f95121ce96ea20ba443f8672fd2053696f019de4664b3e5eeb65efdc34e100ee6a4e7ab0db45561952931a08793c99a8a25abdec4bae31d651a316965a3e8acec06a8661697822ea57ad3d18d0526ebe6f5a121f17397d8c7d1e81652535690728da0d5cf05b1c4a9bab8eda63a3be35c2b889299350694aca94098f74f6e8e5891a9a8dba8f662dcaf1b08acec3ddc3be0add470f50e2a195525e13e73390b9369fb549e02067c15ed811efa79715a87bfebf9c89c4bb323d6c82d619bf3f9de40904777922d0d8e7d297ebb008161aa7b87f2ff7735ee668ae930a3f3370b73e4f3566856ebaaa92dc2e497454e531576ba823badc17665ac6d57bd5e6bdd8487be2f0d6278c215353edcf9d55701564503411f827e963d52a47c2c03792648212464c3cec9fee203f93d7211b3247f3831fc2012b9c3c4d76178b71f5bdd25a642ad516ccfb7e5dd92de6320a9809061d2db3705205be7e98df00253a7debff9a93ee36f2f727b45be72a48ce7bd5fa7f9817491fb74dcdca004690f9d1821c26428e6f9ca1ddab9b9e4a16ac3c102d03d06f2722dbab10d58120db9a9dc30ed399aedefc0f073a5e9d98f9c58fccdab8f88116784f9283f71d86579bc7fcbb4dd8c7ef411b35da3f37b55a041ca0e0dc2e549f87207d9c6094b9b9ad58fe16b4c876667404b3d6614d9574d2cb7918caf3c9a31d094f8e274bb234a7567a1e30aad1a903293f65f194be0215b299f22bfb4c892c3084ec656d68a0cda06935d477490d162b0484a6b0c24e3be703e0c69ba9eeab69c48319cca4d641bd6ebfbff7e25bc9f1e62a248cf1335c6d8ac7e88fa2491f5bfeca3df3bdaf328f19fbb73d372c7429ae5c1861190faca5c748906036045a5e3bfcc555148eb940df8b4cc106956698e1679a3f4343cefbcdba05f67b971316f0c7a22e26696903437ec542791892609eb6fb7a78aad9013787719d66dad14fa7c451df9eb2f546cd2ceb343818151fa808b4053dd634abbdce28fb1396807fa17c7663a61d0ea108cd90f727db59f7499f99bbf07910f2a56f6eefb4e2ef6d411584c9b6a552a9cf3933ba21ec7dc7f0f3dbc1b3587d8ce3bf25afb3b9133abe85a1fd93b0cf5258a6be6798b0848f222dc838e30da8f03706fbee6f41a60f9c044495865e44fdcfaa584a308f681335c391f8615602295541589c01d3548059d92cfb4b75c2c2bb9e6d3eaf4bef4834868f3fd960681f832c8a2f834e3439d16ac6cd30a6e4ec5a4dbcb4c6ac0bb3919fbfe6d676169f5f3dd5da864827f6d5d3ab7aa31a8181af8229e8de6f78b294e5ffc73dbe742b73ccb0ec658c2465e01cbfbff306c340a09a3125c4a368bbddf299352703243466629d64b1d0b542b67d85374428f53807d69b2af2be669b862b2d6c2d2e9a10b77fe0dbb599fb3a67348f0b1f8cb2737b5cb01704d4ce4ca5704881f1534fb838bea3f52b5d09db3ce95d38533565416c2912e0d2222fa2674906c67c8976cb55961e9355e78ed93e5b1228b5bd9d2d9834ef0a1fdf49dcc1494084dc38ff7bae2e622a47c31347bfbc7a308f0b234fef5178d232280f18e2adae90fa7391b504a7324a7329efb4700c78c1e94571cf831d223409f38f65e4b4b93515058d6e0d30d522a4766b7dd64ab2401decc2e031473f8ee50fa53307b17ad9503441778f5c21807cacaa1f7599af0ad3f417300e249cf5e8e25d1368cf94c057078284dad980a5fa946e3b2dcc991cba0874ffd25533073a117faf4506d2f4ff27e9f4c429fd253e656f77f3b3f92b57829169607361d96cb9893f3c747acc9a566fafce79a0a4ea8f814bf04e494ece1506421210203f1ef918233292b4c1b28019c29eaf420b15b5d8784887977238cc0e272e2236708edc5b3cbe22adc5f622c98fbe3a832ba0de911fb66187c6465b6fdb5daf1a4cde39ca509fa9a2b98eaac57e72ccd24445cb2d410083737b0bed3d74d3bf3d8013cea601b7448b16692131a160ab53adeaf4325cc27efbb17fc3788c29e6647851b618f0b92e418cf7293b889111b22e9942d627daa1727a0b97c0f2c411ab144862efe9682ee224d3425cd3c12cb504c3241141fe3021b3456cb9c1c505d46fe37270d397db2449b0411b06c01756f6d0d7ac39ad4fe1937e43fac4a721872a3e6679e7e009ef6dfb71e669dc06662dad00cccf300b182cd1e29e113442f91cb80c8fbb2729918682e94d6103f68fa01bcb99d59651246c125974704b56ae87855ca3077c6083cb43a67b146ac6a64f3ae8a531c9737c78784eeceebd45779fa2d3139e80e6d8f9777a4bdd2d70318548c5a18a7d97ede6e18f32e8889cafa9bed4a280b5d20501c236a7f8e3346d3ac28efe23c648781e969713602a713825c4f1ed4947c667e4347f572fd0d5206a3915a465ddb132b13d518842c0e7f50aa4f16d1a29dfea150b364e795bd078561451cf108076e657266e3a97adf6874f7ad951e95f553801472b2fab9b16d4c5a63bc7c609489c8c599de37f5233ae6452bcc54559b8424cc2b0559c364606d050e1a5722c77530df3e4bb7f40ff8dcfd0bef7174e773875f6474569fcb1bfbf33373f1a58cb55ba87b8d91bf23d47c018d578c75de81dfa57444e70962003ba74be2a6527f46989ec2b98b0b4ba051639274971cda52105c428d3d6307948e5cd951bea8b26a89d0d6d1eac38da6999b40e4d2c374d728ced341309fb5e11be9c0ec728737950af6f1cd6bdee8ff380dcb001799380727473e719dcfef0ab94e7e62582898e9855ac50434acf1dd0e42b1dcff2f1d85c5582d10c5f9f7fa00d45589e10ab9ca598e47b03998ae021add6f832483798c4e7dd912d6483f74fbdd5130f51d7fdb82f8b63be4646343afa83d7b3bf56058228f402538b8e0775558c14e3bda065eec13820caea9181ed1d505f142104de6f65d5e63d517a758d71b43e31b16dc4f0054952d18e23e3727b34f1b71c6d9717acf045498dbae2e2f9f6597e95dfcf8a8cd6a8640662777313cd8c63514651567440f72fee9d9bdd19b456e74b7812d5411a2fb889ec71b795e2fb934946375d6ec2a87a12309f8b522d7a2a3ee885b28e824f75478c23f3f8cd1e9a1addc29aa09c893068f9b7db671f9934a52bf59c7edbdcbd059a45af2d4f0de7d541d9c417ff9979d58326c1ad9bd7d6e794b50ed19ab4703d5730638608d16d6f433d5cf5ad5ff1be0ab2da0d1557a01a1cf2f6eff331ee0caee68540ffeeea8fd22b25fd77b447cb513108a9abf701021f9caf40e20152ea654569f717481d605dac0150c6bc682a16971c0e0d4ca23bc6b3596213e2caa1a5013fed36d2d735dc0516b974d98eb9c4b838c0c92bc4c9fe44b8d82c0b4418392edb0cc704afc47209eae570c86e5e2e71fbdf412f5808bd31dae1c42e90ea7a3803c7b50819337614763ddee62326944455020620c3989a9fd4c25f6ba7b31a88e092a9508ddddfcc952a7d44b1b38dbfeaf64c795869eeb6b0bf267d5800db5d173b8e4328c18f788dee18a45fa44a00ae731ae6fc67ab6ca47bbbb3219a0ee11b79c3a231c3eefdece3ac767bde5f82e0914d5e7133a279c2efef555c31acaabb230faace0fb72e2a273d253503d1f1505e78d2465b75a7e807a229404477fed43e77abda360fe6aae8383c8d8fa6bc0cdc0b769eeacecf31163e3a7005c3d2f8ca2da1defc87a1cf843cf77d022eed890654b23453677b039c149db32b81bbf7c860e9847a9418e12efc3711dd119709642b472fee38715d0fcc57ee48d30acb048be0f300ebe083a2036067270fe1bb619218eeb225f4889a643bad1f8742bfc8545b46d18218a29c3ceaa71e86e1e19b8554f54cbe152549ee8f1e26857edd155f50fe6ce29240e4ba5d0d83c3b5dee10b2af6c8b40315b6d38f4e4ec7ec4e211695cf02a5960c2defb3c42fd419156dbe49496ebba5e6bf9870b550cfbe93611b30845c20abf2b96e74bad6ce0a7302c4863cf7dac67285147555b5d606f69344cd3a326b2d1fe0b2f60533140f6fa9461390de1167997207694a85caa25018d20367bc2c82e784d537005f26be584c0bbf6a3b2b9a5311834fbd43ac266b36eab3d5fe23072834c9b736efb23ca046202dc0c65c671ec4f7d397792f149ac0c4359d0b04da3bb2744f9702f62f6cadddb50ba5e95607d6ca6b16b30aa70b0ce81c281dce8a9c757546335360e0a879274351ce4b057121b7bb91eb24749a8516eae6ab97c9fca9e81e6eaa24108893ffc69ac41e79a4c658183a5a349ed5f59a54af8c9f5509a58c0108f86e8a80398f1d11145d6e5c923dbcef44ea2bf8aea4460b47de83d17a090f5db15f8d847f6b081b888a8a0e553f03ecbbc32e08a149e6ad94ace4c3182576500faad5d9eb0e879bf23e499fa74d113c1871719bd6f083de0996d66c9892b18ff611102890775abf195f02dd2f51d5765117307e1f34b159cf044914f49aa66335021696bccc167691878a1208acc3e7ee598f0abcc5845c2efd56301c818b0dc68a0d4e90a72170ffb172781100af735f0abb50d32d8c2facb2a69cf78384f605d777f25a51f82a1e50e89a5a9699b9d6e7d265e0076e55ca77a2da34802c2a3ba37f4dd87abf4f8ea1ceb1f53b55e058f9bc9a6077387cd3b69b3b17585f936b29e49c4a695134cb7b588403fafa766861cd2e007ba4e87afa70454121140da5ced9c38040b8e39d6e228f84a69b33ddfc9761996aa223ee7b631c5343f485d85e4a77e6eb7cced6a56d5d7e76c4a753a7354668583c489e492856daac3d9c337b9b5d7f8408c60419f3d9998f01a16d8f0ef41f26c22086e46f80ce18c695e6003957c2149b3bc219bf47b2ca436ee184f63883bfb3c1c70d1ea0ba862c4e6b894d3f898b2103443f6adaac6b56cf76ecf6f99e9604bd13a49d8bd0876724e6a73cc28002cee7746bbd893e75ca0617c47d781e3a83b18fe0c569359bd580e9fc7190b4f298346f889ba626f75a77edfbdd4f3c3aacde25945433c0a50bf1a937ecf0c3d6c82b75ab6724a323ee94aaa6d7e55be0b78d6202176e649bd99053722ec7210c43a6d288c758e7b9cbcb4280672f83321c42f6c52fa8df3b001c0bb0ddc36dcf560842216d64776ae32ba71af971a6d48e24bc28d8bb8714b80e47fa3a8845ae9d0f2f067bd11eae9521d301f42c760b5125e39de862b082b22b3d67d05aba3f4079bcececc5aaf93c80d0c69f9b4b036f1c9c30acbb6ee692cbfb3827c712542d6e19785d9019015f6c6e5776cb1736a4b577f42f80b0e8fca548056121811ff4eea74a225c2c62c64b0d640332d47c8942a05b7eb421a704e7f6b08dcc00ea1cbd73910064f1edeb29ee5d644425e72f28c9de833c63b08fbd7af8a46647b95c106a08d42895e8bb583f8aee30ced6b8d965234495ef24a9368085684ef20ea4f796f941258f0f8d13c0a1179f7c8748f0d15743a879d9bc9b6455e56407b9a8bb5b897f4a001e7ca3a0fbe12c86df19ba5f93c1d67bc0a55f11f60ac74887a855d299d3b98cecc4b28c267b30dd299811da3fbe9fa5aab0b21de8fa3a4ecc7f7324e1281041f66b54e4ffe206c4013cf939d38648cb1001b983a3582533a60f906d74dd51edbed1255d554f57b39b269d94fc9cc44641b8c654fb0e2e036a863a4c91fa10d0cb81293295abc39223fa68e93eb672707641c7ada846dcc2f371703372d0a057c2a0e03f2bcc682f0f846fbd47d4606b9a4c21a04bb0a0aef0ad50ffeb7a1e6de984115b8e9986180aef83a0dd74634259eec6fe47cc2b2f1c61cfc69480cc721cbde2f97bc589c2b521797bff0af59d13669f3ceab4104365d723ce735249f48ab69ac597728691d78c56c3f69c70c30141a2133d95ff84a7a9d3f460ac0e33a64aae14fbf2146fb3c97bf5ee9d0e5aa4a19413b3a7cf4b3ff101e0a7d2b64807f19cbb01884ed43db78fac8da4e13702a19fea12af9524866389711fe2b99fa888060cf4f8facb2a22b5cc9e5e190fb795ea20ef11d0468c0b4f9163d8518bcd2af181f09631ce05ed111f1ef3d346a47e8a1c906ae1ef8a780760dfe864390398eae0a8ff04b9727c0e0b250bcaa61524c909eb35bd5cf437db472d211c8e2cf35f220b483c429c8ae88af015e11d582546edbc159f56341c8600e3db56136c35d70d545e529b263b273786b6f4d5e38da757b0da8d800f5e63e4e2392179f412894f9a73b00c50cd938c8a99ca22e7e7f8d5c8b0b1a92e713e7319ba3b90704dc658a6c723e5d0f543578bc148599115636224c247ba65bafdc2cd3387d4b9c3dee8d18aae444867baef33eccfa425af0c59cd576d4963685c7a936f733ecb4fb07a09f8a18b070f9c91d24100f190d3da7dd00574e1db2474ad61ef2259344adeb52d4caa2ed798aeb6dce7782525537d1391e8455501ab60b0e0fb8691d2dac083e0970040171b7bcb5178d0e7edb0d68fd9de70ec00f47baf202dfc34d2d35d981bf6fb9ae753729baee9942c3a6c81d37fff3b265f3fa4a3e388d2e864e5184377910cdaa8a804a250f5408617e578eb32304a105de0af52a67f1b91f95590bb97ff344f3cb70a05e205a53ff40fa2147be308111cd87625b5a65e3145a62f4b93293f1abd2aa00543f5f6c99cee016321bc1c5da89cdf0dcc554654cac1cb11ecbbeca84f26bf9ff56cb371e800e24fa64fed4e1cfdb113050b283a2197e5be8b8fc6d706ed251f25087cc4d3dd60e835295a49824c9c05400380e86c45f8e136178394b2714ec3770e41492f2c1313e1e9fb17e5f08d9d9f4cff996ce237d04b753b1e919cc6b9bded1ab4286a7ba694091603df59927a04a57929579fa753cafdb935bc644045c69d1f4f6392173d9ce6e7f8d0c69467c1cd88785487125d9523326d95706746b4cccf4862a5659f424f3264ded0ab72d74e96b406697766e7204dc3309f79f64efa284af1758f3b1246726a82c8824108703a591ebdc821b4ee83d061fdd97936c756bdd96a43977fe8942b1fd03003ee7133f83d7fd23f50ab9c69c61fa024532e1086773674f7ee65f07d553b582085b84bab180db690378d3e3fbeb3335561a4a6bf427b4306cd1fd8b655dd3c3c0e8b2a8e5bee922a24f1c2fd4979bc6294060e9165834ffedeb0130173eb443c00aaaa2018272b0d6a96b537a41d9ca377fe09e875ecafc2c4c601bd51a70fd28fd905e60dfebc5734b3ec0619afe743cce7afa5d1f4aded97d251b00f4c45307995d929549cd5330604e9c8c005cdf6cb8e66e510314ec66fade8b12264318a021e5933a7056405f00ab86d62196306350329e128df4b4cb04eb018b8af9e92bd4dad97f8538d8465487029e7774721d6cd3eed088f79850005deeedf9c2dea378fcc890863024a3de8b154f30b78f52322b7b2e0c6cb2f0685c52e3c5ee36af350abeb38a7b0cb5eabe09b69224aa1c23f05600d74a6113faca545bb85f779d0e956565c48a3018032a09275b8f8a045c3e5ae515478df889badb6369d33bd2b8f88b1136788bf4ef0a2d138341803239231874f10619d8ab33a15759a4c39e88ead574ed5ad38d2ee5585af77c101933dc035ce2f16fb8770086273e314b2409f8e3a36988c6d9f4af93e85afee2debc34eaa3fed343cd73a338d1ba21f82718e58489f217fa1fe46f047295c6493fcae5530f4848ff9b495c0cd7187af8a90feafb865574f963913750f4443800b5415b70fd87918c7c7e79f0e3454d517041ff308ef68c44f67e71c7e1674e2e50a1a0b1d2626743b911958027d87301ebd907075b12524d469f06082ad08b001ecfb370414232ee9fde4f184343249f92ef8a966d1121672459c8d70b0856768192bfb43597db00d3dd068e503445b5d8f24f2b2be42dd9d5dfa59f8c560d44c3876d532d63f26191a75e18e8ec1c3597886eb23b7fd6b491e67dab6087831f6ddebe4a229394a5a4175a03e6176e841955fb9c8884d46376cbe85c12e19a26d9f04b0eb56cbb649da16bf483852a0068c7ca373e001e7c60ebe62121fce5821d5cc027cfe97b4fe3c3883897bae3208cf91c8a3e63909295a4f4732cdc095dd7611bfafbb8a8c5b06ae762a5cc3834e8f9965a6164d9f7c9f256711a454cbbe4c0e7599afead9af398bc609d13ec8555aaf211b9cff52612a6775a4d52e1ebfab893a1476b2f8243d5c2fe06fbe68a37113f9f329d9dcbf2f01a7e8fce74c7667cc7fb67761f3587195fa4d86ade6fb022a9f37f49c66b354aa40dbd93c2254a027ff5daa676da9a64a4a98b761f6255771dfe8192eeb89710603b360383bfa4e264e4a274773c9d183b726ccbe1768fed9817b58d0226520f57b6922dcc8e402701612ea96ca7b302cc026013aa34a514cf67f3be0f3025ab9915acb3fd5464ddbad3ab8c472b9bc0bb38bf00d56a79c8ae54afcd1921b2bca34e19f49701c49435b561e30bc33bedbdc3c77df043b847366908943e8f15cd3eee31c061843dc7c06b022002853f8b7fdb2653826fe53b992b4c967904ce61644f398447b8d84a2b13283fda287a3c20a8e8d3c223f91a8282dfca2440273febec67243eba72eb77dd6b47d066ff97de2d74eff47832ee14b7b15b558ceae3f94c3516632afb49c5c0a7f1942e58d60607e6cbf5506e536f8211bb83c7fd3c5d1e2307c54135eb09a459247c04d37b466e910253a9dda17473078287b5729163b63479da41f638730d2a645757413797d21e27b8457b7cb51eb2bf562a541f4941c931992c02d33ba83912324059bd72e73bf25edd913e1fe3e8d896936716631b556529fc5d0f924ff4d27ffda6347a924b0052f68416ebc94acaa12a86cd971277130a125f6196063c9f4390bb147c4e4503268b2d111b69414bed117002e97fadcd7181bfc1dcd2c9e0249c00d0c6528cac3e6876a84fb48ccb9ecf096a2aa3d35d66ac86448585a0d685dec0af06c28b5806548675b9db88b893ff10a9f87df5629d824fba99172047118498f904a26a706367e69a593942aea6bd983d4335c400d6be9f25b96495d8a073d7998400cf7ec6111d52d05651b8f08211b5e965cedf54b7ed457923e4be3459e9b34ee34fb97969d6c620790e2b1faa236363186e3c1581435aa8bc4fe27b62760fcb645baa34805633c7f4efc3faacabef9015457a08a2ee73035f07ff45aa67d0f90953772c07d8003bcac3e9418a0be9e0ff702522ed7114573a67c6dd864603ae82d6b0646450035b1aeef4e8cd6fff12b492e630ef9e89ba5c05f3d6e14672288f36ecc836262860afc1d925665df5a8aea10641d97cf36e19f1469542975068a6f223637bad8f23af7d6fc88836b47593c26fb3ce8baeb7cc25777a21b19d8cdedbc959cf17e8dfe087aff8bb74dddce8626b47aba5e86ae9d30f45e1ce7c49a954ff2e3d96970752323bccb8a9b3169396a87bc54c9eb32c4991bd12e0bbb1020cb92165952bb9b756412bf26039505494affc2147f4bbc4d313f934f92a6a923d0bdefd2db8b6f3e1c99f68037876a89f3e132473056ea65fea85f6570c73a68d87bc9b4976f680738201f906d5f5dba56a98854ec6899eee5b29858f90833dd194e39815009bc99110beb34e80b4ebe551ad901547154ad0dbf825aed516555ae0b7c069387a8c41633b47d746bd246aff8a4c56830202df670b63763b910c52f0f25b238f497a8de481d7a5c79840972b1186a4839ccbad678014b9816ed1160ce3e78d882254d0185648b550c3ce1d363eddc58341827068045080e2718e25f908815a724d14ac4671281fa2cbb4fb9841dafccdf23868a7f1c60a0dee7f2ef103640d5e41a28283734978df78a420f0f63013966f373c21211d3da6635a6812142530a1fe31cfcdb8b6411a5887068ca40cddd8a08b9d5693c6c09f1acc2732026db1d25f79ff7e080932917f3257a5109e07c4fc46e55bab1232e76fbed41c0eecfffb073fa3f6bc0f88e62422090c7de27ef14c87b0c3ff7c41e0a41c9cab171b62c95c027e01b5013c8b170824e6fd3501dc5ed563aa0d25f7e9662fc7ff9a0e86d5a6af32b3e424452bfdb531d51b7051ce975c5d10e0f02723a1393078ca050f4faead8ae3ad8d0948772c669814c9c28f378d87b9e07e1fc7c14199c87d1c5393a4211eb4d44b8f39713e80ea6e4987b68aa3d3a522317388f7b2364e40ab1bdbb228ea6335322c96433069a1767fc44b71f3b147d1ce8d42005dc9a17a654d5a801bb2c3b66597032af950e85d91320f02a8816c3fb66a7e27bc66c8f0b3ba9a5a58b6fee8746e792990ddfc62da08adfd47b8f9f4869ec6a2769b0c700b36d6e8dd8b23c211fcbedb6e7cdbf1504f2e95b5e9a5378d13893c61c8edc855aed275305858cfd08f752ac92d2a923fcc8a51e0bcc7bb081c4b6ca8382358b1f7d7ab4562e752076045c504b70e35603db5c6274515eb9bc17adb7ce9790e8c053d2c86120143e5466f6711e6a028e9a42f2b6dfdcafd74e7d9d0efbc38b7c6d7c69bf829ec0fbdc22c24fc31b693abb32eb0db92747005260c2346adfd8e9ade1ebb5aaebc9c3e96b9393f29891dd90ce005c0810153381c6e49f1ec34d0716763931fd478779815ee50e7bdbd0fb04915622381dc13065727b0db426e9c71a1670db0660ecac6de2f30a010e621318ce040ef8b842ece6ab07a364cbe3cb77d6a0d412420c3098fdc6dd8177677f8ee9235586524a70528a3b1859e4631f03eae4d42da4f703ad277297589ed02f99a9c3bb2bb6da5c7538ed5f8920ab481e5367b48f351e9106cb1863b7dc2599a3e4aa6b48d954c3dc1c0e51b27c379b5197743bf22b3bb13b331c3fb9868332937003db90dd43e53f080d0f04e77ddf0b25fcb2c450d53e0e6b0058bd0a62d29577b2556d7520fdb970664d6e8ae4f1a79bdcfc8dedb1aaf72019c7f2a27f797603397775e64a1c066147ae14e96b42ba0763ba8cf774ce6669e82b7ddc1784f068863e508c13c232fb28dd89a86bc9329eb44d00727b4c940afd0357f0049ba9aaa881d8110c597721e28150d8a0a839cb044fed84ef39a2811adb4a24342692ddbecf8df235a0153c2617e285b9c3d171a859d65009f6845537c156632661825e70fa90498699ac377fe0823fc9f37e42605f3d7d6991521c891174bad1ecdd61b452c19de7c67a500b9271268e46695b78978f3733fac25a83d9d811df5e1ab24ae7e917fca4e1f9a9087ce9827bc6938fef971aa3c603acc6a68690960bdc2422254194efe75c0917e0a969d708b7d8b8268e70dbbec61a21b6cc0760f1c87b6e604e6ab20a643793c94e84979e0cad6a83ceefd02d3214316dce10f9dfefaef94b915f2f452ea47f21f7fc4100ee20ecac850975a8c5fcb4fe0b229d3bb1e03a211c871d06d833a7e9cc1c20fa6ae984193b57488758e710c01ab8872201b88d3bde140ed9a097a225708aa84113d1d1819d2c77edecf28ec2714bae2d83badc6bd194ff187706e32dc9f326dec8f4805ec9562464957f97192cbb7dd7ffe337cf83c744a8736cf8601d94040d9956fd1d1ae2cc0e00bcf2e3318f17560d9e3d926fef5df2874e35914debf93222357ec3ef6177634cc2e2c6d800f998e530540c3f71a03b12a9d92f741fe6b7ffc855f792f0368246aa6bac189fec7244d0b36b7cece3764cb14e950caed7ecaaf9bdb57c97beb6fd9372e9a58ff2c515830f5e6f58927603591496de5ec26a650336487047110133f8392422cc318d733c2a5852fdbbb97cc890d8aa66de1a607911bd0685876f3d0341b735e356756812970947455b3310f44e228a767e6a919ab17bbf530b02aae5543f9bf7adb743083ea8b36beb97d921093a92de608eddf3f6fa6823303ff65d42ad8eb38e8e85eeda291bcb3e245cfded9b99cb66b6c0d6711482f0d11801b56cefc26f35644794b6735c62baaf74cd758a22ebcc3c2c440dcf61079f00aadec3b0af10e2f9735958d357e1e3632a17b35757ac57219b2015e4cce5ea1d28fefe50f9212f1731ee9b15c8ab5fa2e23fd2de96e5a47f4e1cfc3be5793963f623528ecd162731ebbfae5961ddf4681efde55cbce1560dddbd93f91572a5b45a99a5272bd09156596cbf20f366faf0447ca1e3585e399e998f7b5e805e9c44bf3f700c5bc4086b0de205a51f5806ef0036a062dcc70cb1fccc2f9e7bae371b62a24848a70a22fe3b715f49560529f0ea2bf5a902ee358f22666394f209659df91bbb9b1cb3b3fe87d2d48a27b12cdda6c7e4640f38b8da66782272da71fd67b89e909657c5466e71e597d688c64680d49e7fccc23226887b7258222c9b2d9aa19e3ed6a7366a94d6f2b3655180e5182e56bcb95ea856865f0b4ceb0c399ace87b1fdbec8c17b4025c3ea4991e824a088f5f1a6fa11a6cf46d3f76d1bc03aad12e2a74ce7792ac851e243f82b1e097140448f5bcca3dad8a74d27a559818ca534ceed6d79781fb291eb3387af296d3dcf204e45b7a26005af6b45789e2f2512814ccdebab3e101f2ebc44020f95d849d0a6b5d6058cdba438adb49b9ccc59533d03c4eb348eaf63849df234b6ab8580a1f42e62aa2145d700e41cfbdeab519cdd476fcca52d79d150792dd7556c4385011c2c5a74002e93946c4728ae1e422815f7b03fc6429116899b7bf1787ef5d7b17e3f9f25a4c6eb39674014af20ec303286dca95f1454c8e7b306b8d8ffb945e29dfb3d99f93997db1fff52bb82a73541eee59d434205c11af81580cf47e1c9c6eb51d0a9cc6306f183659c9e53355dbd685e907f579958ec2cc46b3e101fe02eca056e8fedb6bd96126356e0415d6a4ab182d2a527fc76514052c166631b3ac75afd376069df8cb1b76de1adf30f7f9da0c61da009d5827324a5fdd923e89315e3bd8683a1d426b378eb5431dfd0a2a93af81e47912ca7cbd98cb19293a4947f6eb5fb29d104f59a8f19102812a6d37c70b0fee76d664a76849ebf315dfb54253ab0e8af2cd2faa089d81b7434d93838be26cc8e27233129f79dd19d54e5863140d8f29e4b379d1b923cb51520ad3e33d60a6d6cb22790c21dd4c738c8c71b09c13099008b49d84bf6603df60f0c834500c809581899938b580f209c63d4fde171daa67d5b7d32ebbbca81b70285fb97f5a9276575413e8436026f882875b8b7bd5fa4aecc3b5d68aa07c9bfb6561b17cb9b6cf99443fed5a8a7b9e7e4f738265c0edf66cfb256675b74a928ef78d10da959e004fd1a7c6c2073b44f24e1ce72fd81b5a656a96a5bd7de63ecbb9132a79f6f1514abcd3dbaede26e96a22fc607c69b0507540384b5b29e5640df98cd2cdf6ee600a416b6a2791a1ae1c04a45f45f80e853f71043d82eb16b8f965b5088f0528daf7500d19792d2974186bb17604c60b49815a52f35e40d55edc1b6d89196daa2f2896d5974a2888c2b60ea28f9e9ac0a62b7072f9b62d940e21a5498d4a37ed623e061a113a129f41c7d5b4e4fcec8766a0b0f696b6794a8122aa2f8cd7ccd636f76381daae5974c9d1d1e7237205910d74c01597ed34e52238ca86b8e5d7e681b6e981790737fb9316255c21fce0c2a24036adf7f4ac3ee4733d33d4a6fd089fd12943b877cb82e51153acde8b9f2e87ae140efbc34855f6da548ad0a0c94df866ad33939c962f202da8e5a51f26cbfab6f756d38e31c0bcea394cf964c37c85efc3729805ccb3dd3254ac4cc4340fe93d4798ac33da31e942c8994eb6fe0fd8c2d140d39ed4289f048b1ff0f246763f5279ceae82ac2f5975b82e5b13df3d20157b5be3595e9616e20f2ef4f1899f31605d3c442d82996e28eefe8777538904d3c190ab3bda0f37c8c848df31d8916d04107c26541ce5434d72c7fc12b850ce428554192df62cb52455d4a296a09b72ca96d28416d135ba7d3ffada317f5e380b2b2fb28c95dd19d94ca595a22868eb34d08ae537c4bb65536576dc4e972f003aee97e9d8708531df54de110df6cdae2f54bbfd0d5c49a810b99c54a89ab4e5141a0f29db26411d503031748bcef0ec37ac382ac2f63b6781482317e5ac3f3c47dc90cf5d30471f46172f6e05cded04bc3e4c629f2e68dac7e8d1728a66971bf6a1e8f98e3d2049c0baccb2f38048d152cc7a41347ac264ae4cfa6e852b80d28bb8669a11391856f34b61200ef867f78f30d57cf6c3234daa88f9b6a2d69c99ba39349d2c107cf2e44840d872f883057d7bfa84fd898ca828eef77f43b6ef7256afda0f4ef4be81bf0eae7c91637ef3d712868b07b667544f5416ed5fce1888f016bc8a1e5185c273b9912fa4be2def8550c413c45bcd79e8ea04139fea9ede1ae9dedc577f60ed9c0e5622b869f6256f11a78362e1381e4a13b1fe94fe74397cae2cb76fd985393b9d69e7f308fff9db9f36dd39d33d3846422e598cfc7c57e94070b9707e81e2d83630111dacd461909416ad9f56e825b329fba0ff4372567cfcd25ffdf705fb3706d942e18f460855251e2af817eb001bb16cd630f4a05c9774284cd85ab240c32044aa2cd904a55a0263db0c33e5ed33a50136575f4cb93953f8eb2ab7228b5eae2aa673b27783bcb3f5428cd39db0dfd879ff61635ed6f3e676ddb898277faa533db33c72f4802361d6b9fcd677948db3223c0c3e06ec0d3dc8fe9fd93af1d298956ae545613174243eab231ac38b9c7b466e768044587fe016240892d69e6b88a3b301fa4fab3976495adb6335ebfba829214721c28376f5cf4b0353c4baa120f7a1300b4d6200243bac861e23af72bad732489a0e7afa5d3c32ba904dd98ea2f3f3f44da67a8586d0005a263451b3007f84a7cbba5472767f37c20828b4d00c6f71a04b9339466e96f0c6d04f40918d54ed86270fd99240d7e44183688590cea8f87bafedf6775e390597fb662ca2623136641a6c63c2326a8b28c50a8dd2bf0194c499273cd62aa465f31b6f6933b2beec2cb0bc0c5c6bea8a2678a940773cedfaf0e9cf3df4a82cff581122771fcaaf456133ca02cbd084f7ebee37b65fce8479ede70b024fe6c6552b85e37a065afaae2cf4e5813c1575e04ebe0db9874191d87cb1af7f58a7a5e691ee29dd7f6ce5752a7d3bc6040ec9032bf416e12c451767390b31abfafb08a217338eadf6b81b087460734741101d51de9ba725471bcab120104eca16274def2ecf209db4b36243f46889c2b8028fca3c82e0e5b57c0b3359b7798c547f656124a43f20cecafcde56bde3f74838189a2947a82b88c2e6e47866006fd40bf873ea2526c537242471f0713861aacbf4fac286c9b07163627f7a464f3cf22679c92bdb8de2aec54585ba24a956fe656cb698815cbd128f6813e7f63b6ad0b10f7f6d27d032890651258a4091db63b5e6801a2940a4009687e79aed7965920b793c9916a3f8caaf471b13266066d9b4e9c62f552922a446498c24429372a3ba753d85ef21b106c3bab7c05df61b51d730d1e9e618e91f3c57f5baef59db284d5dcf3d7ebf3df5e2ec2b9195dbc87dc0e1f946ec0c0b89bb854cdc7521012d38253203dce231c3314c2de2507c2aa84d64b87b827485993dfbfdd584143bbc243bc994c1d638d0a4d3e98bfd4b0d3adc440099a4b929961b7a612deb04e156661371ea450bc9624cfe463a8225ec8058a2ad8e893ae0f745f853b9e4f09963f230b977d3447c2557c5b2311a9199d47829c43910285e1d7d2b7f57a027618ca249c8b9da9aa5214fd000276e9137a2598f3a0da39f115de16c5903041718547e68981b33f13ad8633abd010dc71de7726c02bf4d35764e877ca3d89e2d8710488610da95df1cb9fe687aefb3c78cbd37edaca437683a69332ee4d820c044362a369210a038cdc238c48e994ef0b7f5f5ca909894cfebc9bed5dfab05f5f2848c7c4d66b818b5f19322bf486db7a1c036f60b5f24d1a64d55b99f58386a1075d689898c51f3ee17408cfd71905004940cbbc9795112f995ae18f0fe749f7b8ee5c09475c3af38ba64d574066f82b21ef15f3f73bd1b0e3c2ef3c3d1669e96d7f3c99cc651403d0350a2ca4927883cd1c76af93b2e95bc8ad1000bb634312b54bc1cc1c9827f5d3398796c79a74d5e89c1a87ae818823a16512e6ea8dbc18532de354217cf9c5b9d0504259278afa38221b19602beab5ce7681e71a03f058fd246928656b55218c50130b4ab191e972a9b6d1c337a6cfbd3b3da47ccfc356be68573dae95143909bd5730ff90940efead15ec46980a93090b26ed916cf1b09ae832d752045cb001e335ed3ddeeb63339aa98b5e62b0f6f2379dca37fe8288c93eb85d58415188dda9c12018481c98faf7c3bca8a899e977df22f4cd83598a3c5a5d78e3318b1a0b526b99a7a0fd57edc06218cb858a16ca4b22183afca03224514fdbc8707e50967bf8a7151720cc1c88f4dc95cf81d573190d874e13213c781594fd084443dd375bb72ec259f94adac86eb3b3c3278a9048944a45db320efe659b21976a712bc07773f60dc30bb47626865400b4cc52c5c0faa774f6a91fd57c0066bed2d6596d33e074a779463a90eead9ac366b32e786d7fa5b532fda824e184e581acb40c88a132b777d5aeabbeb84ab5873f80caff9f764eeda6e9d57d9a6f15d78cff33e7ef686ae09321dbd256370c92ded90903b0ad77234fec0953cef9681e837525a83313f527efd09ad31b2c820c9a2aeb41eb9964f6dbc2c299a1e3cdfffccfa3788b7efbeb578b83b70da862ddc7e695e61d6626f65a5313b5691a56e85db47568a5caf5baa32f97c67a0c6a15cf4d01ede077f28d2a798f4189fd46449455105472c02a7630db6b57720ef910bc99dd32cd49b94e0b43608343fcfc8ca9326699572443718aaae9791fcacd0bcfe65247e92425c636543ee72daf53f9440addf65cbcae8bf6d34ad7cf9c1b4e2ecaed43b111ba05c1b569c39b11a5bdff32c41051e1c21844e68e0fd5a8b95b02c07355053072ce10b553e937a02333d2cafa2557a1f1c199184e218668bbb2a27583b036b084a7c6aaa6337b96994f5e53cb72bb8f66b2b69aca1ecf8d894325fe03fe90eaa8cfb8feccf537b60849260893e67f1e4ab3bdfefafb6853da78f0fcb5922016c406a214a81cd9e5266da667d24b2f095cd5453a620a1ca23593cbeba17139340ba3355a52f044292fb333e5af61723efb570891bbe16882aaf5d8948e75ae281afcd191e8750be8535e3c4c650e707f4fda86da5d7f99eea2b7aa9bb35af7546c7a8c2d0ac4b46e3c3ad51e8fc7cc3d984f5cf10510ac661f46dad8539b7da5fc50820f28cb716103a07de795a30dea64b6e43f3189acd6d20cd91227dbe9a368ec2506f6c67971b5a7ef51da25ac06748f100e4dac0d50c446f4e1d64d1ca7d24951e19d82471bcea4278ed189901dfa98f4fcfe1f09234179bab632d89f9ddcfe465891411fc12d1fb045af3b5858b4384be3d6a5bf699074bd686363bcacf32797f1abf3e233714c26d65117e852a76c1b250071dbf906186ed787c16bbad22b47b60d9f251ba7db68feede00755dc3f4164c4b2c8f4997a4a27bfc53ec16c0365b059dec27e1df1f9f66b405acd3f6962889c6a417980bbb1931efb1ea2d7bff1a6a65b8059e3d249ff4324cdb770a90ac95e96b21cc155062b9441f7ef88cbe11c1d8d7a0b88026003112517743a48975ff12818b25035d350b6935671b3cca26405ebf1f550c46d40c16835db8c65146b14bef8d9cca896a4d3a7f74968aff5be3c3e67a9570ec296fe4cf53c002857efc164c1000549772ef31747216edbc9892e193da687f3bfc73bb5e9b8cb78427e1018b69aaff3b277d39ecf50a58766bdba2c6d08949f3f8d1530dc0c5dcb0153e8b5a9b0989ee8d030af9207286dec7b6db4049f65391a1f11c2d05af931ca3f55cb2b970e17a3018e62b15d91d3ad37df2a82f65c8ffb1ac676eb1ceeca1063144809bf11d8da089dee36f05f12443deb42ab6d62041e864b355b5d25b05d83552b6089d5b390ecc9baca055a2befb71b41d23f2c0bc566ced134e0406bbcd808d903915ea31082b8ef0927c0cefa5015e8b5cf1b001fc3b968e871da131968f2a1b7c58e5ef6d54222f06f12aca6509ccd35823345437b84f3234db29cc801a0397a4aa58d277705979d8f71d05396164cae1c074dc33178a381e89999118a6f57f1da2413a9b1d63037c6480e0c99ffea52e3a9ab6b0eaee1f18356468edd2ae5c487693081d2b7059ab411e37964269152f3713350f530462c6eb1c1330f8dbab19c672c336e7a504ceadbb521e4629d096da8c61169ce5089e63ad6c61bb21687c19612984329cb2444dc88b842272ff7fc63c0832966f8b8530160a47a6f80a903813f637aa0f880416a3c1e9cae00a300736d65a981d33cb7bb9fae67f2b9d182e899c3bff2065dedd81584346b995b686e2efbc068cef9fbda501f01488664bfb0fd15c3d04535d1d9e0b4b652d0a507d5a3089f3382916f68516cce076dc939fa516d02c55dec06dafb41dec3574430488a934920c6dcc421606b47f9bdacd49f2c799593929f15fc27192a06c59c13286cd95d1d50c80f72555a45a8ae9edb97ff254c660087d730c7726aa071987bef30692c81ad16da2854e800a2572ae8808b4ffd574b1b44b4ceb1160a992a5ecb764651503fc1f9a50f42ec0fb655b5c72a2f74d5cb275bbda0f96acd032950deebfd8b06a264e1f668c3ecc36417fbb9be8f34ae0582e95e33acf57131806079a8c188025ce354a9706de82931bf91c998cad0b716975766c8f1a8333fae952f25df35e85f8f5bea791d73d5a226e2a0bffb9f7bab0d222c505d25655bc1bc4ce71cabc5b867ecfe4ae58c5349b8539710c3b3a5cf2f5f2587c478139cfc65b77c43cc74a77f859d2e45a4e9d5439c868885e388d3f6d2ddc217bc8ffe776f53a9ed417dae857f565ccad92eb71e29c9c09680254f45275c6ffdd8034fd841a2c4a3aa1a81924225902166f200aeccf70baf703e72dad31f5aa38e70b04929c226956eee12987930727f7c74e5b7686298a7d4b3309bbc4e96887a61cfe96c7348863aff8874d5c1019adedd9d531eebc296cd5e255862ec232731912e99e452147623e4887539fd941f8695c9528e17350193355b23fa68708243cdb390b4d42ec6e8ad3ae49451f9e4397f916ed1d4b2d9bd842f93feb7515e560e0eb7abdfb96ff28155e752ef9fa82de980cb8a0a6c43c89f7b548ed798c96176609aa01d643d910906ccfb1a61cec6453e28500ed539a3e8b1cfec9048122159129045b93a230f8613440dd08501c65a2223d6d1b6a2506a18be767802640f0fe90826260da4b021c9286769ec0a011900bff598911873e6cb8980956d6165e3aec0063877105bc535facf7fb56c8f55d66d13f0ead377f51a2a4cd0f80fd715fb2aed3ebff09632d98cc1caaf15211bf21588dd0812acfcba0156a2d6f34e28bae0b3e3b9f715a8681dabf8b7b930cfd90942e75d4f56aaaca4b4e227a92ed5e46c842e4af8ef9fbceb8fdb87eb1bb54b7f835c38b83a91552610bdfb922100128b783745977e1c97f829f4298d994facdd762253de13019a3647e2963549bc577bfab520c302a766b32201d27552a293f614d04d05f83a08d1391f35151f289927250894ce288085aa5eeda1cb034e40e816c0c3c4a32ef12ac4279dcc5e47dc79afa995c200070a8d8ca352611b56f030c46fff7e0f23e66f3f14f3cddda55af5da9751d1189c3310e32f955aa80c3c453343055482decf35767d6539a60bf7a3b4233f4d63a6d22fd35f6c3cec7d22926ada5542f914949676dd5a78808fff5eb3658e9e06706f59c1b0ccce263fe891b6614fee1cc7da479d92e672e36d66dc30fc15e9a968fb036abe0d11ce5ad77f05db78245335b6cf0bd8f15cf75b07cd8f1a957ecf0b38cbd1330e2c5461af9dff602f0b449e09d57e040cd13c77c56bd0fa3427a6bc840c1e0cfd9a64ebc2151fe1a57052b96b633e3d63cbf6c939422b68839c007c83ac544e7eb2c5a843197c3ec60ff815cc643244015d1583de40e596d4aa30665ada62d29d066d627da26dc0e0f8fa0985a58d953e5ed40d2d51928d17131e5f0a5c39d75b5bb749329ede73773706351e27f510adc4e5a6526e4ab32874003bbb03a3a705c2731e97be8b4c074d1b8388991167e6634d84b4755e778be7a24360ef9f6782e0212c0ec5c5215b265b77e725fcb7d03132ec35ce3b429150885f538c00efa7d58327d37f49090029623126e869d9183a0f7627dc3137ad32aebf5a5acbacb196f03f8c9d077f438c2ab3372d7b6f4b344bedcbb26bd99752a737e2637cf7272cda25483f52c22e060dbfcc4afc8d7a1461835e0a6e38f40da60dab9acfb2987e1553ee6f5d124ca39d240bef5f1168f479132d70a5d6a8dbf83c5fbedb4f8b8337d3136b714e0afe621373ebf002ddb11ac0f78bff74c8b958d6973d693f54e70df97b933c01b9040acc079b99d2dcdb722c9834bb1ab750a3cd099c8264431d820272919c4977084990bb6f3a902d37f7bc55a0643812ef482bddc24109ae579723a01f66ff6d900dc1601567601e921d37160e2015675de18f4e0c513d989a877a893ac252f1eabf1e89493e9af52719379bba6b7d64df39c28a088eba6bd89859551dc1e06c9d6d5e80b2b77a7130949d7d4dce86faad81630d6979697a9a7d4efdc88213143353716ea0c5cf11acce3f218f45bffbffa38a78ab41a88de3d8d05bd2ea41c10ead99bd9ac7de4d3bdee1546823cb5f27020c8ec12919250a750c7248f2b1c954857f0623a48752fb1ed3d764e97651f4c369f52ac6c8a98892f5f5684da11b4f8298b018cb53ac248857400fea830b949b122ec2342a728d21c31c3a3e21be7d9d1732b233ac5a3abfcf0af2a6e7dc0a7bb29a8e789cd214463b4c300addff1b6a4f6cebb1232f4d0f7ec07ae68edfd33605747927ee8fc6eb90ce50a9aaca33c1e8b4db94394462bee7b352de3bd9daf5466399bea04d9cadcc36f6410b3a7b492e9b7be399c25d65d7264e5bd315d93cd7cafd1724fdfe87892bcb18cfcc43a74646942b982275041ae53d7249bf12385283d63bc314d835ea0b3b570f164258d6a5d3aa96fdce7f7de19222de072073e07a41863dab2db67b2aeae54ffad146f62dd4e36a28be1777cef60dd6022371c0e53b26b04226c1a5174c3892f519d292517faa1620213006c6860c727510159a62b9d014d8deebbbb46fd64d6187ad0cfd2da9ff61e298dff5cda8181daed878c5889ac0ddc2614ccf3b91891cdba32816c46bdb9204651d07324b1a3002cf12b0e6c989dc21afd01e35ebe02025324fc8a31eda0a121e985f9419a76dca404b0f413a17462fcb42a201edea026a0cabe5462235d405a9717231ce9f285a7c96c474e1ac601e6072451b80b7a2e1cf9f9f03545f1ecb38853ac2330929a0a65db5c0f1dd5928d59fd2c1036510ee70bcad5024b59910ac7f6e14f3b38ffaa323805728b30928cbf8e73204faf9b5899a080b43160ce6f5ae71258fddaaa35f3ad5205bea1c8ee13464df8225233d469dced680fe27140cf5c1ba3b57a73f2e13f841f41e7b81c260e41b2c0f18fa0cdffb89aeb80d3468738ccc5b212af1f926c34557f69acf924cfde1da4e6899bcebdad95e82e86b1ba8a73532282e44d7130460c4fcf18e13afd7d61c7a52328013d2f5011b88c49a8b8ace60bea248c78de9d936ee24ae6dcbdd6fd54db8bd44aa57ee651ae1ff6f3f87dc5bbbccc64b4c59b83a85ef048cce828c8abef93a4ba64bab24c796e1eff11848cdb3770ebb94fc0821b6f343e286082db5d28c08f8787b7326c743dd832829afa93a9e607ea492148556f309d5805de9c8b16cca960a846f60e4bc3dd583627e9b982db7cde9e330db8e14676196f5566c3c3870787b12454fe3e6c500003a474563f56223d462d566fe8b4ff2bd3cfe687cc87a1efbbc96f309e0f9974f5b8d925314f16cf9706c7ac04e16b861dba182dbce3d7df672bc8ee88b9c34d8c16e3be7c66305e64b189c6d7de82727481210f96228b1bb4e82a4ae71f080facf73870d765c06e00097ae55dac2d3ef57e97ce8fc7f68733571016ef6327b254ec65d52f02a5c5161db5f65992c8ae3c6a1b10cb7d8101138630718888e974b7aad172798ca04295a732f8a3b9063b744ccdb0ea5dbb79ff33dc2dc2acedc45bb53f87e17528df80743da73b10146ffebdd1cf9c8cec2f0edcb3cce872ef661f1a2605bb8e5173a458eb471432cc3bef58f3c0d194271d4a88996a55532f20fd668cc80b83ab6d168711a5a6d32e93b41d2f79dbbc6986a8c00864f8d47808f2b88ce41ba04cd47e6e54f441b6c2f1d92b19b8b07c3ed38becbd6200f69fb7fb122dae7fa83ef760557ec5d057fefef7082d47d49b378fef4de84ff292a6701d59fd564f17f5e0d51ef1f480dedd4ceabfa7ae6698e212cb1013fb7df068cbfa078d20bad8c0a7e51eab83798d199ae3353c4e87c99911dfea105d26ea1b1b22f96b1c13475be6c12613d1de56c17bc140ac9f723796d43f99c3a23f6015f7f2ca38cc0c51359d6c8638ba1d10dc5ae752d624874be9c90225e093ddffa7da1454b80316cf34c88f966d50d7652fb54da41cb9a6f4ae3e443e31c628750140aebc8b4c90f2be56508ab694de6054d76e0f4ea5b81848567f520802589710baad5e3ce370ac1f0d2f4a9fb0b3eb3a55d47ebfaf2408982363baf342e54a90e908273489dd9e52e17e9ba64fe48e93190cc67c83c668ac2007329e297a7257dbd9b9cbe696159964924d1844967b09f8e945667e2be59e9cb3358db20270815d4c94bcd97d15c8a15e373de637636a2cada326e3a056c505a683cee2c23b87e2b8efbe82897e2995587a608a45b49d245f5c6773eced151fc1ef3f58d46a1cbf361cb392b1e591280f90907801732887481b3bd2101320b434d11b0a16cb264de839005eb8d785c61eee81a0f0678b93fdf7274496631597305842e44f0d483dd87dd848d595419cf6ab03672b9df8f93fb54062daf65abb3ce04ae25c4903f241fe40a469ecbe824e84a18f3eaccc87f5f398669f1fe357d7a05b9ab7dece7f4ea0c3f3580c15fce123c5cf8c59bcea6a67b3e4702829ea8e6bd0d15ce06f43ccaea53d8004a4d0be7b897cda157fc2798defac097c5b721830f1cb177102a5953fce52a24bfbd50f7b88dae72f40e4a26e34d163c64924ebf0eaff6740e8eacb743270e22c7a442d7e79cafd89761a0e81bec2d25a7f24def27c7cee1f6c7acd04a8ff12493d247da139e2d0fb0f91f83febce0b6e562dd8c591bf0cc14957e98a7618cfbc40afaba8c7f1af06acc2226520b0955d22ce8b9d07885842da3b3f8aef9bb46c9e299521d0ed07ba2dd642f3957183538c2f7f375f52ebadc9add2f7da4fc188894063f8008bb25c4993970c26f53d446cc4db4a872e9e3dc82508a3bee59402cce68bb8f3540529904abac8471ca55e1b8fe8d0184bb9d8f45b7691979c0aea6e9711daf3aeed86d1b88d47170e27b5b041fbb465ce283c5a02fe7761874623e2e933ca4db455de0517b8b4a73ac9e07653fdca742c97e38abf52f342b4b2e2143ab667e7b781958e880c89a5a532ca716e33c5bcba55d73d0a67561390ed69022c2739e721d328cb77d6511f54f44249ec33a17208d73df48331d9151f91b0c52c4e9c3ea58c6b6261531319e05221f22553d031e56db4491d21e2ea0869f0faae1309511bfedd86d3da92bd75eb74c43de60167ce21e43bf8801435686550c0437da70b233acbfe20fd06be81bedb1999754613acb47dc413255e791934386a9ceec05c5dc1e62d6fdce7a24cb3a1514c45595871bdc351fb93f230436b2b433a0bbec62f2501f2051b5c633d3a777ed666dcb2dbface5e8c94553a5206f53cf89975246c7137259639e802ccb522b00958d3d4d516d45605c70a7be33bdac22052fbb4072b16e7ebcd558d9611dbf26965309dedf663adbef97e802aa73f57d24b30732ee9d63d8a6e671e3a83374bad5d00d5d2c417329575536576c2736b3e76f42819a4f7badffbdbdcb1e28b37e5cfe920f349527e41b81ac772c5969bd524817542d38571711018ba998cfe25fc02cbc5f9a6e4002cd02637733576f4517390e95761f2beb0d0b8f1611932e7fa52c8d241ac1c6431d0f7428f4cb32c607314e5f5c5e6f5932dcf681f55ea292b56ac0a2c9f79b187dec1d21ec30c3e1544cd594a739164649175ea79f304b0fa4f4e5fcad38cbd82687f46d09f4a83b9626dfaa596539ed6a870c3bb12ed6dd16f7d1ef51204c13d9f17bda30511d7b2ae46b088c92b69d19fcf40c8aa8afa136ec3957c6c90f4949cb3c9c12d0336578afe2fb5e264cf7d14189cca054491d8b416dbc5eedbde8704366344cac74d5597b55240fa426effeb7e9376c80c843628d6b7299bc0e864a1dd436e67bfed6075536051205989bdb20c1811d141a5271ca21c523e48c1d3e08119cf0849c237240ef74b1bb9971e4f8e4ce0a968571086d730543f3178d13dbb7e7827895ddf8eca3965f85a3a4b2c483786efc09c33684d40ce70bb88b104b26c45db3c932c07bc75e35794ada4197affbd2d1eff8ae9532516aba733188d9ecd9168422d913a9ef3848eb1ee89689178e4d161cc486aa3c9bdd796ef228d7a7ed4667a5c2e42ecd63449b82607506d51a7ad17547c7674e7872c09e533d5fba9247b8f8c112ba737632f997802b487cb3325520cee4add0738fdc91b834c1756f7f1ea9fab627e85a627e46106196a339206b18ec4e155835e8683fd1611737c29376f60d18bf376157d1630eb9156dadebdc5eddc335d9d73eb4ce2c4e0b4af6eb9d0b6b65dc7427e2092c4c9d7868d76aa81d076de8c94ef01c6694689217a80889a3feb461f2b1279ddff676f1a3f9cfd1259910ff88402e2eb3d2b2da705044aaf8dbd051234c219eefca2f5a8ed48a6ffa50f66ef5a3cdc1f2ffd6dc0e94fbb1fe9a54503df5b46db4df175e16f59f6bfc33b10ce7c964f60d3baf8d079830ec5b762318ce1b47cf2356d7db80e7de799eb50054c6654cd78c8d3748d00687165777130d7607ac035e1c26b0d4a6188ee8d8638b41b89d01551a2480c06e9a4065056518e5bbe17357c76d54e5079e5052b5d8d54520608cf1ced2ac4942d8c680660dfb187f39da762ca0cd01f60487a0fcd91d1b3ed1705ebdf8a12c031848ccab21b1fe28baea46e12a3380b8c746af4cd5730375fb470d1aa76ffb6c9c5f3a7c38c0f74f8464a102db22eef0373ee2f039280dcfb81299c784c4c1bac5d03b84c70c15078ee94fe61bd9fa634777ac22268f9aa49f0c7b0da08a47cd16eab2b82be4e22bab3b5487e957aa0d68ea58e2263c6313a25e442102b0b49ef3d7c4b01c43f18f920485eebe2f6e6d9de56be12dced949a27cc6687fc2e8fb0ee5fa7cc8ba8c621bfb1ed6a7bc38391efc2be95cd1a79e55e9aa8240028a76c29a6e8bc903a0502a3e4d836c5f1023ed2c79353da6a4c73a516a25c8f1270d66ffe3196354fe0bcc7569dcc2c574c2929b8eb22385647c0069e972608da6cda9e6ac0f02cd0ef8d31204875db6ec84fb67eff592c5d291b78ae453ededec70df14b192e92e78df1793cbfec7e9542fe2a934cdaf90ceb8c57e681bd860d51b47fb4b9445f5efb625dc5d6d02c21526239f6db66d7a944c48b94b3bb8c3cfc4922e86c7a39c9a9d0bed31b702e08437310446cfdf94ab92f3d3c9fe875514afa23748e3b176970421369f76ae28bc74f9396de37e8712318e0da8e686dba0b30a2acc17be75bf1ff0c895d11aed05a34dad48621eb7278b5e51cb0e85bb4d6aa22f9df2773bcf1201705a2b3ee14ed432e87b4a5c59864acfb17cc2517e9829e7d8ca362cdf3dd323045aab4ee464d4c7f36d49a6659565585a3dc8f4e067a1b90e85dc31f1025f0e76ca2c89904b35ca0abb0e15d523f91caae7c018c45f701f0cd36163cb729c42cf2ca6cf7bf79467a38e0019b7d2d412673ed58b8e311c6fc96858ceeed8f1d5c5b29e916d7dd2455884fbe5aa54020b9ddfeff0ed1c20630eee1a3a82c95c94f4b85bc953569c0cd6fee3cdfdd33d850858544b1cfe4813598dc00ebfd14fd45129f0fe69032b918582ea916262b8db32cc4ce1511f776d8cc7de5dd9d844bf54ac3a420e332bf6c4f8b1147bbb01ea940a4760e46d0bfc1e32ae82a14af2b99585866e36eb170363ff92bfa13006adf96d4c7a4309866b779e9c5bc5448ebcfd74f19b5aa9c907d5181abf8c51ff726bdc3e8f0d4dcda7ecaf634fcfc4b04323223362678f04b64fa0df46eabe19d1648041b7e2df6e1fed4ce8df9e1e54ce39f6fc57a100b1d6d2cfa01b9279411916e3a14ee40e06acebd9af16513f0d86feb75d667e31e7aab3c66abd444595fc13f4e6a70c6ee294bbbb6cdd3efe293e3107ce1265acb85b456f97a89fedf0e1845fbefd0d3ae46fb76bd0bb4d74a74b3668bd49231a532c36c88adbf5faa52ff2c72b35a5d297df1585badc85194af5beb497b1965cc470f7d5c879ccc089812f8ef0e01f209c0f61724933f6df147956c4c9e012c7a7e53e845e643e5a2498c511cbf70d352d8a5dd9bc5ba26c42101b8186b0ee6ac79eb0cfa69a5bfdd27db634bb8e5d4b510ebf12975b1561346e0c74ada849b44be746353df388f9be00e84044657e950d0d7a96208476cc911897a064c6bc66c2789648133b958e9c697bfd71f0f1889d7beeeea49d3fa2749391413f2efbcb64fcddbe066a9f1a43297cfc0ca25d3a7a2aae4f3636b9419eeb95c97f86a728e45989a94e3f198256a90c4cff7cbbb7d69523d093fd0fb78170b66b2e0d7ecf9fe7b6b14857df11efe9636ba3140f2445b9135e4a9c34c93c0d1f1185a02aa4418acaf0296a4cc2626ffbcd807fe07c92651ac3142cb3214d6665f98759d55567cb77af8401e007af267fd0e2f802a0660eb2f98b62658134feaa806fd8f3b98cd75b9bf08198e364fb9f1375f994b1e895899e5ecc3d29e1314f2999590645a717209dcff34fb46792475ea18d201b9051229d1766b007099dd5a574f98a85c824c6920a79ec0237b787c54f1320920503705a27d49d4716fb63554cda52316c580d41e977d84ae3c96f65103c8e5aba574bf2aeb8c83b3a5adfdd8717601f1df100b1880301b2755fb52050d00ad76ee3f513ebb6e1044a880d9e1d526a0ac8f6416f3d0fc81370ad849b3540597cf3513513cd36d6f8014874228ed21a8e517e458ff639163c8812be2056a45189615bdc89a1f9ba4a2f37ed9efba39d0d34afe393197f0be0b29a5d868092aa36ef272133e4589527d862f46097209a237b2ba0d0b51e00060e61c41889d15ab96fe28472496bae81b5fccc7579d96706126db92d82651c860fbc8c9667f57c9ee192ec656d7d5cd93b1ab91011330b6eeff69d184ca30bee014bab1acdd009f913945f5fcfbcbcf638e731d7f508c6f947a14bf98e6c322fd3ac912f816a0679a974af3823b6bca8b592d1f7b4a1ecd977c503392d0f1f32b79c644d076b242b5bf432f875235fe302966b0426bd18ff2991d5b3d38dafc5d50b2f55dd9e1dd56272687292ea5492fef43ffe2bc55b7e34542158067e557ac96d1ccb6151595aa109da5348ff263d9d6a4bb0147bbccc37690634fc6d95dcc6bc21f311992657220faeb0dbbccc431217be50eeba2cad44c0492e0832b38febf467ba279acaa85a3349910f9b0da300fd6acc4a794357d10309b8984e36fd4167b029dc1a2a119036b3f16f7445dd76be1fd0cbd13ad6ab347024ea04921c6a7517aad0e6279b7c80742d20e1b768ce6700429e5031634a1bf445528a45908f3fa4d70db8a9c774174272cd8f59e40b039bea252998368d204321ee6cba24f04a9922c368b645e64414ea5976bdfa4a1a97b3cf44b806ef3d87903d8715c0c53ed988e83d16be97c4e57dc27c3852bdc4e68dd1b2d460250784282f5321c80ac9d456effe20be072616178ecae21ee9042386b0b23bea34f6c702b2e01271a38d1eed4a5e161db972a50d2545dc719e24396c4fd11a84a637e44ebe5b0918fa4c303f809b3bd0d0e37dbaa318c0dd226f81d500a74b75343a048aa565def5692c4249109e7850f8e671e97f8de423e1be0b7f7df95b060f24ddda863a95500dffe3b81d163c6dc65e76fe15eb160e78b2f27e6de8e8802b7827a4614f48e2558291cb29216b8b92ed8c8ecf719bf71cef94324347d8049517031a737de25845279546b8ae25db6ef00da524e531e8a0f7c4a7129492e9084c18fe5c08827f3b4f86dfc589b0b703acb30f35e64cab90f159d7aa085c0b5d963f1cfdc377f6ce2aeceab0a29ed5251322322b0fbfb627a6e56d227cf56abfad47ce503baeb9603ea54b0078ca32a754a6f390e4fced4cf4635ceb9029b21817f7343267130f8d2b47cfbe197450ae1a70828b8c1ac7787d82599c6a64d9799778e3e4094d62d5d6afcc15738ef44d57d2aba7b5290e5945d3de06267d344e65d8cb3ed29246b8db5bf488c972c0c0c543bef274d9ed71df8c940f686deb4f877d4462125b40b90f3e4a58b4dee9ac348968500030a59948f40d6c0a5f7a6adf3195dc77626cc8c65eafffa62242364c62116c2bc12287166d565fb231a1a3b8e7c8fee6b45be0f7ab591481352487f54806300a729b5600157ca0111af31ff3ddcee8f7659eaccde7756a792b933a3c1834aa28b61f9efce4838320d7672a1fbc107c8ec5b5f792dfc79e62da9fe6456a780ed5147576bb31631e3666739a2df52b9f2bbc9021deab0aaefe43b4cac18da32e9b1824d42ab66e695be93fc5d2a4e11ab62ec4946eab90bf1be1cd37febf5bcf94fb41ffa14b255fe9c366b9b620b41f756b61376d0e3e3018d522f1c24b716d4ea87fc7f93b3caf1e1c6d40f413f1fdae7b7f6c07196fdf59fc29a1167a87fe9a2678def2ad8ce52d3b3192bdc8bded1930c9c742cf34da228fb3056f99386d1bcc8b7587336c7bad4e73f53858b293102140c3fcbd44f81029a9c0d63d0d10f1e00042d1a50b631137a47116d8a26528735bc34226255250dd6f825bc95fa2bc015f2e1e5891fb2e21afb40e47ac7c4acbbc4768edffa0efdb9782701df15204e8ea4aa9edd2e6598d5cd5494c2e1bab6ea533852bca96555958b1224a73a7b267dbd076fe086897b802f7396dba1f4c2be16aff1c1af4241c19c70a8e4d02c6a2c857ea64c521cd4eb28226f43686e9ee2d7e82aa2ef136149a35029545739b143b37ed9b56c3f19902d584fa8e033983b604ef548549f4fdd9a551d0cf201a701c28f523373ffa7db72469c9a536aa3684aef5f12134e880353f6ef2bbe8d6a24c5fe9f633249fb46d59a52588e0e63002baa7a9f02dd2e512369ae3368ff60d891889e3eaf67df6d64bc1a706eed2be70eabd56bb5500a694d9ac3942e9f72f0beaed4359f79a3f662042742fb5d325600d229f949a42e4a419e68e7b7acab8906b3d78fd3f40c8280d6799e583c84e74d5dab3e2946757cd38c512b9de35a6279ae2fc1deca88f38bf737847fad8a3390a6ce30be498a4635c9db6aae75ea07a1584900d02b8c7fd02677ee76167e5674d168a49378c6647bcd4b1b36173374ac4c1cdd3971b7ea9ee0abca526f9d8f81588eeb578e306016c1ba8ea4bbc91419deeb4c12171dbcf3b918a50e821524502912b955b79a231e28171313155fd3f31efe3e63502616d112227029eb5655baeb55e4280912f451637d57bd638612e62ecf4a46b8e604d5eeadd070c6667ddefba01a3d694d92669562d9b13216a3256f674b8e227d0e873804c2260cd662a3db846d626b827505d489907cc2fbe26e0820bbc197d022be62ca9a3e99beb9ce85293a4cfda7428b94f1a1a05129b89331e4722fcaee492c422a39dfe0b6c4e5de2ef7177ae78e5df252bda1ddfda5908302d934d4d92a412777a1e38dfc1b11d29b1a953ba3ce59e4423d684b7a30628090e0b3546d1d9e447a486f0708d29b53c5b6437137c10105806fbafd3b1f64e2a4f671c6339cffe1e44c5a1123ac8683377ea8b287e5aa3e7fe5f405526dca28a5494bec8849c1dc3b793daf9006322744dd08940dcf2619c74e2a8501eed035deaeec5a2e1768c34eb2483fb49a97c082be0a91426f94ea1a3596913666643ab38cee23fc6d94069a7aec4e282debc483dad2358b57a5d589cc50c73de152062d3f3e3794e70cc6bdb61a3d81f166cac0dd983d455202a72a47030010d2fc21c2ae2ffbd2283fa3f09d8da5c8a2b9907f0a4b139fdc5e986378d20002b43ee7ede84482ccf526a3e64684bfc507fe287b6337b5494ec0536decaa9cb3f1e9618103c187dec831ad16300c333812ec45b43b520c327644adce19d252f3f2b4bd7fe8c1fc540eed07797a29329542cd037001042713787312557a7beb6727dcfcbcc7ca9231e3e475494923bbd650e55118b1ec56419edf1ea13cf8ca77af6b140be2dea9c0b3e894694f89fa6ef052fdee5fbce4a9708ddd2b353c75c467f2e2bb856174a30a4df59a7a0827b87ddfa326b20b17900daa06198ef8a5f1188c950c7ab180521e30c09bcab69ade16f480244d2fd2300d35c83886d7fb3cb429e3a6eaf98dea0b03bed316c45f585a3de9e5531ecc9e924eda5c5ac036dc19bccc6326052413be84cc186d967df1e449d3b68eed6a71949186ec4d067e3c9e2f63ed4deed936474129b4ede5b9651af3f0be6cf6e217242c5c189d06b416194f8af3e4f62516d4d271363a03d9ebeaf548cd56dca8fa99e8a95c6691029eec7a748ceaf622d8e3c099dfdd76fc402a6b160c048194c3745ae12b5def38d3d54033cbc49830e1cf01c8e1a334d832bfc4820d3e12e7c1a7e506d3d3988bae0b42bfbbac3eb428f7f819b717931174d9f5479a1474cf1292bcdcc3c487db000cd104bbacb30744fedc1397bc73709b45f206e23761b6aeca45faf5eb2a095e10fd065dbc9c0e6ca9920fff1b76b5d5c81cad8681ec13232b368df519a52dd2127440255c0f87511600a636c73ac91e9d882568b252311a95c2926a70341a3d978f0060de84b1ab60edb7fc69beaa6a189d90fe0d303a1b5df8de6f86ed080b8bd320fd7cee30ed21887974ceead378305945a102ca35783c59206d7c351d21fec6720d63d875e30a89e4e9e690e1c84aa2f08b8453f4cf90f207f77cae4798d49603481e949c9dda1c8dc44d8d1c2a2b3fd6567068f742c528c7b8fe20e0dbd81bf16721fc751d922667af312dd0cfd04e98f90945c43c8766e26dbc3524295b0c68d02d932d6e406fb7c2cbdff8f16a6d2ee2599a5b24f87e15a798420c958b0b26ee06373728ca9c01da276e3080ef183d84077ed5c08fd87be5a418bfcf4923a3a0c1c6be9352d1d882a272240079ce6512149a14bf2f07d8bf07b3bcab469cfb79264a202e452e3ed46d946d26aa9acf158fcc99816894fe9a6eec685ea9db3279ea326476f776e229de61c4758796e119308daa0000e371da887ae7e2812966ce07730ccfa1ec85e9974e41e1af37fade23c8fcddbb8101a24a1cb8c134d3e945b0abeb09ffe50ea936e3762b6f59c47fecef59703dcb869029f101506df0ffbd865a2724d953ddf70c904f5c84a854c8e1dd36b159513902e235b045efebf00921a58e1cb985436bf297b864e0388bacfc2c2e025a05e54817b77ec2b46e12d78fe1b4c8e4404c844febabfc6436120115bf90978f3756245ec5059520f9ebc642cfb20689e078f1248903bb8f586def6b7514f9f7d6983bcb0179fea347b17ef7b6c1055b45c008d627cafc1e5cb0f3f44eff82986f2212b7fa547bd080a4bcd423b514c0ee1e59549496511800b9d4ebbecdbb4b8a41cd9e5a4de6d97a638c51971577f23a6063f52ed554f4f6b302aab6e034bd36ea37d5c9bceb532b07862912263d332ad5893492544ad88c6849d7060ce32d6da97cc344502e6aeddedb9a68d71635207b653c384b9e4b2c5768430459afc7a0d34cb5b864310513f91a9f3016c79843da4c0296500051ddad4e70d21d70e5d36ec4d58fe5db862dd1f318e92e1ae0eaa9523c8c6ef65c816c04cb9d1aa2e8f2679df1b9b5f3efcdde20e5308b601bd423978e947b3869e50a57578aba8f88e80ec4f1f514b978393a0adb9b73c5d22905393fbcd1b2170dc539c336e8fb39e3f73fb9ccf3353ec8f6cb9c5b11c334d8b49fb7d00b69e3fe54f95e325f958cbd35fa2a6ab4ff88ca27d424728739986bdeb6cb5a7baaa84f575e0d86596b8b52460d3eb347f898cebc6fc3ddedd3a95912ad0fe2f9d42644fa484b65311af1b70673e0c4ac233dd967bd4d6ff2069cdc569d0068373863fdb00323e68ee80da540a1f11e67c93e1c0a417cc590082e0c4e3953459ce06ee10cef497bf359e0cd44c8d842a1bfec5ec3d7241bf098ae65c876af61be2061ccd88069d48a31b9ae47e454372c37ba958d7b3def586c7fa177078d50ad8d4bdbe74902b0d32e2d694c641209e0bb2070706137e868fbe5da7893cb2ac324232194747f4c68da2182cb0625123c7598090d59fd8fcf41d26b2591c9e5ff536d6a66dc8abeed29264e2182339b2b8bfb18394f8a22f6b70fd732f7156e56204f971ce24077280eb336c16a991ed53b4767b11798593af36f6e136272fd4ea57889169e562ac5c877023066ecc7d124a113d4a5c440e7740526da9f63299eac0d7ac491f857821343e3f83498ad2bdea5c55db3f0fd14414e8d27446fb042c9fcd544c19dfeebc2e038960b83826735199c1b11bd8c7070429819fc35cce21f1cb444a61b0f184d2642283114f8bc687b4a0ef11096ddcc9367ae97dfe7d330665255f3cc01ad7c00b21924a6f324bebe80117cdf63b529eed514bc4e38d44ee721272019b4d3f67757a024b29181e4024b155cdefe092e99454017bcfd94d438831593b9293f136847ce6f9a30eef3caea09541261962066fa27246c8fe54e342681ed29c8784305f5e157580547b99e3fcfed587d059e3c73b0c1b4f224e58717fb02c8b9c5f4cf73462efca5823102316be37ccf6b09d66340d307729ac0310bfb19a38a88ebcb83aa633dae8ae89af5c2bc81d4bb60585da1e233559c04af9c8a8c3801cd04d4198397b3effad3508c9d45c7f14d4355fdeb52d2eb37fd3de99fb6ae9837dcd63ee155acf61e7c18094b3cdf09d01d52861e21fbea65df61c3a5a7e1291e989e2cdcb1aac0d5c1c00de7205c920053bdac1cdc36f6e6eee5215f67b937e237816597275667b36c5cd038e497113be9b10992783647efc50fa6eef542327d744d39e14dd8fcf2cc7fd217df4d5179060470b39d951a3ff3b1f031d5faf4c9e20f2fe5ace64bad9985d12d09e00568fa5090111726f164a07472c86394bc50700878d5f0bb05f95e5e12c12ee364a914f8c801618f954f1bb874bed28aa701c8aeb3784225e74801b3be22e266b3b829f38a8eb34abc2fcdd010af2c9e83550904de5a983cc7bb8cfba686cbb85370a989e3a31f32dd949163d181a3edefbd3bfe430747b38091938ea3623a458e6cee7e2ca5e92361622974ffe11021ea1c0ebfdabff10505113fb523507739cb392ee6d76d53e7474bd67b30be9f1c115bd9cb734932deb653a074d550cb2c209ee191a7561aba90c651f122c4b15d7d5008dd57464c60baf5f149131df1a81b611acc6da773f40b5a4f70ca1d37bc1e5b092c7f90c579bfc40523ea3d23b144e4a48cad88dd1bccc603ff4ffb40011e18ce632eab5d8d0bd608ce831ad357ae30ab2bcc2d0067aa03312efdd92238f1c879d916e9fc950b318b25d3e93cd283e7c07ed3a4646dd627cd485b230750076a3296388a25a5362f6465b98451787082431b0fc12c515c7886fd282c6c2b5d7c4b03b2d9466ee3b1fe905b838ca9fae1d2e593d7caf4f95993c1d052592a29f2de77a26e86db93910fea7768a505fcbbc1e02d4950c509b8c19d2576d75b1d9aaf0338d8c224af5c692286fb8b7dd53439dbc4d3d285bbc5dfc2732a1ab2dd2c35996a63c6c04a664d6fbb38eced505b132e50443c864c59f3127640710d113809a0ff951a41f466c6fb7ec6333e2c4e9c293070ca699ac84518c30ae1e3e64e83e79d7dadeb51f933e2b76ae8395e021f6f6079ea0718624cadea215c68ecf0cd2a11d806c1d8e6b04893075622bfba3b2084a4cb2dae8684a07c2b1006d5245ef30c9a7684622abe968131d5789675372b5d78c71dbb5af38b57d6e83022278e9abaecf10da1fa4bd35b702ff697f01d17204c4a6528de02d4be8c811d3e5d845f752bc0a3a12f29244d22f1550aa15fd91c643aaf6519962776bc9d9e98c16fdc6b8f7f6bdea3dea7ae81b5e094882a61332eac641d01cbc24d2c07dac997af391f2367d1b315e30fe2ad309813787518f884614a7a815ca4a0f5007b76466d21876cf55e7bbc02ec7271256b1a0787c5a6876feef0a7614116d281b2d5d91bf5de242ea3f383ac0f9785b8cc57a1f1cf0bcaf16e5579653abaabe96b6228e87d0d8aec494c0c960f5f1775a31aee6d3a9a5aa8b3f1318d369b138112c67892b14225874b6793845bd736ef03fdc82df1810ac148b68a8d92a6acbdb6368cf2a547b12482f5d6102cdfcacc3eab15ffe4713dfd8ed982a8664acd443d51d51b1fa195ba90e3e313f1c07e10b237b13bae7d9bfa1ab16cf7e473086eaa226b95eb950c294868b6c0efe9036e1f516f5a6ca54b1f8dc682568f8fa9518384e5481dcf8eca0b7af0e430b7d490460a05ca45bc93b92cdb30194bb18082cd0b4e020e746f6c4cae1bbddaacc52210428835d960cfb2c60a89d43392173dda7cc75749d48c149c302972f02eeb0add3d6a812cb49718272b2042bbc029969939324beb2e5e2754d5719cac1e46ad7eb1d653a67704e0bd7aae9fe053c9c6c2213ffe3caba17a7de5d740599b79a8a25e9014c68c28d3cfe1f86094c84eabd8cfd176fa359754ee172ea71258e6cb7ef85ff2bc9ed07b3ec1719b4432028eacaaa6b7bc4d608b3c8b1301cdf818668ce1e29a982a3829fae2fa9f4e190b49b90947f53645b43c0e8bcfef29fc167dc5c5881aac3d22f0f5361ac6f45444672bcdefafd3b9d7080a65e8e02571e3eda0922c5a483d6d64d6cb11ec37d583616c0a7ce499a5bf1132eb53bfb44daa7f4d1946ecc2ebb7243c76cfda54ffdde3d6c176f2e7b16dc3e468df5602058ae5b56c455d40a2a45d979a1ba37549ca4de7cf3adf3f52562a4187dac0e39712e3323f8e90cf2f904e7606c664d00e493d773dd4a4dde041eb4f81f25f3f0fb44dd168ea9e1934258b503a0749b66e83bba3a833ec7d461239e32a3d45ea4cfc2a7eb894284275d57f4a3fb2dbc0e86860b57dd4268be890ed1fd8327f0c28350fd85057d35bfc0adb978722ae0d48a0380101ce70b2ac551a547156f7c7f6703967a6137f303297d73f8810d8c3cc7a215841bf77b8eede59e0fe0b217f389ec02ecaefdd6f9c8e58d37ec92e54e663f6365240cdaeb9bd064fb733fba1366baf9b47f405a756f4c555e57debc8f9090b910b5a67281e21f009cbf577ccb6407e4a46f661fdecd41452b5de693bc73272c5c8caece27613dc574fc76ea0a58f51723b0f67d767ecc0fd6120047f782824cef134b447a7e0fc88a8f1d6e4a00c59f506b7450a429c012ba07f8bb9030c1b35ae5cb8200668b07101d794449b3583188935594df926703413fe5250188a63f1dcc830a0d05cbc1879c89475197b4beab01f780868f47d4b233da32dfff775fe04ec1ba49d9f73e7fb807d6003b1cb4ab068d7dcee8d83c42c8e2a751987dbff82d774292d7cb4fc70e5990dfb289c07207967574ef6939392966f773e3f71b1ff62cf3e10ac13f1fc47e409aae8da43037f07a42c81787ce63ed650fe64d731ccbbab51030a4fb8b5f0aabc10616c8846845265a61d85ab0313aa81d6af62ba4c14dd99f7cee6df4a7cba2738b0f0fcc607422be7c45de7a16a12c16900cbb856c1e27e34ba87c9cb4e6a978ac2c17ae02327b519787542952f80d4e0621120d531b2356aaccffeb2e081f1ea5cb97d3961e91e7e792b3751ec0cf6100727c18744387e505bbc573475883b33b89fbab08b122d0996a10e403dd367fd915e33d4b9a1329932ebb735c95be7b3b8bc1f949bd38a9cc1a8d6ef2a129bef0a542d9b5f848ddff9748786208d3c25ae32aa06737e4acf49b970440d7b196062cb57332a3240184df459e1f3865b0ff1ab861a6dd7441325adf4d47c5c002258209cc2aaeea240cfdc87a134b5b09056027c8f218f30841b1d2a01997039e09d719d96bcc4714e08528cb44537c53025ff4c38e93fd34dd5297c2a44bf952ba1ae154cd8ec4579af3561e288165058fb0fbf7eb92a377092ea13a239be664ee5f341036d3b31f49ba50ac857a2f5d95bb6a98697420b720dd018333ee30ea6739d7c4f57183187ba2ff18517f6f38d38629ab7a3c10839fa8be8951f0569eabab8aa4d01f012ad7e65752ac728fee57c502edcb567d4893e914f883ad422ac82c67cb57ed16e45c60142fb6a2cf1562662097fc468c7fe8edbafe6a0fc1ff4edd6e6ada2a85b76a0ad16a8f362e5c018ccf33419f7eb93a2d7f4c2968a50277bc3061229887bfd5b3394be9b1350ec1b7b66bcec93124f94005a38e58d26c6bdb71fdd0f0c73f5a4a867f8010f5039d254e40d58f16db8fc98d9dcb786e78a8391031ad8943a31dccd43e242709b6eaea7a83027e1bd250ffc801021175bc30cf3aa1fc6084585b708d0d8dd3478edad700712dde065e49eca4e0f5ebe26ba199fb6b76a0a6a5e5162e9a1a15f7ed3055cb954fb2453e98ee4de42b1f537fae09624cea80fece467a9b68e615f46be96df8ac4154fbb02444d1de0681a46e8c5006ae9841189241630963bfa03af02cb1081ed9fa30b577dba55d1507f68458c65bd2ddab79f5e73d483954e97063b0053cd5c87804e21223e5384514d40f549bb2692befa337663cc11e19291921f4e90416e89f6a9729778a0fba8ef3fdb8d8353810b82a42e18aa7548d7610d83d603023aa01d4016d3e4a7ada23b1c0265aa455fec35bfc24971e646da8c75e7b955f002f55fca48876c123a454580efbd7352db90aeae73894b4d1dca558b98c57cb84953bb5fd3c94b6f441ea091f078b5776f9879026a79a9c3c479d8a2c386a864bdca84fa50b5af45fb4dc4ca3128a45c543372c37d20a450502833a3304dd3a032fd73f2d91a22d2fb2fd5855fd223ab3ec506e9a36aa8d305e4269ee971a3cc99ea591b5fc242a7731029c5105d378d07dbc04a9750aa599e44a4b464a64f9fdf2154266f301acdbfc85b6353747b85d1399dd7145383c2701ab9fd930886789cf3118b7f63ac703b7e0a9e106204934efbbbb977d790229a17e118180daa9baacb920dcfeed6f19652d948f9a3620fba6d0c48a8087ff939214fbc898fc7b5963e7a1e741083a89049423eeaa155dae8937a8a6ec836060ebc8a4c1a9410628f3f16ab3e72c9bb5d6c7bd016149c6798384bdcefbd0a8584271650e2b094927c6e56e66348fb630f2ce9078e52d76533ff6dbad4b4f15e24279216acf9af3e2b01f160de6550354253a58c4ff26ff6ab43eb67cbdf87ab42d5c3ad643a4b46e9668c5b7c18c9f97793dc7b346a346702d71a6fb4838741f2d43150f6bce29e86f35cb5bc2e152139e00f9af4dc4eeaa291ffe139e7e0a140fe9df01502be033005c29829411a83a2ce13067f4ed4c3a3d04db63d3662f914d9b28f564c05433e7a0ebd3a76a68a4b38d2fbfc6a4d0de1bda2ec77f30d9fc5870dfeab7ddac7032043cef5bd85f7934cb922ba7c71fda74ddbb4a829dcb69d1c56b581f4f929bb92f7ce5fddf8af42d8184f21cadcc375ce87de339f9662b27115aa755187ca4ff56e2b3f16459212ec87f36ddebee3b69c5e61fb25e7c65c6564b5dc14786d6baf7241d8afaeb2b4ed811e480e32ed7c82e69902e8ede64eafe398cff44d5a14ce93e43bf51a2950c919e9ca6803b7fe36e41807b05133e9c38336a7075a66aeab850ba5263855a7f6e43ee174f498e7be878f234191b6faf2ab7acd706ac9d976a94e57c69658382fd34884a4b6c6fd0927f609cea9bc52ec8001104ea74cffdb2ed47ac84a9feaeec4b33482fda03b6ac5d2abeebdb66b7d5797d17bb247828d32b373cb9a5123a459d3988fb7dfbe6a2866bfe46105ab8b1399daa0bfd7997a4a2297c541ad0b76fa2424ec51b3c43b8305679902bd5fee8aa4b7a41d97d9dcef12fd1d36b2fbc11f54aff419cbf6775a8c0a1a5349124a74cb35e3d2d363bc4e77f86e27fa706769e6eeb21cd9420e848dc705d6f02ba7aa19caabbe02ac03bcc5482ae2b9da9815bc7c13094f5af5f39fc935956d427c0a1bb131cea0c4e19dffef4e5833c5a7bb10d24f18c72613719971e94b930b0e96e77d0a82410c82c98fe4d07548b269b6c06659891893b8dfc5ee5dbea4b0c5fefdbfadc6f7bbd43fb34cdfc8ed773025ec655de81c9b9de1aed0cf20db8cd8b96618a090fc1d7259f2d6ba7d85a42cfe0f76219f1bd09a4160a2551c50e118e39b0188cd39db2a4ba8595ab8a2580d2877cc11ad0c78af20fb6eb35c07d7ab2de79a2092b45dd1b3de7ef8619cd27e9fe2266c64648b8c96e06747c161837cedd3ac2c9ad480738615628d5c48f0b319e6fd4c0010015370ab9904f71d7b17a8bec0b7eec7275267eeb8bbe833250dc72486a514cedaebf43b5af8ac1eee9dd59d85ae71e73b809624efd861232405b8be7b6b15826bbe081cbae4c59e74e423261759d20abd4db126eaaac777cf490c0ea4ab54d9aaa0a2a7de3ea0ec453e6d0dd9793ad4a29843aae38bb912a5d20ff658930d411d86b08cf9b790f2afa3c9b0cfe3f6186ec04297aa822953f5b075eb856bbb9639e700b94e566433b5fd40f7029638c55bd45c24789b95e8bf1620cd4efd86c90b493d56bf15481aee8252cfafb59c80790e378ca6b0ce043c9f09ceb5b4eef644453408fb39b0c923b62dd0ffb0c1cec3dfc764469a6999a081698cdc0686f36cfeb6467a9c0dcccabfe6615b5ab58e4f075ed73e6fd75bd24ea1579952cc4177c275ea628860ccc412a7c1e29f48920138ad1fef91874e0cf99462be174dfd7e7a20dd1f93bc8acad35c99dba23891b1096f23bf9dc0aaffff89e23aaac765b94b33005cd211ef8d3d24a1e977a66b65ad0728d3da6df5ae10e2fbcbe9c510eef6fcd8766a811433d23c5c68d4112efda41ad0ca4ae4c39586a554fa61ae15c9717ec32f678bf92694113fa32ce6f4a4541a91203e80d64cfbb425b1b08f4c2add2c3f997e914d7ce8a1b7621594ad743147899eaf0784f203d01a46d2225109a86cbc5c8ec1d9e2872ea6503d65aaabb1e9e129170f647d0d84104e1cceb56de489bb7aec0bbeb82c4bc2ca68bc3fcc1501d04b49664ef78b1bdc4e42b0c0130dbf1474869b4cb14788ad339292b6cf4dd81c075d61ba3ec5cf6f4f57c00a103285743e1e9ba63ca57e4027676569413cfa0adf7089596d66cf5aa3312efc769aa36cf3e4ff903af464ec03dc7d7cf9451d04f3b92837f0b8ea1ebf301d2d2bf98959d1ce545856c0f61785e9b413f17ebf20417a05b95f1703841c9ba99b3ecabf47320395b136bf65e50b9f5c80ba79e19d58edb80cc99702f87572a041f8a582cc2d9fe263d8834d527289e7c662c4c1b94ddaa9d04644411632d6c855835551881f7ac336819ae386ad82ba46f91261e208563930239122ca91bd41e16305876bc3a6baca19639766fa693d4e16d049c0fb4730af3c380fef9744deab640d6404cdf7d0cadd25b6b8d5c0c231fcf1042f7d24c9bd7c98fe22246212445c7f82a412bfed4e70967a448fa40240d3611e6d50ad8d40d5820d57b086717e198803431b70c9d17451e29ac237bdb7ce9c485f0fd7767c95ec83de181d29f460ecbf02f3b108a5afe5e8ddd1704ca72223d95d6d6363639a3f74700fffb9b8d8736e6b7efba0ffba340fce149af7a8b744f54e1fe145f924f9f6c1d999f9da695b2b0274db956acb35fb64ea570ce13b70b697447cf7816f51f784f7109dd726fb2540ac46c690dbe957dcc05c9317d071e1b0f8e31195f07ce716dff9ed7546825232a673ea4e1ec283b73c972b68e0e23b105c19c4e51f94758c802bf1bc541036465c73787cabb5b5df88fff44b97c6de3a7016b406e6d4a81cc707d9de29044e6bfa9595e4ff9d6d92b8e1e4de7d438c9a149ed55ef07b0f4a98152b5a0e585fdb7ad69282632452248279499e6beef2bfbe90c4df35748fe90ce224fd6c81f0a7a1666c0b03c8b5333923597dcc263c3385200787c2da8b321b96831614e60820da7fae43baffde0e477352831e8c81709035f8683401f6972c035ae70c5e78ee6151f494a2835b67b6412194e4110526d10ec27b0eebeda1de15cbed0409b64950fec32ff9e3502938c129acf1695621a111f7607f88a7f781be07118b8899e66d9ea1d0481a1c80f79e031cd8df77c07a83acaa4867edc5e9a225b778aca78d3ea917e458365d0b69ef5dc37d665553bbb25102b04d2ef2311acf55cbc3c76bcdaf0f0f6470ff4c8761871e057a0cdae4e5fdda96b7091cae083fbae059afcde763458683255d2b1559e65747291f2796eb86e20e3646b454f0381ed4ef9c8ecf42fa2f2be4d3d84a7ea53fe60e7e9fdfdcea504921775f106d0bfbf8dbd34d9f721e8577ac01febeecab364b621bf7a884504ea7861bdda4d2ab26cbd28349756cc2f6edada3b23c939f2d6a1041c2879107ba6a33190acf24b859bacd2a0c3202253e26ae0bfe1fc0755b6e36ef437fcfb889e5843bb42d00c5ff63177ef601ee5ad793c893358c1f6c14226866a4d2790f779d2c57fb738f55ae188dc0ebd661e6ead4237c1ef4aa4432f56c69ef1728e97b09784d96b1966b9fe1f44ddd07b74e2c361e52ac62b61c15687d993b3b1f9a9dbc5eaa9abeefbaa4b11a2b28c63ee5b6c032711e861755d7f434acb1825cbf4cc82fc9c003ae9554b198f6abeea842ec9117d444097fcc336af35e9fc53f45a2d397bb3d00e9e064ab7fa8d963c732494dc47252b1ec38db3ece8f4612059d5e15e33e6c8f83681a31cae8359e98b8e89021533c2010ac8d273d7bfa88eda802eacfaaf3179c92f42c9f5f4e6f838668f943d208c453512a3fd811f63300651cf97c710763a24acc6a0710f86994009af98870733576e901e51a311853e09ae1bae4ea62c4521e42f7ba60e1dd6afd31115f87f34b5f5648a2ff1eda0803fbd18a34bd8e70b0d01c4af453dcacb2e99bdb2e2f327a0fd288f23a2b28b26ab6680da7d97ffe7141ebcfc1daf77e3a1cb0aa32cabdacff0b3348ab4897bf8588adb3cffcf1a8b8b05f9af54fa2d7c3e0a482d5b408a7bd2b0df6470a2868a95c342cd1b25f63acc7cb8cf00c9415473b66a54b3fa5b4e53bf183e68a2831526daea3130b43ac90ea9cc2e5af308c756cd02e0db219c64d0e5fd0a6ca18c5906898f18e847f8e53b7799d9f845ed58079e2e08ea6c9756ccf7635ad1111ef7a39bd6bd7e9a6399a147e89fe5f2a905595a8d0f5ba73c94b99a694e965bc143ea7aca3ca38f23881b92e0ebbf370b677a112b6e43d06d7aa35d5eb6acbf1db5bae4f4b661f8287ae59acbdf27ededabbf65c95b9cb773776195e1ec660b657786f17fc996cf41fbcdbcf45b1db75a02ede0366b3248dca602c36bee49b69026b6c61e895bd5ee8cc0fcdb31ef8944f9d6f7d153e018e3e872ef1eb09a45251cf04d26fb509fb47664dd1bd019369b52d4b3c93308b18a05c0bc139a8499f03f8c153ef85ec6ef572f39c39b0552697c48ba2149223b658de85f058df42207c9b035345bed41e7825f849d7d39790f8e9109cf8ad30c9625100b4d73b7d105fdf171560f68c7ea12ccb270542db79efe5e8dae91864e159f7b894c26a4e327d55e7aae16c60eaa8613827b53471f883eace3198a27bba69c5ae381830c4ae67dff95c2fd03a76c8218b72fe162b43dbf1180505e65249e658f58465b279cf3aa1ae8447a2faaa60182bbc9e1fea59231d44c636091b9bd69aaa2777b4be07e3b38df13511647fee050f3a9539ab4b84468d94bf835fcb6de5c4fba68626f580a6ed6e7c01a4e7a6e38abe038d2728d76f809fc012186abaab2d95459f0c1317a52569057ba7b9a9820b3d0923c010fee283cb5a12618d51240042282df028f2aca7f9eb9d2f35c201b9414d831910a2ca37652b002412b5122b93ac88d34611e96dbccfcaf2d1184752308711f2ae981c4680ef7712c61bc4190e84aefedb9a1fffd374ff28a74409347f80e6472176204ef0ab271f4267c39b56a83237d74376ee07b7c035a70e98028a1c2a6f7eb7b44ad1b087cec1cb6c9244cea42a33d3536492ca8ffce154107556817775d7d038a692a483b8811c6e1b1672630daea8d41ccfc42e1b7a9db5225796865b9466628afe10f0bd27c40659bc67734b0a0aff6ea10da14907b053eb6e14499521b1c3f473cee049e208b99fb7aabdf983420032b85929aed470ec4d016876157e36873ee56730ec822ede3b140d0cde5f1ad963583c5df1807cdfaaa18416ad9dc2f4dbda43616f56ccc67ca774ed4d4e15894d39e0ee4ac78c1dc5d46d8213da6b0044889bdfcd0998597a8d39bf5278adac97bf99a9642014e62cc5c67dd052a283ff18c29a8f847bec7f2d46f883289ad8976fb493915f22c1682dae7ad64db2370afe7aa5b4f242a8462701612c253444b07843e341e94f05fdf725b9c7e2ee8d5e4731f901c1ee7c46215a121802e12be4d4a97ced71067d2b103e14fff298324c6b08c4827919ddf6b29b14be0d81a90c7c2927960bc7512d5dc3d2a03a3fc1abebb9f88d3c708b290bd9225e48fa65b0158b94fb57757199dfa934edcba7d4b715e9f25d8bd2b08f3a5d4ce46ac13f806cc56335cc410195ba70995c422ba1162f4c2ffa06692d72ae3caed486d6c7f73e56df0b424255eba018ec02087ff2c6adba601529a2d661fbb0d9c3065572e1d5cc06367c4a24943671c2d1d2a149a9df1ac4dab61b8abf064699adcf245bdb2d4acd8411cd3564e5b1128562939955376da22a2c16a1349edfdd50a151fe598eb854badacf2f50d3e34e1cd791fe62ea5e261df6deeabf69a99a8cc9a218903d7a77246b240d3f5a441554b7a3b9f48c40f0c551fa4dfe9292417ea0e9fef55c870f2bb7762f8f048289fae11b9e5fc811993d4b71f3742ba812d54926ffbbefaf8af9fd4a3d1424b6aac5bf54b3850463ff397f725521dff9ae70f9aaa15b05ac7ceef6ebc09065f77ca1da3dc25395046e0cbccc54c357b3ae240e83729da7cdb75ccdbd2c7293e0e4abf810d62856e3aaf819575461646cdf3ca51b0fe4d2dd482ee55aeaaed0f1871a7870f2280ad516b1d4a96d88e0fff7ae3a0736811b6823e70d8ed48b91f28c82e095bdcb112ad2ac4f8ac09eb1e8b991f079d3843d5b75d7fb609e182be0936ed442f388e97a21371e60ac5b05c3a52413bb72762cfd09461cccc82039f62ca87c719e10c5c53cacc290df1804b69b7ce4a8c9b1abd64217ac83cd62a9c45d2020774a971974dced1a3f939487d3ad9092d25e66c51bb97023b2bd2ad2334603824fdc0c0f7cef03a66e12f65b4916105824e84e73114ff45c5781ff4779379d334714b6e75549c7c122b36d3f2f526e725bcebc1561b10b26490f51d911bb1d123826ca192361520f8ed28d1b122acbbce31669915eb75350d7f65d8477cf8a93c141e76600589e82990eab73fef4bf7fcb86cf6daf1c397c910fe882451ea88eb43e6ff9cb58818db33dc1abc16b7e9fd6156e24dd6d176490298b829e6a9b7d203736bdabf8de5e327fa0b94f6a76263906b7fe413aaec179f9b5f3f8fdf0ed1768aaf8f5864b9fad03dc9f795d0484850a4c1ecdd66a4aafce964c9f268b0b6ef75b38ecae68e61a4f52b748e73193df28c788f7d202c4705ee97554708065d69d4fcda069a1c3b3395da7a450a5654fea7c1a310aab3cb499d7f55649feee70204b1ad4dd981def6de8b219095c2f2f60697caeb1d7a2037fe53cdb72a3c094c2ce34bcabf849422dd6e08139ee9d6a0a24146ac03ac0fbbd2432cb96911ab40caf15518dcf8c20db922d869eb8bb570e686f2588daa1d5f06932baf9d4fcb719ad974586e6063dc057ccb0c15d0cf5932191d0bcebd7082d2dd3e5471e88867464894dbe8e921c2b323c6f228cd774f3f7c2b3d744ceac0bcd82f1daa477f16ddcbd38533510850082d796088d8f7656e40de8130a038dd7611a3baf735b48ef7fb6df42f38fe12ce1dcc75b6d55d71be6a6cbc7a0db5ce804c84405774661234251122eb41e09f4fb4d5807c592e3e8b1f47075aa7cc63daedcb59d4b9722702e51ab596382c46b299680424fd08cf26825428d02f0655383262a075c985460a4438e88fdce604c7d9fa98c670ef08c31e9c493642e1b06ad3fe42095546a3c8a62dfb204fe20796813638006bef582f97d65ce9e61f3d73969ded131ca3feddf8542a7cb3849ca61aa3a58ddb95ab57fb30fec17910cfac169fcd07dcba48fd223d1c9809b88a522f77bef1c9fad8e3e136bcc7337c982ac7ecd6f59c0ccec627dc5937a991fd6c7caafe19b015620a266fd4b23dfe3565c45962e2951fadde5fc884c858f0ba2389cc5ad735d6ada50335f4a7866b155229284fce6f48747c55aee210bb8fc73986b197d6100b287512a5559cc01db6d2006a8197c50d1b17eb3cd5792b6b6ba1a8708f95f2e24ec84140c05bfd3bb25fd6065d508dca1de2e29db333e688d45d4bf89e8797a3da7033a0d9480a8c203ec2822cda28e5b90429269f18039f791992be76c4a773b139bd2e5edac499689c6711b7befc29d868e0a24811c7144f79236541050ba643e2b83b1a425223ae72ef0a76c14c57dfdf0acb5ac8bd5066ba53098402f448bbad8771eb02d02e4c19aba4059f5f758a65fce328ae5876e3a5bdfa53172025be545bccb7346904e1280059f21ae687c3d709853d42546976a68c4ba3876ab33342415e8fe5e375bfa2d67578bd5ae7688842e1d8e3f771d3a592e51f6d3cf9d63c37a4a8c6f6299c8a5fa4f24e4bb7a54560987b3e3e9247fe7b7c81f939303ac8ff7600385e4bf1fae12146d97e973c26c454714dff3947744d9ca78c42f9485d13dd37796af312952671f95a44c58034deeb519f8508482db96c406220ead123762df51c65a3fd814bb867aece546e8ed96c81585e417476b8d38c8f33b0c28b78af43eda2625d6ebcdcf2d32945dee4e6bded45ff8e3e19a3ae65505bd853a60c3f5b3d556f45063423bf5f97011b1056f77d28099848f5059dd8cf86268d468ac6ced1a0cc724879fdf24464e73b8f453373f3587d5d7be26f23acf311e7e269406837f320789808bdf5520a4ae344cce05f79479b048fb3c9375b45c6a95dfed36798ab1325c51964d0a70aca4a97e6c49e13330e3bcaa3a8c23f909449f1a01bf45bf7bdee15198052ebb6ae671e0fa4a58dbd2cc9c4111804698cc214eb091b3bebeab5d360c4bfa35f7e8afa8c606c580e8b9cce41c41a5299245bd03fa600575d0faefdf2f49ac87d5c0ed77951e2324cd6b398b882e0b2e55fdc5dbcc98570775663675db9c084b38a0b57dbc22d5f54bd81280843779495ef3b5759100438bd65573e9cbfbdbafbe907dee4fe8e2bcbed2781d0da5b8557943876038217c4f288fdd2799003b47879324da474422fe6baa9da35f85d69282112427c3e2ff6707a650cc8aa742f3923e97882fecd4188929906c3a0edacff2e848c0ecf0fac31265a19a7808a00c036aef6b83fb5f1fcfc0bef6f7d41d0ef1c260e0ba24439a619cf86323ed999ca3c8d47501c2a29a65a8c5b35efbc89b73f310ec6ab52e3ca4bb91f134b14888a2f45dc54be89da085523e8b60305d3e46dc4045185217c7a29f711ef2f8a8e0e5af4827f4edab00d63a6d4b24c87d7de879ed66b6c7dc7c00390b659f26bc71a40fb736300c7028cdd4161462617d2d5e586b87bf273f38936d206500d493839e0c792b875d6994cb2a7b5a8b461b825b32bb54c92628a0290283bf311fa83af5b84b86c0f246a4bd6a0e6d6bcbf75a8a9d06198466ad8b55068cc0a4f922c683a7ce47e0df18fc3fb5fa46f7ff79c17e45a5cf7b7ca0de423e67bf5d2dd294ed1c76b5c14c945600a8307e7f706fc4e0314f2b996500f894122e850dab99b7047ff892b13c2cc18a4aaa41f6b2b68d0e4086d81ab5dac220a477bd69f1b9133de308211bb901c79038a49b816122f1935dddfdaab45a87c730a70e4c6af214e785e787b5750b89336f7ddfde526f1742e5ce5cd19c9c2bd59f5441a3401810c53f91268b7eeea80f20bfaedbbab5ca3daeb14f6cee8ea5da480d42f73546388968220a3c913867e0a7f47427b6a4e39d4176e4f0230dd54fbc0c852ab582c1db4b7e9443afdfbaf92695552af44105bb4448cde4e3ab90b3aa07bbdd5fc76876a8494d77362adc510d975aeb29fe96c45ece18b0042524a318813eb5d8aff3331e47504150fe260330be1906c8b0dd16a1932c4f85eafa0f497c4498e51c8d5bf018ed7496f28efa973a1120b1d7c2a2d4f30676f5320b44b229bd6a664be1ca79e55dfc446715144d4d15da1b0ce11da9c964d8362122bffe143db44a6616522c21ac4c6a81eb293028b7ce8f2f0fba982d5469061cc0451501c4f4bcb6e09b70353e4ecd1a21db8342eff256ce5801d0232bd8a6542c60dad55c3e290ac293d1ae8b457c0990058653c354ba2c98c65a279fc43fed16f219ce7ceae03364d0761633fb0a1228c130b6ceb55ba0ce4d6af4b162462f4f40ffc3d5beef836944098ba89f0065690f8bd4331b573e300d929b56f45c0b9ace20e2e1c783eaca768365873480d073069062f4067722f78eeb365e16070a3917b2f7de958681503430df0b99a63dbbe18338e4e5e23b9e5c3c51cbcdf0e961fca4b6d4f3759c91adeb209ba15946338e8c36dec5b762b8109a6d9f24387099757289341074984fe462b01ffe50eed36cf4f0c1773f59966eac28982ed6514351eec5685805e430728c7dcabb9d0d869c9b06eafb9b33ab4f87d4b11fbc0a002d7790fee7de9a56e6ed5afaa230b1fcf96d8c2137a58f1e7dd94cc0c302b1ade492a13a5d6ecbcbee27a9256f6e7f6dac719c853c87c0f274e3d13a12a83c55b5d281f60a8afdc5b88bc6eae25f9ab04e9477220727af9178446832985381e22d7171f0a0a6fd4027c79b422cf019d2ed681b4e69adf61435ee496b5d18c370600b621a7dd15c3e8445133d5c1a9a275a02fe22228cecc8ceac90b4a531809435df6c056df440ddb73706c411bdffde7a6adf5ecfd260147f579356ee29412da42ffd115676491f07539ca520e01967265a956e4c1cb1f61fbf02ef674424d8a7ea6d8ad172f10a8225171b30c7c8a0d0bc6f3c906460c01d56a99e4e5a2e92514d09252ff382df12d8e6a6a6a0b0c51bf295eaf3f10677e59f1b834ff85b7048a9343e1074581dcf8e06714e3ca4c35603dcddf79263ccba21d9a354d1aacfcd931c0932eaa9beed5c28cab11f544e33953cfeee512d71e1fcd13ef78b3c01a5e792af6f1a7bacdab5461a3d70642bd68174982ebab739602f9f2f4310c511239aedfc741f36ce7b8bb70b44a17b64f2fedebcdb0d027e018ac0113391c4ae7a01bff694bee9df309a92f158a413186bc56b94abecd008bd52430a5a0e5469d5bc3fc82dd452e7d45adc06aee7dc21d66d2ccedb3cb59db83861559bd408e8f20a913bd4318363d5aefa72eb6f4ef814f0ea8e09de5aac6ac75d4854a0a009b3665b1c4c18825f64f230802a3b6fb131bb1f12d5e9caef6fee4166b57ff6baa95265250bee27da0a4754bf8e6ceeff8e7827fdb4eee42df4fb113b15f6addd78d8789a61e22ab34c27484b599291bbf6970eb31dfc2964de63ad83b824d723094360439708315453d89c6d50d642e1f79cb1e39d003252799de4a58499e8012f8548dba19ee2e27c7557042c4902b6042e90ba8032edace3745e659a7e5e8a52ad5eb4bcbeefdad0d27fdfac60c5cc42943489d0b93e44846b7bfc6d40681b82dbe7d31482042e4a1abe0837c8e598a13f6fc4688156808e9702ceb9bee6e707fd97e80447154117a4c378dddccf0af82c2b01ee96b5fc2db8def7c9d9f89ada5a40b1346cd457b776c8c69218fc910920da19f21a538c585a663197dffe6d92f025c3f434b9e3a40b01dcb7c878b21ff42e95161d5efd0f8c86468531a9d53d4404a85cf8d94c7f6970a1c71bbdb3450b2e9820538c8b5d41879fd9c017f5e760c33875a78b746a3595828ce8480978993e3a39b5595d496aebeaadd35746dd14db93de59f0e5e89d6424fc203d88bb80c5fb0431365aff1e5756c589813b3d7077f3f81d8cd9a93c53c7dc0846ca7b9c5e8461fd865604b0ed5602dc7e3f35d0254d47aec4374955f93a2ef7fa5744d6bad994b2ce902d9bdd68bffbc75bcab50b1712e15595d39bd082270f3c46149a7afb87977d7b5967229661784cf5ab0214f139574f01255ce3a79d10e6891e4830f3765d734e7d0ce2211f85415db338e95e0a0235f4f5a6cf3f358df7a57c0f741ef5c5f02b38a49da38ad0519b02091698617951e851c0037a0c0cf0758d87d389de42b13da82b85eb35860ca9c9fb1587f9d7508ea3a332efaa46d39a6fa8389738f7477a8c3dbff8e63e770f6112cea88f70a2f7b996d67058805b608baea16b068eebb9a9585db24dcf1cbe85950cd7e3573bd545f7d36fdb0c0de88f46b2f0f182a73b9ddbe6fae8a3e477a04597298ff8c12ec7e91fed70b880483d71001081d750c2d2b3aab724a93e09bab7eb682e9c46e7a2b4e2228de81a5ec640d66285c598613a129b6857bdbc4d8c835e03b4411c49e3f367f3cc1d6ebeca218b417817a0db85fdf3ae9828fd69841eb6f43e05b0d91b89af65fafbe6f69a1320cfb59be800046a9dec23d2f9710d86d07f372ae51cbc6907e55d4a2f3121d7bc6afb4ea1a4c3956f2e8f7a9bc9480be79791638c599fd5167c09116ce19c30001bbe5206ab161c7eecb12703d068d3208b66541e88f40a806b12dc082c261bad61c78423709db6f3c696799ba6571b8b4238167664ea2f26c666fcb75764f1e5f20198e64423c9ccee64a5f0e2704de2c4c480681e6cb7e4f1a21216b462e8978bd5d7428c401cd59b426cd2d98fa23448b7a972c37beb9a1cca7ff4f2b99756904fb99d7e8c4dc2a0e3891b392ac8ab29bd2c8df3a7d5d4fc5713ac01ddb0bd7ce445c32c68a6b4cbcfd62adeff78065e0ed96d720d266b4e79ddd3fe72fe7df5db76143f7a50545ae33dadb38be8199e37589878886547f3811ab032018df37c5851e5fa129b64d48dfbe17bb95b2f6e8e5d00bf8b1690358d38b3089c9d5926ca4621e2b831444c061a70a11d742cc4f02575e7ee1f6d4c438c7d7c4b31bf4acc46a3e49d79f54ec7429065b9c372e6f61f871af8ab01f7921fdee8849d86d2db28a1d90cf2c93701b25a3026ce64f7568a40e82c576ff753539d56263e703cc8870d7a04579d7c2b2cc2bc992abe31d3d533df4346ab0c3e97452b5a719409d45084a19bab77f1810910aad9ccb5cae99852f8c1751bee2f85de16d82b39f64e0d5bb53834d5d18c14e375522b834cb285b366674b9cd0dd67bc40af80878a94bf620f6744309bc89d949d7a7501eea90c97b062ef4c142aa719ad7335b47fa093847453c3bc02c70e25181d7d1a8cce795fd438b958fab9f4c9a41f49ddfd7f26ba0c42fb459d2a69286c2bc21f77808b17c609b9b3637df71c69069a081054d1b01b8e1a3bb345c691de0b6e1675c74528c38a736a39ea64ee662c49b2e367c37f39c2832cd390f4b86c8002a45adb5c53f5a74436c399bba2881a6304ec39c180537611dfc70e39c686db947f4e7c9605a7215dcc89a9736c68e86f0bbaf5584a4ebfe24ac82b0498a7b859dc4c69c01ff0fcc32b5d274d1d31fb44773fa0557719877370e61e56b8a3d007ab8e9fda545e1e0ee9c83bc7fcd1022075ac00beb81bdda35e9c61c26633e165d94c141ae9ec0472817b07c9440b03ebabc7396e5982a5a81b4833fa558be27c051cb3c3bd543bf7dec377cc6a9df7c774ba63fe630d043b6b4e3e677bf5dea8b807325020c399946b98ec0066dffaacbe85ab4633f58d8c6b6fde6abc98eea7761f0a9dd2639fd3eeba33881c34be71c167b239a96ca2200ba7a8f1bcebdb5719429b69681ebe4f5fc6d902484036758d2208c95ecf048a58d915fa84c662361b58d0e8703519bb26ea37804ba98d0bc85c5b485e84c0215cd3bf94df5448c780c51ae47b16e413314bbd74d961075276abe44ddf7f38488309cad10f85c673d67b9f1753fc187087277f7c967a4cfdeedabf2881757650a5afaa4f22efebea2a53273ce262822c4423057dcbf6c12c4cb32e21983812cdcdff1d7ab549aad42db967e3911b1eee5c96d4cb9f6ae6a6453923fa214f22d96b9c1f4bf6fd6c11169926c638db22710f87d86c02ead58f8065932bfb192e3ec14e3d80ae6299503e7e09922aab3b2d117ba0d527bf4a63ace9e712540438e8ddc9e372fe9de57c5d94fdd521d44b39bcfd24e0fa15a094a8a2654587a60397305bde3eb8a9368814b78ea471bb93fa6d3ba42c3453c0e2f3adac705674a3b0304edc97f8c4deb244203a2fa8fe3e5c74df68c47aab157692f5255d0f583184ea6ddb533f4c25f2a5ca5d52319ee848a7c63ad9b65002c18302514357dcd708e1d3fec0ecac68e6f047c842ebcd2667cd87fcba26f36223d62b7d50c1aeac12a7631ca04d511745c93c8f9e734e13d1c54fc1b6c23fa1e51ba6ae6ece4512faf0ebc58a286dd256cf604f829f1afd0cc35d2b4ac9dff0e708f2d07c0b01dca2f3361e2c0c17e573f16a15e4bc1c8ef115487126da394e4afcb3d9cf51a2727af119e935c22270d47c4d1e679967ccd224be56798f1e3769ee084c821b6b95c6b3f821a50f1ec18ad1eb1a71e21748cb9e62df63b553cfbf64c87d9e5fd2183cb3fdb6fdee7635c614ccfcc856349d5c4fbd6ad1aa9bd69c7c516c25c1cbe8f707480d61501b3733f922fb8cb46f52b31bba8f6b279200def14e79947f36b909f45626e688179ceb3c19b193e75d5ed31447ada1b1a606d21e47fa9cf9f268355c24dc9b560d66c5594221f10377108b06e0772bcb0ce54ef91e2813bd061137908e596483f362730971534895da560c6f416abec816650c6b4dac52e99e265350c3aa62cede9070b4090332cb256c5688eaa200f7b6a302c82afe15734a3d08ecfa96483795554795ec15ab28bdcb55036a8a75b28de2ee0015e3a3ca30fec92b13bf13e7680203fee780a0faf7b5296276610a0444505545039946ffbeb59ba1a054e1877cf7f9e555c8fa7fc9dba13733c9e64af522a0d256db93959e289594354c2c362b401d8ddd9ac87f7af3c487156f6f564d3c88597fdf2bf490a41683517e7825628cbefe15eafc27d1c053b602ce608fe48e4b43e47f5ceca27a4efa41979236f89c6d0098237dcba27130d551053a3106d1bbd7b44e9844f2e5938c9a6cabb5d7b85590cf8d1830c5256813ada68316a4eda31b017628ae38d6bd507567432ab4efbc8e4949446b1865fd0264cf33c35cacfed09dfd86ff31ef0f0ca9d349591a1ca69f5dfb5af006b75945312cf4249b7275d96235bf87172085b41f3e5e729ebb93404d9564ad431cdfe89ccf8f3fe980dfc59bc5389c94821e6ee2aaf34c3d6545996b3a1b0d26578d9579b2b92598e234bf1eb2f76a6e274ff38e7f27c3f8e2ccbed125954f4f2a946f89e6e2c6f5b0b900add1dbff7dce70546f7153262f5eb04474ae9385d1efa46904a1f08c232c90b16c6fb35daca6b0a300fd4b613893a52886b8b3c76f94bec277fa047c54e3337413ddc5a4169ec84072561ef93e5dba3ba22ba40a978d846d25f9d006a2c7fef9093c09fba15589b42517be3a76cabfe8ced8e903c71f0a8e931f5c63adc2648f5487fcca3d8445e1ec6363429d060a6dc72f08efa18f06353a9eab67d0661b810f327977ad042b106de2d1870272edfb35d3d27a01e2bc53c5ec317f2a89559a57bcdfe9c2951d40640989797d0927646bd423c5b239cfacb30895184e788970f700af6baaa7ab19992c7ff07e4c33810bb149852adb8654e618adcb98d595c3e0e2358675f69ea0692be57a9c68b04f0372f8740692ea5eb2ea5feca471ae7fe7bb1a2378aeb81f65b0c2ff5925363358b233a68ac4b0c6f17eb40de3bc335e8e16608372363d58f43429d406b0efdaf313aaca6aa494e236180dfce1757f4c1b79438f8ee346510be719e27eee0ab4cd948983f849a86da8494535d66c4baa548d6e8902ec77c7f15ac29557f564ee93db945bf1268180e55f3b9f082292b866fed9f258f91ffd85206ed1344a4261cef2210b212cf38d752a416d9b1d12727eaa539481c632d9002a17d34766318c3b89bf6a58311f0fa44722cf9e992166b9ea0829</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">输入密码查看内容</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>frida</tag>
      </tags>
  </entry>
  <entry>
    <title>flutter案例抓包-猿人学app</title>
    <url>/2022/04/06/flutter%E6%A1%88%E4%BE%8B%E6%8A%93%E5%8C%85-%E7%8C%BF%E4%BA%BA%E5%AD%A6app/</url>
    <content><![CDATA[<p>这是猿人学App第七题flutter案例<br />直接抓包看一下，直接抓不到。关闭抓包就正常<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/01.webp"
                     
                ><br /><br>既然说了是flutter，可以参考这两篇文章</p>
<ul>
<li><a href="https://bbs.kanxue.com/thread-261941.htm"><font color="blue">一种基于frida和drony的针对flutter抓包的方法</font></a></li>
<li><a href="https://github.com/G123N1NJ4/c2hack/blob/master/Mobile/flutter-ssl-bypass.md"><font color="blue">Bypass SSL pinning on flutter app</font></a></li>
</ul>
<p>文章里面也说了Flutter是Google使用Dart语言开发的移动应用开发框架，由于Dart使用Mozilla的NSS库生成并编译自己的Keystore，导致我们就不能通过将代理CA添加到系统CA存储来绕过SSL验证。为了解决这个问题，就必需要研究libflutter.so。<br /><br>写脚本，在运行时将返回函数改为true即可绕过证书链检查实现抓包。<br />文章内容各位就自己看，我们直接上手<br />解压apk，用ida打开libflutter.so<br />在ida中的strings搜索字符串ssl_client<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/02.webp"
                     
                ><br />跟进去可以找到并定位函数为sub_393DA4，也可以按x看它的引用，也是函数sub_393DA4，跟进去<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/03.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/04.webp"
                     
                ><br /><br>找到ssl_client的引用位置，往上找到函数sub_393DA4头部字节定位，<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/05.webp"
                     
                ><br /><br>针对64位flutter.so的hook代码示例如下，地址不再需要+1。把上面的头部字节替换到pattern里</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_ssl_verify_result</span>(<span class="params">address</span>) &#123;</span><br><span class="line">    <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(address, &#123;</span><br><span class="line">        <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Disabling SSL validation&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Retval: &quot;</span> + retval);</span><br><span class="line">            retval.<span class="title function_">replace</span>(<span class="number">0x1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hookFlutter</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> m = <span class="title class_">Process</span>.<span class="title function_">findModuleByName</span>(<span class="string">&quot;libflutter.so&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> pattern = <span class="string">&quot;FF C3 01 D1 FD 7B 01 A9 FC 6F 02 A9 FA 67 03 A9 F8 5F 04 A9 F6 57 05 A9 F4 4F 06 A9 08 0A 80 52&quot;</span>;</span><br><span class="line">    <span class="keyword">var</span> res = <span class="title class_">Memory</span>.<span class="title function_">scan</span>(m.<span class="property">base</span>, m.<span class="property">size</span>, pattern, &#123;</span><br><span class="line">        <span class="attr">onMatch</span>: <span class="keyword">function</span> (<span class="params">address, size</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[+] ssl_verify_result found at: &#x27;</span> + address.<span class="title function_">toString</span>());</span><br><span class="line">            <span class="title function_">hook_ssl_verify_result</span>(address);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onError</span>: <span class="keyword">function</span> (<span class="params">reason</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[!] There was an error scanning memory&#x27;</span>);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">onComplete</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;All done&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>开启脚本后，抓包就正常了<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20220406/06.webp"
                     
                ></p>
]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>动静态SO层算法还原和脱机(吾爱论坛2021春节安卓题目)</title>
    <url>/2021/12/12/%E5%8A%A8%E9%9D%99%E6%80%81SO%E5%B1%82%E7%AE%97%E6%B3%95%E8%BF%98%E5%8E%9F%E5%92%8C%E8%84%B1%E6%9C%BA-%E5%90%BE%E7%88%B1%E8%AE%BA%E5%9D%9B2021%E6%98%A5%E8%8A%82%E5%AE%89%E5%8D%93%E9%A2%98%E7%9B%AE/</url>
    <content><![CDATA[<p>文章的案例来自吾爱论坛2021春节安卓题目</br><br>链接：<a class="link"   href="https://www.52pojie.cn/forum.php?mod=viewthread&tid=1369661&highlight=2021%EF%BF%BD%EF%BF%BD%EF%BF%BD%EF%BF%BD" >案例链接<i class="fas fa-external-link-alt"></i></a></p>
<p>java用的是unicode编码，c语言用的是ASCII编码</p>
<p>明文限制的长度是30，检测函数在nativel-lib文件里<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/01.webp"
                     
                ></p>
<p>解压apk并用ida打开so文件<br />大概分析一下，传进来的参数判断是否为30位，然后进入sub_B90进行处理后，再进入sub_D90处理，结果为v9，最后v9和v19作比较，相等返回1，不等返回0；<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/02.webp"
                     
                ></p>
<h4 id="用ida动态调试"><a href="#用ida动态调试" class="headerlink" title="用ida动态调试"></a>用ida动态调试</h4><p>调试前先把ida目录下的dbgsrv、android-server拷贝到手机上<br />并修改权限 777<br />这里需要开启frida去获取so的基址+sub_B90的偏移量&#x3D;sub_B90的绝对地址<br />先运行frida，再运行android-server<br />frida代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_KeyStore_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> addr_libnatuve = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(addr_libnatuve) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;so基址：&quot;</span>, addr_libnatuve)</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(hook_KeyStore_load)</span><br></pre></td></tr></table></figure>
<p>打印结果<br />so基址： 0x7613313000<br />0x7613313000+8AC<br />所以需要在动调调试的时候在位置打上断点<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/03.webp"
                     
                ><br><br />没显示汇编按空格<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/04.webp"
                     
                ></p>
<p>以go方式打开ida</p>
<p>选择Debugger–》Attach–》Remote ARM Linux&#x2F;Android debugger<br />输入手机IP，选择进程<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/05.webp"
                     
                ><br><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/06.webp"
                     
                ><br><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/07.webp"
                     
                ></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/08.webp"
                     
                ><br><br />加载好后跳到指定位置，或者快捷键G<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/09.webp"
                     
                ></p>
<p>打上断点后，点击绿色小箭头继续运行，app点击验证，会断到当前位置<br />可以转为汇编跟静态ida的作比较，Edit–》Code，或者快捷键C<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/10.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/11.webp"
                     
                ><br /><br>按F8单步调试<br />打开寄存器，进入<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/12.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/13.webp"
                     
                ></p>
<h4 id="用Frida"><a href="#用Frida" class="headerlink" title="用Frida"></a>用Frida</h4><p>这里直接用fridahook 函数，sub_B90<br />sub_B90的偏移量为B90<br />这就是第一轮加密后的<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/14.webp"
                     
                ></p>
<p>hook 第二个函数<br />这是明文经两轮加密后的结果<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/15.webp"
                     
                ></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_KeyStore_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> addr_libnatuve = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(addr_libnatuve) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;so基址：&quot;</span>, addr_libnatuve)</span><br><span class="line">            <span class="keyword">var</span> sub_B90 = addr_libnatuve.<span class="title function_">add</span>(<span class="number">0xB90</span>)</span><br><span class="line">            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(sub_B90, &#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">arg0</span> = args[<span class="number">0</span>]</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">arg1</span> = args[<span class="number">1</span>]</span><br><span class="line">                    <span class="variable language_">this</span>.<span class="property">arg2</span> = args[<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// console.log(&quot;</span></span><br><span class="line"><span class="string">&quot;,hexdump(this.arg0))</span></span><br><span class="line"><span class="string">                    // console.log(&quot;</span></span><br><span class="line"><span class="string">&quot;,this.arg1);</span></span><br><span class="line"><span class="string">                    // console.log(&quot;</span></span><br><span class="line"><span class="string">&quot;,hexdump(this.arg2));</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>参数一：<span class="string">&quot;,Memory.readCString(this.arg0))</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>参数二：<span class="string">&quot;,this.arg1.toInt32());</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>参数三<span class="string">&quot;,Memory.readCString(this.arg2))</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                onLeave: function(retval)&#123;</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>sub_B90 onLeave<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>运算结果<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                    console.log(Memory.readByteArray(this.arg0, 30)); // 这里把结果赋值给了第一个参数</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            var sub_D90 = addr_libnatuve.add(0xD90)</span></span><br><span class="line"><span class="string">            Interceptor.attach(sub_D90, &#123;</span></span><br><span class="line"><span class="string">                onEnter: function(args)&#123;</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>sub_D90 onEnter<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                    this.arg0 = args[0]</span></span><br><span class="line"><span class="string">                    this.arg1 = args[1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>参数一：<span class="string">&quot;,Memory.readByteArray(args[0], 30))</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>参数二：<span class="string">&quot;, this.arg1.toInt32())</span></span><br><span class="line"><span class="string">                &#125;,</span></span><br><span class="line"><span class="string">                onLeave: function(retval)&#123;</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>sub_D90 onLeave<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                    console.log(&quot;</span>运算结果<span class="string">&quot;);</span></span><br><span class="line"><span class="string">                    console.log(Memory.readCString(retval));</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">setImmediate(hook_KeyStore_load)</span></span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/16.webp"
                     
                ></p>
<h4 id="主动调用"><a href="#主动调用" class="headerlink" title="主动调用"></a>主动调用</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"># -*- <span class="attr">coding</span>: <span class="variable constant_">UTF</span>-<span class="number">8</span> -*-</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> frida, sys</span><br><span class="line"> </span><br><span class="line">jscode = <span class="string">&#x27;&#x27;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">var destAddr = &#x27;</span><span class="string">&#x27;;  //定位xsp地址</span></span><br><span class="line"><span class="string">  </span></span><br><span class="line"><span class="string">function inline_hook() &#123;</span></span><br><span class="line"><span class="string">    var so_addr = Module.findBaseAddress(&quot;libnative-lib.so&quot;);</span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">     </span></span><br><span class="line"><span class="string">    if (so_addr) &#123;</span></span><br><span class="line"><span class="string">        console.log(&quot;so_addr:&quot;, so_addr);</span></span><br><span class="line"><span class="string">         </span></span><br><span class="line"><span class="string">        var addr_b90 = so_addr.add(0xB90);</span></span><br><span class="line"><span class="string">        var sub_b90 = new NativeFunction(addr_b90 , &#x27;</span>int<span class="string">&#x27;, [&#x27;</span>pointer<span class="string">&#x27;, &#x27;</span>int<span class="string">&#x27;, &#x27;</span>pointer<span class="string">&#x27;]);</span></span><br><span class="line"><span class="string">        Interceptor.attach(sub_b90, &#123;</span></span><br><span class="line"><span class="string">            onEnter: function(args)</span></span><br><span class="line"><span class="string">            &#123; </span></span><br><span class="line"><span class="string">            destAddr = args[0];</span></span><br><span class="line"><span class="string">            console.log(&#x27;</span>onEnter <span class="variable constant_">B90</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">            &#125;,</span></span><br><span class="line"><span class="string">            //在hook函数之后执行的语句</span></span><br><span class="line"><span class="string">            onLeave:function(retval)</span></span><br><span class="line"><span class="string">            &#123;</span></span><br><span class="line"><span class="string">            console.log(&#x27;</span>onLeave <span class="variable constant_">B90</span><span class="string">&#x27;);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;);</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">        var addr_b2c = so_addr.add(0xb2c);</span></span><br><span class="line"><span class="string">        console.log(&quot;The addr_b2c:&quot;, addr_b2c);</span></span><br><span class="line"><span class="string">        Java.perform(function() &#123;</span></span><br><span class="line"><span class="string">            Interceptor.attach(addr_b2c, &#123;</span></span><br><span class="line"><span class="string">                onEnter: function(args) &#123;</span></span><br><span class="line"><span class="string">                console.log(&quot;addr_b2c OnEnter :&quot;,  Memory.readByteArray(destAddr.sub(0x38),64) );</span></span><br><span class="line"><span class="string">                &#125;</span></span><br><span class="line"><span class="string">            &#125;)</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">setImmediate(inline_hook)</span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">   </span></span><br><span class="line"><span class="string">&#x27;</span><span class="string">&#x27;&#x27;</span></span><br><span class="line">def <span class="title function_">on_message</span>(message, data):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        <span class="title function_">print</span>(<span class="string">&quot; &#123;0&#125;&quot;</span>.<span class="title function_">format</span>(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">    <span class="attr">else</span>:</span><br><span class="line">        <span class="title function_">print</span>(message)</span><br><span class="line">pass</span><br><span class="line">#<span class="title function_">print</span>(frida.<span class="title function_">enumerate_devices</span>())</span><br><span class="line"># 查找<span class="variable constant_">USB</span>设备并附加到目标进程</span><br><span class="line">device =  frida.<span class="title function_">get_usb_device</span>()</span><br><span class="line">#pid = device.<span class="title function_">spawn</span>([<span class="string">&quot;com.live.xctv&quot;</span>])</span><br><span class="line">  </span><br><span class="line">#session = device.<span class="title function_">attach</span>(pid)</span><br><span class="line">session =device.<span class="title function_">attach</span>(<span class="string">&#x27;cn.pojie52.cm01&#x27;</span>) #这里是要注入的apk包名</span><br><span class="line"># 在目标进程里创建脚本</span><br><span class="line">script = session.<span class="title function_">create_script</span>(jscode)</span><br><span class="line"># 注册消息回调</span><br><span class="line">script.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, on_message)</span><br><span class="line"><span class="title function_">print</span>(<span class="string">&#x27; Start attach&#x27;</span>)</span><br><span class="line"># 加载创建好的javascript脚本</span><br><span class="line">script.<span class="title function_">load</span>()</span><br><span class="line"># 读取系统输入</span><br><span class="line">sys.<span class="property">stdin</span>.<span class="title function_">read</span>()</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/17.webp"
                     
                ></p>
<h4 id="异或"><a href="#异或" class="headerlink" title="异或"></a>异或</h4><p>大概分析一下sub_b90，是根据传入的第三个参数s把v20进行了一个初始化，然后再把参数a1和v20进行了异或运算，主要看这个异或运算，先设想一下，如果是把a1进行了异或，那么得到的结果和a1之前的数据再异或就可以计算出异或的key，这里我们把它叫做xorkey，那么先看一下我们传入的参数，是30个1，也就是30个0x31 ，然后看结果，第一位是0xe0，0x31^0xe0 &#x3D; 209，然后把参数改为30个2，即0x32，得出首位的结果是0xe3，0xe3^0x32结果也是209，证明我们的思路是正确的，然后依次求出所有的xorkey，</p>
<p>这里的值是输入，30个1加密后异或来的<br />明文 ^ 密钥 &#x3D; 密文<br /># 拿到密钥<br />明文 ^ 密文 &#x3D; 密钥<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/18.webp"
                     
                ></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = [<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>,</span><br><span class="line">     <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>]</span><br><span class="line">b = [<span class="number">0xe0</span>, <span class="number">0x6b</span>, <span class="number">0x37</span>, <span class="number">0xa1</span>, <span class="number">0x75</span>, <span class="number">0xd7</span>, <span class="number">0xf6</span>, <span class="number">0xd4</span>, <span class="number">0xef</span>, <span class="number">0x19</span>, <span class="number">0xc6</span>, <span class="number">0xc3</span>, <span class="number">0x57</span>, <span class="number">0xa0</span>, <span class="number">0xf9</span>, <span class="number">0xb4</span>, <span class="number">0x73</span>, <span class="number">0xee</span>, <span class="number">0xc8</span>,</span><br><span class="line">     <span class="number">0xd1</span>, <span class="number">0xb3</span>, <span class="number">0x30</span>, <span class="number">0x1a</span>, <span class="number">0x0a</span>, <span class="number">0x09</span>, <span class="number">0x52</span>, <span class="number">0x06</span>, <span class="number">0x8c</span>, <span class="number">0x1f</span>, <span class="number">0x7c</span>]</span><br><span class="line"></span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">30</span>):</span><br><span class="line">    c.append(a[i] ^ b[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br></pre></td></tr></table></figure>
<p>结果：</p>
<p>[209, 90, 6, 144, 68, 230, 199, 229, 222, 40, 247, 242, 102, 145, 200, 133, 66, 223, 249, 224, 130, 1, 43, 59, 56, 99, 55, 189, 46, 77]</p>
</br>

<p>异或的key找到了，现在要找异或后的正确值，才能算出答案明文<br />1.调试<br />![image.png]<img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/20.webp"
                     
                ><br />调试到这里，要在寄存器钟拿到v19<br />这里就是判断的地方，偏移量为B2C<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/21.webp"
                     
                ><br><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/22.webp"
                     
                ></p>
<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><p>没计算前<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/23.webp"
                     
                ><br />计算后<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/24.webp"
                     
                ><br><br />这就是要的密文了<br />“5Gh2&#x2F;y6Poq2&#x2F;WIeLJfmh6yesnK7ndnJeWREFjRx8”</p>
<h4 id="另一种方式hook寄存器"><a href="#另一种方式hook寄存器" class="headerlink" title="另一种方式hook寄存器"></a>另一种方式hook寄存器</h4><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/25.webp"
                     
                ><br />基地址加B30就是结果寄存器的位置，同时我们需要的是x9寄存器的值</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_KeyStore_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> addr_libnatuve = <span class="title class_">Module</span>.<span class="title function_">findBaseAddress</span>(<span class="string">&quot;libnative-lib.so&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span>(addr_libnatuve) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;so基址：&quot;</span>, addr_libnatuve)</span><br><span class="line">            <span class="keyword">var</span> <span class="variable constant_">LDRB</span> = addr_libnatuve.<span class="title function_">add</span>(<span class="number">0xB30</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LDRB&quot;</span>, <span class="variable constant_">LDRB</span>)</span><br><span class="line">            <span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(<span class="variable constant_">LDRB</span>, &#123;</span><br><span class="line">                <span class="attr">onEnter</span>: <span class="keyword">function</span>(<span class="params">args</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Memory</span>.<span class="title function_">readCString</span>(<span class="variable language_">this</span>.<span class="property">context</span>.<span class="property">x9</span>))  <span class="comment">// 上下文获取x9寄存器</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">onLeave</span>: <span class="keyword">function</span>(<span class="params">retval</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;运算结果&quot;</span>);</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Memory</span>.<span class="title function_">readCString</span>(retval)); </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(hook_KeyStore_load)</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20211212/26.webp"
                     
                ></p>
<h4 id="异或出答案"><a href="#异或出答案" class="headerlink" title="异或出答案"></a>异或出答案</h4><p>密钥：[‘0xd1’, ‘0x5a’, ‘0x6’, ‘0x90’, ‘0x44’, ‘0xe6’, ‘0xc7’, ‘0xe5’, ‘0xde’, ‘0x28’, ‘0xf7’, ‘0xf2’, ‘0x66’, ‘0x91’, ‘0xc8’, ‘0x85’, ‘0x42’, ‘0xdf’, ‘0xf9’, ‘0xe0’, ‘0x82’, ‘0x1’, ‘0x2b’, ‘0x3b’, ‘0x38’, ‘0x63’, ‘0x37’, ‘0xbd’, ‘0x2e’, ‘0x4d’]<br />结果：“5Gh2&#x2F;y6Poq2&#x2F;WIeLJfmh6yesnK7ndnJeWREFjRx8”<br />结果^密钥&#x3D;答案<br /></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">a = [<span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>,</span><br><span class="line">     <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>, <span class="number">0x31</span>]</span><br><span class="line">b = [<span class="number">0xe0</span>, <span class="number">0x6b</span>, <span class="number">0x37</span>, <span class="number">0xa1</span>, <span class="number">0x75</span>, <span class="number">0xd7</span>, <span class="number">0xf6</span>, <span class="number">0xd4</span>, <span class="number">0xef</span>, <span class="number">0x19</span>, <span class="number">0xc6</span>, <span class="number">0xc3</span>, <span class="number">0x57</span>, <span class="number">0xa0</span>, <span class="number">0xf9</span>, <span class="number">0xb4</span>, <span class="number">0x73</span>, <span class="number">0xee</span>, <span class="number">0xc8</span>,</span><br><span class="line">     <span class="number">0xd1</span>, <span class="number">0xb3</span>, <span class="number">0x30</span>, <span class="number">0x1a</span>, <span class="number">0x0a</span>, <span class="number">0x09</span>, <span class="number">0x52</span>, <span class="number">0x06</span>, <span class="number">0x8c</span>, <span class="number">0x1f</span>, <span class="number">0x7c</span>]</span><br><span class="line"></span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">30</span>):</span><br><span class="line">    c.append(a[i] ^ b[i])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c) <span class="comment"># [209, 90, 6, 144, 68, 230, 199, 229, 222, 40, 247, 242, 102, 145, 200, 133, 66, 223, 249, 224, 130, 1, 43, 59, 56, 99, 55, 189, 46, 77]</span></span><br><span class="line"></span><br><span class="line">d = [<span class="number">0xd1</span>, <span class="number">0x5a</span>, <span class="number">0x6</span>, <span class="number">0x90</span>, <span class="number">0x44</span>, <span class="number">0xe6</span>, <span class="number">0xc7</span>, <span class="number">0xe5</span>, <span class="number">0xde</span>, <span class="number">0x28</span>, <span class="number">0xf7</span>, <span class="number">0xf2</span>, <span class="number">0x66</span>, <span class="number">0x91</span>, <span class="number">0xc8</span>, <span class="number">0x85</span>, <span class="number">0x42</span>, <span class="number">0xdf</span>, <span class="number">0xf9</span>, <span class="number">0xe0</span>, <span class="number">0x82</span>, <span class="number">0x1</span>, <span class="number">0x2b</span>, <span class="number">0x3b</span>, <span class="number">0x38</span>, <span class="number">0x63</span>, <span class="number">0x37</span>, <span class="number">0xbd</span>, <span class="number">0x2e</span>, <span class="number">0x4d</span>]</span><br><span class="line">data = base64.b64decode(<span class="string">&#x27;5Gh2/y6Poq2/WIeLJfmh6yesnK7ndnJeWREFjRx8&#x27;</span>.encode())</span><br><span class="line">flag = <span class="built_in">bytes</span>([d[i] ^ data[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(d))]).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>


<p>运行结果为：</p>
<p>52pojieHappyChineseNewYear2021</p>
]]></content>
      <tags>
        <tag>frida</tag>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>抓包进阶之SSL unpinning</title>
    <url>/2021/09/25/%E6%8A%93%E5%8C%85%E8%BF%9B%E9%98%B6%E4%B9%8BSSL-unpinning/</url>
    <content><![CDATA[<h1 id="SSL-Pinning-Bypass"><a href="#SSL-Pinning-Bypass" class="headerlink" title="SSL Pinning Bypass"></a>SSL Pinning Bypass</h1><p>客户端的证书绑定（pinning）。一种情况没有分析，就是客户端并不会默认信任系统根证书目录中的证书，而是在代码里再加一层校验，这就是证书绑定机制——SSL pinning，如果这段代码的校验过不了，那么客户端还是会报证书错误。<br>两层校验，<br>第一种不信任系统证书，使用自己的证书。<br>第二种在自己证书上再做一层判断<br>● Https客户端代码校验服务器证书<br>案例是自己配置的证书，不是ca机构签发的。这段代码放了自己的证书，一段检验机制</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/01.webp"
                     
                ></p>
<p>打开charles抓包，抓包失败</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/02.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/03.webp"
                     
                ></p>
<p>信任所有证书，都为空表示都信任</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/04.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/05.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/06.webp"
                     
                ></p>
<p>因为图片是https的，修改一下ssl</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/07.webp"
                     
                ></p>
<p>成功抓包<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/08.webp"
                     
                ></p>
<h2 id="让客户端信任系统根证书目录中的证书"><a href="#让客户端信任系统根证书目录中的证书" class="headerlink" title="让客户端信任系统根证书目录中的证书"></a>让客户端信任系统根证书目录中的证书</h2><p>把证书校验重新开起来<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/09.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/10.webp"
                     
                ></p>
<p>hook住checkServerTrusted，将其所有重载都置空；<br>使用spawn模式运行</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 检查一个类是否继承某一个接口</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">checkIsImplementeInterFace</span>(<span class="params">clsName, interface_</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">              <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">isInterface</span>())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span> != <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">if</span>(interface_.<span class="property">class</span>.<span class="title function_">isAssignableFrom</span>(cls.<span class="property">class</span>))&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustManagerInterface</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.TrustManager&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.CertificatePinner&quot;</span>).<span class="property">check</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;[Ljava.security.cert.Certificate;&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CertificatePinner check called!&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.CertificatePinner&quot;</span>).<span class="property">check</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.lang.String&#x27;</span>, <span class="string">&#x27;java.util.List&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CertificatePinner check called!&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">clsName,handle</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">checkIsImplementeInterFace</span>(clsName,<span class="title class_">TrustManagerInterface</span>))&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> targetClass = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> len = targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">                        targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                            </span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName + i + <span class="string">&quot;checkServerTrusted Called!&quot;</span>)</span><br><span class="line">                            <span class="comment">//return targetClass[&quot;checkServerTrusted&quot;].overloads[i].apply(this,arguments)</span></span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Search Classes Completed!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>成功抓到包</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/11.webp"
                     
                ></p>
<h2 id="过检验证书"><a href="#过检验证书" class="headerlink" title="过检验证书"></a>过检验证书</h2><p>把证书检验开启</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/12.webp"
                     
                ></p>
<h2 id="objection绕过检测"><a href="#objection绕过检测" class="headerlink" title="objection绕过检测"></a>objection绕过检测</h2><p>使用objection，直接将SSL pinning给disable掉</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">android sslpinning disable</span><br></pre></td></tr></table></figure>

<h1 id="ssl-pinning-服务器检验客户端证书"><a href="#ssl-pinning-服务器检验客户端证书" class="headerlink" title="ssl pinning+服务器检验客户端证书"></a>ssl pinning+服务器检验客户端证书</h1><p>注册页面抓包，证书不信任<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/13.webp"
                     
                ></p>
<p>用frida hook掉他的一些检测，</p>
<h2 id="ssl-pinning（hook掉证书验证-自定义证书-）"><a href="#ssl-pinning（hook掉证书验证-自定义证书-）" class="headerlink" title="ssl pinning（hook掉证书验证(自定义证书)）"></a>ssl pinning（hook掉证书验证(自定义证书)）</h2><h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">// 检查一个类是否继承某一个接口</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">checkIsImplementeInterFace</span>(<span class="params">clsName, interface_</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">              <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">isInterface</span>())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span> != <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">if</span>(interface_.<span class="property">class</span>.<span class="title function_">isAssignableFrom</span>(cls.<span class="property">class</span>))&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustManagerInterface</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.TrustManager&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java.use(&quot;okhttp3.CertificatePinner&quot;).check.overload(&#x27;java.lang.String&#x27;, &#x27;[Ljava.security.cert.Certificate;&#x27;).implementation = function()&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;CertificatePinner check called!&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java.use(&quot;okhttp3.CertificatePinner&quot;).check.overload(&#x27;java.lang.String&#x27;, &#x27;java.util.List&#x27;).implementation = function()&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;CertificatePinner check called!&quot;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">clsName,handle</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">checkIsImplementeInterFace</span>(clsName,<span class="title class_">TrustManagerInterface</span>))&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> targetClass = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> len = targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">                        targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                            </span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName + i + <span class="string">&quot;checkServerTrusted Called!&quot;</span>)</span><br><span class="line">                            <span class="comment">//return targetClass[&quot;checkServerTrusted&quot;].overloads[i].apply(this,arguments)</span></span><br><span class="line">                            </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Search Classes Completed!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>

<h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">checkIsImplementeInterFace</span>(<span class="params">clsName, interface_</span>)&#123;</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">              <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">isInterface</span>())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">              &#125;</span><br><span class="line">              <span class="keyword">if</span>(cls.<span class="property">class</span> != <span class="literal">undefined</span>)</span><br><span class="line">                <span class="keyword">if</span>(interface_.<span class="property">class</span>.<span class="title function_">isAssignableFrom</span>(cls.<span class="property">class</span>))&#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">              <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustManagerInterface</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.TrustManager&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java.use(&quot;okhttp3.CertificatePinner&quot;).check.overload(&#x27;java.lang.String&#x27;, &#x27;[Ljava.security.cert.Certificate;&#x27;).implementation = function()&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;CertificatePinner check called!&quot;)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java.use(&quot;okhttp3.CertificatePinner&quot;).check.overload(&#x27;java.lang.String&#x27;, &#x27;java.util.List&#x27;).implementation = function()&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;CertificatePinner check called!&quot;)</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Java.enumerateClassLoaders(&#123;</span></span><br><span class="line">        <span class="comment">//   onMatch: function(loader)&#123;</span></span><br><span class="line">        <span class="comment">//       try&#123;</span></span><br><span class="line">        <span class="comment">//           if(loader.findClass(&quot;okhttp3.OkHttpClient$Builder&quot;))&#123;</span></span><br><span class="line">        <span class="comment">//             console.log(&quot;Found the really Classloader&quot;)</span></span><br><span class="line">        <span class="comment">//             Java.classFactory.loader = loader</span></span><br><span class="line">        <span class="comment">//           &#125;</span></span><br><span class="line">        <span class="comment">//       &#125;catch(e)&#123;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//       &#125;</span></span><br><span class="line">        <span class="comment">//   &#125;,</span></span><br><span class="line">        <span class="comment">//   onComplete: function()&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;Search Loaders Completed!&quot;)</span></span><br><span class="line">        <span class="comment">//   &#125;</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="comment">// Java.use(&quot;okhttp3.OkHttpClient$Builder&quot;).certificatePinner.implementation = function(certificatePinner)&#123;</span></span><br><span class="line">        <span class="comment">//   return this.certificatePinner(Java.use(&quot;okhttp3.CertificatePinner&quot;).DEFAULT.value) //CertificatePinner.DEFAULT</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">clsName,handle</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_">checkIsImplementeInterFace</span>(clsName,<span class="title class_">TrustManagerInterface</span>))&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> targetClass = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">                    <span class="keyword">var</span> len = targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; len; i++)&#123;</span><br><span class="line">                      <span class="comment">//console.log(targetClass[&quot;checkServerTrusted&quot;].overloads[i].returnType.name)</span></span><br><span class="line">                      <span class="keyword">if</span>(targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>[i].<span class="property">returnType</span>.<span class="property">name</span> == <span class="string">&#x27;V&#x27;</span>)&#123;</span><br><span class="line">                        targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                          <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName + i + <span class="string">&quot;checkServerTrusted Called!&quot;</span>)</span><br><span class="line">                          <span class="comment">//return targetClass[&quot;checkServerTrusted&quot;].overloads[i].apply(this,arguments)</span></span><br><span class="line">                        &#125;</span><br><span class="line">                      &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        targetClass[<span class="string">&quot;checkServerTrusted&quot;</span>].<span class="property">overloads</span>[i].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                          <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName + i + <span class="string">&quot;checkServerTrusted Called!&quot;</span>)</span><br><span class="line">                          <span class="comment">//return targetClass[&quot;checkServerTrusted&quot;].overloads[i].apply(this,arguments)</span></span><br><span class="line">                          <span class="keyword">return</span> <span class="literal">null</span></span><br><span class="line">                        &#125;</span><br><span class="line">                      &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Search Classes Completed!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">        </span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>现在可以抓到包，证明请求发出去，那就是证书不对<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/14.webp"
                     
                ></p>
<h2 id="dump-证书"><a href="#dump-证书" class="headerlink" title="dump 证书"></a>dump 证书</h2><p>先关掉vpn，让它正常发请求，并用脚本把证书导出</p>
<h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>把证书密码dump出来，手动解压apk搜索证书导入charles即可</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">print_stack</span>(<span class="params">p</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=====&gt;&quot;</span>, p)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">StringClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">KeyStore</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore&quot;</span>);</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.KeyStore$LoadStoreParameter&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0</span>) &#123;</span><br><span class="line">            <span class="comment">// print_stack(&quot;KeyStore.load1&quot;);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load1:&quot;</span>, arg0);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.io.InputStream&#x27;</span>, <span class="string">&#x27;[C&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0, arg1</span>) &#123;</span><br><span class="line">            <span class="comment">// print_stack(&quot;KeyStore.load2&quot;);</span></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load2:&quot;</span>, arg0, arg1 ? <span class="title class_">StringClass</span>.$new(arg1) : <span class="literal">null</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0, arg1);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook_KeyStore_load...&quot;</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/15.webp"
                     
                ></p>
<h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>dump出证书到手机，并修改证书密码 </p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Enter!&quot;</span>)</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">storeP12</span>(<span class="params">pri, p7, p12Path, p12Password</span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> X509Certificate = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.cert.X509Certificate&quot;</span>)</span><br><span class="line">            <span class="keyword">var</span> p7X509 = <span class="title class_">Java</span>.<span class="title function_">cast</span>(p7, X509Certificate);</span><br><span class="line">            <span class="keyword">var</span> chain = <span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&quot;java.security.cert.X509Certificate&quot;</span>, [p7X509])</span><br><span class="line">            <span class="keyword">var</span> ks = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore&quot;</span>).<span class="title function_">getInstance</span>(<span class="string">&quot;PKCS12&quot;</span>, <span class="string">&quot;BC&quot;</span>);</span><br><span class="line">            ks.<span class="title function_">load</span>(<span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">            ks.<span class="title function_">setKeyEntry</span>(<span class="string">&quot;client&quot;</span>, pri, <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(p12Password).<span class="title function_">toCharArray</span>(), chain);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">var</span> out = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.io.FileOutputStream&quot;</span>).$new(p12Path);</span><br><span class="line">              ks.<span class="title function_">store</span>(out, <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&#x27;java.lang.String&#x27;</span>).$new(p12Password).<span class="title function_">toCharArray</span>())</span><br><span class="line">            &#125; <span class="keyword">catch</span> (exp) &#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(exp)</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">//在服务器校验客户端的情形下，帮助dump客户端证书，并保存为p12的格式，证书密码为r0ysue</span></span><br><span class="line">          <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore$PrivateKeyEntry&quot;</span>).<span class="property">getPrivateKey</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">getPrivateKey</span>()</span><br><span class="line">            <span class="keyword">var</span> packageName = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">currentApplication</span>().<span class="title function_">getApplicationContext</span>().<span class="title function_">getPackageName</span>();</span><br><span class="line">            <span class="title function_">storeP12</span>(<span class="variable language_">this</span>.<span class="title function_">getPrivateKey</span>(), <span class="variable language_">this</span>.<span class="title function_">getCertificate</span>(), <span class="string">&#x27;/sdcard/Download/&#x27;</span> + packageName + <span class="string">&#x27;.p12&#x27;</span>, <span class="string">&#x27;r0ysue&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dumpClinetCertificate=&gt;&quot;</span> + <span class="string">&#x27;/sdcard/Download/&#x27;</span> + packageName + <span class="string">&#x27;.p12&#x27;</span> + <span class="string">&#x27;   pwd: r0ysue&#x27;</span>);            </span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore$PrivateKeyEntry&quot;</span>).<span class="property">getCertificateChain</span>.<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="variable language_">this</span>.<span class="title function_">getCertificateChain</span>()</span><br><span class="line">            <span class="keyword">var</span> packageName = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.app.ActivityThread&quot;</span>).<span class="title function_">currentApplication</span>().<span class="title function_">getApplicationContext</span>().<span class="title function_">getPackageName</span>();</span><br><span class="line">            <span class="title function_">storeP12</span>(<span class="variable language_">this</span>.<span class="title function_">getPrivateKey</span>(), <span class="variable language_">this</span>.<span class="title function_">getCertificate</span>(), <span class="string">&#x27;/sdcard/Download/&#x27;</span> + packageName + <span class="string">&#x27;.p12&#x27;</span>, <span class="string">&#x27;r0ysue&#x27;</span>);</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;dumpClinetCertificate=&gt;&quot;</span> + <span class="string">&#x27;/sdcard/Download/&#x27;</span> + packageName + <span class="string">&#x27;.p12&#x27;</span> + <span class="string">&#x27;   pwd: r0ysue&#x27;</span>);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/16.webp"
                     
                ></p>
<h2 id="charles导入证书"><a href="#charles导入证书" class="headerlink" title="charles导入证书"></a>charles导入证书</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb pull /sdcard/Download/com.ninemax.ncsearchnew.p12 /root/Desktop/</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/17.webp"
                     
                ><br>再运行绕过本地校验脚本，成功抓包<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/18.webp"
                     
                ></p>
<h1 id="混淆的okhhtp3抓包"><a href="#混淆的okhhtp3抓包" class="headerlink" title="混淆的okhhtp3抓包"></a>混淆的okhhtp3抓包</h1><p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/19.webp"
                     
                ></p>
<p>通过它的官网知道是https，用的ca机构证书。不需要hook证书校验这一步<br>jadx打开搜索 CertificatePinner</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/20.webp"
                     
                ></p>
<p>通过查看的CertificatePinner源码，和该app的代码对比，基本一样的逻辑，证书校验不通过就会抛异常</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/21.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/22.webp"
                     
                ></p>
<p>使用frida对其hook，置空</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;q.g&quot;</span>).<span class="property">a</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;check called!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>charles设置443端口<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/23.webp"
                     
                ></p>
<p>成功抓包</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210925/24.webp"
                     
                ></p>
]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>检测vpn抓包</title>
    <url>/2021/09/06/%E6%A3%80%E6%B5%8Bvpn%E6%8A%93%E5%8C%85/</url>
    <content><![CDATA[<p>这是肉师傅知识星球的一道检测vpn抓包的练习题，当检测到开启vpn就会闪退<br>软件我放在网盘了，需要的自取<br>链接：<a class="link"   href="https://pan.baidu.com/s/1h4QkrLyDlz8Wb1XylzYLWA" >https://pan.baidu.com/s/1h4QkrLyDlz8Wb1XylzYLWA<i class="fas fa-external-link-alt"></i></a><br>提取码：jjrh<br>既然已经知道是检测vpn了，通过查询资料以下4个类跟网络相关</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/01.webp"
                     
                ></p>
<p>通过百度知道java.net.NetworkInterface.getName()是检测vpn的api，用objection来hook查看一下</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/02.webp"
                     
                ></p>
<p>发现当开关vpn时，会检测到tun0的网卡，可以用来监测是否开启vpn。<br>那用frida来hook修改tun0的返回值看看能不能绕过</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/03.webp"
                     
                ></p>
<p>还是会闪退，怀疑检测点不止一个<br>NetworkCapabilities 也有检测vpn的<br>用objection hook一下 android.net.ConnectivityManager.getNetworkCapabilities</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/04.webp"
                     
                ></p>
<p>通过查看文档知道，返回null即可</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/05.webp"
                     
                ></p>
<p>用frida hook返回为null，还是闪退，用jadx打开查看报错位置</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/06.webp"
                     
                ></p>
<p>这里返回null的话就无法调用后面的hasTransport方法，直接hook hasTransport修改返回值为false绕过</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/07.webp"
                     
                ></p>
<p>开启vpn后app不闪退了，成功绕过</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210906/08.webp"
                     
                ></p>
<p>完整代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.net.NetworkInterface&quot;</span>).<span class="property">getName</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> string_class = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">            <span class="keyword">var</span> gname = <span class="variable language_">this</span>.<span class="title function_">getName</span>();</span><br><span class="line">            <span class="keyword">if</span>(gname == string_class.$new(<span class="string">&quot;tun0&quot;</span>))&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;find ===&gt; &quot;</span>, gname);</span><br><span class="line">                <span class="keyword">return</span> string_class.$new(<span class="string">&quot;rmnet_data0&quot;</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;gname ===&gt; &quot;</span>, gname)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> gname;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// Java.use(&quot;android.net.ConnectivityManager&quot;).getNetworkCapabilities.implementation = function(v)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(v)</span></span><br><span class="line">        <span class="comment">//     var res = this.getNetworkCapabilities(v)</span></span><br><span class="line">        <span class="comment">//     console.log(&quot;res ==&gt; &quot;, res)</span></span><br><span class="line">        <span class="comment">//     return null;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.net.NetworkCapabilities&quot;</span>).<span class="property">hasTransport</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">v</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(v)</span><br><span class="line">            <span class="keyword">var</span> res = <span class="variable language_">this</span>.<span class="title function_">hasTransport</span>(v)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;res ==&gt; &quot;</span>, res)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main);</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>抓包进阶之通杀okhttp证书</title>
    <url>/2021/09/05/%E6%8A%93%E5%8C%85%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%80%9A%E6%9D%80okhttp%E8%AF%81%E4%B9%A6/</url>
    <content><![CDATA[<h1 id="三层检验"><a href="#三层检验" class="headerlink" title="三层检验"></a>三层检验</h1><p>okhttp在客户端有三种检验证书方法<br>证书验证sslSocketFactory<br>证书锁定certificatePinner<br>域名验证hostmaneVerfier</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210905/01.webp"
                     
                ></p>
<p>如何做到通杀？<br>三个检验方法都基于 OkHttpClient.Builder()<br>要先找到 OkHttpClient，由于经过混淆的，无法直接定位</p>
<h1 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h1><h2 id="先把内存中的类的存到数组"><a href="#先把内存中的类的存到数组" class="headerlink" title="先把内存中的类的存到数组"></a>先把内存中的类的存到数组</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> classesNames = <span class="keyword">new</span> <span class="title class_">Array</span>()   <span class="comment">// 存放加载的类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 1.把已经加载内存中的类枚举出来，存到一个数组里</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadClasses</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">clsName, handle</span>)&#123;</span><br><span class="line">                classesNames.<span class="title function_">push</span>(clsName);</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Search Class Completed!&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">loadClasses</span>()</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>

<h2 id="查找-okhttp3-OkHttpClient类和证书CertificatePinner类"><a href="#查找-okhttp3-OkHttpClient类和证书CertificatePinner类" class="headerlink" title="查找 okhttp3.OkHttpClient类和证书CertificatePinner类"></a>查找 okhttp3.OkHttpClient类和证书CertificatePinner类</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">findOkhttpClass</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Modifier</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.reflect.Modifier&quot;</span>)  <span class="comment">// 反射框架，可以提供类的一些属性，例如是不是final，sttic等</span></span><br><span class="line">		<span class="comment">// 判断类是否是OkhttpClient</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">isOkhttpClient</span>(<span class="params">clsName</span>)&#123;</span><br><span class="line">			<span class="comment">// Okhttp3.OkHttpClient</span></span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="property">length</span> != <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">                <span class="keyword">var</span> interfaces = cls.<span class="property">class</span>.<span class="title function_">getInterfaces</span>()  <span class="comment">// 通过反射获得当前类的一些接口</span></span><br><span class="line">                <span class="keyword">const</span> count = interfaces.<span class="property">length</span></span><br><span class="line">                <span class="comment">//console.log(count)</span></span><br><span class="line">				<span class="comment">// 当前类如果实现的接口小于2，就不是，okhttp实现的接口Cloneable, Call.Factory, WebSocket.Factory </span></span><br><span class="line">                <span class="keyword">if</span>(count &lt; <span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> flag = <span class="literal">false</span></span><br><span class="line">				<span class="comment">// 对实现的接口进行遍历，进行判断</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++)&#123;</span><br><span class="line">                    <span class="keyword">var</span> interface_ = interfaces[i]</span><br><span class="line">                    <span class="keyword">var</span> interface_name = interface_.<span class="title function_">getName</span>()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(interface_name.<span class="title function_">indexOf</span>(<span class="string">&quot;Cloneable&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        flag = <span class="literal">true</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(interface_name.<span class="title function_">indexOf</span>(<span class="string">&quot;$&quot;</span>) &lt;= <span class="number">0</span>)&#123;  <span class="comment">// 内部类Call.Factory</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                </span><br><span class="line">				<span class="comment">// 过滤当前类没有内部类</span></span><br><span class="line">                <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>().<span class="property">length</span> &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// 过滤父类不是Object，OkHttpClient没有继承其他类</span></span><br><span class="line">                <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getSuperclass</span>().<span class="title function_">getName</span>() != <span class="string">&#x27;java.lang.Object&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">isCertificatePinner</span>(<span class="params">clsName,prefix</span>)&#123;</span><br><span class="line">            <span class="comment">// prefix=Okhttp3.</span></span><br><span class="line">			<span class="comment">// CertificatePinner类</span></span><br><span class="line">            <span class="keyword">if</span>(!clsName.<span class="title function_">startsWith</span>(prefix))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">indexOf</span>(<span class="string">&quot;$&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="property">length</span> != <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">isInterface</span>())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getInterfaces</span>().<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">         </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>().<span class="property">length</span> &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getSuperclass</span>().<span class="title function_">getName</span>() != <span class="string">&quot;java.lang.Object&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 类属性是否有Final</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="title class_">Modifier</span>.<span class="title function_">isFinal</span>(cls.<span class="property">class</span>.<span class="title function_">getModifiers</span>()))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> flag = <span class="literal">false</span></span><br><span class="line">			<span class="comment">// 获得所有方法，然后遍历</span></span><br><span class="line">            <span class="keyword">var</span> methods = cls.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">var</span> method = methods[i]</span><br><span class="line">				<span class="comment">// 过滤方法没有参数的</span></span><br><span class="line">                <span class="keyword">if</span>(method.<span class="title function_">getParameterCount</span>() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// 方法的第一个参数是java.security.cert.Certificate</span></span><br><span class="line">                <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;java.security.cert.Certificate&quot;</span>)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">            flag = <span class="literal">false</span></span><br><span class="line">			<span class="comment">// 获取类的所有成员变量</span></span><br><span class="line">            <span class="keyword">var</span> fields = cls.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>()</span><br><span class="line">			<span class="comment">// 类包含set集合</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; fields.<span class="property">length</span>; k++)&#123;</span><br><span class="line">                <span class="keyword">var</span> field = fields[k];</span><br><span class="line">                <span class="keyword">if</span>(field.<span class="title function_">getType</span>().<span class="title function_">getName</span>() == <span class="string">&quot;java.util.Set&quot;</span>)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classesNames.<span class="property">length</span>; i++)&#123;</span><br><span class="line">			<span class="comment">// 如果类名是OkhttpClient，就保存为变量</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">isOkhttpClient</span>(classesNames[i]))&#123;</span><br><span class="line">                <span class="title class_">OkhttpClientClassName</span> = classesNames[i]</span><br><span class="line">                <span class="comment">//console.log(OkhttpClientClassName)</span></span><br><span class="line">                <span class="keyword">var</span> splits = classesNames[i].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                <span class="keyword">var</span> len = splits.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len-<span class="number">1</span>; j++)&#123;</span><br><span class="line">					<span class="comment">// Okhttp3.OkHttpClient</span></span><br><span class="line">                    prefix = prefix + splits[j] + <span class="string">&#x27;.&#x27;</span>  <span class="comment">// 当前包名的一个前缀，prefix=Okhttp3.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 找CertificatePinner类</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classesNames.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">isCertificatePinner</span>(classesNames[i],prefix))&#123;</span><br><span class="line">                <span class="title class_">CertificatePinnerClassName</span> = classesNames[i]</span><br><span class="line">                <span class="comment">//console.log(CertificatePinnerClassName)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Found Class: &quot;</span>+classesNames.<span class="property">length</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Okhttp&#x27;s package prefix: &quot;</span>+prefix)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Find the OkhttpClient: &quot;</span>+<span class="title class_">OkhttpClientClassName</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Find the OkhttpCertificatePinner: &quot;</span>+<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">OkhttpClientClassName</span> == <span class="string">&quot;&quot;</span> || <span class="title class_">CertificatePinnerClassName</span> == <span class="string">&quot;&quot;</span> || prefix == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Can&#x27;t find the okhttp class&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>attach模式运行</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210905/02.webp"
                     
                ></p>
<h2 id="找到之后进行hook"><a href="#找到之后进行hook" class="headerlink" title="找到之后进行hook"></a>找到之后进行hook</h2><p>找builder内部类<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210905/03.webp"
                     
                ></p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Modifier</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.reflect.Modifier&quot;</span>)</span><br><span class="line">        <span class="comment">//TrustAllManager，自定义类，hook方法置空，什么都不干</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustAllManagerClass</span> = <span class="title class_">Java</span>.<span class="title function_">registerClass</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;TrustAllManager&quot;</span>,</span><br><span class="line">            <span class="attr">implements</span>:[<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.X509TrustManager&quot;</span>)],</span><br><span class="line">            <span class="attr">methods</span>: &#123;</span><br><span class="line">                <span class="title function_">checkClientTrusted</span>(<span class="params">chain, authType</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;checkClientTrusted Called!!&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">checkServerTrusted</span>(<span class="params">chain, authType</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;checkServerTrusted Called!!&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">getAcceptedIssuers</span>(<span class="params"></span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> [];</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> trustAllManagerHandle = <span class="title class_">TrustAllManagerClass</span>.$new()</span><br><span class="line">		<span class="comment">// 仿造</span></span><br><span class="line">		<span class="comment">// SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);</span></span><br><span class="line">        <span class="comment">// context.init(null, trustManagers ,new SecureRandom());</span></span><br><span class="line">        <span class="comment">// SSLSocketFactory factory = context.getSocketFactory();</span></span><br><span class="line">        <span class="keyword">var</span> sslContext = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.SSLContext&quot;</span>).<span class="title function_">getInstance</span>(<span class="string">&quot;TLS&quot;</span>)</span><br><span class="line">        sslContext.<span class="title function_">init</span>(<span class="literal">null</span>,<span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&quot;Ljavax.net.ssl.X509TrustManager;&quot;</span>,[trustAllManagerHandle]),<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">var</span> sslSocketFactory = sslContext.<span class="title function_">getSocketFactory</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//HostnameVerify，自定义类</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">MyHostnameVerify</span> = <span class="title class_">Java</span>.<span class="title function_">registerClass</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;MyHostnameVerify&quot;</span>,</span><br><span class="line">            <span class="attr">implements</span>:[<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.HostnameVerifier&quot;</span>)],</span><br><span class="line">            <span class="attr">methods</span>: &#123;</span><br><span class="line">                <span class="title function_">verify</span>(<span class="params">hostname, session</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(hostname)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> myHostnameVerifyHandle = <span class="title class_">MyHostnameVerify</span>.$new()</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 已经拿到okhttp3.OkHttpClient，拿它的内部类builder</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">BuilderClassName</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">OkhttpClientClassName</span>).<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>()[<span class="number">0</span>].<span class="title function_">getName</span>()</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">OkhttpClient</span>$Buidler = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">BuilderClassName</span>)</span><br><span class="line">		<span class="comment">// 通过反射获取builder的所有方法</span></span><br><span class="line">        <span class="keyword">var</span> methods = <span class="title class_">OkhttpClient</span>$Buidler.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> method = methods[i]</span><br><span class="line">			<span class="comment">// 过滤方法没有参数的，目标方法都有参数</span></span><br><span class="line">			<span class="comment">// builder.sslSocketFactory(factory, (X509TrustManager) trustManagers[0]);</span></span><br><span class="line">			<span class="comment">// builder.certificatePinner(cerBuilder.build());</span></span><br><span class="line">			<span class="comment">// builder.hostnameVerifier(new HostnameVerifier()&#123;&#125;)；</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterCount</span>() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第一道校验，第一个参数的类名是javax.net.ssl.SSLSocketFactory就进行hook，参数替换为自定义参数</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> sslSocketFacotryMethodName  = method.<span class="title function_">getName</span>()</span><br><span class="line">				<span class="comment">// 获取该方法的重载个数</span></span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[sslSocketFacotryMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">				<span class="comment">// 遍历重载</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[sslSocketFacotryMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">SSLSocketFactory</span>)&#123;</span><br><span class="line">						<span class="comment">// 把参数替换为自定义的类</span></span><br><span class="line">                        <span class="variable language_">arguments</span>[<span class="number">0</span>] = sslSocketFactory</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[sslSocketFacotryMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(sslSocketFacotryMethodName,<span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第三道校验，第一个参数是javax.net.ssl.HostnameVerifier就进行hook，参数替换为自定义参数</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;javax.net.ssl.HostnameVerifier&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> hostnameVerifierMethodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[hostnameVerifierMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[hostnameVerifierMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">hostnameVerifier</span>)&#123;</span><br><span class="line">                        <span class="variable language_">arguments</span>[<span class="number">0</span>] = myHostnameVerifyHandle</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[hostnameVerifierMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(hostnameVerifierMethodName, <span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第二到校验，参数替换为它默认的，builder.certificatePinner(cerBuilder.build());</span></span><br><span class="line">			<span class="comment">// 默认public static final CertificatePinner DEFAULT = new Builder().build();</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="title class_">CertificatePinnerClassName</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> <span class="title class_">CertificatePinnerClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line">                <span class="keyword">var</span> certificatePinnerMethodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[certificatePinnerMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[certificatePinnerMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;certificatePinner add called!&quot;</span>)</span><br><span class="line">						<span class="comment">// 拿到所有的域，遍历</span></span><br><span class="line">                        <span class="keyword">var</span> fields = <span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>()</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; fields.<span class="property">length</span>; k++)&#123;</span><br><span class="line">                            <span class="keyword">var</span> field = fields[k];</span><br><span class="line">                            <span class="keyword">var</span> modifiers = field.<span class="title function_">getModifiers</span>()</span><br><span class="line">							<span class="comment">// public static final CertificatePinner DEFAULT = new Builder().build();</span></span><br><span class="line">                            <span class="keyword">if</span>(<span class="title class_">Modifier</span>.<span class="title function_">isFinal</span>(modifiers) &amp;&amp; <span class="title class_">Modifier</span>.<span class="title function_">isStatic</span>(modifiers) &amp;&amp; <span class="title class_">Modifier</span>.<span class="title function_">isPublic</span>(modifiers))&#123;</span><br><span class="line">                                <span class="variable language_">arguments</span>[<span class="number">0</span>] = field.<span class="title function_">get</span>(<span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[certificatePinnerMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>( method.<span class="title function_">getName</span>(),<span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">CertificatePinnerClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line">        <span class="keyword">var</span> methods = <span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> method = methods[i]</span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getReturnType</span>().<span class="title function_">getName</span>() == <span class="string">&#x27;void&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> methodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(methodName+<span class="string">&quot; Hooked!&quot;</span>)</span><br><span class="line">                <span class="keyword">var</span> m_len = <span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; m_len; j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>[j].<span class="property">returnType</span>.<span class="property">name</span> == <span class="string">&#x27;V&#x27;</span>)&#123;</span><br><span class="line">                        <span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;certificatePinner check called!&quot;</span>)</span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>运行</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210905/04.webp"
                     
                ></p>
<h2 id="使用spwan模式主动加载类名"><a href="#使用spwan模式主动加载类名" class="headerlink" title="使用spwan模式主动加载类名"></a>使用spwan模式主动加载类名</h2><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">loadOkhttpClient</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="comment">// 把找到的类名替换这里</span></span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;okhttp3.OkHttpClient&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            <span class="comment">//console.error(e)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>滴答清单app<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210905/05.webp"
                     
                ></p>
<h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> classesNames = <span class="keyword">new</span> <span class="title class_">Array</span>()  <span class="comment">// 存放加载的类</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">OkhttpClientClassName</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">CertificatePinnerClassName</span> = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">var</span> prefix = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadOkhttpClient</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;q.x&quot;</span>)</span><br><span class="line">        &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">            <span class="comment">//console.error(e)</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1.把已经加载内存中的类枚举出来，存到一个数组里</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loadClasses</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">enumerateLoadedClasses</span>(&#123;</span><br><span class="line">            <span class="attr">onMatch</span>: <span class="keyword">function</span>(<span class="params">clsName, handle</span>)&#123;</span><br><span class="line">                classesNames.<span class="title function_">push</span>(clsName)</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">onComplete</span>: <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Search Class Completed!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">findOkhttpClass</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Modifier</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.reflect.Modifier&quot;</span>)  <span class="comment">// 反射框架，可以提供类的一些属性，例如是不是final，sttic等</span></span><br><span class="line">		<span class="comment">// 判断类是否是OkhttpClient</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">isOkhttpClient</span>(<span class="params">clsName</span>)&#123;</span><br><span class="line">			<span class="comment">// Okhttp3.OkHttpClient</span></span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="property">length</span> != <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">                <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">                <span class="keyword">var</span> interfaces = cls.<span class="property">class</span>.<span class="title function_">getInterfaces</span>()  <span class="comment">// 通过反射获得当前类的一些接口</span></span><br><span class="line">                <span class="keyword">const</span> count = interfaces.<span class="property">length</span></span><br><span class="line">                <span class="comment">//console.log(count)</span></span><br><span class="line">				<span class="comment">// 当前类如果实现的接口小于2，就不是，okhttp实现的接口Cloneable, Call.Factory, WebSocket.Factory </span></span><br><span class="line">                <span class="keyword">if</span>(count &lt; <span class="number">2</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">var</span> flag = <span class="literal">false</span></span><br><span class="line">				<span class="comment">// 对实现的接口进行遍历，进行判断</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; count; i++)&#123;</span><br><span class="line">                    <span class="keyword">var</span> interface_ = interfaces[i]</span><br><span class="line">                    <span class="keyword">var</span> interface_name = interface_.<span class="title function_">getName</span>()</span><br><span class="line">                    </span><br><span class="line">                    <span class="keyword">if</span>(interface_name.<span class="title function_">indexOf</span>(<span class="string">&quot;Cloneable&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                        flag = <span class="literal">true</span></span><br><span class="line">                    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">if</span>(interface_name.<span class="title function_">indexOf</span>(<span class="string">&quot;$&quot;</span>) &lt;= <span class="number">0</span>)&#123;  <span class="comment">// 内部类Call.Factory</span></span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                </span><br><span class="line">				<span class="comment">// 过滤当前类没有内部类</span></span><br><span class="line">                <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>().<span class="property">length</span> &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// 过滤父类不是Object，OkHttpClient没有继承其他类</span></span><br><span class="line">                <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getSuperclass</span>().<span class="title function_">getName</span>() != <span class="string">&#x27;java.lang.Object&#x27;</span>)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">            &#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">isCertificatePinner</span>(<span class="params">clsName,prefix</span>)&#123;</span><br><span class="line">            <span class="comment">// prefix=Okhttp3.</span></span><br><span class="line">			<span class="comment">// CertificatePinner类</span></span><br><span class="line">            <span class="keyword">if</span>(!clsName.<span class="title function_">startsWith</span>(prefix))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">indexOf</span>(<span class="string">&quot;$&quot;</span>) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(clsName.<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>).<span class="property">length</span> != <span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> cls = <span class="title class_">Java</span>.<span class="title function_">use</span>(clsName)</span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">isInterface</span>())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getInterfaces</span>().<span class="property">length</span> &gt; <span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">         </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>().<span class="property">length</span> &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span>(cls.<span class="property">class</span>.<span class="title function_">getSuperclass</span>().<span class="title function_">getName</span>() != <span class="string">&quot;java.lang.Object&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 类属性是否有Final</span></span><br><span class="line">            <span class="keyword">if</span>(!<span class="title class_">Modifier</span>.<span class="title function_">isFinal</span>(cls.<span class="property">class</span>.<span class="title function_">getModifiers</span>()))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> flag = <span class="literal">false</span></span><br><span class="line">			<span class="comment">// 获得所有方法，然后遍历</span></span><br><span class="line">            <span class="keyword">var</span> methods = cls.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">                <span class="keyword">var</span> method = methods[i]</span><br><span class="line">				<span class="comment">// 过滤方法没有参数的</span></span><br><span class="line">                <span class="keyword">if</span>(method.<span class="title function_">getParameterCount</span>() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                &#125;</span><br><span class="line">				<span class="comment">// 方法的第一个参数是java.security.cert.Certificate</span></span><br><span class="line">                <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;java.security.cert.Certificate&quot;</span>)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">            flag = <span class="literal">false</span></span><br><span class="line">			<span class="comment">// 获取类的所有成员变量</span></span><br><span class="line">            <span class="keyword">var</span> fields = cls.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>()</span><br><span class="line">			<span class="comment">// 类包含set集合</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; fields.<span class="property">length</span>; k++)&#123;</span><br><span class="line">                <span class="keyword">var</span> field = fields[k];</span><br><span class="line">                <span class="keyword">if</span>(field.<span class="title function_">getType</span>().<span class="title function_">getName</span>() == <span class="string">&quot;java.util.Set&quot;</span>)&#123;</span><br><span class="line">                    flag = <span class="literal">true</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!flag) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(clsName)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classesNames.<span class="property">length</span>; i++)&#123;</span><br><span class="line">			<span class="comment">// 如果类名是OkhttpClient，就保存为变量</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">isOkhttpClient</span>(classesNames[i]))&#123;</span><br><span class="line">                <span class="title class_">OkhttpClientClassName</span> = classesNames[i]</span><br><span class="line">                <span class="comment">//console.log(OkhttpClientClassName)</span></span><br><span class="line">                <span class="keyword">var</span> splits = classesNames[i].<span class="title function_">split</span>(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                <span class="keyword">var</span> len = splits.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len-<span class="number">1</span>; j++)&#123;</span><br><span class="line">					<span class="comment">// Okhttp3.OkHttpClient</span></span><br><span class="line">                    prefix = prefix + splits[j] + <span class="string">&#x27;.&#x27;</span>  <span class="comment">// 当前包名的一个前缀，prefix=Okhttp3.</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 找CertificatePinner类</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; classesNames.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_">isCertificatePinner</span>(classesNames[i],prefix))&#123;</span><br><span class="line">                <span class="title class_">CertificatePinnerClassName</span> = classesNames[i]</span><br><span class="line">                <span class="comment">//console.log(CertificatePinnerClassName)</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Found Class: &quot;</span>+classesNames.<span class="property">length</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Okhttp&#x27;s package prefix: &quot;</span>+prefix)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Find the OkhttpClient: &quot;</span>+<span class="title class_">OkhttpClientClassName</span>)</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Find the OkhttpCertificatePinner: &quot;</span>+<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title class_">OkhttpClientClassName</span> == <span class="string">&quot;&quot;</span> || <span class="title class_">CertificatePinnerClassName</span> == <span class="string">&quot;&quot;</span> || prefix == <span class="string">&quot;&quot;</span>)&#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Can&#x27;t find the okhttp class&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hook</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>)&#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">Modifier</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.reflect.Modifier&quot;</span>)</span><br><span class="line">        <span class="comment">//TrustAllManager，自定义类，hook方法置空，什么都不干</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">TrustAllManagerClass</span> = <span class="title class_">Java</span>.<span class="title function_">registerClass</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;TrustAllManager&quot;</span>,</span><br><span class="line">            <span class="attr">implements</span>:[<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.X509TrustManager&quot;</span>)],</span><br><span class="line">            <span class="attr">methods</span>: &#123;</span><br><span class="line">                <span class="title function_">checkClientTrusted</span>(<span class="params">chain, authType</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;checkClientTrusted Called!!&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">checkServerTrusted</span>(<span class="params">chain, authType</span>) &#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;checkServerTrusted Called!!&quot;</span>)</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="title function_">getAcceptedIssuers</span>(<span class="params"></span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> [];</span><br><span class="line">                &#125;,</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> trustAllManagerHandle = <span class="title class_">TrustAllManagerClass</span>.$new()</span><br><span class="line">		<span class="comment">// 仿造</span></span><br><span class="line">		<span class="comment">// SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);</span></span><br><span class="line">        <span class="comment">// context.init(null, trustManagers ,new SecureRandom());</span></span><br><span class="line">        <span class="comment">// SSLSocketFactory factory = context.getSocketFactory();</span></span><br><span class="line">        <span class="keyword">var</span> sslContext = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.SSLContext&quot;</span>).<span class="title function_">getInstance</span>(<span class="string">&quot;TLS&quot;</span>)</span><br><span class="line">        sslContext.<span class="title function_">init</span>(<span class="literal">null</span>,<span class="title class_">Java</span>.<span class="title function_">array</span>(<span class="string">&quot;Ljavax.net.ssl.X509TrustManager;&quot;</span>,[trustAllManagerHandle]),<span class="literal">null</span>)</span><br><span class="line">        <span class="keyword">var</span> sslSocketFactory = sslContext.<span class="title function_">getSocketFactory</span>()</span><br><span class="line"></span><br><span class="line">        <span class="comment">//HostnameVerify，自定义类</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">MyHostnameVerify</span> = <span class="title class_">Java</span>.<span class="title function_">registerClass</span>(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;MyHostnameVerify&quot;</span>,</span><br><span class="line">            <span class="attr">implements</span>:[<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;javax.net.ssl.HostnameVerifier&quot;</span>)],</span><br><span class="line">            <span class="attr">methods</span>: &#123;</span><br><span class="line">                <span class="title function_">verify</span>(<span class="params">hostname, session</span>)&#123;</span><br><span class="line">                    <span class="variable language_">console</span>.<span class="title function_">log</span>(hostname)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">var</span> myHostnameVerifyHandle = <span class="title class_">MyHostnameVerify</span>.$new()</span><br><span class="line">		</span><br><span class="line">		<span class="comment">// 已经拿到okhttp3.OkHttpClient，拿它的内部类builder</span></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">BuilderClassName</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">OkhttpClientClassName</span>).<span class="property">class</span>.<span class="title function_">getDeclaredClasses</span>()[<span class="number">0</span>].<span class="title function_">getName</span>()</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">OkhttpClient</span>$Buidler = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">BuilderClassName</span>)</span><br><span class="line">		<span class="comment">// 通过反射获取builder的所有方法</span></span><br><span class="line">        <span class="keyword">var</span> methods = <span class="title class_">OkhttpClient</span>$Buidler.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> method = methods[i]</span><br><span class="line">			<span class="comment">// 过滤方法没有参数的，目标方法都有参数</span></span><br><span class="line">			<span class="comment">// builder.sslSocketFactory(factory, (X509TrustManager) trustManagers[0]);</span></span><br><span class="line">			<span class="comment">// builder.certificatePinner(cerBuilder.build());</span></span><br><span class="line">			<span class="comment">// builder.hostnameVerifier(new HostnameVerifier()&#123;&#125;)；</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterCount</span>() &lt; <span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第一道校验，第一个参数的类名是javax.net.ssl.SSLSocketFactory就进行hook，参数替换为自定义参数</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;javax.net.ssl.SSLSocketFactory&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> sslSocketFacotryMethodName  = method.<span class="title function_">getName</span>()</span><br><span class="line">				<span class="comment">// 获取该方法的重载个数</span></span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[sslSocketFacotryMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">				<span class="comment">// 遍历重载</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[sslSocketFacotryMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">SSLSocketFactory</span>)&#123;</span><br><span class="line">						<span class="comment">// 把参数替换为自定义的类</span></span><br><span class="line">                        <span class="variable language_">arguments</span>[<span class="number">0</span>] = sslSocketFactory</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[sslSocketFacotryMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(sslSocketFacotryMethodName,<span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第三道校验，第一个参数是javax.net.ssl.HostnameVerifier就进行hook，参数替换为自定义参数</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="string">&quot;javax.net.ssl.HostnameVerifier&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> hostnameVerifierMethodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[hostnameVerifierMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[hostnameVerifierMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">hostnameVerifier</span>)&#123;</span><br><span class="line">                        <span class="variable language_">arguments</span>[<span class="number">0</span>] = myHostnameVerifyHandle</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[hostnameVerifierMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(hostnameVerifierMethodName, <span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">			<span class="comment">// 第二到校验，参数替换为它默认的，builder.certificatePinner(cerBuilder.build());</span></span><br><span class="line">			<span class="comment">// 默认public static final CertificatePinner DEFAULT = new Builder().build();</span></span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getParameterTypes</span>()[<span class="number">0</span>].<span class="title function_">getName</span>() == <span class="title class_">CertificatePinnerClassName</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> <span class="title class_">CertificatePinnerClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line">                <span class="keyword">var</span> certificatePinnerMethodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                <span class="keyword">var</span> len = <span class="title class_">OkhttpClient</span>$Buidler[certificatePinnerMethodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; len; j++)&#123;</span><br><span class="line">                    <span class="title class_">OkhttpClient</span>$Buidler[certificatePinnerMethodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;certificatePinner add called!&quot;</span>)</span><br><span class="line">						<span class="comment">// 拿到所有的域，遍历</span></span><br><span class="line">                        <span class="keyword">var</span> fields = <span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredFields</span>()</span><br><span class="line">                        <span class="keyword">for</span>(<span class="keyword">var</span> k = <span class="number">0</span>; k &lt; fields.<span class="property">length</span>; k++)&#123;</span><br><span class="line">                            <span class="keyword">var</span> field = fields[k];</span><br><span class="line">                            <span class="keyword">var</span> modifiers = field.<span class="title function_">getModifiers</span>()</span><br><span class="line">							<span class="comment">// public static final CertificatePinner DEFAULT = new Builder().build();</span></span><br><span class="line">                            <span class="keyword">if</span>(<span class="title class_">Modifier</span>.<span class="title function_">isFinal</span>(modifiers) &amp;&amp; <span class="title class_">Modifier</span>.<span class="title function_">isStatic</span>(modifiers) &amp;&amp; <span class="title class_">Modifier</span>.<span class="title function_">isPublic</span>(modifiers))&#123;</span><br><span class="line">                                <span class="variable language_">arguments</span>[<span class="number">0</span>] = field.<span class="title function_">get</span>(<span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="variable language_">this</span>[certificatePinnerMethodName].<span class="title function_">apply</span>(<span class="variable language_">this</span>,<span class="variable language_">arguments</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>( method.<span class="title function_">getName</span>(),<span class="string">&quot;Hooked!&quot;</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">CertificatePinnerClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="title class_">CertificatePinnerClassName</span>)</span><br><span class="line">        <span class="keyword">var</span> methods = <span class="title class_">CertificatePinnerClass</span>.<span class="property">class</span>.<span class="title function_">getDeclaredMethods</span>()</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; methods.<span class="property">length</span>; i++)&#123;</span><br><span class="line">            <span class="keyword">var</span> method = methods[i]</span><br><span class="line">            <span class="keyword">if</span>(method.<span class="title function_">getReturnType</span>().<span class="title function_">getName</span>() == <span class="string">&#x27;void&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">var</span> methodName = method.<span class="title function_">getName</span>()</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(methodName+<span class="string">&quot; Hooked!&quot;</span>)</span><br><span class="line">                <span class="keyword">var</span> m_len = <span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>.<span class="property">length</span></span><br><span class="line">                </span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; m_len; j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>[j].<span class="property">returnType</span>.<span class="property">name</span> == <span class="string">&#x27;V&#x27;</span>)&#123;</span><br><span class="line">                        <span class="title class_">CertificatePinnerClass</span>[methodName].<span class="property">overloads</span>[j].<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">                            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;certificatePinner check called!&quot;</span>)</span><br><span class="line">                        &#125;   </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">		</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title function_">loadOkhttpClient</span>()</span><br><span class="line">    <span class="title function_">loadClasses</span>()</span><br><span class="line">    <span class="title function_">findOkhttpClass</span>()</span><br><span class="line">    <span class="title function_">hook</span>()</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>抓包进阶之双端校验</title>
    <url>/2021/09/02/%E6%8A%93%E5%8C%85%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%8F%8C%E7%AB%AF%E6%A0%A1%E9%AA%8C/</url>
    <content><![CDATA[<p>挂上vpn，打开charles抓包可以看到没网络，但是可以抓到包，怀疑是服务器校验客户端证书了<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/01.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/02.webp"
                     
                ><br>这里推荐一下肉老师的文章 <a class="link"   href="https://www.anquanke.com/post/id/197657" >https://www.anquanke.com/post/id/197657<i class="fas fa-external-link-alt"></i></a><br>引用里面一张图<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/03.webp"
                     
                ><br>原本服务器校验的是app的证书，但是挂上charles，服务器校验的是charles的证书，一匹配发现不是app的证书，就返回网络失败，所以我们要将app中内置的证书导入到Charles中去。<br>这个操作通常需要完成两项内容：</p>
<ol>
<li>找到证书文件</li>
<li>找到证书密码<br>首先找证书文件，直接对apk进行解包，直接过滤搜索后缀名为p12的文件即可，一般常用的命令为<strong>tree -NCfhl |grep -i p12</strong>，直接打印出p12文件的路径</li>
</ol>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/04.webp"
                     
                ><br>找证书密码一般解密会调用现成的API，<strong>java.security.KeyStore</strong> ，直接使用frida打印出来，<br>也可以hook系统文件库，这里直接使用现成的代码，</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hook_KeyStore_load</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">StringClass</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.String&quot;</span>);</span><br><span class="line">        <span class="keyword">var</span> <span class="title class_">KeyStore</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.security.KeyStore&quot;</span>);</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.security.KeyStore$LoadStoreParameter&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load1:&quot;</span>, arg0);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="title class_">KeyStore</span>.<span class="property">load</span>.<span class="title function_">overload</span>(<span class="string">&#x27;java.io.InputStream&#x27;</span>, <span class="string">&#x27;[C&#x27;</span>).<span class="property">implementation</span> = <span class="keyword">function</span> (<span class="params">arg0, arg1</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Throwable&quot;</span>).$new()));</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;KeyStore.load2:&quot;</span>, arg0, arg1 ? <span class="title class_">StringClass</span>.$new(arg1) : <span class="literal">null</span>);</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">load</span>(arg0, arg1);</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;hook_KeyStore_load...&quot;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">setImmediate</span>(hook_KeyStore_load)</span><br></pre></td></tr></table></figure>
<p>使用spawn的模式启动，密码一下子就吐出来了<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/05.webp"
                     
                ><br>把证书导入到charles，并输入刚才的密码<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/06.webp"
                     
                ><br>再次抓包试试，这次页面跳转了，请求也是正常了<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/07.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210902/08.webp"
                     
                ></p>
]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>Hook抓包</title>
    <url>/2021/09/01/Hook%E6%8A%93%E5%8C%85/</url>
    <content><![CDATA[<p>Hook抓包核心思想：数据包在明文状态下的一切时机进行dump</p>
<h1 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h1><h2 id="request"><a href="#request" class="headerlink" title="request"></a>request</h2><p>使用socket实现原生的请求<br>新建一个安卓项目，在mainactivity里添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainActivity</span> <span class="keyword">extends</span> <span class="title class_">AppCompatActivity</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">Runnable</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                httpsock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">httpsock</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;www.httpbin.org&quot;</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">80</span>;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/get&quot;</span>;</span><br><span class="line">            <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>(host, port);</span><br><span class="line"></span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            sb.append(<span class="string">&quot;GET &quot;</span> + path + <span class="string">&quot; HTTP/1.1\r\n&quot;</span>);</span><br><span class="line">            sb.append(<span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36\r\n&quot;</span>);</span><br><span class="line">            sb.append(<span class="string">&quot;Host: &quot;</span>+ host+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">            sb.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">            outputStream.write(sb.toString().getBytes());</span><br><span class="line"></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">            <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">            <span class="type">int</span> len;</span><br><span class="line">            <span class="keyword">while</span> ((len = inputStream.read(buffer, <span class="number">0</span>, buffer.length)) != -<span class="number">1</span>)&#123;</span><br><span class="line">                Log.d(<span class="string">&quot;response==&gt;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(Arrays.copyOf(buffer, len)));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行一下<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/01.webp"
                     
                ></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><p>这是socket发送http请求的数据包，把数据包写进outputStream后进行发送，outputStream是socket对象的方法，先看一下socket的实现。跟进一下socket的实现</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/02.webp"
                     
                ></p>
<p>这些都是实现的接口，要找到实现的地方，跟进setImpl方法</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/03.webp"
                     
                ></p>
<p>可以看到impl是实例对象，这里有分支，先看一下factory，在该文件搜索factory &#x3D; ，看被什么赋值了，</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/04.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/05.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/06.webp"
                     
                ><br>看到两次赋值的值都是null，所以走else，跟进 SocksSocketImpl();，这里就到socket实现的地方。</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/07.webp"
                     
                ></p>
<p>进行搜索getOutputStream()方法实现的地方，发现没有找到，那就是存在父类了，跟进父类PlainSocketImpl。<br>再次搜索没有，再跟进它的父类AbstractPlainSocketImpl</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/08.webp"
                     
                ></p>
<p>再搜索，发现找到了getOutputStream()实现的地方，两个if都是抛出异常，看第三个if，跟进SocketOutputStream()，</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/09.webp"
                     
                ><br>找到了SocketOutputStream()对象的地方，搜索write()方法，参数是字节</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/10.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/11.webp"
                     
                ><br>跟进socketWrite()，调用了socketWrite0()方法，跟进</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/12.webp"
                     
                ><br>可以看到该方法在native层。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/13.webp"
                     
                ></p>
<h3 id="frida抓包"><a href="#frida抓包" class="headerlink" title="frida抓包"></a>frida抓包</h3><p>跟到socketWrite0()这里，应该是java层最底层了，hook socketWrite0尝试下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//Http request</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.net.SocketOutputStream&quot;</span>).<span class="property">socketWrite0</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">fd,bytes,off,len</span>)&#123;</span><br><span class="line">            <span class="title function_">hexdump</span>(bytes,off,len)</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">socketWrite0</span>(fd,bytes,off,len)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// 打印字节数组</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">hexdump</span>(<span class="params">bytearry,offset,length</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">HexDump</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.internal.util.HexDump&quot;</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">HexDump</span>.<span class="title function_">dumpHexString</span>(bytearry,offset,length))</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>运行frida，运行脚本，成功抓到包<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/14.webp"
                     
                ><br>再完善一下，添加请求地址，堆栈</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//Http request</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.net.SocketOutputStream&quot;</span>).<span class="property">socketWrite0</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">fd,bytes,off,len</span>)&#123;</span><br><span class="line">            <span class="comment">// 地址</span></span><br><span class="line">            <span class="title function_">printAddress</span>(<span class="variable language_">this</span>.<span class="property">socket</span>, <span class="literal">true</span>)</span><br><span class="line">            <span class="comment">// 请求</span></span><br><span class="line">            <span class="title function_">hexdump</span>(bytes,off,len)</span><br><span class="line">            <span class="comment">// 堆栈</span></span><br><span class="line">            <span class="title function_">showStacks</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">socketWrite0</span>(fd,bytes,off,len)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">printAddress</span>(<span class="params">socket, isSend</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> localAddress = socket.<span class="property">value</span>.<span class="title function_">getLocalAddress</span>().<span class="title function_">toString</span>()</span><br><span class="line">            <span class="keyword">var</span> remoteAddress = socket.<span class="property">value</span>.<span class="title function_">getRemoteSocketAddress</span>().<span class="title function_">toString</span>()</span><br><span class="line">            <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(localAddress +<span class="string">&quot;====&gt;&quot;</span>+ remoteAddress)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable language_">console</span>.<span class="title function_">log</span>(remoteAddress +<span class="string">&quot;====&gt;&quot;</span>+ localAddress)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">hexdump</span>(<span class="params">bytearry,offset,length</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">HexDump</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.internal.util.HexDump&quot;</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">HexDump</span>.<span class="title function_">dumpHexString</span>(bytearry,offset,length))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>请求地址，堆栈都打印了<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/15.webp"
                     
                ><br>现在知识完成request部分，还有response</p>
<h2 id="response"><a href="#response" class="headerlink" title="response"></a>response</h2><h3 id="分析-1"><a href="#分析-1" class="headerlink" title="分析"></a>分析</h3><p>接受数据是InputStream，调用的是socket的getInputStream，getInputStream和getOuputStream是成对出现的，按着刚才的思路可以找到。或者，socketWrite0()是在SocketOutputStream，那么socketRead0()就是在SocketInputStream里。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/16.webp"
                     
                ></p>
<h3 id="frida抓包-1"><a href="#frida抓包-1" class="headerlink" title="frida抓包"></a>frida抓包</h3><p>用Frida hook试试，再之前的代码上添加</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Http response</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.net.SocketInputStream&quot;</span>).<span class="property">socketRead0</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">fd,bytes,off,len,timeout</span>)&#123;</span><br><span class="line">    <span class="title function_">printAddress</span>(<span class="variable language_">this</span>.<span class="property">socket</span>, <span class="literal">true</span>)</span><br><span class="line">    <span class="title function_">hexdump</span>(bytes,off,len)</span><br><span class="line">    <span class="title function_">showStacks</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">socketRead0</span>(fd,bytes,off,len,timeout)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也是成功抓到返回的数据<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/17.webp"
                     
                ><br>HTTP通用的收发包都抓到了，那HTTPS的呢</p>
<h1 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h1><h2 id="request-1"><a href="#request-1" class="headerlink" title="request"></a>request</h2><p>也是一样，创建一个HTTPS的请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">host</span> <span class="operator">=</span> <span class="string">&quot;www.httpbin.org&quot;</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">int</span> <span class="variable">port</span> <span class="operator">=</span> <span class="number">443</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="type">String</span> <span class="variable">path</span> <span class="operator">=</span> <span class="string">&quot;/get&quot;</span>;</span><br><span class="line">    <span class="type">SSLSocketFactory</span> <span class="variable">sslSocketFactory</span> <span class="operator">=</span> (SSLSocketFactory) SSLSocketFactory.getDefault();</span><br><span class="line">    <span class="type">SSLSocket</span> <span class="variable">socket</span> <span class="operator">=</span> (SSLSocket) sslSocketFactory.createSocket(host, port);</span><br><span class="line"></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    sb.append(<span class="string">&quot;GET &quot;</span> + path + <span class="string">&quot; HTTP/1.1\r\n&quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.159 Safari/537.36\r\n&quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;Host: &quot;</span>+ host+<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    sb.append(<span class="string">&quot;\r\n&quot;</span>);</span><br><span class="line">    Log.d(<span class="string">&quot;request body ===&gt;&quot;</span>, sb.toString());</span><br><span class="line"></span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">outputStream</span> <span class="operator">=</span> socket.getOutputStream();</span><br><span class="line">    outputStream.write(sb.toString().getBytes());</span><br><span class="line"></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> socket.getInputStream();</span><br><span class="line">    <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span>];</span><br><span class="line">    <span class="type">int</span> len;</span><br><span class="line">    <span class="keyword">while</span> ((len = inputStream.read(buffer, <span class="number">0</span>, buffer.length)) != -<span class="number">1</span>)&#123;</span><br><span class="line">        Log.d(<span class="string">&quot;response ==&gt;&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>(Arrays.copyOf(buffer, len)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行之后<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/18.webp"
                     
                ></p>
<h3 id="分析-2"><a href="#分析-2" class="headerlink" title="分析"></a>分析</h3><p>这里使用调试，可以快速定位到对象类的位置，<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/19.webp"
                     
                ><br>在源码中搜一下ConscryptFileDescriptorSocket<br>网址：<a class="link"   href="http://aospxref.com/android-8.1.0_r81/" >http://aospxref.com/android-8.1.0_r81/<i class="fas fa-external-link-alt"></i></a><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/20.webp"
                     
                ><br>然后在源码文件搜索内部类SSLOutputStream，是继承OutputStream，然后对原来的write方法进行重写<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/21.webp"
                     
                ><br>跟踪一下write方法里的ssl.write()<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/22.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/23.webp"
                     
                ><br>再跟踪NativeCrypto.SSL_write()，又到了native层，可以说已经在java层跟到底了<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/24.webp"
                     
                ></p>
<h3 id="frida抓包-2"><a href="#frida抓包-2" class="headerlink" title="frida抓包"></a>frida抓包</h3><p>用frida hook下org.conscrypt.NativeCrypto类下的SSL_write()方法</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">main</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="title class_">Java</span>.<span class="title function_">perform</span>(<span class="keyword">function</span>(<span class="params"></span>)&#123;</span><br><span class="line">        <span class="comment">//Https request</span></span><br><span class="line">        <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;org.conscrypt.NativeCrypto&quot;</span>).<span class="property">SSL_write</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">ssl,fd,shc,bytes,off,len,timeout</span>)&#123;</span><br><span class="line">            <span class="title function_">hexdump</span>(bytes,off,len)</span><br><span class="line">            <span class="title function_">showStacks</span>()</span><br><span class="line">            <span class="variable language_">this</span>.<span class="title function_">SSL_write</span>(ssl,fd,shc,bytes,off,len,timeout)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// 打印字节数组</span></span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">hexdump</span>(<span class="params">bytearry,offset,length</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> <span class="title class_">HexDump</span> = <span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.internal.util.HexDump&quot;</span>)</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">HexDump</span>.<span class="title function_">dumpHexString</span>(bytearry,offset,length))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">function</span> <span class="title function_">showStacks</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;android.util.Log&quot;</span>).<span class="title function_">getStackTraceString</span>(<span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">setImmediate</span>(main)</span><br></pre></td></tr></table></figure>
<p>运行会看到报错了，说找不到NativeCrypto这个类<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/25.webp"
                     
                ><br>使用objection看一下，内存中是否存在NativeCrypto，多加了com.android前缀，再用frida试一下com.android.org.conscrypt.NativeCrypto<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/26.webp"
                     
                ><br>这次成功抓到包<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/27.webp"
                     
                ></p>
<h2 id="response-1"><a href="#response-1" class="headerlink" title="response"></a>response</h2><p>response同理<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/28.webp"
                     
                ></p>
<h3 id="frida抓包-3"><a href="#frida抓包-3" class="headerlink" title="frida抓包"></a>frida抓包</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Https response</span></span><br><span class="line"><span class="title class_">Java</span>.<span class="title function_">use</span>(<span class="string">&quot;com.android.org.conscrypt.NativeCrypto&quot;</span>).<span class="property">SSL_read</span>.<span class="property">implementation</span> = <span class="keyword">function</span>(<span class="params">ssl,fd,shc,bytes,off,len,timeout</span>)&#123;</span><br><span class="line">    <span class="title function_">hexdump</span>(bytes,off,len)</span><br><span class="line">    <span class="title function_">showStacks</span>()</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">SSL_read</span>(ssl,fd,shc,bytes,off,len,timeout)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210901/29.webp"
                     
                ></p>
<h1 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">function main()&#123;</span><br><span class="line">    Java.perform(function()&#123;</span><br><span class="line">        //Http request</span><br><span class="line">        Java.use(<span class="string">&quot;java.net.SocketOutputStream&quot;</span>).socketWrite0.implementation = function(fd,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)&#123;</span><br><span class="line">            printAddress(this.socket, true)</span><br><span class="line">            hexdump(<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)</span><br><span class="line">            showStacks()</span><br><span class="line">            this.socketWrite0(fd,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        //Http response</span><br><span class="line">        Java.use(<span class="string">&quot;java.net.SocketInputStream&quot;</span>).socketRead0.implementation = function(fd,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)&#123;</span><br><span class="line">            printAddress(this.socket, false)</span><br><span class="line">            hexdump(<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)</span><br><span class="line">            showStacks()</span><br><span class="line">            <span class="keyword">return</span> this.socketRead0(fd,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //Https request</span><br><span class="line">        Java.use(<span class="string">&quot;com.android.org.conscrypt.NativeCrypto&quot;</span>).SSL_write.implementation = function(sslNativePointer,fd,shc,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)&#123;</span><br><span class="line">            printHttpsAddress(fd)</span><br><span class="line">            hexdump(<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)</span><br><span class="line">            showStacks()</span><br><span class="line">            <span class="keyword">return</span> this.SSL_write(sslNativePointer,fd,shc,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)</span><br><span class="line">        &#125;</span><br><span class="line">        //Https response</span><br><span class="line">        Java.use(<span class="string">&quot;com.android.org.conscrypt.NativeCrypto&quot;</span>).SSL_read.implementation = function(sslNativePointer,fd,shc,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)&#123;</span><br><span class="line">            printHttpsAddress(fd)</span><br><span class="line">            hexdump(<span class="built_in">bytes</span>,off,<span class="built_in">len</span>)</span><br><span class="line">            showStacks()</span><br><span class="line">            <span class="keyword">return</span> this.SSL_read(sslNativePointer,fd,shc,<span class="built_in">bytes</span>,off,<span class="built_in">len</span>,timeout)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function printHttpsAddress(fd, isSend)&#123;</span><br><span class="line">            var local = Socket.localAddress(fd.getInt$())</span><br><span class="line">            var peer = Socket.peerAddress(fd.getInt$())</span><br><span class="line">            <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">                console.log(local.ip+<span class="string">&quot;:&quot;</span>+local.port +<span class="string">&quot;====&gt;&quot;</span>+ peer.ip+<span class="string">&quot;:&quot;</span>+peer.port)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(peer.ip+<span class="string">&quot;:&quot;</span>+peer.port +<span class="string">&quot;====&gt;&quot;</span>+ local.ip+<span class="string">&quot;:&quot;</span>+local.port)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function printAddress(socket, isSend)&#123;</span><br><span class="line">            var localAddress = socket.value.getLocalAddress().toString()</span><br><span class="line">            var remoteAddress = socket.value.getRemoteSocketAddress().toString()</span><br><span class="line">            <span class="keyword">if</span>(isSend)&#123;</span><br><span class="line">                console.log(localAddress +<span class="string">&quot;====&gt;&quot;</span>+ remoteAddress)</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                console.log(remoteAddress +<span class="string">&quot;====&gt;&quot;</span>+ localAddress)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        function hexdump(bytearry,offset,length)&#123;</span><br><span class="line">            var HexDump = Java.use(<span class="string">&quot;com.android.internal.util.HexDump&quot;</span>)</span><br><span class="line">            console.log(HexDump.dumpHexString(bytearry,offset,length))</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        function showStacks() &#123;</span><br><span class="line">            console.log(Java.use(<span class="string">&quot;android.util.Log&quot;</span>).getStackTraceString(Java.use(<span class="string">&quot;java.lang.Exception&quot;</span>).$new()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">setImmediate(main)</span><br></pre></td></tr></table></figure>]]></content>
      <tags>
        <tag>抓包</tag>
      </tags>
  </entry>
  <entry>
    <title>Frida&amp;反调试&amp;反反调试</title>
    <url>/2021/08/01/Frida-%E5%8F%8D%E8%B0%83%E8%AF%95-%E5%8F%8D%E5%8F%8D%E8%B0%83%E8%AF%95/</url>
    <content><![CDATA[<h3 id="操作Frida的两种模式：命令，rpc"><a href="#操作Frida的两种模式：命令，rpc" class="headerlink" title="操作Frida的两种模式：命令，rpc"></a>操作Frida的两种模式：命令，rpc</h3><h3 id="Frida两种操作APP模式：spawn，attach"><a href="#Frida两种操作APP模式：spawn，attach" class="headerlink" title="Frida两种操作APP模式：spawn，attach"></a>Frida两种操作APP模式：spawn，attach</h3><p>attach：应用运行中hook，有壳也是没问题的<br />spawn：创建进程时就hook，有壳的话就不行</p>
<h3 id="反调试Frida"><a href="#反调试Frida" class="headerlink" title="反调试Frida"></a>反调试Frida</h3><p>1.查看&#x2F;data&#x2F;local&#x2F;usr是否firda文件<br />2.端口20742是否开启<br />3.进程中是否有frida<br />4.检测内存trate是否开启，因为frida调试会显示true，解决方法：使用spawn模式hook检测trate的方法，返回false</p>
<h3 id="三板斧："><a href="#三板斧：" class="headerlink" title="三板斧："></a>三板斧：</h3><ol>
<li>先hook、看参数和返回值：定位：命令行</li>
<li>再构造参数、主动调用：利用：命令行</li>
<li>最后配RPC导出结果：规模化利用：PYTHON</li>
</ol>
<h2 id="作弊检测"><a href="#作弊检测" class="headerlink" title="作弊检测"></a>作弊检测</h2><h4 id="1-检测是否存在危险APP包名"><a href="#1-检测是否存在危险APP包名" class="headerlink" title="1.检测是否存在危险APP包名"></a>1.检测是否存在危险APP包名</h4><p>主要检测hook框架，模拟点击工具，xposed，magisk，supersu等root工具</p>
<h4 id="2-一些设备常规信息，比如电量状态，usb状态，屏幕亮度，地理位置，wifi或者sim卡信息，ip，mac等。"><a href="#2-一些设备常规信息，比如电量状态，usb状态，屏幕亮度，地理位置，wifi或者sim卡信息，ip，mac等。" class="headerlink" title="2.一些设备常规信息，比如电量状态，usb状态，屏幕亮度，地理位置，wifi或者sim卡信息，ip，mac等。"></a>2.一些设备常规信息，比如电量状态，usb状态，屏幕亮度，地理位置，wifi或者sim卡信息，ip，mac等。</h4><p>一般批量操作或者抹机操作的时候这些值更改难度和成本比较大，所以这些指标能伪造会大大降低被风控</p>
<h4 id="3-APP加壳"><a href="#3-APP加壳" class="headerlink" title="3.APP加壳"></a>3.APP加壳</h4><h4 id="4-手机系统usr-x2F-local-x2F-tmp下是否有frida，端口27042是否开着，TracerPid值是否在调试状态（京东9-22）"><a href="#4-手机系统usr-x2F-local-x2F-tmp下是否有frida，端口27042是否开着，TracerPid值是否在调试状态（京东9-22）" class="headerlink" title="4.手机系统usr&#x2F;local&#x2F;tmp下是否有frida，端口27042是否开着，TracerPid值是否在调试状态（京东9.22）"></a>4.手机系统usr&#x2F;local&#x2F;tmp下是否有frida，端口27042是否开着，TracerPid值是否在调试状态（京东9.22）</h4><h4 id="5-参数签名、参数加密，把加密参数放在native层，native层ollvm编译"><a href="#5-参数签名、参数加密，把加密参数放在native层，native层ollvm编译" class="headerlink" title="5.参数签名、参数加密，把加密参数放在native层，native层ollvm编译"></a>5.参数签名、参数加密，把加密参数放在native层，native层ollvm编译</h4><h4 id="6-异常上报sdk"><a href="#6-异常上报sdk" class="headerlink" title="6.异常上报sdk"></a>6.异常上报sdk</h4><p>异常上报sdk一般记录运行时所有的异常情况，并且会记录设备指纹，通过这些也能检测到作弊的一些设备。</p>
<h4 id="7-私有网络协议、protobuf等协议、私有网络证书、反代理抓包"><a href="#7-私有网络协议、protobuf等协议、私有网络证书、反代理抓包" class="headerlink" title="7.私有网络协议、protobuf等协议、私有网络证书、反代理抓包"></a>7.私有网络协议、protobuf等协议、私有网络证书、反代理抓包</h4><p>目前比较流行protobuf协议替代json，还有一些私有TCP&#x2F;Socket协议，这些协议不可直接读，需要一个解析工具或者分析还原。私有网络证书需要证书密钥配合代理抓包工具才能抓包分析，这种其实难度在于找到证书密钥和判断是否用了私有证书，一般聊天APP的IM协议常用。还有反代理抓包，比如集成OkHttp框架等的时候用Proxy.NO_Proxy来防止抓包。</p>
<h2 id="反反作弊方法及思路"><a href="#反反作弊方法及思路" class="headerlink" title="反反作弊方法及思路"></a>反反作弊方法及思路</h2><h4 id="1-搜集设备指纹"><a href="#1-搜集设备指纹" class="headerlink" title="1.搜集设备指纹"></a>1.搜集设备指纹</h4><p>如数美易盾或者一些大的app都会内嵌搜集设备指纹的模块，通过设备指纹来确定设备的唯一性，如imei、android_id、mac、其他设备信息结合起来就能变成一个唯一的标志。</p>
<h4 id="2-搜集IP、MAC地址、蓝牙MAC、WIFI等网络指纹"><a href="#2-搜集IP、MAC地址、蓝牙MAC、WIFI等网络指纹" class="headerlink" title="2.搜集IP、MAC地址、蓝牙MAC、WIFI等网络指纹"></a>2.搜集IP、MAC地址、蓝牙MAC、WIFI等网络指纹</h4><p>大量的搜集后跟其他搜集的信息结合并且不断地完善代理ip和黑ip、mac库，就能不断地能识别作弊源头。</p>
<h4 id="3-地理位置、下载渠道、授权登录"><a href="#3-地理位置、下载渠道、授权登录" class="headerlink" title="3.地理位置、下载渠道、授权登录"></a>3.地理位置、下载渠道、授权登录</h4><p>地理位置和ip是否对应、基站信息是否对应、或者设备型号跟下载渠道对应、一般小米手机的软件大部分应该小米商城下载的，比如微信授权登录，QQ授权登录等、如果模拟授权登录需要破解其他给权的APP的一些协议。</p>
<h4 id=""><a href="#" class="headerlink" title=""></a><a href="https://bbs.pediy.com/thread-263203.htm#5.%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E3%80%81protobuf%E7%AD%89%E5%8D%8F%E8%AE%AE%E3%80%81%E7%A7%81%E6%9C%89%E7%BD%91%E7%BB%9C%E8%AF%81%E4%B9%A6%E3%80%81%E5%8F%8D%E4%BB%A3%E7%90%86%E6%8A%93%E5%8C%85"><br /></a></h4><h4 id="-1"><a href="#-1" class="headerlink" title=""></a><a href="https://bbs.pediy.com/thread-263203.htm#6.dex%E4%BB%A3%E7%A0%81%E6%B7%B7%E6%B7%86%EF%BC%8Cnative%E5%B1%82ollvm%E7%BC%96%E8%AF%91%E3%80%81webview%E7%9A%84js%E6%B7%B7%E6%B7%86"><br /></a></h4><h2 id="反反作弊工具和策略"><a href="#反反作弊工具和策略" class="headerlink" title="反反作弊工具和策略"></a>反反作弊工具和策略</h2><h4 id="1-逆向工具"><a href="#1-逆向工具" class="headerlink" title="1.逆向工具"></a>1.逆向工具</h4><ul>
<li>java：dex2jar,jadx,jeb,android-killer等等很多</li>
<li>so文件：IDA,jeb,Gidra</li>
<li>js：其实nodejs加谷歌或者火狐就能搞定</li>
<li>其他：unicorn,unidibug等基于qemu虚拟机的工具</li>
</ul>
<h4 id="2-抓包工具"><a href="#2-抓包工具" class="headerlink" title="2.抓包工具"></a>2.抓包工具</h4><ul>
<li>Charles、Fillder：这两个其实差不多，用于http、websocket等应用层抓包</li>
<li>WireShark：各种协议都能支持，需要更深入的网络协议技术基础</li>
<li>BurpSuite：可以开发一些插件，会开发就各种神操作把。</li>
</ul>
<h4 id="3-hook框架"><a href="#3-hook框架" class="headerlink" title="3.hook框架"></a>3.hook框架</h4><ul>
<li>xposed：用户比较多，尤其云控、群控、那些化妆品，教育类、保险等销售类的都在用，市场规模大。</li>
<li>frida：一般开发者使用的多，快，无需重启，会js就会玩吧。</li>
<li>cydia：hook Native层的时候多一点，老开发者用的多。</li>
<li>inlinehook，xhook：这两个类似，inlinehook多用于hook b跳转的，xhook多用于系统函数。</li>
<li>magisk:安卓8以上xposed或者其他一些证书安装等工具都基于这个，这个其实未来深入研究的东西。4.模拟点击</li>
<li>uiautomator ：很多模拟点击软件基于这个，跟xposed结合开发比较合适，理解安卓开发的入门比较简单。</li>
</ul>
<h3 id="5-行业难度"><a href="#5-行业难度" class="headerlink" title="5.行业难度"></a>5.行业难度</h3><ul>
<li>ollvm混淆：逆向行业目前应该最头疼的就这个吧，主要原理时if-else改成while(true){switch() case:}了，但是逆向成本变高了，并且各种延申的东西越来越多，需要经验和技术积累才能100%还原或破解。</li>
</ul>
<h4 id="机器学习风控策略：这个没有多年经验或者没有相当长的时间去摸索或者没跟班一个APP的成长的话很难对应，并且大部分都是通过养号，养设备等方式去对应，还有的是破解协议，并且伪造大量的设备信息，通过IP代理池，卡商和打码平台等第三方服务来维持。不过随着法律的完善和APP自身的风控体系健全对应成本越来越高，现在很难实现大批量账号登录注册。"><a href="#机器学习风控策略：这个没有多年经验或者没有相当长的时间去摸索或者没跟班一个APP的成长的话很难对应，并且大部分都是通过养号，养设备等方式去对应，还有的是破解协议，并且伪造大量的设备信息，通过IP代理池，卡商和打码平台等第三方服务来维持。不过随着法律的完善和APP自身的风控体系健全对应成本越来越高，现在很难实现大批量账号登录注册。" class="headerlink" title="机器学习风控策略：这个没有多年经验或者没有相当长的时间去摸索或者没跟班一个APP的成长的话很难对应，并且大部分都是通过养号，养设备等方式去对应，还有的是破解协议，并且伪造大量的设备信息，通过IP代理池，卡商和打码平台等第三方服务来维持。不过随着法律的完善和APP自身的风控体系健全对应成本越来越高，现在很难实现大批量账号登录注册。"></a>机器学习风控策略：这个没有多年经验或者没有相当长的时间去摸索或者没跟班一个APP的成长的话很难对应，并且大部分都是通过养号，养设备等方式去对应，还有的是破解协议，并且伪造大量的设备信息，通过IP代理池，卡商和打码平台等第三方服务来维持。不过随着法律的完善和APP自身的风控体系健全对应成本越来越高，现在很难实现大批量账号登录注册。</h4><h3 id="检测是否root"><a href="#检测是否root" class="headerlink" title="检测是否root"></a>检测是否root</h3><p><a class="link"   href="https://github.com/sensepost/objection/blob/e7eb1d9b769edf6a98870c75a6d2a6123b7346fd/agent/src/android/root.ts" >https://github.com/sensepost/objection/blob/e7eb1d9b769edf6a98870c75a6d2a6123b7346fd/agent/src/android/root.ts<i class="fas fa-external-link-alt"></i></a><br />通过命令行输入su看是否有返回<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210801/01.webp"
                     
                ></p>
]]></content>
      <tags>
        <tag>frida</tag>
      </tags>
  </entry>
  <entry>
    <title>刷机</title>
    <url>/2021/06/07/%E5%88%B7%E6%9C%BA/</url>
    <content><![CDATA[<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><p><a class="link"   href="https://source.android.com/setup/start/build-numbers" >https://source.android.com/setup/start/build-numbers<i class="fas fa-external-link-alt"></i></a><br /><br><a class="link"   href="https://developers.google.cn/android/images#angler" >https://developers.google.cn/android/images#angler<i class="fas fa-external-link-alt"></i></a><br /><br><a class="link"   href="https://github.com/shadowsocks/shadowsocks-android/tags" >https://github.com/shadowsocks/shadowsocks-android/tags<i class="fas fa-external-link-alt"></i></a><br /><br><a class="link"   href="https://github.com/topjohnwu/Magisk/tags" >https://github.com/topjohnwu/Magisk/tags<i class="fas fa-external-link-alt"></i></a> magisk，下载zip包<br /><br><a class="link"   href="https://eu.dl.twrp.me/angler/twrp-3.3.0-0-angler.img.html" >https://eu.dl.twrp.me/angler/twrp-3.3.0-0-angler.img.html<i class="fas fa-external-link-alt"></i></a>   nexus 6p<br /><br><a class="link"   href="https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img.html" >https://dl.twrp.me/sailfish/twrp-3.3.0-0-sailfish.img.html<i class="fas fa-external-link-alt"></i></a><br /><br><a class="link"   href="https://dl.twrp.me/bullhead/twrp-3.3.1-0-bullhead.img.html" >https://dl.twrp.me/bullhead/twrp-3.3.1-0-bullhead.img.html<i class="fas fa-external-link-alt"></i></a>   nexus 5x<br /><br><a class="link"   href="https://www.kali.org/get-kali/#kali-mobile" >https://www.kali.org/get-kali/#kali-mobile<i class="fas fa-external-link-alt"></i></a>  kali nethunt<br /><br><a class="link"   href="https://www.yuque.com/attachments/yuque/0/2021/zip/2721723/1623051375667-e30dbae1-ff19-4de7-ae0d-e548d0aafd72.zip?_lake_card=%7B%22src%22:%22https://www.yuque.com/attachments/yuque/0/2021/zip/2721723/1623051375667-e30dbae1-ff19-4de7-ae0d-e548d0aafd72.zip%22,%22name%22:%22SR5-SuperSU-v2.82-SR5-20171001224502.zip%22,%22size%22:6882992,%22type%22:%22application/x-zip-compressed%22,%22ext%22:%22zip%22,%22source%22:%22%22,%22status%22:%22done%22,%22mode%22:%22title%22,%22download%22:true,%22taskId%22:%22ubc411615-ad75-48a2-bfc5-69d86794e36%22,%22taskType%22:%22upload%22,%22id%22:%22ua8322ffd%22,%22card%22:%22file%22%7D" >SR5-SuperSU-v2.82-SR5-20171001224502.zip<i class="fas fa-external-link-alt"></i></a>  超级授权<br /></p>
<h3 id="nexus-6p刷安卓8"><a href="#nexus-6p刷安卓8" class="headerlink" title="nexus 6p刷安卓8"></a>nexus 6p刷安卓8</h3><p>下载刷机包</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">wget <span class="attr">https</span>:<span class="comment">//dl.google.com/dl/android/aosp/angler-opm1.171019.011-factory-39448337.zip</span></span><br></pre></td></tr></table></figure>
<p>解压</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">7z x angler-opm1<span class="number">.171019</span><span class="number">.011</span>-factory-<span class="number">39448337.</span>zip</span><br></pre></td></tr></table></figure>
<p>手机关机，先按住音量键下+电源键，进入reboot<br /><br>进入解压后的刷机包，运行</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">./flash-all.<span class="property">sh</span></span><br></pre></td></tr></table></figure>
<p>等待过程，显示下图则成功</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/01.webp"
                     
                ></p>
<h3 id="刷入SuperSU（Android-8）"><a href="#刷入SuperSU（Android-8）" class="headerlink" title="刷入SuperSU（Android 8）"></a>刷入SuperSU（Android 8）</h3><p>连上数据线，开启开发者模式<br /><br>运行命令</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">adb push <span class="title class_">SR5</span>-<span class="title class_">SuperSU</span>-v2<span class="number">.82</span>-<span class="title class_">SR5</span>-<span class="number">20171001224502.</span>zip /sdcard/<span class="title class_">Download</span></span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">adb reboot bootloader </span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">fastboot flash recovery twrp-<span class="number">3.3</span><span class="number">.0</span>-<span class="number">0</span>-angler.<span class="property">img</span></span><br></pre></td></tr></table></figure>
<p>音量键向下按两次，进入recovery mode<br /><br>向右划<br /><br>选择install<br /><br>进入Download 选择SuperSU<br /><br>向右划<br /><br>点击reboot system<br /><br>向右划<br /><br>手机就会重启</p>
<p>安装xpoder<br /><br>安装ssr</p>
<p>“已连接，但无法访问互联网”开机后wifi有感叹号, 时间无法同步解决办法 在手机的shell里以root用户执行：<br /><br># settings put global captive_portal_http_url <a class="link"   href="https://www.google.cn/generate_204" >https://www.google.cn/generate_204<i class="fas fa-external-link-alt"></i></a> <br /><br># settings put global captive_portal_https_url <a class="link"   href="https://www.google.cn/generate_204" >https://www.google.cn/generate_204<i class="fas fa-external-link-alt"></i></a> <br /><br># settings put global ntp_server 1.hk.pool.ntp.org <br /><br># reboot</p>
<p>打开xposed，向下拉刷新<br /><br>下载version 90</p>
<h3 id="刷magisk（Android-10有效）"><a href="#刷magisk（Android-10有效）" class="headerlink" title="刷magisk（Android 10有效）"></a>刷magisk（Android 10有效）</h3><p>同样的方式刷入magisk，把magisk.zip放到sdcard根目录下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">adb push Magisk-v21.2.zip /sdcard/</span><br></pre></td></tr></table></figure>
<p>手机关机<br /><br>先按住音量键下+电源键进入reboot<br /><br>按两下音量键下，选择recovery mode<br /><br>点击install<br /><br>选择magisk.zip后，向右划<br /><br>重新启动</p>
<h3 id="刷nethunt"><a href="#刷nethunt" class="headerlink" title="刷nethunt"></a>刷nethunt</h3><p>下载，或者window直接下载</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">proxychains wget https://images.kali.org/nethunter/nethunter-<span class="number">2021.2</span>-angler-oreo-kalifs-full.<span class="built_in">zip</span> </span><br></pre></td></tr></table></figure>
<p>把下载好后的nethunter放到sdcard下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">adb reboot bootloader</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fastboot flash recovery twrp-<span class="number">3.3</span><span class="number">.1</span>-<span class="number">0</span>-bullhead.img</span><br></pre></td></tr></table></figure>
<p> 按两下音量键下 <br /><br>选择nethunter<br /><br>就开始自动刷机</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/02.webp"
                     
                ></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">apt install neofetch jnettop htop nethogs</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">neofetch</span><br></pre></td></tr></table></figure>

<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/03.webp"
                     
                ><br><br /><br>点击NetHunter<br /><br>菜单选择KeX Manager<br /><br>点击SETUP LOCAL SERVER<br /><br>设置密码<br /><br> <br /><br>点击START SERVER开启服务器</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/04.webp"
                     
                ><br><br /><br>连接手机</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ssh root@xxx.xxx.xx.xx</span><br></pre></td></tr></table></figure>





<h3 id="另一种-android8-magisk-LSPosed"><a href="#另一种-android8-magisk-LSPosed" class="headerlink" title="另一种 android8+magisk+LSPosed"></a>另一种 android8+magisk+LSPosed</h3><p><a class="link"   href="https://developers.google.cn/android/images" >https://developers.google.cn/android/images<i class="fas fa-external-link-alt"></i></a><br /><br><a class="link"   href="https://topjohnwu.github.io/Magisk/install.html" >https://topjohnwu.github.io/Magisk/install.html<i class="fas fa-external-link-alt"></i></a><br /><br>android8+magisk+LSPosed<br /><br>下载刷机系统包后，解压，进入，输入 .&#x2F;flash-all.sh<br /><br>安装magisk<br /><br>修补镜像才能root<br /><br>刷完后从刷机包里的镜像压缩包找到boot.img ，推送到 &#x2F;sdcard&#x2F; 下<br /><br>打开magisk，点击安装，选择并修补一个文件，选择刚才推送的文件，点开始，然后就开始patch了<br /><br>显示All done后，adb shell进入到 &#x2F;sdcard&#x2F;Download&#x2F; 下，看到修补后的img，adb pull到电脑上<br /><br>进入到解压的系统包，输入adb root bootloader 到刷机界面<br /><br>输入 fastboot flash boot &#x2F;path&#x2F;to&#x2F;magisk_patched.img （这里用自己修补后的）<br /><br>刷完之后在输入 fastboot flash recovery &#x2F;path&#x2F;to&#x2F;magisk_patched.img <br /><br>重启之后就root成功了<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/05.webp"
                     
                ><br><br /></p>
<p><a class="link"   href="https://github.com/LSPosed/LSPosed" >https://github.com/LSPosed/LSPosed<i class="fas fa-external-link-alt"></i></a><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210607/06.webp"
                     
                ><br><br /><br>下载 Riru 压缩包，push到手机&#x2F;sdcard&#x2F;，打开magisk点击模块，选择Riru，安装后<br /><br>下载LSPosed，推送到 &#x2F;sdcard&#x2F;，，打开magisk点击模块，选择LSPosed，安装后重启</p>
]]></content>
      <tags>
        <tag>刷机</tag>
      </tags>
  </entry>
  <entry>
    <title>App带壳重打包去强制升级</title>
    <url>/2021/04/28/App%E5%B8%A6%E5%A3%B3%E9%87%8D%E6%89%93%E5%8C%85%E5%8E%BB%E5%BC%BA%E5%88%B6%E5%8D%87%E7%BA%A7/</url>
    <content><![CDATA[<h3 id="1-查壳"><a href="#1-查壳" class="headerlink" title="1.查壳"></a>1.查壳</h3><p>打开app，弹出强制升级无法取消<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/01.webp"
                     
                ><br /><br>用jadx打开apk<br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/02.webp"
                     
                ><br><br /><br>搜索包名，可以看到是加壳了<br /></p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/03.webp"
                     
                ></p>
<h3 id="2-使用dexdump进行脱壳"><a href="#2-使用dexdump进行脱壳" class="headerlink" title="2.使用dexdump进行脱壳"></a>2.使用dexdump进行脱壳</h3><p>先打开frida-server，打开objextion并加载dexdump插件，输入plugin  dexdump dump命令进行脱壳，就把dex文件脱出来了<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/04.webp"
                     
                ></p>
<p>进入到dex文件的位置，使用grep -ril “MainActivity” *  命令搜索MainActivity再哪个dex，用jadx打开<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/05.webp"
                     
                ></p>
<h3 id="3-定位到弹窗代码位置"><a href="#3-定位到弹窗代码位置" class="headerlink" title="3.定位到弹窗代码位置"></a>3.定位到弹窗代码位置</h3><p><a class="link"   href="https://www.jianshu.com/p/18e1f518c625" >https://www.jianshu.com/p/18e1f518c625<i class="fas fa-external-link-alt"></i></a><br /><br>根据弹出框的实现方法进行搜索对应的类<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/06.webp"
                     
                ><br /><br>打印出所有的类，然后输入<code>cat .objection/objection.log |grep -i window </code>进行搜索<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/07.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/08.webp"
                     
                ></p>
<p>由于app启动的时候就把弹窗加载出来了，所以要在没加载前hook类<br /><br>使用–startup-command可以重启app并进行hook</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">objection -g com.hello.qqc explore --startup-command &quot;android hooking watch class android.view.Window&quot;</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/09.webp"
                     
                ><br /><br>出现很多的window，无法保证加载的类就是弹窗的<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/10.webp"
                     
                ></p>
<p>换一种方式 Dialog<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/11.webp"
                     
                ><br /><br>搜索dialog有哪些类，出来两个比较可疑的<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/12.webp"
                     
                ></p>
<p>先对android.app.Dialog<br>进行hook，看有没有反应<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/13.webp"
                     
                ><br /><br>查看文档发现setCancelable是不让返回，所以点后退一直没反应<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/14.webp"
                     
                >)<br /><br>hook这个类android.app.Dialog.setCancelable 查看调用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">android hooking watch class_method android.app.Dialog.setCancelable --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/15.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/16.webp"
                     
                ></p>
<p>用jadx搜索观察cn.net.tokyo.ccg.ui.fragment.dialog.UpdateDialogFragment.onCreateDialog</p>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/17.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/18.webp"
                     
                ></p>
<p>加载wallbreaker<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/19.webp"
                     
                ><br /><br>搜索该类实例</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectsearch cn.net.tokyo.ccg.ui.fragment.dialog.UpdateDialogFragment</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/20.webp"
                     
                ><br>查看该对象的属性</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectdump --fullname 0x74e</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/21.webp"
                     
                ></p>
<h3 id="4-查找哪句代码控制弹窗"><a href="#4-查找哪句代码控制弹窗" class="headerlink" title="4.查找哪句代码控制弹窗"></a>4.查找哪句代码控制弹窗</h3><p>查看<code>cn.net.tokyo.ccg.ui.fr agment.dialog.UpdateDialogFragment.b</code> 的调用栈</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">android hooking watch class_method cn.net.tokyo.ccg.ui.fragment.dialog.UpdateDialogFragment.b --dump-args --dump-backtrace --dump-return</span><br></pre></td></tr></table></figure>
<p><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/22.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/23.webp"
                     
                ><br /><br>查看对应smail代码，把eqz改为nez<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/24.webp"
                     
                ></p>
<h3 id="5-把壳脱掉重打包看能不能用"><a href="#5-把壳脱掉重打包看能不能用" class="headerlink" title="5.把壳脱掉重打包看能不能用"></a>5.把壳脱掉重打包看能不能用</h3><p>解包，保留dex文件<br /><br><code>apktool -s d qqc.apk</code><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/25.webp"
                     
                ><br /><br>删除class.dex，把脱下来的dex替换进去<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/26.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/27.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/28.webp"
                     
                ></p>
<p>修改dex执行的入口<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/29.webp"
                     
                ><br /><br><code>vim AndroidManifest.xml </code><br /><br>修改为cn.net.tokyo.ccg.base.App<br><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/30.webp"
                     
                ><br /><br>打包，签名<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/31.webp"
                     
                ><br /><br>生成签名，keytool -genkey -keystore my-release-key.keystore -alias my_alias -keyalg RSA -keysize 4096 -validity 10000<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/32.webp"
                     
                ><br /><br>进行签名，jarsigner -sigalg MD5withRSA -digestalg SHA1 -keystore my-release-key.keystore -signedjar qqc.apk qqc.apk my_alias<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20210428/33.webp"
                     
                ><br /><br>安装，看有没有报错，能不能正常使用</p>
<h3 id="6-修改smail文件重打包"><a href="#6-修改smail文件重打包" class="headerlink" title="6.修改smail文件重打包"></a>6.修改smail文件重打包</h3><p>找到对应的smail文件<br /><br>tree -NCfhl |grep -i MainActivity<br /><br>把 if -eqz改为if-nez<br /><br>重打包</p>
]]></content>
      <tags>
        <tag>脱壳</tag>
      </tags>
  </entry>
  <entry>
    <title>Objection命令</title>
    <url>/2021/03/15/Objection%E5%91%BD%E4%BB%A4/</url>
    <content><![CDATA[<h3 id="安装frida-12-8-0全家桶"><a href="#安装frida-12-8-0全家桶" class="headerlink" title="安装frida 12.8.0全家桶"></a>安装frida 12.8.0全家桶</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pip install frida==12.8.0</span><br><span class="line">pip install frida-tools==5.3.0</span><br><span class="line">pip install objection==1.8.4</span><br></pre></td></tr></table></figure>

<p>frida切换端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">./frida-server-12.8.10-android-arm64 -v -l 0.0.0.0:9999</span><br></pre></td></tr></table></figure>
<p>根据端口连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">frida -H 192.168.137.148:9999 -F</span><br></pre></td></tr></table></figure>
<p>查看进程端口</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">netstat -tuulp |grep fs</span><br></pre></td></tr></table></figure>
<p>objection通过端口连接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">objection -N -h 192.168.137.148 -p 9999 -g com.android.settings explore</span><br></pre></td></tr></table></figure>

<p>列出所有的类</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">android hooking list classes</span><br></pre></td></tr></table></figure>
<p>在手机上启动<code>frida-server</code>，并且点击启动“设置”图标，手机进入设置的界面，首先查看一下“设置”应用的包名</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># frida-ps -U|grep -i setting</span><br><span class="line"> 7107  com.android.settings</span><br><span class="line">13370  com.google.android.settings.intelligence</span><br></pre></td></tr></table></figure>
<p>再使用<code>objection</code>注入“设置”应用。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># objection -g com.android.settings explore</span><br></pre></td></tr></table></figure>

<ul>
<li>查看内存中加载的库</li>
</ul>
<p>运行命令<code>memory list modules</code>，</p>
<ul>
<li>查看库的导出函数</li>
</ul>
<p>运行命令<code>memory list exports libssl.so</code></p>
<ul>
<li>将结果保存到<code>json</code>文件中</li>
</ul>
<p>当结果太多，终端无法全部显示的时候，可以将结果导出到文件中，然后使用其他软件查看内容</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"># memory list exports libart.so --json /root/libart.json  </span><br><span class="line">Writing exports as json to /root/libart.json...</span><br><span class="line">Wrote exports to: /root/libart.json</span><br></pre></td></tr></table></figure>


<h3 id="批量Hook"><a href="#批量Hook" class="headerlink" title="批量Hook"></a>批量Hook</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">objection -g 包名 explore -c <span class="string">&quot;path&quot;</span></span><br></pre></td></tr></table></figure>
<p>搜索文件下含有关键字</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">grep -ril <span class="string">&quot;okhttp3&quot;</span> *</span><br></pre></td></tr></table></figure>

<p><strong>第二种  使用无线WiFi连接</strong><br />首先先了解一点底层的知识：<br />    Android系统底层运行着一个服务（adbd），用于响应和管理大家在电脑端的adb命令连接，这个服务在启动时会根据手机的配置监听USB连接或网络其中之一。配置的属性为：service.adb.tcp.port，也就是监听的网络端口<br />•以上属性的值 &gt; 0：adbd将监听网络对应的端口（一般为5555）<br />•以上属性的值 &lt;&#x3D;-1：adbd将监听USB<br />接下来是连接步骤：<br />命令行输入：adb connect (ip):5555<br />提示：unable to connect to (ip):5555<br /><strong>解决办法：</strong><br />   1）手机与PC相连，执行以下命令：adb tcpip 5555<br />     成功提示：restarting in TCP mode port 5555  <br />　  然后断开USB<br />     错误提示：error:device not found<br />     查看手机USB调试是否打开；PC端是否安装手机驱动。<br />   2）接着执行adb connect (ip):5555，这时候应该就能连接成功了<br />     成功提示：connected to (ip):5555<br />调试完成之后，输入如下的命令断开连接：<br />adb disconnect (ip):5555</p>
<p>列出所有activity</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">android hooking list activities</span><br></pre></td></tr></table></figure>
<p>跳到某一个activuty界面</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">android intent launch_activity ***<span class="title class_">Activity</span></span><br></pre></td></tr></table></figure>
<p>列出所有services</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">android hooking list services</span><br></pre></td></tr></table></figure>
<p>从内存中搜索实例类</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">android heap search instances ***</span><br></pre></td></tr></table></figure>
<p>搜索到类的方法是否存在</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">android heap execute 类的地址值 方法名</span><br></pre></td></tr></table></figure>
<p>查看实例类的地址</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectsearch ****</span><br></pre></td></tr></table></figure>
<p>根据地址查看该类属性</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectdump ****</span><br></pre></td></tr></table></figure>

<h4 id="启动app并执行"><a href="#启动app并执行" class="headerlink" title="启动app并执行"></a>启动app并执行</h4><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">objection -g 包名 explore --startup-command <span class="string">&quot;android hooking watch ... --dump-args --dump-backtrace --dump-return&quot;</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">objection -g 包名 explore -s <span class="string">&quot;android hooking watch ... --dump-args --dump-backtrace --dump-return&quot;</span> </span><br></pre></td></tr></table></figure>

<h3 id="如何使用objection去批量hook和trace？比如一次性hook几千个类？"><a href="#如何使用objection去批量hook和trace？比如一次性hook几千个类？" class="headerlink" title="如何使用objection去批量hook和trace？比如一次性hook几千个类？"></a>如何使用objection去批量hook和trace？比如一次性hook几千个类？</h3><ol>
<li>把~&#x2F;.objection&#x2F;objection.log删掉；</li>
<li>到objection界面中运行android hooking list classes，列出所有的类；</li>
<li>对新生成的~&#x2F;.objection&#x2F;objection.log文件进行过滤，比如只关心http相关的。cat objection.log|grep -i http</li>
<li>将输出结果保存到一个excel列中，前面补全android hooking watch class xxxxx，另存为文本文件。如附件所示</li>
<li>加载这个文件：objection -g com.android.settings explore -c “2.txt” ，这样一下子就hook上了几千个相关类的所有方法及其所有重载。</li>
<li>如果trace感兴趣的方法也是同理，android hooking search methods * ，会打印出所有的方法。</li>
</ol>
<h3 id="安装objection插件"><a href="#安装objection插件" class="headerlink" title="安装objection插件"></a>安装objection插件</h3><p><strong>安装FRIDA_DEXDump</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/hluwa/FRIDA-DEXDump ~/Downloads/FRIDA-DEXDump;</span><br></pre></td></tr></table></figure>
<p>把frida_dexdumpp移到&#x2F;root&#x2F;.objection&#x2F;plugins&#x2F;下</br></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mv /root/Downloads/FRIDA-DEXDump/frida_dexdump /root/.objection/plugins/</span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">objection -g com.app.name explore -P ~/.objection/plugins</span><br></pre></td></tr></table></figure>
<p><a class="link"   href="https://github.com/hluwa/FRIDA-DEXDump" >https://github.com/hluwa/FRIDA-DEXDump<i class="fas fa-external-link-alt"></i></a></p>
</br>

<p><strong>安装Wallbreaker</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/hluwa/Wallbreaker ~/.objection/plugins/Wallbreaker</span><br></pre></td></tr></table></figure>
<p><a class="link"   href="https://github.com/hluwa/Wallbreaker" >https://github.com/hluwa/Wallbreaker<i class="fas fa-external-link-alt"></i></a></p>
</br>

<h3 id="wallbreaker"><a href="#wallbreaker" class="headerlink" title="wallbreaker"></a>wallbreaker</h3><p>导入(win下)</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line">plugin load .objection/plugins/Wallbreaker</span><br></pre></td></tr></table></figure>
<p>查看类的结构</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker classdump ***</span><br></pre></td></tr></table></figure>
<p>根据名字找类</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker classsearch ***</span><br></pre></td></tr></table></figure>
<p>查看类的实例的内容</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectdump --fullname ***</span><br></pre></td></tr></table></figure>
<p>找出类的实例</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">plugin wallbreaker objectsearch ***</span><br></pre></td></tr></table></figure>
]]></content>
      <tags>
        <tag>frida</tag>
      </tags>
  </entry>
  <entry>
    <title>python调用js的几种方式</title>
    <url>/2021/01/01/python%E8%B0%83%E7%94%A8js%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<h3 id="1-PyExecJS"><a href="#1-PyExecJS" class="headerlink" title="1.PyExecJS"></a>1.PyExecJS</h3><p>安装依赖<br>pip3 install PyExecJS<br>新建add.js文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>py文件去调用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> execjs</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;add.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js_code = f.read()</span><br><span class="line">context = execjs.<span class="built_in">compile</span>(js_code)</span><br><span class="line">result = context.call(<span class="string">&quot;add&quot;</span>, <span class="number">2</span>, <span class="number">3</span>) // 参数一为函数名，参数二和三为函数的参数</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5</span><br></pre></td></tr></table></figure>


<h3 id="2-js2py"><a href="#2-js2py" class="headerlink" title="2.js2py"></a>2.js2py</h3><p>#安装依赖库<br>pip3 install js2py<br>还是上面的add.js文件<br>python调用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> js2py</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;add.js&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, encoding=<span class="string">&#x27;UTF-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    js_code = f.read()</span><br><span class="line">context = js2py.EvalJs()</span><br><span class="line">context.execute(js_code)</span><br><span class="line">result = context.add(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>


<h3 id="3-Node-js"><a href="#3-Node-js" class="headerlink" title="3.Node.js"></a>3.Node.js</h3><p>实际上是使用 Python 的os.popen执行 node 命令，执行 JS 脚本<br>首先，确保本地已经安装了 Node.js 环境<br>对js代码添加打印</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(a)+<span class="title class_">Number</span>(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(process.<span class="property">argv</span>[<span class="number">2</span>], process.<span class="property">argv</span>[<span class="number">3</span>]));  <span class="comment">// 运行脚本传进来的参数</span></span><br></pre></td></tr></table></figure>

<p>用python调用控制台方式去使用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">nodejs = os.popen(<span class="string">&#x27;node add.js &#x27;</span>+<span class="string">&#x27;2&#x27;</span>+<span class="string">&#x27; &#x27;</span>+<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">m = nodejs.read()</span><br><span class="line">nodejs.close()</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者使用另一种方式</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(a)+<span class="title class_">Number</span>(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// console.log(add(process.argv[2], process.argv[3]));</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//新增一个导出函数（node方式）</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span>.<span class="property">init</span> = <span class="keyword">function</span> (<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">    <span class="comment">//调用函数，并返回</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">add</span>(arg1, arg2));</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">cmd = <span class="string">&#x27;node -e &quot;require(\\&quot;%s\\&quot;).init(%s,%s)&quot;&#x27;</span> % (<span class="string">&#x27;./add.js&#x27;</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">pipeline = os.popen(cmd)</span><br><span class="line">result = pipeline.read()</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>


<h3 id="4-node服务"><a href="#4-node服务" class="headerlink" title="4.node服务"></a>4.node服务</h3><p>用node做一个服务，提供api<br>还是add.js文件</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a,b</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title class_">Number</span>(a)+<span class="title class_">Number</span>(b);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> =  &#123;</span><br><span class="line">    <span class="attr">add</span>: <span class="keyword">function</span> (<span class="params">arg1, arg2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">add</span>(arg1, arg2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>新建add_api.js<br>下载 express 和 body-parser 两个包</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">var</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">var</span> func = <span class="built_in">require</span>(<span class="string">&#x27;./add.js&#x27;</span>)  <span class="comment">// 导入js模块，并命名为func</span></span><br><span class="line"><span class="keyword">var</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);  <span class="comment">// 导入请求体解析器</span></span><br><span class="line"><span class="comment">// 调整参数大小限制，否则会提示参数过大。</span></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123;<span class="attr">limit</span>: <span class="string">&#x27;50mb&#x27;</span>, <span class="attr">extended</span>: <span class="literal">true</span>&#125;));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置路由</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/add&#x27;</span>, <span class="keyword">function</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// 获取请求的真实IP</span></span><br><span class="line">	<span class="keyword">var</span> ip = req.<span class="property">headers</span>[<span class="string">&#x27;x-real-ip&#x27;</span>] ? req.<span class="property">headers</span>[<span class="string">&#x27;x-real-ip&#x27;</span>] : req.<span class="property">ip</span>.<span class="title function_">replace</span>(<span class="regexp">/::ffff:/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="comment">// 获取请求时间</span></span><br><span class="line">	<span class="keyword">var</span> time = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\+0800.*/</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">	<span class="comment">// 打印请求时间、IP、方法、路由</span></span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;INFO:&#x27;</span>, time, ip, req.<span class="property">method</span>, req.<span class="property">originalUrl</span>, <span class="string">&#x27;200 OK!&#x27;</span>);</span><br><span class="line">	<span class="comment">// 获取POST请求的formdata</span></span><br><span class="line">	<span class="keyword">let</span> result = req.<span class="property">body</span>;</span><br><span class="line">	<span class="comment">// let code = result.code;</span></span><br><span class="line">    <span class="comment">// let seed = result.seed;</span></span><br><span class="line">    <span class="comment">// let ts = result.ts;</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;result: &quot;</span>, result);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;num1: &quot;</span>, result.<span class="property">num1</span>);</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;num2: &quot;</span>, result.<span class="property">num2</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 调用cook模块中的get_cookie方法，该方法需要提前module.exports导出</span></span><br><span class="line">	<span class="keyword">var</span> response = func.<span class="title function_">add</span>(result.<span class="property">num1</span>, result.<span class="property">num2</span>);</span><br><span class="line">	<span class="comment">// 设置响应头，如果不设置，通过asyncio_requests请求的res.json()会报错，因为它是根据响应头解析json数据</span></span><br><span class="line">	<span class="comment">// 而requests可以直接使用res.json()解析，因为它是根据响应信息解析</span></span><br><span class="line">	res.<span class="title function_">set</span>(<span class="string">&#x27;Content-Type&#x27;</span>, <span class="string">&#x27;application/json&#x27;</span>)</span><br><span class="line">	<span class="comment">// 将JSON后的数据返回客户端</span></span><br><span class="line">	res.<span class="title function_">send</span>(<span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;<span class="string">&quot;result&quot;</span>: response&#125;));</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">8919</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">	<span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;开启服务，端口8919&quot;</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">toString</span>().<span class="title function_">replace</span>(<span class="regexp">/\+0800.*/</span>, <span class="string">&#x27;&#x27;</span>))</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>运行，用python写个post请求</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">response = requests.post(<span class="string">&quot;http://127.0.0.1:8919/add&quot;</span>, data=&#123;<span class="string">&quot;num1&quot;</span>: <span class="number">2</span>, <span class="string">&quot;num2&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(response.text)</span><br></pre></td></tr></table></figure>
<p>运行结果:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&quot;result&quot;: 5&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <tags>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>某东实时弹幕抓取</title>
    <url>/2020/12/27/%E6%9F%90%E4%B8%9C%E5%AE%9E%E6%97%B6%E5%BC%B9%E5%B9%95%E6%8A%93%E5%8F%96/</url>
    <content><![CDATA[<h2 id="1-抓包，查找sign"><a href="#1-抓包，查找sign" class="headerlink" title="1.抓包，查找sign"></a>1.抓包，查找sign</h2><p>对于已经拿到sign只想看弹幕的部分直接跳到4。</p>
<p>用的抓包工具是HttpCanary，随便进入一间直播间，可以看到弹幕走的是websocket，携带的url参数token来自于下面post返回的结果，经过分析只有st,sign,sv三个参数会变，其余都不变。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/01.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/02.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/03.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/04.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/05.webp"
                     
                ><br>既然分析完了，那就从sign开始入手。当时我找这个sign找了一会没找出来，由于sign会跟其它参数拼接成url，所以我就搜其它参数wifiBssid，搜出来很明显就在第一个。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/06.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/07.webp"
                     
                ><br>这里hook这个getReportString方法，把它的调用堆栈打印出来，然后去查看。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/08.webp"
                     
                ><br>这里我就直接贴出来了，省得大家浪费时间去找，眼尖的可以看到里面有signature，不就跟我们要的sign很像吗，这里把b方法三个参数hook打印一下，<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/09.webp"
                     
                ><br>进到signature这个方法，可以看到这只是接口，那就搜索这个类，看它在哪里被实现。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/10.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/11.webp"
                     
                ><br>被getSignFromJni方法实现了，再深入看一下，可以看到加密过程在so里面。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/12.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/13.webp"
                     
                ><br>这里就直接hook这个函数打印参数，多调用几次，然后跟抓到的数据做对比，看哪些参数不变。经过我的测试，这些参数不用修改，可以直接拿过来用，而且都是string类型的，也不用做什么类型转换。返回值的st，sign，sv都是组成url需要的参数，而且这里的参数v3是post的body的值。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/14.webp"
                     
                ></p>
<h2 id="2-使用rpc进行调用"><a href="#2-使用rpc进行调用" class="headerlink" title="2.使用rpc进行调用"></a>2.使用rpc进行调用</h2><p>这里就直接使用rpc进行调用就可以了，根据它的参数照搬就可以了。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">rpc_sign = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">rpc.exports = &#123;</span></span><br><span class="line"><span class="string">    getsign: function(function_id, body_string, uuid)&#123;</span></span><br><span class="line"><span class="string">      var sig = &quot;&quot;;</span></span><br><span class="line"><span class="string">      Java.perform(</span></span><br><span class="line"><span class="string">        function()&#123;</span></span><br><span class="line"><span class="string">            //拿到context上下文</span></span><br><span class="line"><span class="string">            var currentApplication = Java.use(&#x27;android.app.ActivityThread&#x27;).currentApplication();</span></span><br><span class="line"><span class="string">            var context = currentApplication.getApplicationContext();</span></span><br><span class="line"><span class="string">            var BitmapkitUtils = Java.use(&#x27;com.jingdong.common.utils.BitmapkitUtils&#x27;);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            sig = BitmapkitUtils.getSignFromJni(context, function_id, body_string, uuid, &#x27;android&#x27;, &#x27;9.2.0&#x27;);</span></span><br><span class="line"><span class="string">        &#125; </span></span><br><span class="line"><span class="string">      )</span></span><br><span class="line"><span class="string">       return sig;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sign</span>(<span class="params">function_id, body_string, u</span>):</span><br><span class="line">    process = frida.get_remote_device().attach(<span class="string">&#x27;com.jingdong.app.mall&#x27;</span>)</span><br><span class="line">    script = process.create_script(rpc_sign)</span><br><span class="line">    script.load()</span><br><span class="line">    sign = script.exports.getsign(function_id, body_string, u)</span><br><span class="line">    <span class="keyword">return</span> sign</span><br><span class="line"></span><br><span class="line">body_data = &#123;<span class="string">&quot;appId&quot;</span>:<span class="string">&quot;jd.mall&quot;</span>,<span class="string">&quot;content&quot;</span>:<span class="string">&quot;tbV8seY199tCdw6GllmkWyCNNENuGsgwLByA7svt5HbPXvlI9wQhHMk3dT7f0ldfpq6M0MCiUD+A\nVrY390Yct0FSub03INUml9n1bS9rZSF3XT0q1kQdehKPO4CccMiEA6NQXYiqYn9wLsDDYEIjmkVA\nEbXI88CwO0K7uhwemdhQMZrcIFj6jMmyiDNDxSA1OjFw88hR0oSCF0m8ll9o9iU2MVSHDipF5ZDn\nFR4E+82mwfRYIxamafB+nWG8GuHcKhiQOWGbChTcG3TxcGT053wfcc6uuMD7+L4PcsNRQjM9syFc\nXR6FBu/sCV/kH/3rT8w/m3zV1c9JpW9lq/7WVzCVvAIj7RNt2zzYFisymCE=&quot;</span>&#125;</span><br><span class="line">body_string = json.dumps(body_data, ensure_ascii=<span class="literal">False</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">function_id = <span class="string">&#x27;liveauth&#x27;</span></span><br><span class="line">u = <span class="string">&#x27;-a08d16f38776&#x27;</span></span><br><span class="line">sign = get_sign(function_id, body_string, u)</span><br><span class="line"><span class="built_in">print</span>(sign)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">st=1608288325570&amp;sign=bf449b04f88afea4c08e18006127cace&amp;sv=121</span><br></pre></td></tr></table></figure>

<h2 id="3-构造请求拿到认证"><a href="#3-构造请求拿到认证" class="headerlink" title="3.构造请求拿到认证"></a>3.构造请求拿到认证</h2><p>上面只是拿到了sign，还得拼接url进行请求，这里就不展示了，要的参数基本都有了，其它不变的参数照搬就行，我就直接post请求拿结果了。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;&#x27;code&#x27;: 0, &#x27;msg&#x27;: &#x27;鉴权成功&#x27;, &#x27;data&#x27;: &#123;&#x27;liveUrl&#x27;: &#x27;wss://live-ws4.jd.com&#x27;, &#x27;token&#x27;: &#x27;amQubWFsbF_muLjlrqJfOTMxMTE0MzY4NDNfMTYwODI3OTE4NzA5NGxTNkViVw==&#x27;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="4-建立WebSocket"><a href="#4-建立WebSocket" class="headerlink" title="4.建立WebSocket"></a>4.建立WebSocket</h2><p>保存刚才请求websocket，打开可以看到它请求的参数。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;app&quot;: &quot;com.jingdong.app.mall&quot;,</span><br><span class="line">  &quot;host&quot;: &quot;live-ws4.jd.com&quot;,</span><br><span class="line">  &quot;remoteIp&quot;: &quot;106.39.169.212&quot;,</span><br><span class="line">  &quot;remotePort&quot;: 443,</span><br><span class="line">  &quot;sessionId&quot;: &quot;c77ac6e9-019d-4ac9-8611-92f24eb29851&quot;,</span><br><span class="line">  &quot;time&quot;: &quot;2020-12-19 23:48:18&quot;,</span><br><span class="line">  &quot;url&quot;: &quot;wss://live-ws4.jd.com/?token\u003damQubWFsbF_muLjlrqJfMjg5NDU0ODc3NDZfMTYwODI3Mjg5ODE0NFdSb0xibw\u003d\u003d&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>怎么建立WebSocket连接呢？<br>这里就需要用到python的aiowebsocket库。<br>详细的说明和使用方法请看：<a class="link"   href="https://zhuanlan.zhihu.com/p/82089648" >https://zhuanlan.zhihu.com/p/82089648<i class="fas fa-external-link-alt"></i></a><br>代码如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"><span class="keyword">from</span> aiowebsocket.converses <span class="keyword">import</span> AioWebSocket</span><br><span class="line"><span class="keyword">import</span> LiveBarrage</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">startup</span>(<span class="params">uri</span>):</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> AioWebSocket(uri) <span class="keyword">as</span> aws:</span><br><span class="line">        converse = aws.manipulator</span><br><span class="line">        <span class="comment"># 客户端给服务端发送消息</span></span><br><span class="line">        a = &#123;</span><br><span class="line">            <span class="string">&quot;aid&quot;</span>: <span class="string">&quot;dongdong&quot;</span>,</span><br><span class="line">            <span class="string">&quot;body&quot;</span>: &#123;<span class="string">&quot;ext&quot;</span>:</span><br><span class="line">                        &#123;<span class="string">&quot;appid&quot;</span>:<span class="string">&quot;jd.mall&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;entrace&quot;</span>:<span class="string">&quot;6&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;ver&quot;</span>:<span class="string">&quot;1.1&quot;</span>&#125;,</span><br><span class="line">                    <span class="string">&quot;groupid&quot;</span>:<span class="string">&quot;3092724&quot;</span>, <span class="comment"># 这个是房间号</span></span><br><span class="line">                    <span class="string">&quot;nickName&quot;</span>:<span class="string">&quot;神秘观众&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;type&quot;</span>:<span class="string">&quot;join_live_broadcast&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;from&quot;</span>:&#123;<span class="string">&quot;app&quot;</span>:<span class="string">&quot;jd.live&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;clientType&quot;</span>:<span class="string">&quot;android&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;dvc&quot;</span>:<span class="string">&quot;-a08d16f38776&quot;</span>,</span><br><span class="line">                    <span class="string">&quot;pin&quot;</span>:<span class="string">&quot;&quot;</span>&#125;,</span><br><span class="line">            <span class="string">&quot;id&quot;</span>:<span class="string">&quot;df09a645-8e9b-4aad-b699-d44753ca8738&quot;</span>,</span><br><span class="line">            <span class="string">&quot;type&quot;</span>:<span class="string">&quot;chat_group_message&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ver&quot;</span>:<span class="string">&quot;9.3.2&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment"># 把json转换为字符串</span></span><br><span class="line">        body_string = json.dumps(a, ensure_ascii=<span class="literal">False</span>).replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        <span class="comment"># print(body_string)</span></span><br><span class="line">        <span class="keyword">await</span> converse.send(body_string)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            mes = <span class="keyword">await</span> converse.receive()</span><br><span class="line">            <span class="comment"># 设置编码</span></span><br><span class="line">            mes = mes.decode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">            <span class="comment"># nickName是用户名，判断nickName可以过滤非弹幕消息</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;nickName&#x27;</span> <span class="keyword">in</span> mes:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&#x27;&#123;time&#125;-Client receive: &#123;rec&#125;&#x27;</span></span><br><span class="line">                    .<span class="built_in">format</span>(time=datetime.now().strftime(<span class="string">&#x27;%Y-%m-%d %H:%M:%S&#x27;</span>), rec=mes))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    token = LiveBarrage.token()  <span class="comment"># 这里返回的是post请求后拿到的token</span></span><br><span class="line">    <span class="comment">#remote = &#x27;wss://api.bbxapp.vip/v1/ifcontract/realTime&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(token)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        asyncio.get_event_loop().run_until_complete(startup(token))</span><br><span class="line">    <span class="keyword">except</span> KeyboardInterrupt <span class="keyword">as</span> exc:</span><br><span class="line">        logging.info(<span class="string">&#x27;Quit.&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行结果如下：<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/15.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/16.webp"
                     
                ></p>
<p>可以看到是实时抓取的，到这里就结束了。</p>
<h2 id="5-其它接口"><a href="#5-其它接口" class="headerlink" title="5.其它接口"></a>5.其它接口</h2><p>这个app的接口参数都是一样的，不同的接口由functionId这个参数决定的。<br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201227/17.webp"
                     
                ></p>
<p>这里我就把其它的接口名发出来，然后post的参数hook查看一下照搬就可以了。<br>搜索 search<br>商品评价列表 getCommentListWithCard<br>问答 getQuestionList<br>直播带货商品 liveCartDetail<br>弹幕 liveauth</p>
]]></content>
      <tags>
        <tag>抓包</tag>
        <tag>安卓逆向</tag>
      </tags>
  </entry>
  <entry>
    <title>App解固脱壳方式</title>
    <url>/2020/10/29/App%E8%A7%A3%E5%9B%BA%E8%84%B1%E5%A3%B3%E6%96%B9%E5%BC%8F/</url>
    <content><![CDATA[<p><a class="link"   href="https://www.yuque.com/attachments/yuque/0/2020/zip/2721723/1603962732264-00bfe3f5-1985-44fa-8c02-31050a671665.zip?from=https://www.yuque.com/gongguoshuiwen/whieq5/gceigp%23OJEdd" >样例app下载链接<i class="fas fa-external-link-alt"></i></a></p>
<h2 id="一、常见的壳"><a href="#一、常见的壳" class="headerlink" title="一、常见的壳"></a>一、常见的壳</h2><p>通常是看lib文件夹下so库特征，以下是市面上常见的不同厂商对APP的加固特征：<br />爱加密：libexec.so,libexecmain.so，ijiami.dat <br />梆梆： libsecexe.so,libsecmain.so , libDexHelper.so libSecShell.so<br />360：libprotectClass.so,libjiagu.so，libjiagu_art.so，libjiagu_x86.so <br />百度：libbaiduprotect.so <br />腾讯：libshellx-2.10.6.0.so，libBugly.so，libtup.so, libexec.so，libshell.so，stub_tengxun <br />网易易盾：libnesec.so<br />为什么要加固：<br />     一定程度保护源代码<br />加固方式：<br />    .dex加固 .so加固 </p>
<h2 id="二、加固原理"><a href="#二、加固原理" class="headerlink" title="二、加固原理"></a>二、加固原理</h2><p>壳dex 读取源dex文件，加密后，写进一个新的dex文件<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/01.webp"
                     
                ></p>
<p><br />新APK运行 <br />先加载壳APP—&gt;壳APP读Dex文件末尾的源APKD大小—-&gt;在内存中壳APP解密出源APP—&gt;运行源APP 壳APK有自己的Application对象 <br />源APK有自己的Application对象 <br />壳APK启动时 在AndroidMenifest.xml里找源APK的Application 执行它的oncreate方法 启动源APK <br />Dex文件格式：  任何类型的文件都有文件格式，对应的软件按照文件格式来就能解析出类型，.xml .json .jpeg<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/02.webp"
                     
                ></p>
<h2 id="三、如何查看有没有壳"><a href="#三、如何查看有没有壳" class="headerlink" title="三、如何查看有没有壳"></a>三、如何查看有没有壳</h2><p>用<code>apktool</code>对apk进行反编译，或者修改apk的后缀为zip，进行解压。查看解压后的文件下的lib目录，<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/03.webp"
                     
                ><br><br />可以看到这两个是用了腾讯的乐加固，或者我们不确定的话可以用jadx打开apk，也是可以发现的<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/04.webp"
                     
                ><br><br />都是壳的代码。不过即使怎么加壳，它都会去调源apk的Application，打开<code>AndroidManifest.xml</code>文件，<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/05.webp"
                     
                ><br><br />可以看到，上面一个是壳的，下面是源apk的Application。<br />逆向&#x2F;脱壳方法 <br />反编译&#x2F;Hook技术和动态调试 <br />Hook：先取得要Hook函数&#x2F;方法的控制权，不用破坏程序 <br />动态调试：反调试，汇编，计算内存地址</p>
<h2 id="四、Hook技术"><a href="#四、Hook技术" class="headerlink" title="四、Hook技术"></a>四、Hook技术</h2><p>改变程序执行流程的一种技术 在函数被调用前，通过HOOK技术，先得到该函数的控制权，实现该函数的逻辑改写<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/06.webp"
                     
                ><br />Hook可以在在Java层、Native层（.so库） <br />在代码层 寻找要Hook的地方 进行Hook 改下代码逻辑</p>
<h2 id="五、脱壳工具"><a href="#五、脱壳工具" class="headerlink" title="五、脱壳工具"></a>五、脱壳工具</h2><p><strong>脱壳原理：</strong><br>在壳APK解密源APK后，源APK被加载前，拦截这个过程中的系统函数 把内存种Dex dump出来。<br /></p>
<p><strong>手动脱壳：</strong><br>通过动态调试，跟踪计算Dex源文件的内存偏移地址，从内存中Dump出Dex文件 ，难度大，寄存器，汇编，反调试，反读写  IDA。<br /></p>
<p><strong>工具脱壳：</strong><br />    HOOK技术&#x2F;内存特征寻找  简单易操作  <br /></p>
<p><strong>基于xposed 脱壳工具</strong>：  <br />        Fdex2：Hook ClassLoader loadClass方法 <br />        通用脱壳  dumpDex：<a class="link"   href="https://github.com/WrBug/dumpDex" >https://github.com/WrBug/dumpDex<i class="fas fa-external-link-alt"></i></a><br /><strong>逆向框架：</strong> 筑好底层 提供开发接口<br /><strong>xposed</strong>（Java 编译，只能在java层）  <br /><strong>frida</strong>（Python Javascript 代码注入，可以hook住java层、Native层） </p>
<h2 id="六、开始脱壳（用FDex2脱壳）"><a href="#六、开始脱壳（用FDex2脱壳）" class="headerlink" title="六、开始脱壳（用FDex2脱壳）"></a>六、开始脱壳（用FDex2脱壳）</h2><p>首先我们打开<strong>xposed，</strong>把FDex2打开，并选择我们要的app<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/07.webp"
                     
                ><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/08.webp"
                     
                ><br />接下来就可以运行app，然后我们去<code>/data/user/0/com.iCitySuzhou.suzhou001</code>该目录下查看，多出来两个dex文件<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/09.webp"
                     
                ><br><br />把这两个文件拉到电脑用kadx打开，第一个是壳<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/10.webp"
                     
                ><br><br />打开第二个很明显看到这才是源apk的源码，而且可以发现它对源码进行混淆了<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/11.webp"
                     
                ><br><br />所以到这里我们的脱壳就成功了。</p>
<h2 id="七、开始脱壳（用Frida脱壳）"><a href="#七、开始脱壳（用Frida脱壳）" class="headerlink" title="七、开始脱壳（用Frida脱壳）"></a>七、开始脱壳（用Frida脱壳）</h2><h3 id="Frida脱壳"><a href="#Frida脱壳" class="headerlink" title="Frida脱壳"></a>Frida脱壳</h3><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">function_address = <span class="title class_">Module</span>.<span class="title function_">findExportByName</span>(libname, <span class="keyword">function</span>);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(address, func);</span><br><span class="line"><span class="title class_">Interceptor</span>.<span class="title function_">attach</span>(address,</span><br><span class="line"> <span class="attr">onEnter</span>: <span class="keyword">function</span> (<span class="params">args</span>) &#123;</span><br><span class="line"> &#125;,</span><br><span class="line"> <span class="attr">onLeave</span>: <span class="keyword">function</span> (<span class="params">retval</span>) &#123;</span><br><span class="line"> &#125;</span><br><span class="line">)</span><br><span class="line"><span class="title class_">File</span> 模块 写文件流程</span><br><span class="line"> <span class="keyword">new</span> <span class="title class_">File</span>(filepath, mode)</span><br><span class="line"> <span class="title function_">write</span>(data)</span><br><span class="line"> <span class="title function_">flush</span>()</span><br><span class="line"> <span class="title function_">close</span>()</span><br><span class="line">file = <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;yuanrenxue.dex&quot;</span>, <span class="string">&quot;wb&quot;</span>)</span><br><span class="line"><span class="comment">//data 是字符串或者 arrayBuffer // readByteArray() 返回的arrayBuffer</span></span><br><span class="line">file.<span class="title function_">write</span>(data)</span><br><span class="line">file.<span class="title function_">flush</span>()</span><br><span class="line">file.<span class="title function_">close</span>()</span><br><span class="line"><span class="comment">//把内存里的值转成字符串</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">readUtf8String</span>()</span><br><span class="line"><span class="comment">//把内存里的值转换成整型</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">readInt</span>()</span><br><span class="line"><span class="comment">//以begin为起始位置，从内存中读length长度的数据出来 返回ArrayBuffer类型</span></span><br><span class="line"><span class="title class_">Memory</span>.<span class="title function_">readByteArray</span>(begin, length)</span><br><span class="line"><span class="comment">//把地址转换成NativePointer类型 frida里操作内存地址需要NativePointer类型</span></span><br><span class="line"><span class="title function_">ptr</span>()</span><br><span class="line"><span class="variable constant_">JS</span> api</span><br><span class="line">#把其它进制转换成<span class="number">10</span>进制</span><br><span class="line"><span class="built_in">parseInt</span>(num, radix)</span><br></pre></td></tr></table></figure>
<p>加壳apk运行流程：app启动后–&gt;壳dex先加载起来–&gt;把源classes.dex读出来–&gt;解密源classes.dex–&gt;把源classes.dex给加载进内存–&gt;源dex运行起来<br />下两篇文章都对dex进行了详解<br />Dex文件格式详解 <a class="link"   href="https://www.jianshu.com/p/f7f0a712ddfe" >https://www.jianshu.com/p/f7f0a712ddfe<i class="fas fa-external-link-alt"></i></a><br />ART 加载dex文件 <a class="link"   href="https://www.jianshu.com/p/f81242ad8cb7" >https://www.jianshu.com/p/f81242ad8cb7<i class="fas fa-external-link-alt"></i></a></p>
<h3 id="dex文件结构"><a href="#dex文件结构" class="headerlink" title="dex文件结构"></a>dex文件结构</h3><table>
<thead>
<tr>
<th><strong>数据名称</strong></th>
<th><strong>解释</strong></th>
</tr>
</thead>
<tbody><tr>
<td>header</td>
<td>dex文件头部，记录整个dex文件的相关属性</td>
</tr>
<tr>
<td>string_ids</td>
<td>字符串数据索引，记录了每个字符串在数据区的偏移量</td>
</tr>
<tr>
<td>type_ids</td>
<td>类似数据索引，记录了每个类型的字符串索引</td>
</tr>
<tr>
<td>proto_ids</td>
<td>原型数据索引，记录了方法声明的字符串，返回类型字符串，参数列表</td>
</tr>
<tr>
<td>field_ids</td>
<td>字段数据索引，记录了所属类，类型以及方法名</td>
</tr>
<tr>
<td>method_ids</td>
<td>类方法索引，记录方法所属类名，方法声明以及方法名等信息</td>
</tr>
<tr>
<td>class_defs</td>
<td>类定义数据索引，记录指定类各类信息，包括接口，超类，类数据偏移量</td>
</tr>
<tr>
<td>data</td>
<td>数据区，保存了各个类的真是数据</td>
</tr>
<tr>
<td>link_data</td>
<td>连接数据区</td>
</tr>
</tbody></table>
<h3 id="header"><a href="#header" class="headerlink" title="header"></a>header</h3><p>简单记录了dex文件的一些基本信息，以及大致的数据分布。长度固定为0x70,其中每一项信息所占用的内存空间也是固定的，好处是虚拟机在处理dex时不用考虑dex文件的多样性</p>
<table>
<thead>
<tr>
<th align="center"><strong>字段名称</strong></th>
<th align="center"><strong>偏移值</strong></th>
<th align="center"><strong>长度</strong></th>
<th align="center"><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="center">magic</td>
<td align="center">0x0</td>
<td align="center">8</td>
<td align="center">魔数字段，值为”dex\</td>
</tr>
<tr>
<td align="center">035\0”（固定的）</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center">checksum</td>
<td align="center">0x8</td>
<td align="center">4</td>
<td align="center">校验码</td>
</tr>
<tr>
<td align="center">signature</td>
<td align="center">0xc</td>
<td align="center">20</td>
<td align="center">sha-1签名</td>
</tr>
<tr>
<td align="center">file_size</td>
<td align="center">0x20</td>
<td align="center">4</td>
<td align="center">dex文件总长度</td>
</tr>
<tr>
<td align="center">……</td>
<td align="center">……</td>
<td align="center">…..</td>
<td align="center">……</td>
</tr>
</tbody></table>
<p>字段太多就不都展示出来，可以看到<code>file_size</code>这个就是我们要找的dex文件,因为源dex解密后会加载进内存，所以我们去Hook加载Dex的函数，把Dex从内存中dump出来。<br />下面这个函数就是把解密后的源dex加载进内存：<br />DexFile::OpenMemory(const uint8_t* base,<br />   size_t size,<br />   const std::string&amp; location, <br />   uint32_t location_checksum, <br />   MemMap* mem_map,&#x2F;&#x2F;nullptr const OatDexFile* oat_dex_file, <br />   std::string* error_msg)<br />OpenMemory()是在安卓系统<code>/system/lib/libart.so</code>里面，然后我们先把这个so文件拉到电脑用IDA打开<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/12.webp"
                     
                ><br><br />打开IDA选择静态调试，打开libart.so这个文件<br><br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/13.webp"
                     
                ><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/14.webp"
                     
                ><br><br />这些就是so文件里面的函数，点击这个框，按ctrl+f进行搜索，输入OpenMemory这个函数，右键进行编辑，<br /><code>_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9_</code><br />这个字符串就是OpenMemory函数在内存中对外的方法名，我们打开IDA就是为了找这个方法名。<br /><br><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/15.webp"
                     
                ></p>
<p>现在来写脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> frida</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">package = <span class="string">&quot;com.iCitySuzhou.suzhou001&quot;</span></span><br><span class="line"></span><br><span class="line">open_memory_6 = <span class="string">&quot;_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9_&quot;</span></span><br><span class="line"><span class="comment">#OpenMemory 在libart.so中  art虚拟机(安卓5)  davlink虚拟机（安卓4）</span></span><br><span class="line"><span class="comment">#Hook OpenMemory的导出方法名</span></span><br><span class="line"><span class="comment">#用IDA 打开libart.so 查看OpenMemory的导出方法名</span></span><br><span class="line"><span class="comment">#OpenMemory的第一个参数是dex文件在内存中的起始位置</span></span><br><span class="line"><span class="comment">#根据dex文件格式 从起始位置开始 第32个字节 是该dex文件的大小</span></span><br><span class="line"><span class="comment">#知道dex起始位置和整个文件大小，只需要把这段内存dum出来即可</span></span><br><span class="line"><span class="comment">#适用于 安卓 6 7 8 9</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#文件的起始位置 文件的大小 知道了文件的结束位置</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">on_message</span>(<span class="params">message, data</span>):</span><br><span class="line">    <span class="keyword">if</span> message[<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;send&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[*] &#123;0&#125;&quot;</span>.<span class="built_in">format</span>(message[<span class="string">&#x27;payload&#x27;</span>]))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(message)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">src = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">//找so文件某个方法地址，找openMemory的内存地址</span></span><br><span class="line"><span class="string">var openMemory_address = Module.findExportByName(&quot;libart.so&quot;, &quot;_ZN3art7DexFile10OpenMemoryEPKhjRKNSt3__112basic_stringIcNS3_11char_traitsIcEENS3_9allocatorIcEEEEjPNS_6MemMapEPKNS_10OatDexFileEPS9_&quot;);</span></span><br><span class="line"><span class="string">send(&#x27;openMemory address:&#x27;+openMemory_address)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">//hook openMemory地址</span></span><br><span class="line"><span class="string">Interceptor.attach(openMemory_address, &#123;</span></span><br><span class="line"><span class="string">    //一进入openMemory，就会调用onEnter方法</span></span><br><span class="line"><span class="string">    onEnter: function (args) &#123;</span></span><br><span class="line"><span class="string">        //dex文件的起始位置</span></span><br><span class="line"><span class="string">        var dex_begin_address = args[1]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //dex文件的前8个字节是magic字段 看dex的文件格式说明</span></span><br><span class="line"><span class="string">        //打印magic（会显示 &quot;dex 035&quot;） 三个字符 可以验证是否为dex文件 </span></span><br><span class="line"><span class="string">        console.log(&quot;magic : &quot; + Memory.readUtf8String(dex_begin_address))</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //把地址转换成整型（十进制） 再加32 </span></span><br><span class="line"><span class="string">        //因为dex文件的第32个字节处存放的是 dex文件的大小</span></span><br><span class="line"><span class="string">        var address = parseInt(dex_begin_address, 16) + 0x20</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //把address地址指向的内存值读出来 该值就是dex的文件大小</span></span><br><span class="line"><span class="string">        //ptr(address)转换的原因是 frida只接受 NativePointer类型指针</span></span><br><span class="line"><span class="string">        var dex_size = Memory.readInt(ptr(address))</span></span><br><span class="line"><span class="string">        console.log(&quot;dex_size :&quot; + dex_size)</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        //frida写文件 把内存中的数据 写到本地</span></span><br><span class="line"><span class="string">        var timestamp = new Date().getTime();</span></span><br><span class="line"><span class="string">        var file = new File(&quot;/data/data/%s/&quot; + timestamp + &quot;.dex&quot;, &quot;wb&quot;)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        //Memory.readByteArray(begin, length)</span></span><br><span class="line"><span class="string">        //把内存里的数据读出来，从begin开始读，取length长度</span></span><br><span class="line"><span class="string">        file.write(Memory.readByteArray(dex_begin_address, dex_size))</span></span><br><span class="line"><span class="string">        file.flush()</span></span><br><span class="line"><span class="string">        file.close()</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        send(&quot;dex begin address:&quot;+parseInt(dex_begin_address,16))</span></span><br><span class="line"><span class="string">        send(&quot;dex file size:&quot;+dex_size)</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">    onLeave: function (retval) &#123;</span></span><br><span class="line"><span class="string">        if (retval.toInt32() &gt; 0) &#123;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>%(package)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;dex 导出目录为: /data/data/%s&quot;</span>%(package))</span><br><span class="line">device = frida.get_usb_device()</span><br><span class="line">pid = device.spawn(package)</span><br><span class="line">session = device.attach(pid)</span><br><span class="line">script = session.create_script(src)</span><br><span class="line">script.on(<span class="string">&quot;message&quot;</span> , on_message)</span><br><span class="line">script.load()</span><br><span class="line">device.resume(pid)</span><br><span class="line">sys.stdin.read()</span><br></pre></td></tr></table></figure>
<p>把frida-server运行起来<br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/16.webp"
                     
                ><br><br /> <br><br />hook需要app运行，先把app打开，再运行脚本，<br><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/17.webp"
                     
                ><br><br />我们去手机<code>/data/data/com.iCitySuzhou.suzhou001</code>目录下查看，会多了几个dex文件<br><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/18.webp"
                     
                ><br><br />把这些dex文件拉到电脑用jadx打开看下，一个个查看后，找到了源dex<br><br /><img  
                     lazyload
                     alt="image"
                     data-src="https://cdn.staticaly.com/gh/Zskkk/blog-images@master/20201029/19.webp"
                     
                ><br><br />到这里用frida脱壳也成功了。。。</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>壳的种类⾮常多，根据其种类不同，使⽤的技术也不同，这⾥稍微简单分个类：</p>
<ul>
<li>⼀代整体型壳：采⽤ Dex 整体加密，动态加载运⾏的机制；</li>
<li>⼆代函数抽取型壳：粒度更细，将⽅法单独抽取出来，加密保存，解密执⾏；</li>
<li>三代 VMP、Dex2C 壳：独⽴虚拟机解释执⾏、语义等价语法迁移，强度最⾼。</li>
</ul>
<p>先说最难的 Dex2C ⽬前是没有办法还原的，只能跟踪进⾏分析； VMP 虚拟机解释执⾏保护的是映射表，只要⼼思细、功夫深，是可以将映射表还原的；</p>
<p>⼆代壳函数抽取⽬前是可以从根本上进⾏还原的， dump 出所有的运⾏时的⽅法体，填充到 dump 下来的 dex 中去的，这也是fart的核⼼原理。</p>
<h3 id="frida-Dexdump"><a href="#frida-Dexdump" class="headerlink" title="frida-Dexdump"></a>frida-Dexdump</h3><p><a class="link"   href="https://github.com/hluwa/FRIDA-DEXDump" >https://github.com/hluwa/FRIDA-DEXDump<i class="fas fa-external-link-alt"></i></a></p>
<p>利⽤ frida 的搜索内存，通过匹配 DEX ⽂件的特征，例如 DEX ⽂件的 文件头 中的 magic — dex.035 这个特征。 frida-Dexdump 便是这种脱壳⽅法的代表作。</p>
<ul>
<li>对于于完整的 dex，采⽤暴⼒搜索 dex035 即可找到。</li>
<li>⽽对于抹头的 dex，通过匹配⼀些特征来找到，然后⾃动修复⽂件头。</li>
</ul>
<p>抽取 -&gt; invoke -&gt; 还原 -&gt; 再抽取</p>
]]></content>
      <tags>
        <tag>脱壳</tag>
      </tags>
  </entry>
</search>
